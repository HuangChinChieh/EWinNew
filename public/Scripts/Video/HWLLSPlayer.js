!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).HWLLSPlayer=t()}(this,(function(){function e(e,t){return t.forEach((function(t){Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}function t(e,t,r,n,i){var a={};return Object.keys(n).forEach((function(e){a[e]=n[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function i(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}function a(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var s=function(e){return e&&e.Math==Math&&e},o=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof r&&r)||function(){return this}()||Function("return this")(),l={},c=function(e){try{return!!e()}catch(t){return!0}},u=!c((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),d=!c((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),h=d,f=Function.prototype.call,p=h?f.bind(f):function(){return f.apply(f,arguments)},m={},g={}.propertyIsEnumerable,v=Object.getOwnPropertyDescriptor,y=v&&!g.call({1:2},1);m.f=y?function(e){var t=v(this,e);return!!t&&t.enumerable}:g;var _,E,S=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},b=d,T=Function.prototype,R=T.bind,A=T.call,w=b&&R.bind(A,A),L=b?function(e){return e&&w(e)}:function(e){return e&&function(){return A.apply(e,arguments)}},C=L,I=C({}.toString),k=C("".slice),O=function(e){return k(I(e),8,-1)},D=c,P=O,x=Object,M=L("".split),N=D((function(){return!x("z").propertyIsEnumerable(0)}))?function(e){return"String"==P(e)?M(e,""):x(e)}:x,F=TypeError,U=function(e){if(null==e)throw F("Can't call method on "+e);return e},B=N,j=U,H=function(e){return B(j(e))},V=function(e){return"function"==typeof e},G=V,z=function(e){return"object"==typeof e?null!==e:G(e)},K=o,W=V,Y=function(e,t){return arguments.length<2?(r=K[e],W(r)?r:void 0):K[e]&&K[e][t];var r},q=L({}.isPrototypeOf),Z=Y("navigator","userAgent")||"",X=o,J=Z,Q=X.process,$=X.Deno,ee=Q&&Q.versions||$&&$.version,te=ee&&ee.v8;te&&(E=(_=te.split("."))[0]>0&&_[0]<4?1:+(_[0]+_[1])),!E&&J&&(!(_=J.match(/Edge\/(\d+)/))||_[1]>=74)&&(_=J.match(/Chrome\/(\d+)/))&&(E=+_[1]);var re=E,ne=re,ie=c,ae=!!Object.getOwnPropertySymbols&&!ie((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ne&&ne<41})),se=ae&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,oe=Y,le=V,ce=q,ue=Object,de=se?function(e){return"symbol"==typeof e}:function(e){var t=oe("Symbol");return le(t)&&ce(t.prototype,ue(e))},he=String,fe=function(e){try{return he(e)}catch(t){return"Object"}},pe=V,me=fe,ge=TypeError,ve=function(e){if(pe(e))return e;throw ge(me(e)+" is not a function")},ye=ve,_e=function(e,t){var r=e[t];return null==r?void 0:ye(r)},Ee=p,Se=V,be=z,Te=TypeError,Re={exports:{}},Ae=o,we=Object.defineProperty,Le=function(e,t){try{we(Ae,e,{value:t,configurable:!0,writable:!0})}catch(r){Ae[e]=t}return t},Ce=Le,Ie="__core-js_shared__",ke=o[Ie]||Ce(Ie,{}),Oe=ke;(Re.exports=function(e,t){return Oe[e]||(Oe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.23.3",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"});var De=U,Pe=Object,xe=function(e){return Pe(De(e))},Me=xe,Ne=L({}.hasOwnProperty),Fe=Object.hasOwn||function(e,t){return Ne(Me(e),t)},Ue=L,Be=0,je=Math.random(),He=Ue(1..toString),Ve=function(e){return"Symbol("+(void 0===e?"":e)+")_"+He(++Be+je,36)},Ge=o,ze=Re.exports,Ke=Fe,We=Ve,Ye=ae,qe=se,Ze=ze("wks"),Xe=Ge.Symbol,Je=Xe&&Xe.for,Qe=qe?Xe:Xe&&Xe.withoutSetter||We,$e=function(e){if(!Ke(Ze,e)||!Ye&&"string"!=typeof Ze[e]){var t="Symbol."+e;Ye&&Ke(Xe,e)?Ze[e]=Xe[e]:Ze[e]=qe&&Je?Je(t):Qe(t)}return Ze[e]},et=p,tt=z,rt=de,nt=_e,it=function(e,t){var r,n;if("string"===t&&Se(r=e.toString)&&!be(n=Ee(r,e)))return n;if(Se(r=e.valueOf)&&!be(n=Ee(r,e)))return n;if("string"!==t&&Se(r=e.toString)&&!be(n=Ee(r,e)))return n;throw Te("Can't convert object to primitive value")},at=TypeError,st=$e("toPrimitive"),ot=function(e,t){if(!tt(e)||rt(e))return e;var r,n=nt(e,st);if(n){if(void 0===t&&(t="default"),r=et(n,e,t),!tt(r)||rt(r))return r;throw at("Can't convert object to primitive value")}return void 0===t&&(t="number"),it(e,t)},lt=ot,ct=de,ut=function(e){var t=lt(e,"string");return ct(t)?t:t+""},dt=z,ht=o.document,ft=dt(ht)&&dt(ht.createElement),pt=function(e){return ft?ht.createElement(e):{}},mt=pt,gt=!u&&!c((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),vt=u,yt=p,_t=m,Et=S,St=H,bt=ut,Tt=Fe,Rt=gt,At=Object.getOwnPropertyDescriptor;l.f=vt?At:function(e,t){if(e=St(e),t=bt(t),Rt)try{return At(e,t)}catch(r){}if(Tt(e,t))return Et(!yt(_t.f,e,t),e[t])};var wt={},Lt=u&&c((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ct=z,It=String,kt=TypeError,Ot=function(e){if(Ct(e))return e;throw kt(It(e)+" is not an object")},Dt=u,Pt=gt,xt=Lt,Mt=Ot,Nt=ut,Ft=TypeError,Ut=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,jt="enumerable",Ht="configurable",Vt="writable";wt.f=Dt?xt?function(e,t,r){if(Mt(e),t=Nt(t),Mt(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Vt in r&&!r[Vt]){var n=Bt(e,t);n&&n[Vt]&&(e[t]=r.value,r={configurable:Ht in r?r[Ht]:n[Ht],enumerable:jt in r?r[jt]:n[jt],writable:!1})}return Ut(e,t,r)}:Ut:function(e,t,r){if(Mt(e),t=Nt(t),Mt(r),Pt)try{return Ut(e,t,r)}catch(n){}if("get"in r||"set"in r)throw Ft("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var Gt=wt,zt=S,Kt=u?function(e,t,r){return Gt.f(e,t,zt(1,r))}:function(e,t,r){return e[t]=r,e},Wt={exports:{}},Yt=u,qt=Fe,Zt=Function.prototype,Xt=Yt&&Object.getOwnPropertyDescriptor,Jt=qt(Zt,"name"),Qt={EXISTS:Jt,PROPER:Jt&&"something"===function(){}.name,CONFIGURABLE:Jt&&(!Yt||Yt&&Xt(Zt,"name").configurable)},$t=V,er=ke,tr=L(Function.toString);$t(er.inspectSource)||(er.inspectSource=function(e){return tr(e)});var rr,nr,ir,ar=er.inspectSource,sr=V,or=ar,lr=o.WeakMap,cr=sr(lr)&&/native code/.test(or(lr)),ur=Re.exports,dr=Ve,hr=ur("keys"),fr=function(e){return hr[e]||(hr[e]=dr(e))},pr={},mr=cr,gr=o,vr=L,yr=z,_r=Kt,Er=Fe,Sr=ke,br=fr,Tr=pr,Rr="Object already initialized",Ar=gr.TypeError,wr=gr.WeakMap;if(mr||Sr.state){var Lr=Sr.state||(Sr.state=new wr),Cr=vr(Lr.get),Ir=vr(Lr.has),kr=vr(Lr.set);rr=function(e,t){if(Ir(Lr,e))throw new Ar(Rr);return t.facade=e,kr(Lr,e,t),t},nr=function(e){return Cr(Lr,e)||{}},ir=function(e){return Ir(Lr,e)}}else{var Or=br("state");Tr[Or]=!0,rr=function(e,t){if(Er(e,Or))throw new Ar(Rr);return t.facade=e,_r(e,Or,t),t},nr=function(e){return Er(e,Or)?e[Or]:{}},ir=function(e){return Er(e,Or)}}var Dr={set:rr,get:nr,has:ir,enforce:function(e){return ir(e)?nr(e):rr(e,{})},getterFor:function(e){return function(t){var r;if(!yr(t)||(r=nr(t)).type!==e)throw Ar("Incompatible receiver, "+e+" required");return r}}},Pr=c,xr=V,Mr=Fe,Nr=u,Fr=Qt.CONFIGURABLE,Ur=ar,Br=Dr.enforce,jr=Dr.get,Hr=Object.defineProperty,Vr=Nr&&!Pr((function(){return 8!==Hr((function(){}),"length",{value:8}).length})),Gr=String(String).split("String"),zr=Wt.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!Mr(e,"name")||Fr&&e.name!==t)&&(Nr?Hr(e,"name",{value:t,configurable:!0}):e.name=t),Vr&&r&&Mr(r,"arity")&&e.length!==r.arity&&Hr(e,"length",{value:r.arity});try{r&&Mr(r,"constructor")&&r.constructor?Nr&&Hr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var n=Br(e);return Mr(n,"source")||(n.source=Gr.join("string"==typeof t?t:"")),e};Function.prototype.toString=zr((function(){return xr(this)&&jr(this).source||Ur(this)}),"toString");var Kr=V,Wr=wt,Yr=Wt.exports,qr=Le,Zr=function(e,t,r,n){n||(n={});var i=n.enumerable,a=void 0!==n.name?n.name:t;if(Kr(r)&&Yr(r,a,n),n.global)i?e[t]=r:qr(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(s){}i?e[t]=r:Wr.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},Xr={},Jr=Math.ceil,Qr=Math.floor,$r=Math.trunc||function(e){var t=+e;return(t>0?Qr:Jr)(t)},en=function(e){var t=+e;return t!=t||0===t?0:$r(t)},tn=en,rn=Math.max,nn=Math.min,an=function(e,t){var r=tn(e);return r<0?rn(r+t,0):nn(r,t)},sn=en,on=Math.min,ln=function(e){return e>0?on(sn(e),9007199254740991):0},cn=ln,un=function(e){return cn(e.length)},dn=H,hn=an,fn=un,pn=function(e){return function(t,r,n){var i,a=dn(t),s=fn(a),o=hn(n,s);if(e&&r!=r){for(;s>o;)if((i=a[o++])!=i)return!0}else for(;s>o;o++)if((e||o in a)&&a[o]===r)return e||o||0;return!e&&-1}},mn={includes:pn(!0),indexOf:pn(!1)},gn=Fe,vn=H,yn=mn.indexOf,_n=pr,En=L([].push),Sn=function(e,t){var r,n=vn(e),i=0,a=[];for(r in n)!gn(_n,r)&&gn(n,r)&&En(a,r);for(;t.length>i;)gn(n,r=t[i++])&&(~yn(a,r)||En(a,r));return a},bn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Tn=Sn,Rn=bn.concat("length","prototype");Xr.f=Object.getOwnPropertyNames||function(e){return Tn(e,Rn)};var An={};An.f=Object.getOwnPropertySymbols;var wn=Y,Ln=Xr,Cn=An,In=Ot,kn=L([].concat),On=wn("Reflect","ownKeys")||function(e){var t=Ln.f(In(e)),r=Cn.f;return r?kn(t,r(e)):t},Dn=Fe,Pn=On,xn=l,Mn=wt,Nn=function(e,t,r){for(var n=Pn(t),i=Mn.f,a=xn.f,s=0;s<n.length;s++){var o=n[s];Dn(e,o)||r&&Dn(r,o)||i(e,o,a(t,o))}},Fn=c,Un=V,Bn=/#|\.prototype\./,jn=function(e,t){var r=Vn[Hn(e)];return r==zn||r!=Gn&&(Un(t)?Fn(t):!!t)},Hn=jn.normalize=function(e){return String(e).replace(Bn,".").toLowerCase()},Vn=jn.data={},Gn=jn.NATIVE="N",zn=jn.POLYFILL="P",Kn=jn,Wn=o,Yn=l.f,qn=Kt,Zn=Zr,Xn=Le,Jn=Nn,Qn=Kn,$n=function(e,t){var r,n,i,a,s,o=e.target,l=e.global,c=e.stat;if(r=l?Wn:c?Wn[o]||Xn(o,{}):(Wn[o]||{}).prototype)for(n in t){if(a=t[n],i=e.dontCallGetSet?(s=Yn(r,n))&&s.value:r[n],!Qn(l?n:o+(c?".":"#")+n,e.forced)&&void 0!==i){if(typeof a==typeof i)continue;Jn(a,i)}(e.sham||i&&i.sham)&&qn(a,"sham",!0),Zn(r,n,a,e)}},ei="process"==O(o.process),ti=V,ri=String,ni=TypeError,ii=L,ai=Ot,si=function(e){if("object"==typeof e||ti(e))return e;throw ni("Can't set "+ri(e)+" as a prototype")},oi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=ii(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return ai(r),si(n),t?e(r,n):r.__proto__=n,r}}():void 0),li=wt.f,ci=Fe,ui=$e("toStringTag"),di=function(e,t,r){e&&!r&&(e=e.prototype),e&&!ci(e,ui)&&li(e,ui,{configurable:!0,value:t})},hi=Y,fi=wt,pi=u,mi=$e("species"),gi=function(e){var t=hi(e),r=fi.f;pi&&t&&!t[mi]&&r(t,mi,{configurable:!0,get:function(){return this}})},vi=q,yi=TypeError,_i=function(e,t){if(vi(t,e))return e;throw yi("Incorrect invocation")},Ei={};Ei[$e("toStringTag")]="z";var Si="[object z]"===String(Ei),bi=V,Ti=O,Ri=$e("toStringTag"),Ai=Object,wi="Arguments"==Ti(function(){return arguments}()),Li=Si?Ti:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Ai(e),Ri))?r:wi?Ti(t):"Object"==(n=Ti(t))&&bi(t.callee)?"Arguments":n},Ci=L,Ii=c,ki=V,Oi=Li,Di=ar,Pi=function(){},xi=[],Mi=Y("Reflect","construct"),Ni=/^\s*(?:class|function)\b/,Fi=Ci(Ni.exec),Ui=!Ni.exec(Pi),Bi=function(e){if(!ki(e))return!1;try{return Mi(Pi,xi,e),!0}catch(t){return!1}},ji=function(e){if(!ki(e))return!1;switch(Oi(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ui||!!Fi(Ni,Di(e))}catch(t){return!0}};ji.sham=!0;var Hi,Vi,Gi,zi,Ki=!Mi||Ii((function(){var e;return Bi(Bi.call)||!Bi(Object)||!Bi((function(){e=!0}))||e}))?ji:Bi,Wi=Ki,Yi=fe,qi=TypeError,Zi=function(e){if(Wi(e))return e;throw qi(Yi(e)+" is not a constructor")},Xi=Ot,Ji=Zi,Qi=$e("species"),$i=function(e,t){var r,n=Xi(e).constructor;return void 0===n||null==(r=Xi(n)[Qi])?t:Ji(r)},ea=d,ta=Function.prototype,ra=ta.apply,na=ta.call,ia="object"==typeof Reflect&&Reflect.apply||(ea?na.bind(ra):function(){return na.apply(ra,arguments)}),aa=ve,sa=d,oa=L(L.bind),la=function(e,t){return aa(e),void 0===t?e:sa?oa(e,t):function(){return e.apply(t,arguments)}},ca=Y("document","documentElement"),ua=L([].slice),da=TypeError,ha=/(?:ipad|iphone|ipod).*applewebkit/i.test(Z),fa=o,pa=ia,ma=la,ga=V,va=Fe,ya=c,_a=ca,Ea=ua,Sa=pt,ba=function(e,t){if(e<t)throw da("Not enough arguments");return e},Ta=ha,Ra=ei,Aa=fa.setImmediate,wa=fa.clearImmediate,La=fa.process,Ca=fa.Dispatch,Ia=fa.Function,ka=fa.MessageChannel,Oa=fa.String,Da=0,Pa={},xa="onreadystatechange";try{Hi=fa.location}catch(Wk){}var Ma=function(e){if(va(Pa,e)){var t=Pa[e];delete Pa[e],t()}},Na=function(e){return function(){Ma(e)}},Fa=function(e){Ma(e.data)},Ua=function(e){fa.postMessage(Oa(e),Hi.protocol+"//"+Hi.host)};Aa&&wa||(Aa=function(e){ba(arguments.length,1);var t=ga(e)?e:Ia(e),r=Ea(arguments,1);return Pa[++Da]=function(){pa(t,void 0,r)},Vi(Da),Da},wa=function(e){delete Pa[e]},Ra?Vi=function(e){La.nextTick(Na(e))}:Ca&&Ca.now?Vi=function(e){Ca.now(Na(e))}:ka&&!Ta?(zi=(Gi=new ka).port2,Gi.port1.onmessage=Fa,Vi=ma(zi.postMessage,zi)):fa.addEventListener&&ga(fa.postMessage)&&!fa.importScripts&&Hi&&"file:"!==Hi.protocol&&!ya(Ua)?(Vi=Ua,fa.addEventListener("message",Fa,!1)):Vi=xa in Sa("script")?function(e){_a.appendChild(Sa("script"))[xa]=function(){_a.removeChild(this),Ma(e)}}:function(e){setTimeout(Na(e),0)});var Ba,ja,Ha,Va,Ga,za,Ka,Wa,Ya={set:Aa,clear:wa},qa=o,Za=/ipad|iphone|ipod/i.test(Z)&&void 0!==qa.Pebble,Xa=/web0s(?!.*chrome)/i.test(Z),Ja=o,Qa=la,$a=l.f,es=Ya.set,ts=ha,rs=Za,ns=Xa,is=ei,as=Ja.MutationObserver||Ja.WebKitMutationObserver,ss=Ja.document,os=Ja.process,ls=Ja.Promise,cs=$a(Ja,"queueMicrotask"),us=cs&&cs.value;us||(Ba=function(){var e,t;for(is&&(e=os.domain)&&e.exit();ja;){t=ja.fn,ja=ja.next;try{t()}catch(Wk){throw ja?Va():Ha=void 0,Wk}}Ha=void 0,e&&e.enter()},ts||is||ns||!as||!ss?!rs&&ls&&ls.resolve?((Ka=ls.resolve(void 0)).constructor=ls,Wa=Qa(Ka.then,Ka),Va=function(){Wa(Ba)}):is?Va=function(){os.nextTick(Ba)}:(es=Qa(es,Ja),Va=function(){es(Ba)}):(Ga=!0,za=ss.createTextNode(""),new as(Ba).observe(za,{characterData:!0}),Va=function(){za.data=Ga=!Ga}));var ds=us||function(e){var t={fn:e,next:void 0};Ha&&(Ha.next=t),ja||(ja=t,Va()),Ha=t},hs=o,fs=function(e){try{return{error:!1,value:e()}}catch(Wk){return{error:!0,value:Wk}}},ps=function(){this.head=null,this.tail=null};ps.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var ms=ps,gs=o.Promise,vs="object"==typeof window&&"object"!=typeof Deno,ys=o,_s=gs,Es=V,Ss=Kn,bs=ar,Ts=$e,Rs=vs,As=re;_s&&_s.prototype;var ws=Ts("species"),Ls=!1,Cs=Es(ys.PromiseRejectionEvent),Is=Ss("Promise",(function(){var e=bs(_s),t=e!==String(_s);if(!t&&66===As)return!0;if(As>=51&&/native code/.test(e))return!1;var r=new _s((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[ws]=n,!(Ls=r.then((function(){}))instanceof n)||!t&&Rs&&!Cs})),ks={CONSTRUCTOR:Is,REJECTION_EVENT:Cs,SUBCLASSING:Ls},Os={},Ds=ve,Ps=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=Ds(t),this.reject=Ds(r)};Os.f=function(e){return new Ps(e)};var xs,Ms,Ns,Fs=$n,Us=ei,Bs=o,js=p,Hs=Zr,Vs=oi,Gs=di,zs=gi,Ks=ve,Ws=V,Ys=z,qs=_i,Zs=$i,Xs=Ya.set,Js=ds,Qs=function(e,t){var r=hs.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},$s=fs,eo=ms,to=Dr,ro=gs,no=Os,io="Promise",ao=ks.CONSTRUCTOR,so=ks.REJECTION_EVENT,oo=ks.SUBCLASSING,lo=to.getterFor(io),co=to.set,uo=ro&&ro.prototype,ho=ro,fo=uo,po=Bs.TypeError,mo=Bs.document,go=Bs.process,vo=no.f,yo=vo,_o=!!(mo&&mo.createEvent&&Bs.dispatchEvent),Eo="unhandledrejection",So=function(e){var t;return!(!Ys(e)||!Ws(t=e.then))&&t},bo=function(e,t){var r,n,i,a=t.value,s=1==t.state,o=s?e.ok:e.fail,l=e.resolve,c=e.reject,u=e.domain;try{o?(s||(2===t.rejection&&Lo(t),t.rejection=1),!0===o?r=a:(u&&u.enter(),r=o(a),u&&(u.exit(),i=!0)),r===e.promise?c(po("Promise-chain cycle")):(n=So(r))?js(n,r,l,c):l(r)):c(a)}catch(Wk){u&&!i&&u.exit(),c(Wk)}},To=function(e,t){e.notified||(e.notified=!0,Js((function(){for(var r,n=e.reactions;r=n.get();)bo(r,e);e.notified=!1,t&&!e.rejection&&Ao(e)})))},Ro=function(e,t,r){var n,i;_o?((n=mo.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),Bs.dispatchEvent(n)):n={promise:t,reason:r},!so&&(i=Bs["on"+e])?i(n):e===Eo&&Qs("Unhandled promise rejection",r)},Ao=function(e){js(Xs,Bs,(function(){var t,r=e.facade,n=e.value;if(wo(e)&&(t=$s((function(){Us?go.emit("unhandledRejection",n,r):Ro(Eo,r,n)})),e.rejection=Us||wo(e)?2:1,t.error))throw t.value}))},wo=function(e){return 1!==e.rejection&&!e.parent},Lo=function(e){js(Xs,Bs,(function(){var t=e.facade;Us?go.emit("rejectionHandled",t):Ro("rejectionhandled",t,e.value)}))},Co=function(e,t,r){return function(n){e(t,n,r)}},Io=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,To(e,!0))},ko=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw po("Promise can't be resolved itself");var n=So(t);n?Js((function(){var r={done:!1};try{js(n,t,Co(ko,r,e),Co(Io,r,e))}catch(Wk){Io(r,Wk,e)}})):(e.value=t,e.state=1,To(e,!1))}catch(Wk){Io({done:!1},Wk,e)}}};if(ao&&(fo=(ho=function(e){qs(this,fo),Ks(e),js(xs,this);var t=lo(this);try{e(Co(ko,t),Co(Io,t))}catch(Wk){Io(t,Wk)}}).prototype,(xs=function(e){co(this,{type:io,done:!1,notified:!1,parent:!1,reactions:new eo,rejection:!1,state:0,value:void 0})}).prototype=Hs(fo,"then",(function(e,t){var r=lo(this),n=vo(Zs(this,ho));return r.parent=!0,n.ok=!Ws(e)||e,n.fail=Ws(t)&&t,n.domain=Us?go.domain:void 0,0==r.state?r.reactions.add(n):Js((function(){bo(n,r)})),n.promise})),Ms=function(){var e=new xs,t=lo(e);this.promise=e,this.resolve=Co(ko,t),this.reject=Co(Io,t)},no.f=vo=function(e){return e===ho||undefined===e?new Ms(e):yo(e)},Ws(ro)&&uo!==Object.prototype)){Ns=uo.then,oo||Hs(uo,"then",(function(e,t){var r=this;return new ho((function(e,t){js(Ns,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete uo.constructor}catch(Wk){}Vs&&Vs(uo,fo)}Fs({global:!0,constructor:!0,wrap:!0,forced:ao},{Promise:ho}),Gs(ho,io,!1),zs(io);var Oo={},Do=Oo,Po=$e("iterator"),xo=Array.prototype,Mo=function(e){return void 0!==e&&(Do.Array===e||xo[Po]===e)},No=Li,Fo=_e,Uo=Oo,Bo=$e("iterator"),jo=function(e){if(null!=e)return Fo(e,Bo)||Fo(e,"@@iterator")||Uo[No(e)]},Ho=p,Vo=ve,Go=Ot,zo=fe,Ko=jo,Wo=TypeError,Yo=function(e,t){var r=arguments.length<2?Ko(e):t;if(Vo(r))return Go(Ho(r,e));throw Wo(zo(e)+" is not iterable")},qo=p,Zo=Ot,Xo=_e,Jo=la,Qo=p,$o=Ot,el=fe,tl=Mo,rl=un,nl=q,il=Yo,al=jo,sl=function(e,t,r){var n,i;Zo(e);try{if(!(n=Xo(e,"return"))){if("throw"===t)throw r;return r}n=qo(n,e)}catch(Wk){i=!0,n=Wk}if("throw"===t)throw r;if(i)throw n;return Zo(n),r},ol=TypeError,ll=function(e,t){this.stopped=e,this.result=t},cl=ll.prototype,ul=function(e,t,r){var n,i,a,s,o,l,c,u=r&&r.that,d=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),p=Jo(t,u),m=function(e){return n&&sl(n,"normal",e),new ll(!0,e)},g=function(e){return d?($o(e),f?p(e[0],e[1],m):p(e[0],e[1])):f?p(e,m):p(e)};if(h)n=e;else{if(!(i=al(e)))throw ol(el(e)+" is not iterable");if(tl(i)){for(a=0,s=rl(e);s>a;a++)if((o=g(e[a]))&&nl(cl,o))return o;return new ll(!1)}n=il(e,i)}for(l=n.next;!(c=Qo(l,n)).done;){try{o=g(c.value)}catch(Wk){sl(n,"throw",Wk)}if("object"==typeof o&&o&&nl(cl,o))return o}return new ll(!1)},dl=$e("iterator"),hl=!1;try{var fl=0,pl={next:function(){return{done:!!fl++}},return:function(){hl=!0}};pl[dl]=function(){return this},Array.from(pl,(function(){throw 2}))}catch(Wk){}var ml=function(e,t){if(!t&&!hl)return!1;var r=!1;try{var n={};n[dl]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(Wk){}return r},gl=gs,vl=ks.CONSTRUCTOR||!ml((function(e){gl.all(e).then(void 0,(function(){}))})),yl=p,_l=ve,El=Os,Sl=fs,bl=ul;$n({target:"Promise",stat:!0,forced:vl},{all:function(e){var t=this,r=El.f(t),n=r.resolve,i=r.reject,a=Sl((function(){var r=_l(t.resolve),a=[],s=0,o=1;bl(e,(function(e){var l=s++,c=!1;o++,yl(r,t,e).then((function(e){c||(c=!0,a[l]=e,--o||n(a))}),i)})),--o||n(a)}));return a.error&&i(a.value),r.promise}});var Tl=$n,Rl=ks.CONSTRUCTOR,Al=gs,wl=Y,Ll=V,Cl=Zr,Il=Al&&Al.prototype;if(Tl({target:"Promise",proto:!0,forced:Rl,real:!0},{catch:function(e){return this.then(void 0,e)}}),Ll(Al)){var kl=wl("Promise").prototype.catch;Il.catch!==kl&&Cl(Il,"catch",kl,{unsafe:!0})}var Ol=p,Dl=ve,Pl=Os,xl=fs,Ml=ul;$n({target:"Promise",stat:!0,forced:vl},{race:function(e){var t=this,r=Pl.f(t),n=r.reject,i=xl((function(){var i=Dl(t.resolve);Ml(e,(function(e){Ol(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var Nl=p,Fl=Os;$n({target:"Promise",stat:!0,forced:ks.CONSTRUCTOR},{reject:function(e){var t=Fl.f(this);return Nl(t.reject,void 0,e),t.promise}});var Ul=Ot,Bl=z,jl=Os,Hl=function(e,t){if(Ul(e),Bl(t)&&t.constructor===e)return t;var r=jl.f(e);return(0,r.resolve)(t),r.promise},Vl=$n,Gl=ks.CONSTRUCTOR,zl=Hl;function Kl(e){return Kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kl(e)}function Wl(e){var t=function(e,t){if("object"!==Kl(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Kl(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Kl(t)?t:String(t)}function Yl(e,t,r){return(t=Wl(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Y("Promise"),Vl({target:"Promise",stat:!0,forced:Gl},{resolve:function(e){return zl(this,e)}});var ql=Li,Zl=String,Xl=function(e){if("Symbol"===ql(e))throw TypeError("Cannot convert a Symbol value to a string");return Zl(e)},Jl=Ot,Ql=function(){var e=Jl(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},$l=c,ec=o.RegExp,tc=$l((function(){var e=ec("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),rc=tc||$l((function(){return!ec("a","y").sticky})),nc={BROKEN_CARET:tc||$l((function(){var e=ec("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:rc,UNSUPPORTED_Y:tc},ic={},ac=Sn,sc=bn,oc=Object.keys||function(e){return ac(e,sc)},lc=u,cc=Lt,uc=wt,dc=Ot,hc=H,fc=oc;ic.f=lc&&!cc?Object.defineProperties:function(e,t){dc(e);for(var r,n=hc(t),i=fc(t),a=i.length,s=0;a>s;)uc.f(e,r=i[s++],n[r]);return e};var pc,mc=Ot,gc=ic,vc=bn,yc=pr,_c=ca,Ec=pt,Sc="prototype",bc="script",Tc=fr("IE_PROTO"),Rc=function(){},Ac=function(e){return"<"+bc+">"+e+"</"+bc+">"},wc=function(e){e.write(Ac("")),e.close();var t=e.parentWindow.Object;return e=null,t},Lc=function(){try{pc=new ActiveXObject("htmlfile")}catch(Wk){}var e,t,r;Lc="undefined"!=typeof document?document.domain&&pc?wc(pc):(t=Ec("iframe"),r="java"+bc+":",t.style.display="none",_c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(Ac("document.F=Object")),e.close(),e.F):wc(pc);for(var n=vc.length;n--;)delete Lc[Sc][vc[n]];return Lc()};yc[Tc]=!0;var Cc=Object.create||function(e,t){var r;return null!==e?(Rc[Sc]=mc(e),r=new Rc,Rc[Sc]=null,r[Tc]=e):r=Lc(),void 0===t?r:gc.f(r,t)},Ic=c,kc=o.RegExp,Oc=Ic((function(){var e=kc(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Dc=c,Pc=o.RegExp,xc=Dc((function(){var e=Pc("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Mc=p,Nc=L,Fc=Xl,Uc=Ql,Bc=nc,jc=Re.exports,Hc=Cc,Vc=Dr.get,Gc=Oc,zc=xc,Kc=jc("native-string-replace",String.prototype.replace),Wc=RegExp.prototype.exec,Yc=Wc,qc=Nc("".charAt),Zc=Nc("".indexOf),Xc=Nc("".replace),Jc=Nc("".slice),Qc=function(){var e=/a/,t=/b*/g;return Mc(Wc,e,"a"),Mc(Wc,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),$c=Bc.BROKEN_CARET,eu=void 0!==/()??/.exec("")[1];(Qc||eu||$c||Gc||zc)&&(Yc=function(e){var t,r,n,i,a,s,o,l=this,c=Vc(l),u=Fc(e),d=c.raw;if(d)return d.lastIndex=l.lastIndex,t=Mc(Yc,d,u),l.lastIndex=d.lastIndex,t;var h=c.groups,f=$c&&l.sticky,p=Mc(Uc,l),m=l.source,g=0,v=u;if(f&&(p=Xc(p,"y",""),-1===Zc(p,"g")&&(p+="g"),v=Jc(u,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==qc(u,l.lastIndex-1))&&(m="(?: "+m+")",v=" "+v,g++),r=new RegExp("^(?:"+m+")",p)),eu&&(r=new RegExp("^"+m+"$(?!\\s)",p)),Qc&&(n=l.lastIndex),i=Mc(Wc,f?r:l,v),f?i?(i.input=Jc(i.input,g),i[0]=Jc(i[0],g),i.index=l.lastIndex,l.lastIndex+=i[0].length):l.lastIndex=0:Qc&&i&&(l.lastIndex=l.global?i.index+i[0].length:n),eu&&i&&i.length>1&&Mc(Kc,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&h)for(i.groups=s=Hc(null),a=0;a<h.length;a++)s[(o=h[a])[0]]=i[o[1]];return i});var tu=Yc;$n({target:"RegExp",proto:!0,forced:/./.exec!==tu},{exec:tu});var ru=L,nu=Zr,iu=tu,au=c,su=$e,ou=Kt,lu=su("species"),cu=RegExp.prototype,uu=L,du=en,hu=Xl,fu=U,pu=uu("".charAt),mu=uu("".charCodeAt),gu=uu("".slice),vu=function(e){return function(t,r){var n,i,a=hu(fu(t)),s=du(r),o=a.length;return s<0||s>=o?e?"":void 0:(n=mu(a,s))<55296||n>56319||s+1===o||(i=mu(a,s+1))<56320||i>57343?e?pu(a,s):n:e?gu(a,s,s+2):i-56320+(n-55296<<10)+65536}},yu={codeAt:vu(!1),charAt:vu(!0)}.charAt,_u=L,Eu=xe,Su=Math.floor,bu=_u("".charAt),Tu=_u("".replace),Ru=_u("".slice),Au=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wu=/\$([$&'`]|\d{1,2})/g,Lu=p,Cu=Ot,Iu=V,ku=O,Ou=tu,Du=TypeError,Pu=ia,xu=p,Mu=L,Nu=function(e,t,r,n){var i=su(e),a=!au((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=a&&!au((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[lu]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!a||!s||r){var o=ru(/./[i]),l=t(i,""[e],(function(e,t,r,n,i){var s=ru(e),l=t.exec;return l===iu||l===cu.exec?a&&!i?{done:!0,value:o(t,r,n)}:{done:!0,value:s(r,t,n)}:{done:!1}}));nu(String.prototype,e,l[0]),nu(cu,i,l[1])}n&&ou(cu[i],"sham",!0)},Fu=c,Uu=Ot,Bu=V,ju=en,Hu=ln,Vu=Xl,Gu=U,zu=function(e,t,r){return t+(r?yu(e,t).length:1)},Ku=_e,Wu=function(e,t,r,n,i,a){var s=r+e.length,o=n.length,l=wu;return void 0!==i&&(i=Eu(i),l=Au),Tu(a,l,(function(a,l){var c;switch(bu(l,0)){case"$":return"$";case"&":return e;case"`":return Ru(t,0,r);case"'":return Ru(t,s);case"<":c=i[Ru(l,1,-1)];break;default:var u=+l;if(0===u)return a;if(u>o){var d=Su(u/10);return 0===d?a:d<=o?void 0===n[d-1]?bu(l,1):n[d-1]+bu(l,1):a}c=n[u-1]}return void 0===c?"":c}))},Yu=function(e,t){var r=e.exec;if(Iu(r)){var n=Lu(r,e,t);return null!==n&&Cu(n),n}if("RegExp"===ku(e))return Lu(Ou,e,t);throw Du("RegExp#exec called on incompatible receiver")},qu=$e("replace"),Zu=Math.max,Xu=Math.min,Ju=Mu([].concat),Qu=Mu([].push),$u=Mu("".indexOf),ed=Mu("".slice),td="$0"==="a".replace(/./,"$0"),rd=!!/./[qu]&&""===/./[qu]("a","$0");Nu("replace",(function(e,t,r){var n=rd?"$":"$0";return[function(e,r){var n=Gu(this),i=null==e?void 0:Ku(e,qu);return i?xu(i,e,n,r):xu(t,Vu(n),e,r)},function(e,i){var a=Uu(this),s=Vu(e);if("string"==typeof i&&-1===$u(i,n)&&-1===$u(i,"$<")){var o=r(t,a,s,i);if(o.done)return o.value}var l=Bu(i);l||(i=Vu(i));var c=a.global;if(c){var u=a.unicode;a.lastIndex=0}for(var d=[];;){var h=Yu(a,s);if(null===h)break;if(Qu(d,h),!c)break;""===Vu(h[0])&&(a.lastIndex=zu(s,Hu(a.lastIndex),u))}for(var f,p="",m=0,g=0;g<d.length;g++){for(var v=Vu((h=d[g])[0]),y=Zu(Xu(ju(h.index),s.length),0),_=[],E=1;E<h.length;E++)Qu(_,void 0===(f=h[E])?f:String(f));var S=h.groups;if(l){var b=Ju([v],_,y,s);void 0!==S&&Qu(b,S);var T=Vu(Pu(i,void 0,b))}else T=Wu(v,s,y,_,S,i);y>=m&&(p+=ed(s,m,y)+T,m=y+v.length)}return p+ed(s,m)}]}),!!Fu((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!td||rd);var nd="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},id=[],ad=[],sd="undefined"!=typeof Uint8Array?Uint8Array:Array,od=!1;function ld(){od=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)id[t]=e[t],ad[e.charCodeAt(t)]=t;ad["-".charCodeAt(0)]=62,ad["_".charCodeAt(0)]=63}function cd(e,t,r){for(var n,i,a=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],a.push(id[(i=n)>>18&63]+id[i>>12&63]+id[i>>6&63]+id[63&i]);return a.join("")}function ud(e){var t;od||ld();for(var r=e.length,n=r%3,i="",a=[],s=16383,o=0,l=r-n;o<l;o+=s)a.push(cd(e,o,o+s>l?l:o+s));return 1===n?(t=e[r-1],i+=id[t>>2],i+=id[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=id[t>>10],i+=id[t>>4&63],i+=id[t<<2&63],i+="="),a.push(i),a.join("")}function dd(e,t,r,n,i){var a,s,o=8*i-n-1,l=(1<<o)-1,c=l>>1,u=-7,d=r?i-1:0,h=r?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-u)-1,f>>=-u,u+=o;u>0;a=256*a+e[t+d],d+=h,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=n;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===a)a=1-c;else{if(a===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),a-=c}return(f?-1:1)*s*Math.pow(2,a-n)}function hd(e,t,r,n,i,a){var s,o,l,c=8*a-i-1,u=(1<<c)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=u?(o=0,s=u):s+d>=1?(o=(t*l-1)*Math.pow(2,i),s+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(s=s<<i|o,c+=i;c>0;e[r+f]=255&s,f+=p,s/=256,c-=8);e[r+f-p]|=128*m}var fd={}.toString,pd=Array.isArray||function(e){return"[object Array]"==fd.call(e)};yd.TYPED_ARRAY_SUPPORT=void 0===nd.TYPED_ARRAY_SUPPORT||nd.TYPED_ARRAY_SUPPORT;var md=gd();function gd(){return yd.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function vd(e,t){if(gd()<t)throw new RangeError("Invalid typed array length");return yd.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=yd.prototype:(null===e&&(e=new yd(t)),e.length=t),e}function yd(e,t,r){if(!(yd.TYPED_ARRAY_SUPPORT||this instanceof yd))return new yd(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Sd(this,e)}return _d(this,e,t,r)}function _d(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);yd.TYPED_ARRAY_SUPPORT?(e=t).__proto__=yd.prototype:e=bd(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!yd.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|Ad(t,r);e=vd(e,n);var i=e.write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(Rd(t)){var r=0|Td(t.length);return 0===(e=vd(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?vd(e,0):bd(e,t);if("Buffer"===t.type&&pd(t.data))return bd(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Ed(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Sd(e,t){if(Ed(t),e=vd(e,t<0?0:0|Td(t)),!yd.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function bd(e,t){var r=t.length<0?0:0|Td(t.length);e=vd(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function Td(e){if(e>=gd())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+gd().toString(16)+" bytes");return 0|e}function Rd(e){return!(null==e||!e._isBuffer)}function Ad(e,t){if(Rd(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Qd(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return $d(e).length;default:if(n)return Qd(e).length;t=(""+t).toLowerCase(),n=!0}}function wd(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Hd(this,t,r);case"utf8":case"utf-8":return Fd(this,t,r);case"ascii":return Bd(this,t,r);case"latin1":case"binary":return jd(this,t,r);case"base64":return Nd(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Vd(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function Ld(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Cd(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=yd.from(t,n)),Rd(t))return 0===t.length?-1:Id(e,t,r,n,i);if("number"==typeof t)return t&=255,yd.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):Id(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function Id(e,t,r,n,i){var a,s=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(a=r;a<o;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*s}else-1!==u&&(a-=a-u),u=-1}else for(r+l>o&&(r=o-l),a=r;a>=0;a--){for(var d=!0,h=0;h<l;h++)if(c(e,a+h)!==c(t,h)){d=!1;break}if(d)return a}return-1}function kd(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(isNaN(o))return s;e[r+s]=o}return s}function Od(e,t,r,n){return eh(Qd(t,e.length-r),e,r,n)}function Dd(e,t,r,n){return eh(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function Pd(e,t,r,n){return Dd(e,t,r,n)}function xd(e,t,r,n){return eh($d(t),e,r,n)}function Md(e,t,r,n){return eh(function(e,t){for(var r,n,i,a=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function Nd(e,t,r){return 0===t&&r===e.length?ud(e):ud(e.slice(t,r))}function Fd(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,l,c=e[i],u=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=r)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&c)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&c)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=d}return function(e){var t=e.length;if(t<=Ud)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Ud));return r}(n)}yd.poolSize=8192,yd._augment=function(e){return e.__proto__=yd.prototype,e},yd.from=function(e,t,r){return _d(null,e,t,r)},yd.TYPED_ARRAY_SUPPORT&&(yd.prototype.__proto__=Uint8Array.prototype,yd.__proto__=Uint8Array),yd.alloc=function(e,t,r){return function(e,t,r,n){return Ed(t),t<=0?vd(e,t):void 0!==r?"string"==typeof n?vd(e,t).fill(r,n):vd(e,t).fill(r):vd(e,t)}(null,e,t,r)},yd.allocUnsafe=function(e){return Sd(null,e)},yd.allocUnsafeSlow=function(e){return Sd(null,e)},yd.isBuffer=th,yd.compare=function(e,t){if(!Rd(e)||!Rd(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},yd.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},yd.concat=function(e,t){if(!pd(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return yd.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=yd.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!Rd(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},yd.byteLength=Ad,yd.prototype._isBuffer=!0,yd.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Ld(this,t,t+1);return this},yd.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Ld(this,t,t+3),Ld(this,t+1,t+2);return this},yd.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Ld(this,t,t+7),Ld(this,t+1,t+6),Ld(this,t+2,t+5),Ld(this,t+3,t+4);return this},yd.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Fd(this,0,e):wd.apply(this,arguments)},yd.prototype.equals=function(e){if(!Rd(e))throw new TypeError("Argument must be a Buffer");return this===e||0===yd.compare(this,e)},yd.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},yd.prototype.compare=function(e,t,r,n,i){if(!Rd(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),o=Math.min(a,s),l=this.slice(n,i),c=e.slice(t,r),u=0;u<o;++u)if(l[u]!==c[u]){a=l[u],s=c[u];break}return a<s?-1:s<a?1:0},yd.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},yd.prototype.indexOf=function(e,t,r){return Cd(this,e,t,r,!0)},yd.prototype.lastIndexOf=function(e,t,r){return Cd(this,e,t,r,!1)},yd.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return kd(this,e,t,r);case"utf8":case"utf-8":return Od(this,e,t,r);case"ascii":return Dd(this,e,t,r);case"latin1":case"binary":return Pd(this,e,t,r);case"base64":return xd(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Md(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},yd.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ud=4096;function Bd(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function jd(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function Hd(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=Jd(e[a]);return i}function Vd(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function Gd(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function zd(e,t,r,n,i,a){if(!Rd(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Kd(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Wd(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function Yd(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function qd(e,t,r,n,i){return i||Yd(e,0,r,4),hd(e,t,r,n,23,4),r+4}function Zd(e,t,r,n,i){return i||Yd(e,0,r,8),hd(e,t,r,n,52,8),r+8}yd.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),yd.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=yd.prototype;else{var i=t-e;r=new yd(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},yd.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||Gd(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},yd.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||Gd(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},yd.prototype.readUInt8=function(e,t){return t||Gd(e,1,this.length),this[e]},yd.prototype.readUInt16LE=function(e,t){return t||Gd(e,2,this.length),this[e]|this[e+1]<<8},yd.prototype.readUInt16BE=function(e,t){return t||Gd(e,2,this.length),this[e]<<8|this[e+1]},yd.prototype.readUInt32LE=function(e,t){return t||Gd(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},yd.prototype.readUInt32BE=function(e,t){return t||Gd(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},yd.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||Gd(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},yd.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||Gd(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},yd.prototype.readInt8=function(e,t){return t||Gd(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},yd.prototype.readInt16LE=function(e,t){t||Gd(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},yd.prototype.readInt16BE=function(e,t){t||Gd(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},yd.prototype.readInt32LE=function(e,t){return t||Gd(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},yd.prototype.readInt32BE=function(e,t){return t||Gd(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},yd.prototype.readFloatLE=function(e,t){return t||Gd(e,4,this.length),dd(this,e,!0,23,4)},yd.prototype.readFloatBE=function(e,t){return t||Gd(e,4,this.length),dd(this,e,!1,23,4)},yd.prototype.readDoubleLE=function(e,t){return t||Gd(e,8,this.length),dd(this,e,!0,52,8)},yd.prototype.readDoubleBE=function(e,t){return t||Gd(e,8,this.length),dd(this,e,!1,52,8)},yd.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||zd(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},yd.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||zd(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},yd.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,1,255,0),yd.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},yd.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,2,65535,0),yd.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Kd(this,e,t,!0),t+2},yd.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,2,65535,0),yd.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Kd(this,e,t,!1),t+2},yd.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,4,4294967295,0),yd.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Wd(this,e,t,!0),t+4},yd.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,4,4294967295,0),yd.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Wd(this,e,t,!1),t+4},yd.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);zd(this,e,t,r,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},yd.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);zd(this,e,t,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},yd.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,1,127,-128),yd.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},yd.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,2,32767,-32768),yd.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Kd(this,e,t,!0),t+2},yd.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,2,32767,-32768),yd.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Kd(this,e,t,!1),t+2},yd.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,4,2147483647,-2147483648),yd.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Wd(this,e,t,!0),t+4},yd.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||zd(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),yd.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Wd(this,e,t,!1),t+4},yd.prototype.writeFloatLE=function(e,t,r){return qd(this,e,t,!0,r)},yd.prototype.writeFloatBE=function(e,t,r){return qd(this,e,t,!1,r)},yd.prototype.writeDoubleLE=function(e,t,r){return Zd(this,e,t,!0,r)},yd.prototype.writeDoubleBE=function(e,t,r){return Zd(this,e,t,!1,r)},yd.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!yd.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},yd.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!yd.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=Rd(e)?e:Qd(new yd(e,n).toString()),o=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%o]}return this};var Xd=/[^+\/0-9A-Za-z-_]/g;function Jd(e){return e<16?"0"+e.toString(16):e.toString(16)}function Qd(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function $d(e){return function(e){var t,r,n,i,a,s;od||ld();var o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a="="===e[o-2]?2:"="===e[o-1]?1:0,s=new sd(3*o/4-a),n=a>0?o-4:o;var l=0;for(t=0,r=0;t<n;t+=4,r+=3)i=ad[e.charCodeAt(t)]<<18|ad[e.charCodeAt(t+1)]<<12|ad[e.charCodeAt(t+2)]<<6|ad[e.charCodeAt(t+3)],s[l++]=i>>16&255,s[l++]=i>>8&255,s[l++]=255&i;return 2===a?(i=ad[e.charCodeAt(t)]<<2|ad[e.charCodeAt(t+1)]>>4,s[l++]=255&i):1===a&&(i=ad[e.charCodeAt(t)]<<10|ad[e.charCodeAt(t+1)]<<4|ad[e.charCodeAt(t+2)]>>2,s[l++]=i>>8&255,s[l++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Xd,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function eh(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function th(e){return null!=e&&(!!e._isBuffer||rh(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&rh(e.slice(0,0))}(e))}function rh(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var nh=Object.freeze({__proto__:null,INSPECT_MAX_BYTES:50,kMaxLength:md,Buffer:yd,SlowBuffer:function(e){return+e!=e&&(e=0),yd.alloc(+e)},isBuffer:th});function ih(){throw new Error("setTimeout has not been defined")}function ah(){throw new Error("clearTimeout has not been defined")}var sh=ih,oh=ah;function lh(e){if(sh===setTimeout)return setTimeout(e,0);if((sh===ih||!sh)&&setTimeout)return sh=setTimeout,setTimeout(e,0);try{return sh(e,0)}catch(t){try{return sh.call(null,e,0)}catch(t){return sh.call(this,e,0)}}}"function"==typeof nd.setTimeout&&(sh=setTimeout),"function"==typeof nd.clearTimeout&&(oh=clearTimeout);var ch,uh=[],dh=!1,hh=-1;function fh(){dh&&ch&&(dh=!1,ch.length?uh=ch.concat(uh):hh=-1,uh.length&&ph())}function ph(){if(!dh){var e=lh(fh);dh=!0;for(var t=uh.length;t;){for(ch=uh,uh=[];++hh<t;)ch&&ch[hh].run();hh=-1,t=uh.length}ch=null,dh=!1,function(e){if(oh===clearTimeout)return clearTimeout(e);if((oh===ah||!oh)&&clearTimeout)return oh=clearTimeout,clearTimeout(e);try{return oh(e)}catch(t){try{return oh.call(null,e)}catch(t){return oh.call(this,e)}}}(e)}}function mh(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];uh.push(new gh(e,t)),1!==uh.length||dh||lh(ph)}function gh(e,t){this.fun=e,this.array=t}gh.prototype.run=function(){this.fun.apply(null,this.array)};function vh(){}var yh=vh,_h=vh,Eh=vh,Sh=vh,bh=vh,Th=vh,Rh=vh;var Ah=nd.performance||{},wh=Ah.now||Ah.mozNow||Ah.msNow||Ah.oNow||Ah.webkitNow||function(){return(new Date).getTime()};var Lh=new Date;var Ch={nextTick:mh,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:yh,addListener:_h,once:Eh,off:Sh,removeListener:bh,removeAllListeners:Th,emit:Rh,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*wh.call(Ah),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Lh)/1e3}},Ih={exports:{}};!function(e,t){e.exports=function e(t,r,n){function i(o,l){if(!r[o]){if(!t[o]){if(!l&&a)return a(o);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[o]={exports:{}};t[o][0].call(u.exports,(function(e){return i(t[o][1][e]||e)}),u,u.exports,e,t,r,n)}return r[o].exports}for(var s=a,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){var n=e("./utils"),i=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,s,o,l,c,u=[],d=0,h=e.length,f=h,p="string"!==n.getTypeOf(e);d<e.length;)f=h-d,i=p?(t=e[d++],r=d<h?e[d++]:0,d<h?e[d++]:0):(t=e.charCodeAt(d++),r=d<h?e.charCodeAt(d++):0,d<h?e.charCodeAt(d++):0),s=t>>2,o=(3&t)<<4|r>>4,l=1<f?(15&r)<<2|i>>6:64,c=2<f?63&i:64,u.push(a.charAt(s)+a.charAt(o)+a.charAt(l)+a.charAt(c));return u.join("")},r.decode=function(e){var t,r,n,s,o,l,c=0,u=0,d="data:";if(e.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var h,f=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===a.charAt(64)&&f--,e.charAt(e.length-2)===a.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=i.uint8array?new Uint8Array(0|f):new Array(0|f);c<e.length;)t=a.indexOf(e.charAt(c++))<<2|(s=a.indexOf(e.charAt(c++)))>>4,r=(15&s)<<4|(o=a.indexOf(e.charAt(c++)))>>2,n=(3&o)<<6|(l=a.indexOf(e.charAt(c++))),h[u++]=t,64!==o&&(h[u++]=r),64!==l&&(h[u++]=n);return h}},{"./support":30,"./utils":32}],2:[function(e,t,r){var n=e("./external"),i=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),s=e("./stream/DataLengthProbe");function o(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}o.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,r){return e.pipe(new a).pipe(new s("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){var n=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(e){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){var n=e("./utils"),i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r,n){var a=i,s=n+r;e^=-1;for(var o=n;o<s;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}(0|t,e,e.length,0):function(e,t,r,n){var a=i,s=n+r;e^=-1;for(var o=n;o<s;o++)e=e>>>8^a[255&(e^t.charCodeAt(o))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){var n=null;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),a=e("./utils"),s=e("./stream/GenericWorker"),o=n?"uint8array":"array";function l(e,t){s.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",a.inherits(l,s),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(o,e.data),!1)},l.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new l("Deflate",e)},r.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){function n(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function i(e,t,r,i,s,u){var d,h,f=e.file,p=e.compression,m=u!==o.utf8encode,g=a.transformTo("string",u(f.name)),v=a.transformTo("string",o.utf8encode(f.name)),y=f.comment,_=a.transformTo("string",u(y)),E=a.transformTo("string",o.utf8encode(y)),S=v.length!==f.name.length,b=E.length!==y.length,T="",R="",A="",w=f.dir,L=f.date,C={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(C.crc32=e.crc32,C.compressedSize=e.compressedSize,C.uncompressedSize=e.uncompressedSize);var I=0;t&&(I|=8),m||!S&&!b||(I|=2048);var k=0,O=0;w&&(k|=16),"UNIX"===s?(O=798,k|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(f.unixPermissions,w)):(O=20,k|=function(e){return 63&(e||0)}(f.dosPermissions)),d=L.getUTCHours(),d<<=6,d|=L.getUTCMinutes(),d<<=5,d|=L.getUTCSeconds()/2,h=L.getUTCFullYear()-1980,h<<=4,h|=L.getUTCMonth()+1,h<<=5,h|=L.getUTCDate(),S&&(R=n(1,1)+n(l(g),4)+v,T+="up"+n(R.length,2)+R),b&&(A=n(1,1)+n(l(_),4)+E,T+="uc"+n(A.length,2)+A);var D="";return D+="\n\0",D+=n(I,2),D+=p.magic,D+=n(d,2),D+=n(h,2),D+=n(C.crc32,4),D+=n(C.compressedSize,4),D+=n(C.uncompressedSize,4),D+=n(g.length,2),D+=n(T.length,2),{fileRecord:c.LOCAL_FILE_HEADER+D+g+T,dirRecord:c.CENTRAL_FILE_HEADER+n(O,2)+D+n(_.length,2)+"\0\0\0\0"+n(k,4)+n(i,4)+g+T+_}}var a=e("../utils"),s=e("../stream/GenericWorker"),o=e("../utf8"),l=e("../crc32"),c=e("../signature");function u(e,t,r,n){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(u,s),u.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,s.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return c.DATA_DESCRIPTOR+n(e.crc32,4)+n(e.compressedSize,4)+n(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=function(e,t,r,i,s){var o=a.transformTo("string",s(i));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(e,2)+n(e,2)+n(t,4)+n(r,4)+n(o.length,2)+o}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},u.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!s.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},u.prototype.lock=function(){s.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){var n=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var a=new i(t.streamFiles,r,t.platform,t.encodeFileName),s=0;try{e.forEach((function(e,r){s++;var i=function(e,t){var r=e||t,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,t.compression),o=r.options.compressionOptions||t.compressionOptions||{},l=r.dir,c=r.date;r._compressWorker(i,o).withStreamInfo("file",{name:e,dir:l,date:c,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(a)})),a.entriesCount=s}catch(e){a.error(e)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.0",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){var n=e("./utils"),i=e("./external"),a=e("./utf8"),s=e("./zipEntries"),o=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new i.Promise((function(t,r){var n=e.decompressed.getContentWorker().pipe(new o);n.on("error",(function(e){r(e)})).on("end",(function(){n.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new s(t);return r.load(e),r})).then((function(e){var r=[i.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var a=0;a<n.length;a++)r.push(c(n[a]));return i.Promise.all(r)})).then((function(e){for(var i=e.shift(),a=i.files,s=0;s<a.length;s++){var o=a[s],l=o.fileNameStr,c=n.resolve(o.fileNameStr);r.file(c,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders}),o.dir||(r.file(c).unsafeOriginalName=l)}return i.zipComment.length&&(r.comment=i.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){var n=e("../utils"),i=e("../stream/GenericWorker");function a(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(a,i),a.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},a.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){var n=e("readable-stream").Readable;function i(e,t,r){n.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),r&&r(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){t.exports={isNode:void 0!==yd,newBufferFrom:function(e,t){if(yd.from&&yd.from!==Uint8Array.from)return yd.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new yd(e,t)},allocBuffer:function(e){if(yd.alloc)return yd.alloc(e);var t=new yd(e);return t.fill(0),t},isBuffer:function(e){return th(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){function n(e,t,r){var n,i=a.getTypeOf(t),o=a.extend(r||{},l);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(e=m(e)),o.createFolders&&(n=p(e))&&g.call(this,n,!0);var d="string"===i&&!1===o.binary&&!1===o.base64;r&&void 0!==r.binary||(o.binary=!d),(t instanceof c&&0===t.uncompressedSize||o.dir||!t||0===t.length)&&(o.base64=!1,o.binary=!0,t="",o.compression="STORE",i="string");var v=null;v=t instanceof c||t instanceof s?t:h.isNode&&h.isStream(t)?new f(e,t):a.prepareContent(e,t,o.binary,o.optimizedBinaryString,o.base64);var y=new u(e,v,o);this.files[e]=y}var i=e("./utf8"),a=e("./utils"),s=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),l=e("./defaults"),c=e("./compressedObject"),u=e("./zipObject"),d=e("./generate"),h=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:l.createFolders,e=m(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function v(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n)},filter:function(e){var t=[];return this.forEach((function(r,n){e(r,n)&&t.push(n)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,n.call(this,e,t,r),this;if(v(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var a=this.files[this.root+e];return a&&!a.dir?a:null},folder:function(e){if(!e)return this;if(v(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=g.call(this,t),n=this.clone();return n.root=r.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=a.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");a.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";t=d.generateWorker(this,r,n)}catch(e){(t=new s("error")).error(e)}return new o(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){var n=e("./DataReader");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===n&&this.data[a+3]===i)return a-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&r===a[1]&&n===a[2]&&i===a[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){var n=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){var n=e("./Uint8ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){var n=e("./DataReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){var n=e("./ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){var n=e("../utils"),i=e("../support"),a=e("./ArrayReader"),s=e("./StringReader"),o=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new o(e):i.uint8array?new l(n.transformTo("uint8array",e)):new a(n.transformTo("array",e)):new s(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){var n=e("./GenericWorker"),i=e("../utils");function a(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(a,n),a.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){var n=e("./GenericWorker"),i=e("../crc32");function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,n),a.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){var n=e("../utils"),i=e("./GenericWorker");function a(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(a,i),a.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){var n=e("../utils"),i=e("./GenericWorker");function a(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}n.inherits(a,i),a.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t,r){var n=e("../utils"),i=e("./ConvertWorker"),a=e("./GenericWorker"),s=e("../base64"),o=e("../support"),l=e("../external"),c=null;if(o.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function u(e,t){return new l.Promise((function(r,i){var a=[],o=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",(function(e,r){a.push(e),t&&t(r)})).on("error",(function(e){a=[],i(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return n.newBlob(n.transformTo("arraybuffer",t),r);case"base64":return s.encode(t);default:return n.transformTo(e,t)}}(l,function(e,t){var r,n=0,i=null,a=0;for(r=0;r<t.length;r++)a+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(a),r=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i;case"nodebuffer":return yd.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(o,a),c);r(e)}catch(e){i(e)}a=[]})).resume()}))}function d(e,t,r){var s=t;switch(t){case"blob":case"arraybuffer":s="uint8array";break;case"base64":s="string"}try{this._internalType=s,this._outputType=t,this._mimeType=r,n.checkSupport(s),this._worker=e.pipe(new i(s)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}d.prototype={accumulate:function(e){return u(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){n.delay(t,arguments,r)})),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==yd,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),r.blob=0===i.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){for(var n=e("./utils"),i=e("./support"),a=e("./nodejsUtils"),s=e("./stream/GenericWorker"),o=new Array(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){s.call(this,"utf-8 decode"),this.leftOver=null}function u(){s.call(this,"utf-8 encode")}o[254]=o[254]=1,r.utf8encode=function(e){return i.nodebuffer?a.newBufferFrom(e,"utf-8"):function(e){var t,r,n,a,s,o=e.length,l=0;for(a=0;a<o;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),a=s=0;s<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t}(e)},r.utf8decode=function(e){return i.nodebuffer?n.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,i,a,s=e.length,l=new Array(2*s);for(t=r=0;t<s;)if((i=e[t++])<128)l[r++]=i;else if(4<(a=o[i]))l[r++]=65533,t+=a-1;else{for(i&=2===a?31:3===a?15:7;1<a&&t<s;)i=i<<6|63&e[t++],a--;1<a?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)}(e=n.transformTo(i.uint8array?"uint8array":"array",e))},n.inherits(c,s),c.prototype.processChunk=function(e){var t=n.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var a=t;(t=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),t.set(a,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var s=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}(t),l=t;s!==t.length&&(i.uint8array?(l=t.subarray(0,s),this.leftOver=t.subarray(s,t.length)):(l=t.slice(0,s),this.leftOver=t.slice(s,t.length))),this.push({data:r.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=c,n.inherits(u,s),u.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){var n=e("./support"),i=e("./base64"),a=e("./nodejsUtils"),s=e("./external");function o(e){return e}function l(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e("setimmediate"),r.newBlob=function(t,n){r.checkSupport("blob");try{return new Blob([t],{type:n})}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(t),i.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,r){var n=[],i=0,a=e.length;if(a<=r)return String.fromCharCode.apply(null,e);for(;i<a;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,a)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,a)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,n=r.getTypeOf(e),i=!0;if("uint8array"===n?i=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=c.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return c.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function d(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=u;var h={};h.string={string:o,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,a.allocBuffer(e.length))}},h.array={string:u,array:o,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a.newBufferFrom(e)}},h.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:o,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a.newBufferFrom(new Uint8Array(e))}},h.uint8array={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:o,nodebuffer:function(e){return a.newBufferFrom(e)}},h.nodebuffer={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:o},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return h[n][e](t)},r.resolve=function(e){for(var t=e.split("/"),r=[],n=0;n<t.length;n++){var i=t[n];"."===i||""===i&&0!==n&&n!==t.length-1||(".."===i?r.pop():r.push(i))}return r.join("/")},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":n.nodebuffer&&a.isBuffer(e)?"nodebuffer":n.uint8array&&e instanceof Uint8Array?"uint8array":n.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!n[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},r.delay=function(e,t,r){setImmediate((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,a,o,c){return s.Promise.resolve(t).then((function(e){return n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new s.Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){r(e.target.error)},n.readAsArrayBuffer(e)})):e})).then((function(t){var u=r.getTypeOf(t);return u?("arraybuffer"===u?t=r.transformTo("uint8array",t):"string"===u&&(c?t=i.decode(t):a&&!0!==o&&(t=function(e){return l(e,n.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):s.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){var n=e("./reader/readerFor"),i=e("./utils"),a=e("./signature"),s=e("./zipEntry"),o=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(e=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,a.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){var n=e("./reader/readerFor"),i=e("./utils"),a=e("./compressedObject"),s=e("./crc32"),o=e("./utf8"),l=e("./compressions"),c=e("./support");function u(e,t){this.options=e,this.loadOptions=t}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var a=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)||s(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)||s(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var i=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),s=e("./utf8"),o=e("./compressedObject"),l=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var a=!this._dataBinary;a&&!n&&(t=t.pipe(new s.Utf8EncodeWorker)),!a&&n&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new i(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<c.length;d++)n.prototype[c[d]]=u;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var a=0,s=new i(u),o=e.document.createTextNode("");s.observe(o,{characterData:!0}),r=function(){o.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}t.exports=function(e){1!==c.push(e)||n||r()}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){var n=e("immediate");function i(){}var a={},s=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n((function(){var n;try{n=t(r)}catch(n){return a.reject(e,n)}n===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function n(t){r||(r=!0,a.reject(e,t))}function i(t){r||(r=!0,a.resolve(e,t))}var s=p((function(){t(i,n)}));"error"===s.status&&n(s.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=c).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(i);return this.state!==l?d(r,this.state===o?e:t,this.outcome):this.queue.push(new u(r,e,t)),r},u.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){a.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},a.resolve=function(e,t){var r=p(h,t);if("error"===r.status)return a.reject(e,r.value);var n=r.value;if(n)f(e,n);else{e.state=o,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:a.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return a.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var s=new Array(r),o=0,l=-1,c=new this(i);++l<r;)u(e[l],l);return c;function u(e,i){t.resolve(e).then((function(e){s[i]=e,++o!==r||n||(n=!0,a.resolve(c,s))}),(function(e){n||(n=!0,a.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var s,o=-1,l=new this(i);++o<r;)s=e[o],t.resolve(s).then((function(e){n||(n=!0,a.resolve(l,e))}),(function(e){n||(n=!0,a.reject(l,e))}));return l}},{immediate:36}],38:[function(e,t,r){var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){var n=e("./zlib/deflate"),i=e("./utils/common"),a=e("./utils/strings"),s=e("./zlib/messages"),o=e("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,d=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:u,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(s[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,p))!==c)throw new Error(s[r]);this._dict_set=!0}}function p(e,t){var r=new f(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}f.prototype.push=function(e,t){var r,s,o=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?o.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new i.Buf8(u),o.next_out=0,o.avail_out=u),1!==(r=n.deflate(o,s))&&r!==c)return this.onEnd(r),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(o.output,o.next_out))):this.onData(i.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==r);return 4===s?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==s||(this.onEnd(c),!(o.avail_out=0))},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=f,r.deflate=p,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){var n=e("./zlib/inflate"),i=e("./utils/common"),a=e("./utils/strings"),s=e("./zlib/constants"),o=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==s.Z_OK)throw new Error(o[r]);this.header=new c,n.inflateGetHeader(this.strm,this.header)}function h(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}d.prototype.push=function(e,t){var r,o,l,c,d,h,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof e?f.input=a.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(p),f.next_out=0,f.avail_out=p),(r=n.inflate(f,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&m&&(h="string"==typeof m?a.string2buf(m):"[object ArrayBuffer]"===u.call(m)?new Uint8Array(m):m,r=n.inflateSetDictionary(this.strm,h)),r===s.Z_BUF_ERROR&&!0===g&&(r=s.Z_OK,g=!1),r!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&r!==s.Z_STREAM_END&&(0!==f.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(f.output,f.next_out),c=f.next_out-l,d=a.buf2string(f.output,l),f.next_out=c,f.avail_out=p-c,c&&i.arraySet(f.output,f.output,l,c,0),this.onData(d)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((0<f.avail_in||0===f.avail_out)&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(f.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=d,r.inflate=h,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},r.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,s;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(s=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)a=e[t],s.set(a,i),i+=a.length;return s}},a={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],42:[function(e,t,r){var n=e("./common"),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function l(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r}s[254]=s[254]=1,r.string2buf=function(e){var t,r,i,a,s,o=e.length,l=0;for(a=0;a<o;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),a=s=0;s<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,a,o=t||e.length,c=new Array(2*o);for(r=n=0;r<o;)if((i=e[r++])<128)c[n++]=i;else if(4<(a=s[i]))c[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;1<a&&r<o;)i=i<<6|63&e[r++],a--;1<a?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return l(c,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+s[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){t.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==r;){for(r-=s=2e3<r?2e3:r;a=a+(i=i+t[n++]|0)|0,--s;);i%=65521,a%=65521}return i|a<<16|0}},{}],44:[function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var a=n,s=i+r;e^=-1;for(var o=i;o<s;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}},{}],46:[function(e,t,r){var n,i=e("../utils/common"),a=e("./trees"),s=e("./adler32"),o=e("./crc32"),l=e("./messages"),c=0,u=4,d=0,h=-2,f=-1,p=4,m=2,g=8,v=9,y=286,_=30,E=19,S=2*y+1,b=15,T=3,R=258,A=R+T+1,w=42,L=113,C=1,I=2,k=3,O=4;function D(e,t){return e.msg=l[t],t}function P(e){return(e<<1)-(4<e?9:0)}function x(e){for(var t=e.length;0<=--t;)e[t]=0}function M(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function N(e,t){a._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,M(e.strm)}function F(e,t){e.pending_buf[e.pending++]=t}function U(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function B(e,t){var r,n,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-A?e.strstart-(e.w_size-A):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+R,f=c[a+s-1],p=c[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(r=t)+s]===p&&c[r+s-1]===f&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do{}while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&a<h);if(n=R-(h-a),a=h-R,s<n){if(e.match_start=t,o<=(s=n))break;f=c[a+s-1],p=c[a+s]}}}while((t=d[t&u])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function j(e){var t,r,n,a,l,c,u,d,h,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-A)){for(i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;n=e.head[--t],e.head[t]=p<=n?n-p:0,--r;);for(t=r=p;n=e.prev[--t],e.prev[t]=p<=n?n-p:0,--r;);a+=p}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,d=e.strstart+e.lookahead,f=void 0,(h=a)<(f=c.avail_in)&&(f=h),r=0===f?0:(c.avail_in-=f,i.arraySet(u,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=s(c.adler,u,f,d):2===c.state.wrap&&(c.adler=o(c.adler,u,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=T)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+T-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<T)););}while(e.lookahead<A&&0!==e.strm.avail_in)}function H(e,t){for(var r,n;;){if(e.lookahead<A){if(j(e),e.lookahead<A&&t===c)return C;if(0===e.lookahead)break}if(r=0,e.lookahead>=T&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-A&&(e.match_length=B(e,r)),e.match_length>=T)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-T),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=T){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=e.strstart<T-1?e.strstart:T-1,t===u?(N(e,!0),0===e.strm.avail_out?k:O):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}function V(e,t){for(var r,n,i;;){if(e.lookahead<A){if(j(e),e.lookahead<A&&t===c)return C;if(0===e.lookahead)break}if(r=0,e.lookahead>=T&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=T-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-A&&(e.match_length=B(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===T&&4096<e.strstart-e.match_start)&&(e.match_length=T-1)),e.prev_length>=T&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-T,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-T),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=T-1,e.strstart++,n&&(N(e,!1),0===e.strm.avail_out))return C}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&N(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return C}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<T-1?e.strstart:T-1,t===u?(N(e,!0),0===e.strm.avail_out?k:O):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}function G(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*S),this.dyn_dtree=new i.Buf16(2*(2*_+1)),this.bl_tree=new i.Buf16(2*(2*E+1)),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(b+1),this.heap=new i.Buf16(2*y+1),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*y+1),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function K(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=m,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?w:L,e.adler=2===t.wrap?0:1,t.last_flush=c,a._tr_init(t),d):D(e,h)}function W(e){var t=K(e);return t===d&&function(e){e.window_size=2*e.w_size,x(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=T-1,e.match_available=0,e.ins_h=0}(e.state),t}function Y(e,t,r,n,a,s){if(!e)return h;var o=1;if(t===f&&(t=6),n<0?(o=0,n=-n):15<n&&(o=2,n-=16),a<1||v<a||r!==g||n<8||15<n||t<0||9<t||s<0||p<s)return D(e,h);8===n&&(n=9);var l=new z;return(e.state=l).strm=e,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+T-1)/T),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=r,W(e)}n=[new G(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(j(e),0===e.lookahead&&t===c)return C;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,N(e,!1),0===e.strm.avail_out))return C;if(e.strstart-e.block_start>=e.w_size-A&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===u?(N(e,!0),0===e.strm.avail_out?k:O):(e.strstart>e.block_start&&(N(e,!1),e.strm.avail_out),C)})),new G(4,4,8,4,H),new G(4,5,16,8,H),new G(4,6,32,32,H),new G(4,4,16,16,V),new G(8,16,32,32,V),new G(8,16,128,128,V),new G(8,32,128,256,V),new G(32,128,258,1024,V),new G(32,258,258,4096,V)],r.deflateInit=function(e,t){return Y(e,t,g,15,8,0)},r.deflateInit2=Y,r.deflateReset=W,r.deflateResetKeep=K,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?h:(e.state.gzhead=t,d):h},r.deflate=function(e,t){var r,i,s,l;if(!e||!e.state||5<t||t<0)return e?D(e,h):h;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==u)return D(e,0===e.avail_out?-5:h);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===w)if(2===i.wrap)e.adler=0,F(i,31),F(i,139),F(i,8),i.gzhead?(F(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),F(i,255&i.gzhead.time),F(i,i.gzhead.time>>8&255),F(i,i.gzhead.time>>16&255),F(i,i.gzhead.time>>24&255),F(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),F(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(F(i,255&i.gzhead.extra.length),F(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=o(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(F(i,0),F(i,0),F(i,0),F(i,0),F(i,0),F(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),F(i,3),i.status=L);else{var f=g+(i.w_bits-8<<4)<<8;f|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(f|=32),f+=31-f%31,i.status=L,U(i,f),0!==i.strstart&&(U(i,e.adler>>>16),U(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),M(e),s=i.pending,i.pending!==i.pending_buf_size));)F(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),M(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,F(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),M(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,F(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&M(e),i.pending+2<=i.pending_buf_size&&(F(i,255&e.adler),F(i,e.adler>>8&255),e.adler=0,i.status=L)):i.status=L),0!==i.pending){if(M(e),0===e.avail_out)return i.last_flush=-1,d}else if(0===e.avail_in&&P(t)<=P(r)&&t!==u)return D(e,-5);if(666===i.status&&0!==e.avail_in)return D(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==c&&666!==i.status){var p=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(j(e),0===e.lookahead)){if(t===c)return C;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===u?(N(e,!0),0===e.strm.avail_out?k:O):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}(i,t):3===i.strategy?function(e,t){for(var r,n,i,s,o=e.window;;){if(e.lookahead<=R){if(j(e),e.lookahead<=R&&t===c)return C;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=T&&0<e.strstart&&(n=o[i=e.strstart-1])===o[++i]&&n===o[++i]&&n===o[++i]){s=e.strstart+R;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);e.match_length=R-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=T?(r=a._tr_tally(e,1,e.match_length-T),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===u?(N(e,!0),0===e.strm.avail_out?k:O):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}(i,t):n[i.level].func(i,t);if(p!==k&&p!==O||(i.status=666),p===C||p===k)return 0===e.avail_out&&(i.last_flush=-1),d;if(p===I&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(x(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),M(e),0===e.avail_out))return i.last_flush=-1,d}return t!==u?d:i.wrap<=0?1:(2===i.wrap?(F(i,255&e.adler),F(i,e.adler>>8&255),F(i,e.adler>>16&255),F(i,e.adler>>24&255),F(i,255&e.total_in),F(i,e.total_in>>8&255),F(i,e.total_in>>16&255),F(i,e.total_in>>24&255)):(U(i,e.adler>>>16),U(i,65535&e.adler)),M(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?d:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==w&&69!==t&&73!==t&&91!==t&&103!==t&&t!==L&&666!==t?D(e,h):(e.state=null,t===L?D(e,-3):d):h},r.deflateSetDictionary=function(e,t){var r,n,a,o,l,c,u,f,p=t.length;if(!e||!e.state)return h;if(2===(o=(r=e.state).wrap)||1===o&&r.status!==w||r.lookahead)return h;for(1===o&&(e.adler=s(e.adler,t,p,0)),r.wrap=0,p>=r.w_size&&(0===o&&(x(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new i.Buf8(r.w_size),i.arraySet(f,t,p-r.w_size,r.w_size,0),t=f,p=r.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=p,e.next_in=0,e.input=t,j(r);r.lookahead>=T;){for(n=r.strstart,a=r.lookahead-(T-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+T-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--a;);r.strstart=n,r.lookahead=T-1,j(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=T-1,r.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,r.wrap=o,d},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){t.exports=function(e,t){var r,n,i,a,s,o,l,c,u,d,h,f,p,m,g,v,y,_,E,S,b,T,R,A,w;r=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),a=e.next_out,w=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),l=r.dmax,c=r.wsize,u=r.whave,d=r.wnext,h=r.window,f=r.hold,p=r.bits,m=r.lencode,g=r.distcode,v=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(f+=A[n++]<<p,p+=8,f+=A[n++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=E=_>>>24,p-=E,0==(E=_>>>16&255))w[a++]=65535&_;else{if(!(16&E)){if(0==(64&E)){_=m[(65535&_)+(f&(1<<E)-1)];continue t}if(32&E){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}S=65535&_,(E&=15)&&(p<E&&(f+=A[n++]<<p,p+=8),S+=f&(1<<E)-1,f>>>=E,p-=E),p<15&&(f+=A[n++]<<p,p+=8,f+=A[n++]<<p,p+=8),_=g[f&y];r:for(;;){if(f>>>=E=_>>>24,p-=E,!(16&(E=_>>>16&255))){if(0==(64&E)){_=g[(65535&_)+(f&(1<<E)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(b=65535&_,p<(E&=15)&&(f+=A[n++]<<p,(p+=8)<E&&(f+=A[n++]<<p,p+=8)),l<(b+=f&(1<<E)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=E,p-=E,(E=a-s)<b){if(u<(E=b-E)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(R=h,(T=0)===d){if(T+=c-E,E<S){for(S-=E;w[a++]=h[T++],--E;);T=a-b,R=w}}else if(d<E){if(T+=c+d-E,(E-=d)<S){for(S-=E;w[a++]=h[T++],--E;);if(T=0,d<S){for(S-=E=d;w[a++]=h[T++],--E;);T=a-b,R=w}}}else if(T+=d-E,E<S){for(S-=E;w[a++]=h[T++],--E;);T=a-b,R=w}for(;2<S;)w[a++]=R[T++],w[a++]=R[T++],w[a++]=R[T++],S-=3;S&&(w[a++]=R[T++],1<S&&(w[a++]=R[T++]))}else{for(T=a-b;w[a++]=w[T++],w[a++]=w[T++],w[a++]=w[T++],2<(S-=3););S&&(w[a++]=w[T++],1<S&&(w[a++]=w[T++]))}break}}break}}while(n<i&&a<o);n-=S=p>>3,f&=(1<<(p-=S<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<o?o-a+257:257-(a-o),r.hold=f,r.bits=p}},{}],49:[function(e,t,r){var n=e("../utils/common"),i=e("./adler32"),a=e("./crc32"),s=e("./inffast"),o=e("./inftrees"),l=1,c=2,u=0,d=-2,h=1,f=852,p=592;function m(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=h,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(f),t.distcode=t.distdyn=new n.Buf32(p),t.sane=1,t.back=-1,u):d}function y(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,v(e)):d}function _(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?d:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,y(e))):d}function E(e,t){var r,n;return e?(n=new g,(e.state=n).window=null,(r=_(e,t))!==u&&(e.state=null),r):d}var S,b,T=!0;function R(e){if(T){var t;for(S=new n.Buf32(512),b=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(l,e.lens,0,288,S,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(c,e.lens,0,32,b,0,e.work,{bits:5}),T=!1}e.lencode=S,e.lenbits=9,e.distcode=b,e.distbits=5}function A(e,t,r,i){var a,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),i>=s.wsize?(n.arraySet(s.window,t,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i<(a=s.wsize-s.wnext)&&(a=i),n.arraySet(s.window,t,r-i,a,s.wnext),(i-=a)?(n.arraySet(s.window,t,r-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}r.inflateReset=y,r.inflateReset2=_,r.inflateResetKeep=v,r.inflateInit=function(e){return E(e,15)},r.inflateInit2=E,r.inflate=function(e,t){var r,f,p,g,v,y,_,E,S,b,T,w,L,C,I,k,O,D,P,x,M,N,F,U,B=0,j=new n.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return d;12===(r=e.state).mode&&(r.mode=13),v=e.next_out,p=e.output,_=e.avail_out,g=e.next_in,f=e.input,y=e.avail_in,E=r.hold,S=r.bits,b=y,T=_,N=u;e:for(;;)switch(r.mode){case h:if(0===r.wrap){r.mode=13;break}for(;S<16;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(2&r.wrap&&35615===E){j[r.check=0]=255&E,j[1]=E>>>8&255,r.check=a(r.check,j,2,0),S=E=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&E)){e.msg="unknown compression method",r.mode=30;break}if(S-=4,M=8+(15&(E>>>=4)),0===r.wbits)r.wbits=M;else if(M>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<M,e.adler=r.check=1,r.mode=512&E?10:12,S=E=0;break;case 2:for(;S<16;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(r.flags=E,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=E>>8&1),512&r.flags&&(j[0]=255&E,j[1]=E>>>8&255,r.check=a(r.check,j,2,0)),S=E=0,r.mode=3;case 3:for(;S<32;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}r.head&&(r.head.time=E),512&r.flags&&(j[0]=255&E,j[1]=E>>>8&255,j[2]=E>>>16&255,j[3]=E>>>24&255,r.check=a(r.check,j,4,0)),S=E=0,r.mode=4;case 4:for(;S<16;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}r.head&&(r.head.xflags=255&E,r.head.os=E>>8),512&r.flags&&(j[0]=255&E,j[1]=E>>>8&255,r.check=a(r.check,j,2,0)),S=E=0,r.mode=5;case 5:if(1024&r.flags){for(;S<16;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}r.length=E,r.head&&(r.head.extra_len=E),512&r.flags&&(j[0]=255&E,j[1]=E>>>8&255,r.check=a(r.check,j,2,0)),S=E=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(y<(w=r.length)&&(w=y),w&&(r.head&&(M=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,f,g,w,M)),512&r.flags&&(r.check=a(r.check,f,w,g)),y-=w,g+=w,r.length-=w),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===y)break e;for(w=0;M=f[g+w++],r.head&&M&&r.length<65536&&(r.head.name+=String.fromCharCode(M)),M&&w<y;);if(512&r.flags&&(r.check=a(r.check,f,w,g)),y-=w,g+=w,M)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===y)break e;for(w=0;M=f[g+w++],r.head&&M&&r.length<65536&&(r.head.comment+=String.fromCharCode(M)),M&&w<y;);if(512&r.flags&&(r.check=a(r.check,f,w,g)),y-=w,g+=w,M)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;S<16;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(E!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}S=E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;S<32;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}e.adler=r.check=m(E),S=E=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=v,e.avail_out=_,e.next_in=g,e.avail_in=y,r.hold=E,r.bits=S,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){E>>>=7&S,S-=7&S,r.mode=27;break}for(;S<3;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}switch(r.last=1&E,S-=1,3&(E>>>=1)){case 0:r.mode=14;break;case 1:if(R(r),r.mode=20,6!==t)break;E>>>=2,S-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}E>>>=2,S-=2;break;case 14:for(E>>>=7&S,S-=7&S;S<32;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&E,S=E=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(w=r.length){if(y<w&&(w=y),_<w&&(w=_),0===w)break e;n.arraySet(p,f,g,w,v),y-=w,g+=w,_-=w,v+=w,r.length-=w;break}r.mode=12;break;case 17:for(;S<14;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(r.nlen=257+(31&E),E>>>=5,S-=5,r.ndist=1+(31&E),E>>>=5,S-=5,r.ncode=4+(15&E),E>>>=4,S-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;S<3;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}r.lens[H[r.have++]]=7&E,E>>>=3,S-=3}for(;r.have<19;)r.lens[H[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,F={bits:r.lenbits},N=o(0,r.lens,0,19,r.lencode,0,r.work,F),r.lenbits=F.bits,N){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;k=(B=r.lencode[E&(1<<r.lenbits)-1])>>>16&255,O=65535&B,!((I=B>>>24)<=S);){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(O<16)E>>>=I,S-=I,r.lens[r.have++]=O;else{if(16===O){for(U=I+2;S<U;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(E>>>=I,S-=I,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}M=r.lens[r.have-1],w=3+(3&E),E>>>=2,S-=2}else if(17===O){for(U=I+3;S<U;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}S-=I,M=0,w=3+(7&(E>>>=I)),E>>>=3,S-=3}else{for(U=I+7;S<U;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}S-=I,M=0,w=11+(127&(E>>>=I)),E>>>=7,S-=7}if(r.have+w>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;w--;)r.lens[r.have++]=M}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,F={bits:r.lenbits},N=o(l,r.lens,0,r.nlen,r.lencode,0,r.work,F),r.lenbits=F.bits,N){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,F={bits:r.distbits},N=o(c,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,F),r.distbits=F.bits,N){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=y&&258<=_){e.next_out=v,e.avail_out=_,e.next_in=g,e.avail_in=y,r.hold=E,r.bits=S,s(e,T),v=e.next_out,p=e.output,_=e.avail_out,g=e.next_in,f=e.input,y=e.avail_in,E=r.hold,S=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;k=(B=r.lencode[E&(1<<r.lenbits)-1])>>>16&255,O=65535&B,!((I=B>>>24)<=S);){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(k&&0==(240&k)){for(D=I,P=k,x=O;k=(B=r.lencode[x+((E&(1<<D+P)-1)>>D)])>>>16&255,O=65535&B,!(D+(I=B>>>24)<=S);){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}E>>>=D,S-=D,r.back+=D}if(E>>>=I,S-=I,r.back+=I,r.length=O,0===k){r.mode=26;break}if(32&k){r.back=-1,r.mode=12;break}if(64&k){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&k,r.mode=22;case 22:if(r.extra){for(U=r.extra;S<U;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}r.length+=E&(1<<r.extra)-1,E>>>=r.extra,S-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;k=(B=r.distcode[E&(1<<r.distbits)-1])>>>16&255,O=65535&B,!((I=B>>>24)<=S);){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(0==(240&k)){for(D=I,P=k,x=O;k=(B=r.distcode[x+((E&(1<<D+P)-1)>>D)])>>>16&255,O=65535&B,!(D+(I=B>>>24)<=S);){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}E>>>=D,S-=D,r.back+=D}if(E>>>=I,S-=I,r.back+=I,64&k){e.msg="invalid distance code",r.mode=30;break}r.offset=O,r.extra=15&k,r.mode=24;case 24:if(r.extra){for(U=r.extra;S<U;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}r.offset+=E&(1<<r.extra)-1,E>>>=r.extra,S-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===_)break e;if(w=T-_,r.offset>w){if((w=r.offset-w)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}L=w>r.wnext?(w-=r.wnext,r.wsize-w):r.wnext-w,w>r.length&&(w=r.length),C=r.window}else C=p,L=v-r.offset,w=r.length;for(_<w&&(w=_),_-=w,r.length-=w;p[v++]=C[L++],--w;);0===r.length&&(r.mode=21);break;case 26:if(0===_)break e;p[v++]=r.length,_--,r.mode=21;break;case 27:if(r.wrap){for(;S<32;){if(0===y)break e;y--,E|=f[g++]<<S,S+=8}if(T-=_,e.total_out+=T,r.total+=T,T&&(e.adler=r.check=r.flags?a(r.check,p,T,v-T):i(r.check,p,T,v-T)),T=_,(r.flags?E:m(E))!==r.check){e.msg="incorrect data check",r.mode=30;break}S=E=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;S<32;){if(0===y)break e;y--,E+=f[g++]<<S,S+=8}if(E!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}S=E=0}r.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;default:return d}return e.next_out=v,e.avail_out=_,e.next_in=g,e.avail_in=y,r.hold=E,r.bits=S,(r.wsize||T!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&A(e,e.output,e.next_out,T-e.avail_out)?(r.mode=31,-4):(b-=e.avail_in,T-=e.avail_out,e.total_in+=b,e.total_out+=T,r.total+=T,r.wrap&&T&&(e.adler=r.check=r.flags?a(r.check,p,T,e.next_out-T):i(r.check,p,T,e.next_out-T)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==b&&0===T||4===t)&&N===u&&(N=-5),N)},r.inflateEnd=function(e){if(!e||!e.state)return d;var t=e.state;return t.window&&(t.window=null),e.state=null,u},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?d:((r.head=t).done=!1,u):d},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?d:11===r.mode&&i(1,t,n,0)!==r.check?-3:A(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,u):d},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,l,c,u,d,h){var f,p,m,g,v,y,_,E,S,b=h.bits,T=0,R=0,A=0,w=0,L=0,C=0,I=0,k=0,O=0,D=0,P=null,x=0,M=new n.Buf16(16),N=new n.Buf16(16),F=null,U=0;for(T=0;T<=15;T++)M[T]=0;for(R=0;R<l;R++)M[t[r+R]]++;for(L=b,w=15;1<=w&&0===M[w];w--);if(w<L&&(L=w),0===w)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(A=1;A<w&&0===M[A];A++);for(L<A&&(L=A),T=k=1;T<=15;T++)if(k<<=1,(k-=M[T])<0)return-1;if(0<k&&(0===e||1!==w))return-1;for(N[1]=0,T=1;T<15;T++)N[T+1]=N[T]+M[T];for(R=0;R<l;R++)0!==t[r+R]&&(d[N[t[r+R]]++]=R);if(y=0===e?(P=F=d,19):1===e?(P=i,x-=257,F=a,U-=257,256):(P=s,F=o,-1),T=A,v=u,I=R=D=0,m=-1,g=(O=1<<(C=L))-1,1===e&&852<O||2===e&&592<O)return 1;for(;;){for(_=T-I,S=d[R]<y?(E=0,d[R]):d[R]>y?(E=F[U+d[R]],P[x+d[R]]):(E=96,0),f=1<<T-I,A=p=1<<C;c[v+(D>>I)+(p-=f)]=_<<24|E<<16|S|0,0!==p;);for(f=1<<T-1;D&f;)f>>=1;if(0!==f?(D&=f-1,D+=f):D=0,R++,0==--M[T]){if(T===w)break;T=t[r+d[R]]}if(L<T&&(D&g)!==m){for(0===I&&(I=L),v+=A,k=1<<(C=T-I);C+I<w&&!((k-=M[C+I])<=0);)C++,k<<=1;if(O+=1<<C,1===e&&852<O||2===e&&592<O)return 1;c[m=D&g]=L<<24|C<<16|v-u|0}}return 0!==D&&(c[v+D]=T-I<<24|64<<16|0),h.bits=L,0}},{"../utils/common":41}],51:[function(e,t,r){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){var n=e("../utils/common"),i=0,a=1;function s(e){for(var t=e.length;0<=--t;)e[t]=0}var o=0,l=29,c=256,u=c+1+l,d=30,h=19,f=2*u+1,p=15,m=16,g=7,v=256,y=16,_=17,E=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],b=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=new Array(2*(u+2));s(A);var w=new Array(2*d);s(w);var L=new Array(512);s(L);var C=new Array(256);s(C);var I=new Array(l);s(I);var k,O,D,P=new Array(d);function x(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function M(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?L[e]:L[256+(e>>>7)]}function F(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function U(e,t,r){e.bi_valid>m-r?(e.bi_buf|=t<<e.bi_valid&65535,F(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=r-m):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function B(e,t,r){U(e,r[2*t],r[2*t+1])}function j(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function H(e,t,r){var n,i,a=new Array(p+1),s=0;for(n=1;n<=p;n++)a[n]=s=s+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=j(a[o]++,o))}}function V(e){var t;for(t=0;t<u;t++)e.dyn_ltree[2*t]=0;for(t=0;t<d;t++)e.dyn_dtree[2*t]=0;for(t=0;t<h;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*v]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function G(e){8<e.bi_valid?F(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function z(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function K(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&z(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!z(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function W(e,t,r){var n,i,a,s,o=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?B(e,i,t):(B(e,(a=C[i])+c+1,t),0!==(s=S[a])&&U(e,i-=I[a],s),B(e,a=N(--n),r),0!==(s=b[a])&&U(e,n-=P[a],s)),o<e.last_lit;);B(e,v,t)}function Y(e,t){var r,n,i,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=f,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=s[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;1<=r;r--)K(e,a,r);for(i=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,K(e,a,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,s,o,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,g=t.stat_desc.max_length,v=0;for(a=0;a<=p;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<f;r++)g<(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)&&(a=g,v++),l[2*n+1]=a,c<n||(e.bl_count[a]++,s=0,m<=n&&(s=h[n-m]),o=l[2*n],e.opt_len+=o*(a+s),d&&(e.static_len+=o*(u[2*n+1]+s)));if(0!==v){do{for(a=g-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[g]--,v-=2}while(0<v);for(a=g;0!==a;a--)for(n=e.bl_count[a];0!==n;)c<(i=e.heap[--r])||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),H(a,c,e.bl_count)}function q(e,t,r){var n,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=t[2*(n+1)+1],++o<l&&i===s||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*y]++):o<=10?e.bl_tree[2*_]++:e.bl_tree[2*E]++,a=i,c=(o=0)===s?(l=138,3):i===s?(l=6,3):(l=7,4))}function Z(e,t,r){var n,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),n=0;n<=r;n++)if(i=s,s=t[2*(n+1)+1],!(++o<l&&i===s)){if(o<c)for(;B(e,i,e.bl_tree),0!=--o;);else 0!==i?(i!==a&&(B(e,i,e.bl_tree),o--),B(e,y,e.bl_tree),U(e,o-3,2)):o<=10?(B(e,_,e.bl_tree),U(e,o-3,3)):(B(e,E,e.bl_tree),U(e,o-11,7));a=i,c=(o=0)===s?(l=138,3):i===s?(l=6,3):(l=7,4)}}s(P);var X=!1;function J(e,t,r,i){U(e,(o<<1)+(i?1:0),3),function(e,t,r,i){G(e),i&&(F(e,r),F(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){X||(function(){var e,t,r,n,i,a=new Array(p+1);for(n=r=0;n<l-1;n++)for(I[n]=r,e=0;e<1<<S[n];e++)C[r++]=n;for(C[r-1]=n,n=i=0;n<16;n++)for(P[n]=i,e=0;e<1<<b[n];e++)L[i++]=n;for(i>>=7;n<d;n++)for(P[n]=i<<7,e=0;e<1<<b[n]-7;e++)L[256+i++]=n;for(t=0;t<=p;t++)a[t]=0;for(e=0;e<=143;)A[2*e+1]=8,e++,a[8]++;for(;e<=255;)A[2*e+1]=9,e++,a[9]++;for(;e<=279;)A[2*e+1]=7,e++,a[7]++;for(;e<=287;)A[2*e+1]=8,e++,a[8]++;for(H(A,u+1,a),e=0;e<d;e++)w[2*e+1]=5,w[2*e]=j(e,5);k=new x(A,S,c+1,u,p),O=new x(w,b,0,d,p),D=new x(new Array(0),T,0,h,g)}(),X=!0),e.l_desc=new M(e.dyn_ltree,k),e.d_desc=new M(e.dyn_dtree,O),e.bl_desc=new M(e.bl_tree,D),e.bi_buf=0,e.bi_valid=0,V(e)},r._tr_stored_block=J,r._tr_flush_block=function(e,t,r,n){var s,o,l=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return a;return i}(e)),Y(e,e.l_desc),Y(e,e.d_desc),l=function(e){var t;for(q(e,e.dyn_ltree,e.l_desc.max_code),q(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=h-1;3<=t&&0===e.bl_tree[2*R[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=s&&(s=o)):s=o=r+5,r+4<=s&&-1!==t?J(e,t,r,n):4===e.strategy||o===s?(U(e,2+(n?1:0),3),W(e,A,w)):(U(e,4+(n?1:0),3),function(e,t,r,n){var i;for(U(e,t-257,5),U(e,r-1,5),U(e,n-4,4),i=0;i<n;i++)U(e,e.bl_tree[2*R[i]+1],3);Z(e,e.dyn_ltree,t-1),Z(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),W(e,e.dyn_ltree,e.dyn_dtree)),V(e),n&&G(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(C[r]+c+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){U(e,2,3),B(e,v,A),function(e){16===e.bi_valid?(F(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){if(!e.setImmediate){var r,n,i,a,s=1,o={},l=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,r="[object process]"==={}.toString.call(e.process)?function(e){mh((function(){h(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(a="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",f,!1):e.attachEvent("onmessage",f),function(t){e.postMessage(a+t,"*")}):e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){i.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(n=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):function(e){setTimeout(h,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return o[s]=i,r(s),s++},u.clearImmediate=d}function d(e){delete o[e]}function h(e){if(l)setTimeout(h,0,e);else{var r=o[e];if(r){l=!0;try{!function(e){var r=e.callback,n=e.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(t,n)}}(r)}finally{d(e),l=!1}}}}function f(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)}(Ih);var kh=Ih.exports;const Oh={SDK_VERSION:"2.5.3",COMMIT_ID:"67d8581",NEGOTIATE_SDP_URL_PATH:"/webrtc/v1/pullstream",STOP_PLAY_URL_PATH:"/webrtc/v1/stopstream",OPS_REPORT_DOMAIN:"log-collection-new.hwcloudlive.com",SHARE_PULL_DOMAIN:["global-lll.huaweicloud.com","global-lll.huaweicloud.cn"],GSLB_DOMAIN:"hcdnl.pull302.global.gslb.livehwc3.cn",GSLB_REQUEST_TIMEOUT:4e3,DNS_REQUEST_TIMEOUT:3e3,PULLSTREAM_REQUEST_TIMEOUT:6e3,REQUEST_DEFAULT_TIMEOUT:5e3,OPS_AUTH_TOKEN:"Token 1dc3549b538515311e23d68684a67fb93341f3f5",OPS_REPORT_INTERVAL:5e3,STATISTIC_INTERVAL:100,PUBLIC_DNS_SERVER:["dns.alidns.com","doh.pub"]};let Dh=function(e){return e[e.HWLLS_OK=0]="HWLLS_OK",e[e.HWLLS_ERROR_INVALID_URL=5e7]="HWLLS_ERROR_INVALID_URL",e[e.HWLLS_ERROR_INVALID_PARAMETER=50000001]="HWLLS_ERROR_INVALID_PARAMETER",e[e.HWLLS_ERROR_SERVER_CONNECT_FAIL=50000002]="HWLLS_ERROR_SERVER_CONNECT_FAIL",e[e.HWLLS_ERROR_SERVER_NO_RESPONSE=50000003]="HWLLS_ERROR_SERVER_NO_RESPONSE",e[e.HWLLS_ERROR_AUTH_FAIL=50000004]="HWLLS_ERROR_AUTH_FAIL",e[e.HWLLS_ERROR_STREAM_NOT_EXIST=50000005]="HWLLS_ERROR_STREAM_NOT_EXIST",e[e.HWLLS_ERROR_WEBRTC_UNSUPPORTED=50000006]="HWLLS_ERROR_WEBRTC_UNSUPPORTED",e[e.HWLLS_MEDIA_NETWORK_ERROR=50000007]="HWLLS_MEDIA_NETWORK_ERROR",e[e.HWLLS_ERROR_BAD_REQUEST=50000008]="HWLLS_ERROR_BAD_REQUEST",e[e.HWLLS_ERROR_STREAM_INVALID_PARAMETER=50000009]="HWLLS_ERROR_STREAM_INVALID_PARAMETER",e[e.HWLLS_ERROR_ENCODING_NOT_ACCEPTED=500000010]="HWLLS_ERROR_ENCODING_NOT_ACCEPTED",e[e.HWLLS_INTERNAL_ERROR=50000020]="HWLLS_INTERNAL_ERROR",e[e.HWLLS_BUSSINESS_DOWNGRADE=50000021]="HWLLS_BUSSINESS_DOWNGRADE",e[e.HWLLS_PLAY_WEBRTC_RETRY_FAILED=50000022]="HWLLS_PLAY_WEBRTC_RETRY_FAILED",e[e.HWLLS_PLAY_FLV_RETRY_FAILED=50000023]="HWLLS_PLAY_FLV_RETRY_FAILED",e[e.HWLLS_PLAY_HLS_RETRY_FAILED=50000024]="HWLLS_PLAY_HLS_RETRY_FAILED",e[e.HWLLS_ERROR_LIVE_UNSUPPORTED=50000030]="HWLLS_ERROR_LIVE_UNSUPPORTED",e[e.HWLLS_ERROR_UNEXPECTED_EOF=50000031]="HWLLS_ERROR_UNEXPECTED_EOF",e[e.HWLLS_ERROR_MEDIA_ERROR=50000032]="HWLLS_ERROR_MEDIA_ERROR",e[e.HWLLS_PLAY_NOT_ALLOW=51e6]="HWLLS_PLAY_NOT_ALLOW",e[e.HWLLS_PLAY_TIMEOUT=51000001]="HWLLS_PLAY_TIMEOUT",e}({});const Ph={[Dh.HWLLS_OK]:"success",[Dh.HWLLS_ERROR_INVALID_URL]:"url invalid.",[Dh.HWLLS_ERROR_INVALID_PARAMETER]:"parameter invalid.",[Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL]:"server not available or server internal error.",[Dh.HWLLS_ERROR_SERVER_NO_RESPONSE]:"server respone timeout.",[Dh.HWLLS_ERROR_AUTH_FAIL]:"server authnicate failed.",[Dh.HWLLS_ERROR_STREAM_NOT_EXIST]:"stream not exist.",[Dh.HWLLS_MEDIA_NETWORK_ERROR]:"media connection establish failed, please switch network or try again later.",[Dh.HWLLS_ERROR_BAD_REQUEST]:"bad request.",[Dh.HWLLS_ERROR_STREAM_INVALID_PARAMETER]:"browser not support avc codec.",[Dh.HWLLS_INTERNAL_ERROR]:"internal error",[Dh.HWLLS_BUSSINESS_DOWNGRADE]:"fatal error, bussiness downgrade: hls/http-flv etc.",[Dh.HWLLS_PLAY_WEBRTC_RETRY_FAILED]:"recover play with webrtc protocol timeOut, pls comfirm the server is avaliable.",[Dh.HWLLS_PLAY_FLV_RETRY_FAILED]:"recover play with flv format timeOut, pls comfirm the server is avaliable.",[Dh.HWLLS_PLAY_HLS_RETRY_FAILED]:"recover play with hls format timeOut, pls comfirm the server is avaliable.",[Dh.HWLLS_PLAY_NOT_ALLOW]:"the user didn't interact with the document first, please trigger by gesture.",[Dh.HWLLS_PLAY_TIMEOUT]:"play timeout, please confirm the stream server status.",[Dh.HWLLS_ERROR_UNEXPECTED_EOF]:"related to unexpected network EOF which cannot be recovered.",[Dh.HWLLS_ERROR_ENCODING_NOT_ACCEPTED]:"server does not accept content-encoding request"};class xh extends Error{constructor(e,t){let r="";r=e in Dh?Ph[e]:"unknow error",super(t),this.code=e,this.message=t||r}getCode(){return this.code}getMsg(){return this.message}toString(){return'["code": '.concat(this.code,', "message": "').concat(this.message,'"]')}}var Mh="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Nh=Zr,Fh=en,Uh=ln,Bh=RangeError,jh=function(e){if(void 0===e)return 0;var t=Fh(e),r=Uh(t);if(t!==r)throw Bh("Wrong length or index");return r},Hh=Array,Vh=Math.abs,Gh=Math.pow,zh=Math.floor,Kh=Math.log,Wh=Math.LN2,Yh={pack:function(e,t,r){var n,i,a,s=Hh(r),o=8*r-t-1,l=(1<<o)-1,c=l>>1,u=23===t?Gh(2,-24)-Gh(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=Vh(e))!=e||e===1/0?(i=e!=e?1:0,n=l):(n=zh(Kh(e)/Wh),e*(a=Gh(2,-n))<1&&(n--,a*=2),(e+=n+c>=1?u/a:u*Gh(2,1-c))*a>=2&&(n++,a/=2),n+c>=l?(i=0,n=l):n+c>=1?(i=(e*a-1)*Gh(2,t),n+=c):(i=e*Gh(2,c-1)*Gh(2,t),n=0));t>=8;)s[h++]=255&i,i/=256,t-=8;for(n=n<<t|i,o+=t;o>0;)s[h++]=255&n,n/=256,o-=8;return s[--h]|=128*d,s},unpack:function(e,t){var r,n=e.length,i=8*n-t-1,a=(1<<i)-1,s=a>>1,o=i-7,l=n-1,c=e[l--],u=127&c;for(c>>=7;o>0;)u=256*u+e[l--],o-=8;for(r=u&(1<<-o)-1,u>>=-o,o+=t;o>0;)r=256*r+e[l--],o-=8;if(0===u)u=1-s;else{if(u===a)return r?NaN:c?-1/0:1/0;r+=Gh(2,t),u-=s}return(c?-1:1)*r*Gh(2,u-t)}},qh=!c((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Zh=Fe,Xh=V,Jh=xe,Qh=qh,$h=fr("IE_PROTO"),ef=Object,tf=ef.prototype,rf=Qh?ef.getPrototypeOf:function(e){var t=Jh(e);if(Zh(t,$h))return t[$h];var r=t.constructor;return Xh(r)&&t instanceof r?r.prototype:t instanceof ef?tf:null},nf=xe,af=an,sf=un,of=function(e){for(var t=nf(this),r=sf(t),n=arguments.length,i=af(n>1?arguments[1]:void 0,r),a=n>2?arguments[2]:void 0,s=void 0===a?r:af(a,r);s>i;)t[i++]=e;return t},lf=ut,cf=wt,uf=S,df=an,hf=un,ff=function(e,t,r){var n=lf(t);n in e?cf.f(e,n,uf(0,r)):e[n]=r},pf=Array,mf=Math.max,gf=function(e,t,r){for(var n=hf(e),i=df(t,n),a=df(void 0===r?n:r,n),s=pf(mf(a-i,0)),o=0;i<a;i++,o++)ff(s,o,e[i]);return s.length=o,s},vf=o,yf=L,_f=u,Ef=Mh,Sf=Qt,bf=Kt,Tf=function(e,t,r){for(var n in t)Nh(e,n,t[n],r);return e},Rf=c,Af=_i,wf=en,Lf=ln,Cf=jh,If=Yh,kf=rf,Of=oi,Df=Xr.f,Pf=wt.f,xf=of,Mf=gf,Nf=di,Ff=Sf.PROPER,Uf=Sf.CONFIGURABLE,Bf=Dr.get,jf=Dr.set,Hf="ArrayBuffer",Vf="DataView",Gf="prototype",zf="Wrong index",Kf=vf[Hf],Wf=Kf,Yf=Wf&&Wf[Gf],qf=vf[Vf],Zf=qf&&qf[Gf],Xf=Object.prototype,Jf=vf.Array,Qf=vf.RangeError,$f=yf(xf),ep=yf([].reverse),tp=If.pack,rp=If.unpack,np=function(e){return[255&e]},ip=function(e){return[255&e,e>>8&255]},ap=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},sp=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},op=function(e){return tp(e,23,4)},lp=function(e){return tp(e,52,8)},cp=function(e,t){Pf(e[Gf],t,{get:function(){return Bf(this)[t]}})},up=function(e,t,r,n){var i=Cf(r),a=Bf(e);if(i+t>a.byteLength)throw Qf(zf);var s=Bf(a.buffer).bytes,o=i+a.byteOffset,l=Mf(s,o,o+t);return n?l:ep(l)},dp=function(e,t,r,n,i,a){var s=Cf(r),o=Bf(e);if(s+t>o.byteLength)throw Qf(zf);for(var l=Bf(o.buffer).bytes,c=s+o.byteOffset,u=n(+i),d=0;d<t;d++)l[c+d]=u[a?d:t-d-1]};if(Ef){var hp=Ff&&Kf.name!==Hf;if(Rf((function(){Kf(1)}))&&Rf((function(){new Kf(-1)}))&&!Rf((function(){return new Kf,new Kf(1.5),new Kf(NaN),hp&&!Uf})))hp&&Uf&&bf(Kf,"name",Hf);else{(Wf=function(e){return Af(this,Yf),new Kf(Cf(e))})[Gf]=Yf;for(var fp,pp=Df(Kf),mp=0;pp.length>mp;)(fp=pp[mp++])in Wf||bf(Wf,fp,Kf[fp]);Yf.constructor=Wf}Of&&kf(Zf)!==Xf&&Of(Zf,Xf);var gp=new qf(new Wf(2)),vp=yf(Zf.setInt8);gp.setInt8(0,2147483648),gp.setInt8(1,2147483649),!gp.getInt8(0)&&gp.getInt8(1)||Tf(Zf,{setInt8:function(e,t){vp(this,e,t<<24>>24)},setUint8:function(e,t){vp(this,e,t<<24>>24)}},{unsafe:!0})}else Wf=function(e){Af(this,Yf);var t=Cf(e);jf(this,{bytes:$f(Jf(t),0),byteLength:t}),_f||(this.byteLength=t)},Yf=Wf[Gf],qf=function(e,t,r){Af(this,Zf),Af(e,Yf);var n=Bf(e).byteLength,i=wf(t);if(i<0||i>n)throw Qf("Wrong offset");if(i+(r=void 0===r?n-i:Lf(r))>n)throw Qf("Wrong length");jf(this,{buffer:e,byteLength:r,byteOffset:i}),_f||(this.buffer=e,this.byteLength=r,this.byteOffset=i)},Zf=qf[Gf],_f&&(cp(Wf,"byteLength"),cp(qf,"buffer"),cp(qf,"byteLength"),cp(qf,"byteOffset")),Tf(Zf,{getInt8:function(e){return up(this,1,e)[0]<<24>>24},getUint8:function(e){return up(this,1,e)[0]},getInt16:function(e){var t=up(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=up(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return sp(up(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return sp(up(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return rp(up(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return rp(up(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){dp(this,1,e,np,t)},setUint8:function(e,t){dp(this,1,e,np,t)},setInt16:function(e,t){dp(this,2,e,ip,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){dp(this,2,e,ip,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){dp(this,4,e,ap,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){dp(this,4,e,ap,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){dp(this,4,e,op,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){dp(this,8,e,lp,t,arguments.length>2?arguments[2]:void 0)}});Nf(Wf,Hf),Nf(qf,Vf);var yp={ArrayBuffer:Wf,DataView:qf},_p=$n,Ep=L,Sp=c,bp=Ot,Tp=an,Rp=ln,Ap=$i,wp=yp.ArrayBuffer,Lp=yp.DataView,Cp=Lp.prototype,Ip=Ep(wp.prototype.slice),kp=Ep(Cp.getUint8),Op=Ep(Cp.setUint8);_p({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Sp((function(){return!new wp(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(Ip&&void 0===t)return Ip(bp(this),e);for(var r=bp(this).byteLength,n=Tp(e,r),i=Tp(void 0===t?r:t,r),a=new(Ap(this,wp))(Rp(i-n)),s=new Lp(this),o=new Lp(a),l=0;n<i;)Op(o,l++,kp(s,n++));return a}});var Dp=gi,Pp="ArrayBuffer",xp=yp[Pp];$n({global:!0,constructor:!0,forced:o[Pp]!==xp},{ArrayBuffer:xp}),Dp(Pp);var Mp=Wt.exports,Np=wt,Fp=u,Up=function(e,t,r){return r.get&&Mp(r.get,t,{getter:!0}),r.set&&Mp(r.set,t,{setter:!0}),Np.f(e,t,r)},Bp=Ql,jp=c,Hp=o.RegExp,Vp=Hp.prototype,Gp=Fp&&jp((function(){var e=!0;try{Hp(".","d")}catch(Wk){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in e&&(a.hasIndices="d"),a)i(s,a[s]);return Object.getOwnPropertyDescriptor(Vp,"flags").get.call(t)!==n||r!==n}));Gp&&Up(Vp,"flags",{configurable:!0,get:Bp});var zp=$e,Kp=Cc,Wp=wt.f,Yp=zp("unscopables"),qp=Array.prototype;null==qp[Yp]&&Wp(qp,Yp,{configurable:!0,value:Kp(null)});var Zp,Xp,Jp,Qp=function(e){qp[Yp][e]=!0},$p=c,em=V,tm=rf,rm=Zr,nm=$e("iterator"),im=!1;[].keys&&("next"in(Jp=[].keys())?(Xp=tm(tm(Jp)))!==Object.prototype&&(Zp=Xp):im=!0);var am=null==Zp||$p((function(){var e={};return Zp[nm].call(e)!==e}));am&&(Zp={}),em(Zp[nm])||rm(Zp,nm,(function(){return this}));var sm={IteratorPrototype:Zp,BUGGY_SAFARI_ITERATORS:im},om=sm.IteratorPrototype,lm=Cc,cm=S,um=di,dm=Oo,hm=function(){return this},fm=$n,pm=p,mm=V,gm=function(e,t,r,n){var i=t+" Iterator";return e.prototype=lm(om,{next:cm(+!n,r)}),um(e,i,!1),dm[i]=hm,e},vm=rf,ym=oi,_m=di,Em=Kt,Sm=Zr,bm=Oo,Tm=Qt.PROPER,Rm=Qt.CONFIGURABLE,Am=sm.IteratorPrototype,wm=sm.BUGGY_SAFARI_ITERATORS,Lm=$e("iterator"),Cm="keys",Im="values",km="entries",Om=function(){return this},Dm=H,Pm=Qp,xm=Oo,Mm=Dr,Nm=wt.f,Fm=function(e,t,r,n,i,a,s){gm(r,t,n);var o,l,c,u=function(e){if(e===i&&m)return m;if(!wm&&e in f)return f[e];switch(e){case Cm:case Im:case km:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",h=!1,f=e.prototype,p=f[Lm]||f["@@iterator"]||i&&f[i],m=!wm&&p||u(i),g="Array"==t&&f.entries||p;if(g&&(o=vm(g.call(new e)))!==Object.prototype&&o.next&&(vm(o)!==Am&&(ym?ym(o,Am):mm(o[Lm])||Sm(o,Lm,Om)),_m(o,d,!0)),Tm&&i==Im&&p&&p.name!==Im&&(Rm?Em(f,"name",Im):(h=!0,m=function(){return pm(p,this)})),i)if(l={values:u(Im),keys:a?m:u(Cm),entries:u(km)},s)for(c in l)(wm||h||!(c in f))&&Sm(f,c,l[c]);else fm({target:t,proto:!0,forced:wm||h},l);return f[Lm]!==m&&Sm(f,Lm,m,{name:i}),bm[t]=m,l},Um=u,Bm="Array Iterator",jm=Mm.set,Hm=Mm.getterFor(Bm),Vm=Fm(Array,"Array",(function(e,t){jm(this,{type:Bm,target:Dm(e),index:0,kind:t})}),(function(){var e=Hm(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),Gm=xm.Arguments=xm.Array;if(Pm("keys"),Pm("values"),Pm("entries"),Um&&"values"!==Gm.name)try{Nm(Gm,"name",{value:"values"})}catch(Wk){}var zm,Km,Wm,Ym={exports:{}},qm=Mh,Zm=u,Xm=o,Jm=V,Qm=z,$m=Fe,eg=Li,tg=fe,rg=Kt,ng=Zr,ig=wt.f,ag=q,sg=rf,og=oi,lg=$e,cg=Ve,ug=Dr.enforce,dg=Dr.get,hg=Xm.Int8Array,fg=hg&&hg.prototype,pg=Xm.Uint8ClampedArray,mg=pg&&pg.prototype,gg=hg&&sg(hg),vg=fg&&sg(fg),yg=Object.prototype,_g=Xm.TypeError,Eg=lg("toStringTag"),Sg=cg("TYPED_ARRAY_TAG"),bg="TypedArrayConstructor",Tg=qm&&!!og&&"Opera"!==eg(Xm.opera),Rg=!1,Ag={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},wg={BigInt64Array:8,BigUint64Array:8},Lg=function(e){var t=sg(e);if(Qm(t)){var r=dg(t);return r&&$m(r,bg)?r[bg]:Lg(t)}},Cg=function(e){if(!Qm(e))return!1;var t=eg(e);return $m(Ag,t)||$m(wg,t)};for(zm in Ag)(Wm=(Km=Xm[zm])&&Km.prototype)?ug(Wm)[bg]=Km:Tg=!1;for(zm in wg)(Wm=(Km=Xm[zm])&&Km.prototype)&&(ug(Wm)[bg]=Km);if((!Tg||!Jm(gg)||gg===Function.prototype)&&(gg=function(){throw _g("Incorrect invocation")},Tg))for(zm in Ag)Xm[zm]&&og(Xm[zm],gg);if((!Tg||!vg||vg===yg)&&(vg=gg.prototype,Tg))for(zm in Ag)Xm[zm]&&og(Xm[zm].prototype,vg);if(Tg&&sg(mg)!==vg&&og(mg,vg),Zm&&!$m(vg,Eg))for(zm in Rg=!0,ig(vg,Eg,{get:function(){return Qm(this)?this[Sg]:void 0}}),Ag)Xm[zm]&&rg(Xm[zm],Sg,zm);var Ig={NATIVE_ARRAY_BUFFER_VIEWS:Tg,TYPED_ARRAY_TAG:Rg&&Sg,aTypedArray:function(e){if(Cg(e))return e;throw _g("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Jm(e)&&(!og||ag(gg,e)))return e;throw _g(tg(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(Zm){if(r)for(var i in Ag){var a=Xm[i];if(a&&$m(a.prototype,e))try{delete a.prototype[e]}catch(Wk){try{a.prototype[e]=t}catch(s){}}}vg[e]&&!r||ng(vg,e,r?t:Tg&&fg[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(Zm){if(og){if(r)for(n in Ag)if((i=Xm[n])&&$m(i,e))try{delete i[e]}catch(Wk){}if(gg[e]&&!r)return;try{return ng(gg,e,r?t:Tg&&gg[e]||t)}catch(Wk){}}for(n in Ag)!(i=Xm[n])||i[e]&&!r||ng(i,e,t)}},getTypedArrayConstructor:Lg,isView:function(e){if(!Qm(e))return!1;var t=eg(e);return"DataView"===t||$m(Ag,t)||$m(wg,t)},isTypedArray:Cg,TypedArray:gg,TypedArrayPrototype:vg},kg=o,Og=c,Dg=ml,Pg=Ig.NATIVE_ARRAY_BUFFER_VIEWS,xg=kg.ArrayBuffer,Mg=kg.Int8Array,Ng=!Pg||!Og((function(){Mg(1)}))||!Og((function(){new Mg(-1)}))||!Dg((function(e){new Mg,new Mg(null),new Mg(1.5),new Mg(e)}),!0)||Og((function(){return 1!==new Mg(new xg(2),1,void 0).length})),Fg=z,Ug=Math.floor,Bg=Number.isInteger||function(e){return!Fg(e)&&isFinite(e)&&Ug(e)===e},jg=en,Hg=RangeError,Vg=function(e){var t=jg(e);if(t<0)throw Hg("The argument can't be less than 0");return t},Gg=RangeError,zg=function(e,t){var r=Vg(e);if(r%t)throw Gg("Wrong offset");return r},Kg=la,Wg=p,Yg=Zi,qg=xe,Zg=un,Xg=Yo,Jg=jo,Qg=Mo,$g=Ig.aTypedArrayConstructor,ev=O,tv=Array.isArray||function(e){return"Array"==ev(e)},rv=Ki,nv=z,iv=$e("species"),av=Array,sv=function(e){var t;return tv(e)&&(t=e.constructor,(rv(t)&&(t===av||tv(t.prototype))||nv(t)&&null===(t=t[iv]))&&(t=void 0)),void 0===t?av:t},ov=la,lv=N,cv=xe,uv=un,dv=function(e,t){return new(sv(e))(0===t?0:t)},hv=L([].push),fv=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,a=6==e,s=7==e,o=5==e||a;return function(l,c,u,d){for(var h,f,p=cv(l),m=lv(p),g=ov(c,u),v=uv(m),y=0,_=d||dv,E=t?_(l,v):r||s?_(l,0):void 0;v>y;y++)if((o||y in m)&&(f=g(h=m[y],y,p),e))if(t)E[y]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return y;case 2:hv(E,h)}else switch(e){case 4:return!1;case 7:hv(E,h)}return a?-1:n||i?i:E}},pv={forEach:fv(0),map:fv(1),filter:fv(2),some:fv(3),every:fv(4),find:fv(5),findIndex:fv(6),filterReject:fv(7)},mv=V,gv=z,vv=oi,yv=function(e,t,r){var n,i;return vv&&mv(n=t.constructor)&&n!==r&&gv(i=n.prototype)&&i!==r.prototype&&vv(e,i),e},_v=$n,Ev=o,Sv=p,bv=u,Tv=Ng,Rv=Ig,Av=yp,wv=_i,Lv=S,Cv=Kt,Iv=Bg,kv=ln,Ov=jh,Dv=zg,Pv=ut,xv=Fe,Mv=Li,Nv=z,Fv=de,Uv=Cc,Bv=q,jv=oi,Hv=Xr.f,Vv=function(e){var t,r,n,i,a,s,o=Yg(this),l=qg(e),c=arguments.length,u=c>1?arguments[1]:void 0,d=void 0!==u,h=Jg(l);if(h&&!Qg(h))for(s=(a=Xg(l,h)).next,l=[];!(i=Wg(s,a)).done;)l.push(i.value);for(d&&c>2&&(u=Kg(u,arguments[2])),r=Zg(l),n=new($g(o))(r),t=0;r>t;t++)n[t]=d?u(l[t],t):l[t];return n},Gv=pv.forEach,zv=gi,Kv=wt,Wv=l,Yv=yv,qv=Dr.get,Zv=Dr.set,Xv=Dr.enforce,Jv=Kv.f,Qv=Wv.f,$v=Math.round,ey=Ev.RangeError,ty=Av.ArrayBuffer,ry=ty.prototype,ny=Av.DataView,iy=Rv.NATIVE_ARRAY_BUFFER_VIEWS,ay=Rv.TYPED_ARRAY_TAG,sy=Rv.TypedArray,oy=Rv.TypedArrayPrototype,ly=Rv.aTypedArrayConstructor,cy=Rv.isTypedArray,uy="BYTES_PER_ELEMENT",dy="Wrong length",hy=function(e,t){ly(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},fy=function(e,t){Jv(e,t,{get:function(){return qv(this)[t]}})},py=function(e){var t;return Bv(ry,e)||"ArrayBuffer"==(t=Mv(e))||"SharedArrayBuffer"==t},my=function(e,t){return cy(e)&&!Fv(t)&&t in e&&Iv(+t)&&t>=0},gy=function(e,t){return t=Pv(t),my(e,t)?Lv(2,e[t]):Qv(e,t)},vy=function(e,t,r){return t=Pv(t),!(my(e,t)&&Nv(r)&&xv(r,"value"))||xv(r,"get")||xv(r,"set")||r.configurable||xv(r,"writable")&&!r.writable||xv(r,"enumerable")&&!r.enumerable?Jv(e,t,r):(e[t]=r.value,e)};bv?(iy||(Wv.f=gy,Kv.f=vy,fy(oy,"buffer"),fy(oy,"byteOffset"),fy(oy,"byteLength"),fy(oy,"length")),_v({target:"Object",stat:!0,forced:!iy},{getOwnPropertyDescriptor:gy,defineProperty:vy}),Ym.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",a="get"+e,s="set"+e,o=Ev[i],l=o,c=l&&l.prototype,u={},d=function(e,t){Jv(e,t,{get:function(){return function(e,t){var r=qv(e);return r.view[a](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=qv(e);r&&(i=(i=$v(i))<0?0:i>255?255:255&i),a.view[s](t*n+a.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};iy?Tv&&(l=t((function(e,t,r,i){return wv(e,c),Yv(Nv(t)?py(t)?void 0!==i?new o(t,Dv(r,n),i):void 0!==r?new o(t,Dv(r,n)):new o(t):cy(t)?hy(l,t):Sv(Vv,l,t):new o(Ov(t)),e,l)})),jv&&jv(l,sy),Gv(Hv(o),(function(e){e in l||Cv(l,e,o[e])})),l.prototype=c):(l=t((function(e,t,r,i){wv(e,c);var a,s,o,u=0,h=0;if(Nv(t)){if(!py(t))return cy(t)?hy(l,t):Sv(Vv,l,t);a=t,h=Dv(r,n);var f=t.byteLength;if(void 0===i){if(f%n)throw ey(dy);if((s=f-h)<0)throw ey(dy)}else if((s=kv(i)*n)+h>f)throw ey(dy);o=s/n}else o=Ov(t),a=new ty(s=o*n);for(Zv(e,{buffer:a,byteOffset:h,byteLength:s,length:o,view:new ny(a)});u<o;)d(e,u++)})),jv&&jv(l,sy),c=l.prototype=Uv(oy)),c.constructor!==l&&Cv(c,"constructor",l),Xv(c).TypedArrayConstructor=l,ay&&Cv(c,ay,i);var h=l!=o;u[i]=l,_v({global:!0,constructor:!0,forced:h,sham:!iy},u),uy in l||Cv(l,uy,n),uy in c||Cv(c,uy,n),zv(i)}):Ym.exports=function(){},(0,Ym.exports)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var yy=ot,_y=TypeError,Ey=of,Sy=function(e){var t=yy(e,"number");if("number"==typeof t)throw _y("Can't convert number to bigint");return BigInt(t)},by=Li,Ty=p,Ry=c,Ay=Ig.aTypedArray,wy=Ig.exportTypedArrayMethod,Ly=L("".slice);wy("fill",(function(e){var t=arguments.length;Ay(this);var r="Big"===Ly(by(this),0,3)?Sy(e):+e;return Ty(Ey,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),Ry((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var Cy=o,Iy=p,ky=Ig,Oy=un,Dy=zg,Py=xe,xy=c,My=Cy.RangeError,Ny=Cy.Int8Array,Fy=Ny&&Ny.prototype,Uy=Fy&&Fy.set,By=ky.aTypedArray,jy=ky.exportTypedArrayMethod,Hy=!xy((function(){var e=new Uint8ClampedArray(2);return Iy(Uy,e,{length:1,0:3},1),3!==e[1]})),Vy=Hy&&ky.NATIVE_ARRAY_BUFFER_VIEWS&&xy((function(){var e=new Ny(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));jy("set",(function(e){By(this);var t=Dy(arguments.length>1?arguments[1]:void 0,1),r=Py(e);if(Hy)return Iy(Uy,this,r,t);var n=this.length,i=Oy(r),a=0;if(i+t>n)throw My("Wrong length");for(;a<i;)this[t+a]=r[a++]}),!Hy||Vy);var Gy=gf,zy=Math.floor,Ky=function(e,t){var r=e.length,n=zy(r/2);return r<8?Wy(e,t):Yy(e,Ky(Gy(e,0,n),t),Ky(Gy(e,n),t),t)},Wy=function(e,t){for(var r,n,i=e.length,a=1;a<i;){for(n=a,r=e[a];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==a++&&(e[n]=r)}return e},Yy=function(e,t,r,n){for(var i=t.length,a=r.length,s=0,o=0;s<i||o<a;)e[s+o]=s<i&&o<a?n(t[s],r[o])<=0?t[s++]:r[o++]:s<i?t[s++]:r[o++];return e},qy=Ky,Zy=Z.match(/firefox\/(\d+)/i),Xy=!!Zy&&+Zy[1],Jy=/MSIE|Trident/.test(Z),Qy=Z.match(/AppleWebKit\/(\d+)\./),$y=!!Qy&&+Qy[1],e_=L,t_=c,r_=ve,n_=qy,i_=Xy,a_=Jy,s_=re,o_=$y,l_=Ig.aTypedArray,c_=Ig.exportTypedArrayMethod,u_=o.Uint16Array,d_=u_&&e_(u_.prototype.sort),h_=!(!d_||t_((function(){d_(new u_(2),null)}))&&t_((function(){d_(new u_(2),{})}))),f_=!!d_&&!t_((function(){if(s_)return s_<74;if(i_)return i_<67;if(a_)return!0;if(o_)return o_<602;var e,t,r=new u_(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(d_(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));c_("sort",(function(e){return void 0!==e&&r_(e),f_?d_(this,e):n_(l_(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!f_||h_);var p_=$n,m_=gs,g_=c,v_=Y,y_=V,__=$i,E_=Hl,S_=Zr,b_=m_&&m_.prototype;if(p_({target:"Promise",proto:!0,real:!0,forced:!!m_&&g_((function(){b_.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=__(this,v_("Promise")),r=y_(e);return this.then(r?function(r){return E_(t,e()).then((function(){return r}))}:e,r?function(r){return E_(t,e()).then((function(){throw r}))}:e)}}),y_(m_)){var T_=v_("Promise").prototype.finally;b_.finally!==T_&&S_(b_,"finally",T_,{unsafe:!0})}var R_=pt("span").classList,A_=R_&&R_.constructor&&R_.constructor.prototype,w_=A_===Object.prototype?void 0:A_,L_=o,C_={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},I_=w_,k_=Vm,O_=Kt,D_=$e,P_=D_("iterator"),x_=D_("toStringTag"),M_=k_.values,N_=function(e,t){if(e){if(e[P_]!==M_)try{O_(e,P_,M_)}catch(Wk){e[P_]=M_}if(e[x_]||O_(e,x_,t),C_[t])for(var r in k_)if(e[r]!==k_[r])try{O_(e,r,k_[r])}catch(Wk){e[r]=k_[r]}}};for(var F_ in C_)N_(L_[F_]&&L_[F_].prototype,F_);function U_(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U_(Object(r),!0).forEach((function(t){Yl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}N_(I_,"DOMTokenList");const j_="httpRequest";const H_=new class{constructor(){this.defaultRequestOption={method:"GET",mode:"cors",cache:"default",referrerPolicy:"strict-origin-when-cross-origin"}}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Oh.REQUEST_DEFAULT_TIMEOUT,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5?arguments[5]:void 0,s=null,o=null;i=i||1;let l=0;for(;l<i;)for(let c=0;c<e.length;c++){let u=null;const d={};s=X_.generateRandomId(16,10),$_.debug(j_,"[HTTP_ID:".concat(s,"] fetch request start: ").concat($_.shieldUrlParameters(e[c])));try{this.extendInfosHandle(e[c],"start",d,a),u=await this.doFetch(e[c],t,r,n,s),this.extendInfosHandle(e[c],"end",d,a,u),$_.debug(j_,"[HTTP_ID:".concat(s,"] fetch request success"))}catch(Wk){$_.error(j_,"[HTTP_ID:".concat(s,"], requestUrl: ").concat($_.shieldUrlParameters(e[c]),", fetch request failed")),this.extendInfosHandle(e[c],"end",d,a,Wk),c>=e.length-1&&(l++,l<i&&await X_.sleep(500*X_.getRandom()+500)),o=Wk}if(u)return o=null,u}if(o)throw o}doFetch(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,s=null,o=null;AbortController&&(s=new AbortController,o=s.signal);const l=new Promise(((e,r)=>{t=setTimeout((()=>{clearTimeout(t),r(new xh(Dh.HWLLS_ERROR_SERVER_NO_RESPONSE)),s&&s.abort()}),i)})),c=new Promise(((i,s)=>{let l=null;l=o?fetch(e,B_(B_(B_(B_({},this.defaultRequestOption),r),{headers:n}),{signal:o})):fetch(e,B_(B_(B_({},this.defaultRequestOption),r),{headers:n})),l.then((t=>{if(/webrtc\/v1\/pullstream/gi.test(e)&&X_.syncLocalTime(t.headers.get("Date")),!t.ok)return $_.error(j_,"[HTTP_ID:".concat(a,"] doFetch failed: ").concat(t.status)),void(t.status>=500||0===t.status?s(new xh(Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL,"".concat(t.status," _ ").concat(t.statusText||"fetch failed","."))):i({httpCode:t.status}));let r;const o=t.headers.get("Content-Type")||n["Content-Type"];r=/.*application\/json.*/.test(o)?t.json():/^text.*/.test(o)?t.text():t.arrayBuffer(),r.then((e=>{i({httpCode:t.status,data:e})})).catch((t=>{$_.error(j_,"[HTTP_ID:".concat(a,"], requestUrl: ").concat($_.shieldUrlParameters(e),", doFetch get response failed: ").concat(t)),s(new xh(Dh.HWLLS_INTERNAL_ERROR,t.message||"get respone error."))}))})).catch((t=>{$_.error(j_,"[HTTP_ID:".concat(a,"], requestUrl: ").concat($_.shieldUrlParameters(e),", doFetch failed for exception: ").concat(t)),s(new xh(Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL,t.getMsg?t.getMsg():t.message))})).finally((()=>{clearTimeout(t)}))}));return Promise.race([l,c])}extendInfosHandle(e,t,r,n,i){n&&("start"===t?Object.assign(r,{id:n.length+1,domain:e,start_ms:X_.getCurrentLocalTimestamp(),end_ms:0,rspCode:"",errMsg:""}):"end"===t?(i instanceof xh?(r.end_ms=X_.getCurrentLocalTimestamp(),r.rspCode=i.getCode(),r.errMsg=i.getMsg()):(r.end_ms=X_.getCurrentLocalTimestamp(),r.rspCode=i.httpCode),r.delay_ms=r.end_ms-r.start_ms,n.push(r)):$_.info(j_,"cannot handle"))}},V_=1e4,G_="HWLLSReport";const z_=new class{constructor(){this.records=[],this.initEmergencyReport(),this.regularReport(Oh.OPS_REPORT_INTERVAL)}async addRecord(e){this.records.push(e),this.records.length>V_&&this.records.splice(0,this.records.length-V_)}immediateReportRecords(){0!==this.records.length&&X_.getAreaDetectionCompleted()&&this.reportRecords(this.records)}initEmergencyReport(){window.onbeforeunload=()=>{$_.info(G_,"app is closing, emergency report"),0!==this.records.length&&X_.getAreaDetectionCompleted()&&this.reportRecordsEmergency(this.records)}}async sendRequest(e,t){try{var r;const t=this.getReportUrl(),n=await H_.fetch([t],{method:"POST",body:JSON.stringify({request_id:X_.generateStandardUuid(),timestamp:Math.round(X_.getCurrentSyncTimestamp()/1e3),logs:e})},{"Content-Type":"application/json;charset=UTF-8",Authorization:Oh.OPS_AUTH_TOKEN});if(n.httpCode&&0!=(null===(r=n.data)||void 0===r?void 0:r.Code))throw $_.error(G_,"sendRequest and get fail Respone: ".concat(JSON.stringify(n))),new xh(Dh.HWLLS_INTERNAL_ERROR)}catch(Wk){$_.error(G_,"sendRequest failed"),t.push(...e)}}async reportRecords(e){const t=[],r=[];do{r.push(this.sendRequest(e.splice(0,50),t))}while(e.length>0);Promise.all(r).finally((()=>{this.records.push(...t),t.length=0,this.records.length>V_&&this.records.splice(0,this.records.length-V_)}))}async reportRecordsEmergency(e){if(!navigator.sendBeacon)return void this.reportRecords(e);const t=this.getReportUrl();navigator.sendBeacon(t,new Blob([JSON.stringify({request_id:X_.generateStandardUuid(),timestamp:Math.round(X_.getCurrentSyncTimestamp()/1e3),logs:e})],{type:"application/json;charset=UTF-8"}))}regularReport(e){this.reportInterval&&clearInterval(this.reportInterval),this.reportInterval=setInterval((()=>{0!==this.records.length&&X_.getAreaDetectionCompleted()&&this.reportRecords(this.records)}),e)}getReportUrl(){return"https://".concat(Oh.OPS_REPORT_DOMAIN,"/v2/log/log_report?service=LLL")}},K_=window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto,W_={Mac:/(mac os x)\s+([\w_]+)/,Windows:/(windows nt)\s+([\w.]+)/,Ios:/(i(?:pad|phone|pod)).*cpu(?: i(?:pad|phone|pod))? os (\d+(?:[.|_]\d+)+)/,Android:/(android)\s+([\d.]+)/,Ipad:/(ipad).*os\s([\d_]+)/,Iphone:/(iphone\sos)\s([\d_]+)/,Linux:/(x11;)\s(linux)\s(x86_64|mips64|aarch64)/,ChromiumOS:/(x11;)\s(cros)\s(x86_64|mips64|aarch64)\s([\w.]+)\)/},Y_=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","_"],q_="CommonUtil",Z_="https://".concat(Oh.GSLB_DOMAIN,"/v1/live/dns?dns=").concat(Oh.SHARE_PULL_DOMAIN[0],"&withdomain=1&dualstack=1");const X_=new class{constructor(){this.uuidCount=0,this.timeDiff=0,this.platform=(()=>{const e=navigator.userAgent.toLowerCase(),t=e.match(/(micromessenger)\/([\w.()]+)/i),r=t?" -WeChat".concat(t[2]):"";let n;for(const i in W_)if(Object.prototype.hasOwnProperty.call(W_,i)){const t=e.match(W_[i]);if(t)return n="Ios"===i?t[2].replace(/_/g,"."):"Linux"===i?t[3]:"ChromiumOS"===i?t[4]:t[2],"".concat(i," ").concat(n).concat(r)}return"unknown"})(),this.browserVersion=(()=>{const e=navigator.userAgent.match(/(chrome|CriOS|safari|firefox|microMessenger)\/(\d+(\.\d+)*)/i);if(e&&e.length>2){let t=e[2];if(/safari/gi.test(e[1])){const e=/.*Version\/([\d\.]+)\s.*/gi.exec(navigator.userAgent);e&&2===e.length&&(t=e[1])}return"".concat("CriOS"===e[1]?"Chrome":e[1],"-").concat(t)}return e&&e.length>1?e[1]:""})(),this.areaDetectionCompleted=!1,this.responeInfo={gslbRequestUrl:"",respone:null}}async sleep(e){return new Promise((t=>{const r=setTimeout((()=>{clearTimeout(r),t()}),e)}))}getDeviceID(){return this.deviceID||(this.deviceID=this.generateStandardUuid()),this.deviceID}generateStandardUuid(){let e;if(K_&&(e="function"==typeof K_.randomUUID?K_.randomUUID():""),!e){let t=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),e="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,(()=>{const e=(t+16*this.getRandom())%16|0;return t=Math.floor(t/16),e.toString(16)}))}return e}getRandom(){return this.getRandomArray(1)[0]/256}generateUuid(e){let t="";const r=this.getRandomArray(33),n=e?22:33;for(let s=0;s<n;s++)t+=Y_[Math.round(r[s]%64)];let i="";for(let s=0;s<33-n;s++)i+=Y_[63&e],e>>=6;let a=this.uuidCount.toString(16);for(let s=3-a.length;s>0;s--)a="0"+a;return this.uuidCount>4094?this.uuidCount=0:this.uuidCount++,"".concat(t).concat(i).concat(a)}generateRandomId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:62,r="";const n=this.getRandomArray(e);for(let i=0;i<e;i++)r+=Y_[Math.round(n[i]%t)];return r}getPlatform(){return this.platform}getBrowserVersion(){return this.browserVersion}syncLocalTime(e){try{if(e){console.debug(q_,"syncLocalTime, serverTime: ".concat(e));const t=new Date(e).getTime();this.timeDiff=(new Date).getTime()-t,console.debug(q_,"syncLocalTime, timeDiff: ".concat(this.timeDiff))}}catch(Wk){console.error(q_,"syncLocalTime error: ".concat(Wk))}}getTimeDiff(){return this.timeDiff}getCurrentLocalTimestamp(){return(new Date).getTime()}getCurrentSyncTimestamp(){return Math.abs(this.timeDiff)>=36e5?(new Date).getTime()-this.timeDiff:(new Date).getTime()}getCurrentTimeInfo(){const e=new Date(this.getCurrentLocalTimestamp()),t=e.getFullYear(),r=e.getMonth()+1,n=r<10?"0".concat(r):r,i=e.getDate(),a=i<10?"0".concat(i):i,s=e.getHours(),o=s<10?"0".concat(s):s,l=e.getMinutes(),c=l<10?"0".concat(l):l,u=e.getSeconds(),d=u<10?"0".concat(u):u,h=e.getMilliseconds(),f="".concat(h+1e3).substring(1),p=e.getTimezoneOffset()/60,m=p>=0?p:-p,g=(p<=0?"+":"-")+(m<10?"0".concat(m):"".concat(m))+":00";return{year:"".concat(t),month:"".concat(n),day:"".concat(a),hour:"".concat(o),min:"".concat(c),sec:"".concat(d),millsec:f,zoneOff:g}}adjustTimeByServerTime(e){return e-this.timeDiff}convertString2Timestamp(e){return new Date(e).getTime()}generateStreamId(){return"2xxxxxxx-8xxx-xxxx-yxxx-xxxx".replace(/[xy]/g,(e=>{const t=16*this.getRandom()|0;return("x"==e?t:3&t|8).toString(16)}))}isWKWebview(){return/I.*-WeChat.*/gi.test(this.platform)}isAppleDevice(){return/^(Mac|I).*/gi.test(this.platform)}isMobileDevice(){return!/^(Mac|Windows).*/gi.test(this.platform)}isTencentX5BrowserKernel(){return/.*(tbs|xweb).*/gi.test(navigator.userAgent)}isMobileWeChatBrowser(){return this.isMobileDevice()&&/.*MicroMessenger.*/gi.test(navigator.userAgent)}dnsRequestEncode(e){const t=new DataView(new ArrayBuffer(12)),r=32767&(e.flags||0);t.setUint16(0,e.id||0),t.setUint16(2,0|r),t.setUint16(4,e.questions.length),t.setUint16(6,0),t.setUint16(8,0),t.setUint16(10,0);const n=e.questions[0].name.split("."),i=new Uint8Array(n.length+e.questions[0].name.replace(/\./gi,"").length+1),a=new TextEncoder;let s=0;for(let c=0;c<n.length;c++)i[c+s]=n[c].length,i.set(a.encode(n[c]),c+1+s),s+=n[c].length;i[i.byteLength-1]=0;const o=new DataView(new ArrayBuffer(4));o.setUint16(0,1),o.setUint16(2,1);const l=new Uint8Array(i.byteLength+t.byteLength+o.byteLength);return l.set(new Uint8Array(t.buffer),0),l.set(i,t.byteLength),l.set(new Uint8Array(o.buffer),t.byteLength+i.byteLength),window.btoa((new TextDecoder).decode(l)).replace(/=/gi,"")}getAppUrl(){const{origin:e,pathname:t}=window.location;return"".concat(e).concat(t)}getValue(e,t){return e||t}setValue(e,t){return!e||e<0?t:e}createLoadingMask(){const e=document.createElement("div");return e.setAttribute("id","loadingMask"),e.style.display="block",e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style["z-index"]=99,e.style.background="rgba(0,0,0,0.8) url(data:image/jpeg;base64,R0lGODlhgACAAOMAAP///93d3bu7u5mZmf///wAAAAAAAAAAAP///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oCKxA6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEgLYwIlaGngHVlE2a+KOvt/wZzz2FbvotJrDJpPMobh8rqnbVW9nel58G35/IHgeg3uFGIdagD+Cg450h5I5IoxgloaYMoEgnJ6XfqGTo4ylpqcfihqcnax9oB6wGaS0n7YcuBeyu61sr6IcusK8dbfGsavJw20dvxXI0LWuRM0Y1tcZkJEa1BLB3tGIGOME3eaPkNqpueztF+/wQM6VfAL8Ain24vDJ03cCzYl+/VAATDEvT5wSCCOe6IXiGRyCISJqLEGxIEaH/g05aBxJYlkMPSRkNQIxkuQIaTUMUlIJseVGetxUrhRh0yVOcjp3kuh5s11QoSaISjR3lJANpQihNZ21A2pCVlOPWOVXKmuSrZaaVoEaVuccomVDRumZ9uO+oo7cWoqKFenPu3jz6t3Lt6/fv4ADCx5MuDDhqeWMIrZIYXHia467RX4sbLI1y4wrY0Y5YTNnqZ5lAg3tFDRpqutIKw4NzDNO1oZjy55Nu7bt27hz697Nu/cO0Z6Ad/0cl3ghymqQW6FZXC2SoG2d9xDb3GwSr9GZC8EenDoP7rTAvxCv+ehJ70zRmyCf3vx693vVq7K+ya7H0iC155eeUzjDhzPx2NeagAMC6EJm8yG4iIIJ+veecfXJtaCD+1GYEoMNohahhgFa2Jl9o0E403EYfuhhiAb2pVxjEprY4k/SlYjiiau9OCN+/dnYnogWyHgjjncJ6OOPHNIjpI5E6kXgkEkGuSSSRBZpGo850sgilN0x+WOGVmZJZZUg9qgliVi62OWVXw5X5pYVhlldih+MaeaZYay4gZxRTglnnGvO6WZyffop5TGBOoGnoBftWRedYqZ5p6Lh/TkQpHwCKduhvrGZ6YaMbqqpp5VSCiqYlo6aj6SmupjqqqZGAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oGKxB6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEgRYwYlaAngBVlE2a+KOvt/wZzz2FbvotJrDJpPMobh8rqnbVW9nel58G35/IHgeg3uFGIdagD+Cg450h5I5IoxgloaYMoEgnJ6XfqGTo4ylpqcfihqcnax9oB6wGaS0n7YcuBeyu61sr6IcusK8dbfGsavJw20dvxXI0LWuRM0Y1tcZkJEa1BLB3tGIGOME3eaPkNqpueztF+/wQM6VfAP8Ayn24vDJ03einz8TBvmhAJhiXoiEB0dA7HeiF4pnJSYqlKhx4wiL/icwiujo8SHJkiCWxdBD4iTKDy5fepBWA03LmBljRqRnQedOjjp5UvD5M2dQekRjJDW3tEbTXU9vRHU0dUdVNVd5+LS0VQpOqi7nnORKEqxGsmc9TSy1FipFVgaFyp1Lt67du3jz6t3Lt6/fv4AD9yTakSfhwoMPp/WmGPGExmWvQXZMYPLiZJbbSsgMkTHnuI8/v4UmevRm0e1KX/hsmLPg17Bjy55Nu7bt27hz6959U+Y+02w7qxWOVvPvy1gjFxqbnPnysF6PPv+KJKsV60q7BpduVbtb7jCwDwePQvx26gW9tyZvEj1d9SDYdwDtFDhM9/edt7dfPmFv5fsZ4hcgf0b595+A+RF3IIEL+paggUAx+CB9KVC2YHoOxofcahKehmCE0ymIgYgcfviehYlBOCKKJ5o4lIuhwYgUixVsmCKJctFYo4we4riejzd2GCOQTNlYoooa6OgZj0NSuIGSmEH5IpE7GkmalUc6+SSW3zHZpJBTelkckhxwGSSYY2pZpphfohkimWtSmaWatEg5Z4YZ2CmWnlXCGSebVfDZJ51/+pkmnkkCGiahZhlaqJtnFgWXo48imiij40mqoZxbWsqXmbytyGmokZI6kqKkgmrqopCuWhmlrh4Z66yuRgAAIfkEBQUABAAsAAAAAIAAgAAABP6QyEmrvTjrzbv/YCiOZGmeqCisQuq+cMiycW3b83zvfJnTvaBw81sNj8hJsZVsBpfO6A4qrRIG2MGJWgp4A1ZRNmvijr7f8Gc89hW76LSawyaTzKG4fK6p21VvZ3pefBt+fyB4HoN7hRiHWoA/goOOdIeSOSKMYJaGmDKBIJyel36hk6OMpaanH4oanJ2sfaAesBmktJ+2HLgXsrutbK+iHLrCvHW3xrGrycNtHb8VyNC1rkTNGNbXGZCRGtQSwd7RiBjjBN3mj5Daqbns7Rfv8EDOlXzSJ/bi+PL0nQBAEEA/YgezpZgXomDBEv5I9ELxrITDixLBQVRIUaCIi/4gM4ILF2JZDD0kQKoUOZLlDTQpVYZk2ZIeBpkrTYxEaFMCzpwodvIz93PmC6HokhXFaAMpFmhLHQZxStJS1IdDqJa6SrCJU6tXqwgFW3ROzUJlC2l09LMURz5AWQ0la7Cn3bt48+rdy7ev37+AAwseTLhwBapr2yGOOGFx4muOGUd+LGxyRMsTd2FWuNkktM48r4BOSms0OtOKR9frbBO04dewY8ueTbu27du4c+ve7VIuaUdvzXoGzlgN5TBn9x2PMpZ4cq9ILX1NotVTdSHXrU/nkb309hjdk4VP2Dx19BTjzaVfc17v95Ll4T9t+vtc8A7xQQx3sZ/9c/+ZAdU4F3kDCtifB8XJF1pQ9xlYXzQMNjhCggrOt5GFOgV42IMSUKigWhpScOCGEva0nIglnmiXh42VKJqL6rHYoYsq0iPjjCOSmKN5O6LYY4swiheijgWuFqRmQxLJoY8/Ipkkk0UaeaR2Uz4JZZSV3XglhvZxCZmVW1bVpY1ghilGmcpNieOC+KFpnJtrYvkNnFLUOGeTFtiZJp55qgkkn1bQGeeSd7Lplp9/yomNoYcquqijhXrppJgVErpobYLylulum+rWaW6f4haqqIzyBqCpqKbKQQQAIfkEBQUABAAsAAAAAIAAgAAABP6QyEmrvTjrzbv/YCiOZGmeqDisQ+q+cMiycW3b83zvfJnTvaBw81sNj8hJsZVsBpfO6A4qrRJ0JmpJwBVYVbls0dTtfj9a8G9bNp85admY1Ha/NUumOjyq2+8YeXogcR5+f4AXeSOFHYdeiUSNkmshj5Fwk3hzIJeYlJVonIaHn5maiqMcj5Cmm6qgWKR+rqewGagVrLW2fB25FJ68sbLERo6lw73Fr74bwsrNzri3FtDR1MDAu9jLQNLfGdfdgYvgx+Lj5KnVFKHptHfMJObNq8knAfoBJ+/0wJ3wldi3zwfAc4NQCBxBsOG/envmkYnHsKFDRoLQyZF4og4Ji/4gH2YUeaPMR5AWDWbUuK4CypBiVrJc9xImCpnhsNVMCQPnTF47L9bwmdBUUIJPfLo6WnAI0U9M9TVRmihqFZmRjr4ZWbVmIkFZX35qZ8WmKY5vkLZcy7at27dw48qdS7eu3bt48+qNSZSsKwCAAwseTHgwu74HARVezFhwBcQrsTWezNgdZLDRKGs2rOQyRF6bQwOw7NlvItGbH5eeNgz15MOlW7pevLe27du4c+vezbu379/Ag/NAe4b4Vn/ykB9PfARz8s/FnVvB+jWyFKqAsDfXnp37cO/dcSYVP+wpDvC1zL9Q3409X+ts3UeU7hb9L+p7bhjPxnW+6XL7zdAnEnQe9OdfUe/lRAh9ovyHUE8O8sdagwoeiKBKym1U4YI/WWiLNx1qGF6GpG1Y4oT1EXiiiRIwmKJp2jBXnoorhtiZjOkBpCOOZx3kI4+Y0KgaiUMSGY2QRQbYIpDPRZiYi0cyJyWTX0AJIIpXGtljhEtqmaSS1XHZJZYSgtkkmVmymKaakSC55oXG2BimmGOaeSOdUbj55oB2XodnnWyWKeeZge7J56CEJohome0VKiicBTpKF5XBUQqcpb9h6pumvXHaKZrC3bdoqKSWSkAEACH5BAUFAAQALAAAAACAAIAAAAT+kMhJq7046827/2AojmRpnqg4rEPqvnDIsnFt2/N873yZ072gcPNbDY/ISbGVbAaXzugOKq0SdCaqD2gF/bJFMLbb0arCJDM5o/aiR+21Zck8f+FxOYVed99ldHpEeYN/foaCGIGAiGWEiUqPim8fi5Aalh6Sc5uXfIdjjp2eoxKlV6eJn5qUha2XmKWyqaSvk423uLCxthejmbuiuhWdwMEcq7w5yMbHrsvPXGy0x8m5ob7NztHS133e3VbYaZvjnL0hAuoCJ8OV1NPoH+vrW/LC5vbQJfT95Nr4wonZJ6KfwX/WQH1L4U6DwYcIE74zgkNgh4cQI0rchgFjRn3+fChyvODxY7uQ+Y6VPAgDZUpYK/1VdLnwUkx6T2jWlHOz3hCdO7v0VNdEZ6KhVVwejbkm5FKPgjZaKVnrZRWTVXfhHMm1q9evYMOKHUu2rNmzaNOqXcs2HtB7sALInUu3rt262d4CjHu3r9+5xPQ65fi3sN89gqVeMswYb6TE8KI0nhwAMWS4eig3DnzZKiTNhfN2/gq6b9vTqFOrXs26tevXsGPLnn3WcxUAuAFUayglt++qvJv4Hq5bz2A9xIc3RZkoOfGkNJs7f54E6KXpyY9Yh4WdOo/tx7orn6mUq/jfLY16PZ/bBXiw7HGfLF82Psi9ym7YvsBeI2bRIr3GEBx/4vm3H4AWGVhCdwYGxcqADxI0wnT3oYAfIxBm4B1CDJWT4GMZatieHBfydqFXiplyT4pflQjXiSOxiIqJMG5zYjGRqfLLfzUGA+OO//k4C4Q9QiIjiAceCUuPpxRpHJNBzhjlk1Om4iQZTtJypThaTimlhLt5+eWHboG55JXUKNnFlvBsWZSYKoZomZlGwjlmgBgeuCadEep5Dpk64mkHnxHGliNtcRKKaECCLqpQo472CWik4DhIqTKQXiqMppx2akEEACH5BAUFAAQALAAAAACAAIAAAAT+kMhJq7046827/2AojmRpnqg4rEPqvnDIsnFt2/N873yZ072gcPNbDY/ISbGVbAaXzugOKq0SdCaqD2gF/bJFMLbb0arCJDM5o/aiR+21Zck8f+FxOYVed99ldHpEeYN/foaCGIGAiGWEiUqPim8fi5Aalh6Sc5uXfIdjjp2eoxKlV6eJn5qUha2XmKWyqaSvk423uLCxthejmbuiuhWdwMEcq7w5yMbHrsvPXGy0x8m5ob7NztHS133e3VbYaZvjnL2M33bh69Au2qDqldR76HjDrPbK+vvsW/jczAmDF60GwGl85A0kqOyGQGYJFS5kuC1SRIn5LlZEqDHFRX/+1T5ivNdxo8iR/0oGO/lE5C6WQ2CqcpmEph6bTlSu0Skl4UyKNYEGpdfSnSB+XR6SUbqxqdOnUKNKnUq1qtWrWLNq3cq160lrGwWIHUu2rNmy2b4K1XO2rVuyxNT6rPi2rtt6cteSscsXrcW8SOX0HSwAL+CDbAnzjXuYKSTFddM2hgq5bdfLmDNr3sy5s+fPoEOLHv3ZcZUAqAOENKontetagZG4nq36JlgytGfvjJgoN+0qONf4zt1EpqDhxGMGP45cdw/ju5o7N7j8mPTXMKBXvJ76XfWm3FGf+A41fMrbGW8AWA+ABHdyc9uhFMGevXvp8IkSvVC/fonm+bHKJp8RL/RnnwnDnTdfQAt6YOCBCE6Xn0flgDTBg+ulgN1u/ByEYXtaoWcYUx+CiBVFm3yYlYgjWihBiScWg5SKVgk1Co1U2RgYjlKtVQqPT7F4joAZwBiVXqcAaRKSsRFgpFN6oYIYBUo6E6WURG5Q5Uq00LIlLFdiaZoFX/7U5F9jVvAkl2ei6WKRGG6jX5sXPignnabg6aSdd6YpmZ9k9tcUoEMSqiaEpelJWosELipGlo7OM2Wk4DRIaaFvXspRo5qS1OmnoGYQAQAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtetJaya/xhEL1hlZYGfLvkxrhi3RnG4NxT14c24ou0yP4jVSz67TvdniQvXbtbDhw4gTK17MuLHjx5AjM85bRYBlASGN6rnMuRbSJJxDY64rFIno0DsjJjotugrONaxPN5EpKLbsmK9r20bdg/au3bwN5j4GvDMM3xWLX343vKlyyyeaQ32eUq2wGwGyByChnJxPknxhaNfOHbh3om8tjB9fYvd5ze1AjlhP3kTs6igh0v1Av7794Od5xrQJAAQCwEF/2aVgXGr8FFjggQhuZd0EDjq4AYIJZkVRhQ9eGCFWE1LIoYEefmgVUCOSWCJ9VwmVogcYnjjKix3ESFVpNNZo4mA4jsifjTx+JkGOOvYXVYgWEAnhjmEJOaSPIADZ5H4UKFkki02VJiKHIkhpFjVWXrleRUhiEOaSRn7pZJVQdskkLESdKaZ/K63JJpckvAknfCDIOWeW8nXg55WQDSqZB4YeykGiimrAaKNmtgmpCI9OmmSFlppgYaacdopBBAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtetJaya/xhEL1hlZYGfLvkxrhi3RnG4NxT14c24ou0yP4jVSz67TvdniQvXbtbDhw4gTK17MuLHjx5AjM85bhbI4unCN1n3rUOgRn3o99+CZNGLljz9NDyW9FOdo16FZw5C5EvY727VRz8YdUjcK2oN5ZwRtVXhAzBYAKAdwQ4BzAeRUt6O3fHmN58+jq51o+UL16jCwY0+JNDByDN+tvxCfXcx5YppHpFfvgn1793xTppivnEOA/wFw2GCfcx6B5AR/zG0AIIACDrgVgglmsOCCGwxIYFYI+jfhfw3ah2GGCm4YYIUWYgViiBt2UKJVJ6I4oQcrUtWiBiKO2CF7Vc1Io4gfxAgVhB/U2KOPTum4Y4pDevijkRLymKSSRfIXgpAgELkNAFhmmaUIVFbpYFNahsmlk15CeWWYW46JZAhWwoKmliN0WaaZu7yJJQlyzinemWiWkKee9wVjp59kivClM30SuuYIOG4Epwl/shkoY5FKpuaLlp5QaaZBFsrppRR+iqenooKwaKmXoqrqqhlEAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtetJaya/xhEL1hlZYGfLvkxrhi3RnG4NxT14c24ou0yP4jVSz67TvdniQvXbtbDhw4gTK17MuLHjx5AjMwZAGcBavrsqa66VN4rmz5b1vrUB+vPP0S9Kgz4t9Ibq0qzV9ngNG5LMILRXw7rtOvdmszhh+P4d9mOM4ZUHBy+BnDJV3iKaY13+ATmJANgDOAQZkO6F4dezYzdoNB7S77RLiBcPg6jPEQDiy5d/Yn329uc5lgcxPz4K+/e92NCafihtMF8KAI63gQAMCgCRd67okaB2CzbI4IP7VTUhhRlYaGF3BTY1IQceNohhZxttSGKJDoKI1YgrljgRZlTBGKOHGWX4lI0VyjhjiMHw2COOOaIIi4oesNjij0BCIuSQH86TXyJIJsmiedzt8iSUJmLZpBxbcnlhOjpqmaAISrZj5BphirmklxVVCUKaaq5ZRZtukjPlnQCWQCdJdkpxJgl/1vkln+z5eWVKNDqTqKI+pgRZoZJBSmSlJlCKKZqLbkpop55yGmmoonZJ6qdjnqrqqhdEAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtSuAr2DDih0rFupJaxPIql0b1ulZnxTYyl1r8i1cCXPzlq1o9y4BvYAB1O1rJrDewYQRGZbrNrHRtIvJmnVspKvly5gza97MubPnz6BDi+4coHSAlyDlmF5di6mU1bBPHxV6JDbsn0Rj2I6Nm7aN3bZ7oxUCPDgkmUGK84aF/Iby286av3jOuqn0E9RNT/7oIntpqtdBeMeKM0R2EgLSC3CYuh896ujVpzf4eJ5f8cVLyJcPg+j9D8Cd0LCfev0h5V5lIyxnwoAEvuCbN9hphwKD87kC0UHC6EHhegUFhNJTG3LIEVPDUbXhha49eEyIKLaHSm6JnNgiggd+uI2MM9qo4iU4BpRRfSBSaB+Q4NAYpJA/umiRgTwimaSRHkbF4pCu1QOjFD1OZOOSRAaTpZbtVCnIlzmGqaSGTsYDpZZbdjFlOmISs6MTZIJJUpdjMphSnOfgieaAe56ZDYZrABromlS2SQZ/Yvh5YWhXjvaio5KWWWmjfF7aZ6aaWklppxCCmpKopJaaQQQAIfkEBQUABAAsAAAAAIAAgAAABP6QyEmrvTjrzbv/YCiOZGmeqDisQ+q+cMiycW3b83zvfJnTvaBw81sNj8hJsZVsBpfO6A4qrRJ0JqoPaAX9skUwttvRqsIkMzmj9qJH7bVlyTx/4XE5hV5332V0ekR5g39+hoIYgYCIZYSJSo+Kbx+LkBqWHpJzm5d8h2OOnZ6jEqVXp4mfmpSFrZeYpbKppK+Tjbe4sLG2F6OZu6K6FZ3AwRyrvDnIxseuy89cbLTHybmhvs3O0dLXfd7dVgDjACnae+GcvYzfIuTkKOd465XQI+/4J9TTw6z0GvgCbulnx17BfxkCKkxj0AVBftZAKFw4r53DdMIiSpwocFtGjf4hOFL0mI0PthIiO5I0ZfLkiZT5VrZ0mQLmu20zMcKwCQ9WTiNDeI6rNbOJUFU5q9hEanJNSqb7doiE+jDKSEEIu9z0qXOl169gw4odS7as2bNo06pdy7btygBw48qdS3cu2J9NLdTdy1euV7wtK/QdzJck4KITCCu26/Fw4MSLIxt2bC2y5MaUgVkm/Dczrs2Fv3qm6ba06dOoU6tezbq169ewY4MVQFvALtJyausm2rWK7t+2scpzAvw31apCigM/nnWH8uLMo5Z4Dh0S3iPUl3NN2iO7cWfXbXjfLfNnjPG175pPgZ422fDT0aNdP0J+xRu4lYHsMJ5h/opAHbW0T3YDNaRPcyUNqNyByPljIDsPeqCdGA1+1NtHJ5DH4EP/DeegHh5yKN12/0iyn1ghIuRheZu0uCJmWRUzIoi/NPdiNTUid+NtszS4o3U39oggkEOe8iONRhZ55Bo/prJkF0fS8mQVUQ7JkpVQUqPljEecqN+FCVZI5T5kcilEVGhiGUWaYqLTphRvRhLnlWAiaREodUL0mpmw8bmnmrIRA2igckZIqIP/Hfqlohsy6uijHEQAACH5BAkFAAQALAAAAACAAIAAAAT+kMhJq7046827/2AojmRpnqg4rEPqvnDIsnFt2/N873yZ072gcPNbDY/ISbGVbAaXzugOKq0SAFjAieoDWkHZrIk7+n0/4XDXTCKfM2lxu7jOvTlxuYpedt8teXogfh1LRn8agVp7bDKEiBWKjHaOfJCJgZM6lY2XcJmDlh6GnniSH48YhkylmHmhnRykrRuKi4WiRLO0rnGouRq7vL1po8CqqcMUp7LHF8LKn6/NscjO0ZHMGckSq9gd2taUwdzfEra61RXe5qbT5Jvw6lIB9QEp4c9e2+W4hyX27KHIN6Zfun0hAio8AcqFQX7XNiicWKJhiocWVrFKOJHiCF/+MeZRYyeiY0cSanAg/KVxI0eTC9uJ03gC5kmZSlquJGHTozmdO030jIkN6L8YQwMqM+rSRlKBpZgeeVrPk9QkVCEZrZJUa8s3Pb1C+2JTbESuPhGdPaM0alCccOPKnUu3rt27ePPq3cu3r9++AgILHky4MGGZTElSMMy48eCfiRUTcEy5cdHINCdU3nw4GubMEjiLFnD5M5nRnEubjoWaMuTV8Ra3NowY9tG/uHPr3s27t+/fwIMLH068RmyzvNZGUe5E8hnnVkDfkV5Fp9mxSLaqBdrk6nXqPLxfEn+DvFvuKtGr/grD/FLtKNx/k8+SPV34mrD7a+rw7UHo++nNN9JtF43DiYD/iTSgf/kRWB9zGWGkj4IN8gcLhfI4eOBxW0g4IYMjFbgWhxFCKM8fCHZj4EwkygVgThS+iFOKBJRD43w02nijZ/306OF5GKoYZI0/jmfQkUVuB+FDOwI5JJFPypgcRlQm+YWU65iIpVUSdmmlFE3CuGKALbYSppBjLgiikk9S8OOZ1cEJZZpqrvlckXh+eUSSfJoYZ5tZAuqmn3/ayaKGxpTJJaKJ0lnfb3oKF2lwkwJXKaSEFiemopom2GlBjH4qqqgRAAA7) no-repeat center/80px",e}debounce(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2?arguments[2]:void 0,i=null;return{exec:function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];i&&(clearTimeout(i),i=null),n&&!i&&e.apply(t,s),i=setTimeout((()=>{e.apply(t,s)}),r)},cancel:()=>{clearTimeout(i),i=null}}}isIpv6(e){return!(!e||/^(\d{1,3}\.){3}\d{1,3}$/gi.test(e))}configurationEnvironment(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;$_.log("CommonUtil","resolvedOptions ".concat(JSON.stringify(Intl.DateTimeFormat().resolvedOptions())));const t=!/Shanghai/.test(e);$_.log("CommonUtil","isOverseas:".concat(!/Shanghai/.test(e))),this.configuringTheEnvironment(t),this.gslbConfigurationEnvironment()}getAreaDetectionCompleted(){return this.areaDetectionCompleted}async gslbConfigurationEnvironment(){H_.fetch([Z_],{method:"GET",mode:"cors"},{"Content-Type":"application/json"},Oh.GSLB_REQUEST_TIMEOUT,1,[]).then((e=>{this.gslbResponeConfigurationEnvironment(e),$_.info("CommonUtil","gslb respone ".concat(JSON.stringify(e))),this.areaDetectionCompleted=!0,z_.immediateReportRecords()})).catch((e=>{$_.info("CommonUtil","gslb respone failed"),this.areaDetectionCompleted=!0,z_.immediateReportRecords()}))}gslbResponeConfigurationEnvironment(e){var t;if(200===e.httpCode&&0===(null===(t=e.data)||void 0===t?void 0:t.errno)&&e.data.user_loc){this.responeInfo={respone:e,gslbRequestUrl:Z_};const t=this.detectedUserLocConfigurationEnvironment(e.data.user_loc);this.configuringTheEnvironment(t),$_.info("CommonUtil","gslbGetIsOverseas success")}}detectedUserLocConfigurationEnvironment(e){if(!e)return!1;let t=!0;return/ä¸­å½/.test(e)&&(t=!1,(/é¦æ¸¯/.test(e)||/å°æ¹¾/.test(e)||/æ¾³é¨/.test(e))&&(t=!0)),$_.info("CommonUtil","detectedUserLocGetIsOveseas isOverseas:".concat(t)),t}configuringTheEnvironment(e){e?(Oh.OPS_REPORT_DOMAIN="log-collection-ap-southeast-3.rocket-cdn.com",Oh.PUBLIC_DNS_SERVER=["dns.google","cloudflare-dns.com"]):(Oh.OPS_REPORT_DOMAIN="log-collection-new.hwcloudlive.com",Oh.PUBLIC_DNS_SERVER=["dns.alidns.com","doh.pub"])}getRandomArray(e){const t=new Uint8Array(e);return K_&&K_.getRandomValues(t),t}},J_={none:0,error:1,warn:2,log:3,info:3,debug:4,trace:5,verbose:5},Q_={domain:"",appName:"",streamName:"",svrsid:""};class $_{static setLogLevel(e){if(!(J_[e]>=0))throw new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"log level is invalid");return $_.logLevel=e,!0}static setExtraInfos(e){void 0!==e.domain&&(Q_.domain=e.domain),void 0!==e.appName&&(Q_.appName=e.appName),void 0!==e.streamName&&(Q_.streamName=e.streamName),void 0!==e.svrsid&&(Q_.svrsid=e.svrsid)}static shieldIpAddress(e){return e?e.replace(/\b(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\b/g,"$1.*.*.$2"):null}static shieldUrlParameters(e){if(!e)return e;const t=e.match(/([^?|=|&]+)=([^&]+)/g);return t&&t.forEach((t=>{const r=/([^=]*)=(.*)/g.exec(t);e=e.replace(t,"".concat(r[1],"=").concat($_.secretString(r[2])))})),e}static secretString(e){if(!e)return null;const t="********",r=Math.ceil(e.length/3),n=Math.ceil((e.length-r)/2);return 0===n?"".concat(e.substr(0,r)).concat(t):"".concat(e.substr(0,r)).concat(t).concat(e.substr(-n,n))}static async getLogFileInfo(){const e=X_.getCurrentTimeInfo(),t="".concat(e.year,"-").concat(e.month,"-").concat(e.day,"T").concat(e.hour,":").concat(e.min,":").concat(e.sec).concat(e.zoneOff),r="".concat(e.year,"-").concat(e.month,"-").concat(e.day,"T").concat(e.hour,".").concat(e.min,".").concat(e.sec).concat(e.zoneOff.replace(":",".")),n=$_.getLogBuffer();if(0===n.length)return null;const i="LLL_".concat(Q_.domain||"runtime","##").concat(Q_.appName||"default","##").concat(Q_.streamName||"default","##"),a="".concat(i).concat(Q_.svrsid||"default","##").concat(r),s=encodeURIComponent("".concat(i).concat(t)),o=new kh;o.folder("".concat(t,"#").concat(X_.generateRandomId(6))).file("".concat(a,".log"),"".concat(n.join("\n")));return{content:await o.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}),urlFileNameEncode:s,fileName:a}}static async uploadLog(){const e=await $_.getLogFileInfo(),t=new FormData;t.append("file",e.content,"".concat(e.fileName,".zip")),H_.fetch(["https://".concat(Oh.OPS_REPORT_DOMAIN,"/v1/api/hwrtc_client/log_collect?file=").concat(e.urlFileNameEncode)],{method:"POST",body:t,mode:"cors"},{Authorization:Oh.OPS_AUTH_TOKEN})}static error(e,t){$_.print("error",e,t)}static warn(e,t){$_.print("warn",e,t)}static info(e,t){$_.print("info",e,t)}static log(e,t){$_.print("log",e,t)}static debug(e,t){$_.print("debug",e,t)}static trace(e,t){$_.print("trace",e,t)}static verbose(e,t){$_.print("verbose",e,t)}static clearLogs(){$_.logBuffer=[]}static setlogBufferSize(e){$_.logBufferSize=e}static getlogBufferSize(){return $_.logBufferSize}static getLogBuffer(){return $_.logBuffer}static print(e,t,r){const n=X_.getCurrentTimeInfo(),i="".concat(n.year,"-").concat(n.month,"-").concat(n.day," ").concat(n.hour,":").concat(n.min,":").concat(n.sec,".").concat(n.millsec," [HWLLS] [").concat(e,"] [").concat(t,"] [").concat(r,"]");for(this.logBuffer.push(i);this.logBuffer.length>=this.logBufferSize;)this.logBuffer.shift();J_[$_.logLevel]>=J_[e]&&console[J_[e]>=4?"debug":e](i)}}Yl($_,"logLevel","log"),Yl($_,"logBuffer",[]),Yl($_,"logBufferSize",1e4);let eE=!0,tE=!0;function rE(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function nE(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);const a=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,a),i.apply(this,[e,a])};const a=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(r))return a.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function iE(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(eE=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function aE(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(tE=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function sE(){if("object"==typeof window){if(eE)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function oE(e,t){tE&&console.warn(e+" is deprecated, please use "+t+" instead.")}function lE(e){return"[object Object]"===Object.prototype.toString.call(e)}function cE(e){return lE(e)?Object.keys(e).reduce((function(t,r){const n=lE(e[r]),i=n?cE(e[r]):e[r],a=n&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,{[r]:i})}),{}):e}function uE(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?uE(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((t=>{uE(e,e.get(t),r)}))})))}function dE(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const a=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((t=>{e.forEach((r=>{r.type===n&&r.trackId===t.id&&uE(e,r,i)}))})),i}const hE=sE;function fE(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[i("min",r)]=n.ideal,t.optional.push(e),e={},e[i("max",r)]=n.ideal,t.optional.push(e)):(e[i("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const s=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let s=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&r.length&&t.includes("back")&&(s=r[r.length-1]),s&&(e.video.deviceId=a.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=n(e.video),hE("chrome: "+JSON.stringify(e)),i(e)}))}e.video=n(e.video)}return hE("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{n&&n(a(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(a(e))))))}}}function pE(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function mE(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const i=new Event("track");i.track=r.track,i.receiver=n,i.transceiver={receiver:n},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const i=new Event("track");i.track=r,i.receiver=n,i.transceiver={receiver:n},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else nE(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function gE(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vE(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},a=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){r(a(i(e)))};return t.apply(this,[n,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(a(i(t)))},r])})).then(r,n)}}function yE(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>dE(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),nE(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>dE(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach((r=>{r.track===e&&(t?n=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?n=!0:r=t),t.track===e))),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function _E(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function EE(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return _E(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=a(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>a(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function SE(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function bE(e,t){nE(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var TE=Object.freeze({__proto__:null,shimMediaStream:pE,shimOnTrack:mE,shimGetSendersWithDtmf:gE,shimGetStats:vE,shimSenderReceiverGetStats:yE,shimAddTrackRemoveTrackWithNative:_E,shimAddTrackRemoveTrack:EE,shimPeerConnection:SE,fixNegotiationNeeded:bE,shimGetUserMedia:fE,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const n=r.video&&r.video.width,i=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function RE(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){oE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function AE(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wE(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,a]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(i,a)}}function LE(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function CE(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),nE(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function IE(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){oE("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function kE(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function OE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function DE(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function PE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function xE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var ME=Object.freeze({__proto__:null,shimOnTrack:AE,shimPeerConnection:wE,shimSenderGetStats:LE,shimReceiverGetStats:CE,shimRemoveStream:IE,shimRTCDataChannel:kE,shimAddTransceiver:OE,shimGetParameters:DE,shimCreateOffer:PE,shimCreateAnswer:xE,shimGetUserMedia:RE,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function NE(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function FE(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function UE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};let o=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=o,o=function(e,t,r){const n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=o,o=function(e,t,r){const n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=o}function BE(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(jE(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function jE(e){return e&&void 0!==e.video?Object.assign({},e,{video:cE(e.video)}):e}function HE(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(oE("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function VE(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function GE(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}}function zE(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var KE=Object.freeze({__proto__:null,shimLocalStreamsAPI:NE,shimRemoteStreamsAPI:FE,shimCallbacksAPI:UE,shimGetUserMedia:BE,shimConstraints:jE,shimRTCIceServerUrls:HE,shimTrackEventTransceiver:VE,shimCreateOfferLegacy:GE,shimAudioContext:zE}),WE={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let r;const n=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<n.length;i++)r=n[i].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],i=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");r.profile=n[2];for(let a=3;a<n.length;a++){const i=n[a],s=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const n=t.parseRtpMap(s),a=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(n.parameters=a.length?t.parseFmtp(a[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),r.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(n.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),r},t.writeRtpDescription=function(e,r){let n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));let i=0;return r.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){const r=[],n=t.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),o=s.length>0&&s[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===o&&(l=c[0][1]),n.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&l&&(t.rtx={ssrc:l}),r.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:a?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&o&&r.push({ssrc:o});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=u}))),r},t.parseRtcpParameters=function(e){const r={},n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;const a=t.matchPrefix(e,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(r=i[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,r,n){let i;const a=void 0!==r?r:2;i=e||t.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+i+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const n=t.splitLines(e);for(let t=0;t<n.length;t++)switch(n[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[t].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let t=0;t<r.length;t++)if(r[t].length<2||"="!==r[t].charAt(1))return!1;return!0},e.exports=t}(WE);var YE=WE.exports,qE=Object.freeze(e({__proto__:null,default:YE},[WE.exports]));function ZE(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),n=YE.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,nE(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function XE(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=YE.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=YE.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),r=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(e),n=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const i=YE.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],e);let i;i=0===r&&0===n?Number.POSITIVE_INFINITY:0===r||0===n?Math.max(r,n):Math.min(r,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>i}),this._sctp=a}return r.apply(this,arguments)}}function JE(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},nE(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function QE(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function $E(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function eS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function tS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>r.apply(this,[e])))})}var rS=Object.freeze({__proto__:null,shimRTCIceCandidate:ZE,shimMaxMessageSize:XE,shimSendThrowTypeError:JE,shimConnectionState:QE,removeExtmapAllowMixed:$E,shimAddIceCandidateNullOrEmpty:eS,shimParameterlessSetLocalDescription:tS});const nS=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=sE,n=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=rE(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=rE(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=rE(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:n,commonShim:rS,extractVersion:rE,disableLog:iE,disableWarnings:aE,sdp:qE};switch(n.browser){case"chrome":if(!TE||!SE||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=TE,eS(e,n),tS(e),fE(e,n),pE(e),SE(e,n),mE(e),EE(e,n),gE(e),vE(e),yE(e),bE(e,n),ZE(e),QE(e),XE(e,n),JE(e),$E(e,n);break;case"firefox":if(!ME||!wE||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=ME,eS(e,n),tS(e),RE(e,n),wE(e,n),AE(e),IE(e),LE(e),CE(e),kE(e),OE(e),DE(e),PE(e),xE(e),ZE(e),QE(e),XE(e,n),JE(e);break;case"safari":if(!KE||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=KE,eS(e,n),tS(e),HE(e),GE(e),UE(e),NE(e),FE(e),VE(e),BE(e),zE(e),ZE(e),XE(e,n),JE(e),$E(e,n);break;default:r("Unsupported browser!")}return i}({window:"undefined"==typeof window?void 0:window});var iS={exports:{}};!function(e,t){var r;self,r=function(){return function(){var e={"./node_modules/es6-promise/dist/es6-promise.js":
/*!******************************************************!*\
    !*** ./node_modules/es6-promise/dist/es6-promise.js ***!
    \******************************************************/function(e,t,r){
/*!
   * @overview es6-promise - a tiny implementation of Promises/A+.
   * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
   * @license   Licensed under MIT license
   *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
   * @version   v4.2.8+1e68dce6
   */
e.exports=function(){function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,a=void 0,s=void 0,o=function(e,t){E[i]=e,E[i+1]=t,2===(i+=2)&&(s?s(S):T())};function l(e){s=e}function c(e){o=e}var u="undefined"!=typeof window?window:void 0,d=u||{},h=d.MutationObserver||d.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==Ch&&"[object process]"==={}.toString.call(Ch),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){return function(){return mh(S)}}function g(){return void 0!==a?function(){a(S)}:_()}function v(){var e=0,t=new h(S),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function y(){var e=new MessageChannel;return e.port1.onmessage=S,function(){return e.port2.postMessage(0)}}function _(){var e=setTimeout;return function(){return e(S,1)}}var E=new Array(1e3);function S(){for(var e=0;e<i;e+=2)(0,E[e])(E[e+1]),E[e]=void 0,E[e+1]=void 0;i=0}function b(){try{var e=Function("return this")().require("vertx");return a=e.runOnLoop||e.runOnContext,g()}catch(t){return _()}}var T=void 0;function R(e,t){var r=this,n=new this.constructor(L);void 0===n[w]&&Y(n);var i=r._state;if(i){var a=arguments[i-1];o((function(){return G(i,n,a,r._result)}))}else H(r,n,e,t);return n}function A(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(L);return F(r,e),r}T=f?m():h?v():p?y():void 0===u?b():_();var w=Math.random().toString(36).substring(2);function L(){}var C=void 0,I=1,k=2;function O(){return new TypeError("You cannot resolve a promise with itself")}function D(){return new TypeError("A promises callback cannot return that same promise.")}function P(e,t,r,n){try{e.call(t,r,n)}catch(i){return i}}function x(e,t,r){o((function(e){var n=!1,i=P(r,t,(function(r){n||(n=!0,t!==r?F(e,r):B(e,r))}),(function(t){n||(n=!0,j(e,t))}),"Settle: "+(e._label||" unknown promise"));!n&&i&&(n=!0,j(e,i))}),e)}function M(e,t){t._state===I?B(e,t._result):t._state===k?j(e,t._result):H(t,void 0,(function(t){return F(e,t)}),(function(t){return j(e,t)}))}function N(e,r,n){r.constructor===e.constructor&&n===R&&r.constructor.resolve===A?M(e,r):void 0===n?B(e,r):t(n)?x(e,r,n):B(e,r)}function F(t,r){if(t===r)j(t,O());else if(e(r)){var n=void 0;try{n=r.then}catch(Wk){return void j(t,Wk)}N(t,r,n)}else B(t,r)}function U(e){e._onerror&&e._onerror(e._result),V(e)}function B(e,t){e._state===C&&(e._result=t,e._state=I,0!==e._subscribers.length&&o(V,e))}function j(e,t){e._state===C&&(e._state=k,e._result=t,o(U,e))}function H(e,t,r,n){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+I]=r,i[a+k]=n,0===a&&e._state&&o(V,e)}function V(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,a=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+r],n?G(r,n,i,a):i(a);e._subscribers.length=0}}function G(e,r,n,i){var a=t(n),s=void 0,o=void 0,l=!0;if(a){try{s=n(i)}catch(c){l=!1,o=c}if(r===s)return void j(r,D())}else s=i;r._state!==C||(a&&l?F(r,s):!1===l?j(r,o):e===I?B(r,s):e===k&&j(r,s))}function z(e,t){try{t((function(t){F(e,t)}),(function(t){j(e,t)}))}catch(r){j(e,r)}}var K=0;function W(){return K++}function Y(e){e[w]=K++,e._state=void 0,e._result=void 0,e._subscribers=[]}function q(){return new Error("Array Methods must be provided an Array")}var Z=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(L),this.promise[w]||Y(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&B(this.promise,this._result))):j(this.promise,q())}return e.prototype._enumerate=function(e){for(var t=0;this._state===C&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===A){var i=void 0,a=void 0,s=!1;try{i=e.then}catch(l){s=!0,a=l}if(i===R&&e._state!==C)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===te){var o=new r(L);s?j(o,a):N(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===C&&(this._remaining--,e===k?j(n,r):this._result[t]=r),0===this._remaining&&B(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;H(e,void 0,(function(e){return r._settledAt(I,t,e)}),(function(e){return r._settledAt(k,t,e)}))},e}();function X(e){return new Z(this,e).promise}function J(e){var t=this;return n(e)?new t((function(r,n){for(var i=e.length,a=0;a<i;a++)t.resolve(e[a]).then(r,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function Q(e){var t=new this(L);return j(t,e),t}function $(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ee(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function e(t){this[w]=W(),this._result=this._state=void 0,this._subscribers=[],L!==t&&("function"!=typeof t&&$(),this instanceof e?z(this,t):ee())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var r=this,n=r.constructor;return t(e)?r.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):r.then(e,e)},e}();function re(){var e=void 0;if(void 0!==r.g)e=r.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(i){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(i){}if("[object Promise]"===n&&!t.cast)return}e.Promise=te}return te.prototype.then=R,te.all=X,te.race=J,te.resolve=A,te.reject=Q,te._setScheduler=l,te._setAsap=c,te._asap=o,te.polyfill=re,te.Promise=te,te}()},"./node_modules/events/events.js":
/*!***************************************!*\
    !*** ./node_modules/events/events.js ***!
    \***************************************/function(e){var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,a),n(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}m(e,t,a,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,r)}(e,i,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var i,a,s,c;if(o(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),s=a[t]),void 0===s)s=a[t]=r,++e._eventsCount;else if("function"==typeof s?s=a[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=u.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(a){n.once&&e.removeEventListener(t,i),r(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var c=l.length,u=p(l,c);for(r=0;r<c;++r)n(u[r],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return o(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,a,s;if(o(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
    !*** ./node_modules/webworkify-webpack/index.js ***!
    \**************************************************/function(e,t,r){function n(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,n){var o={};o[n]=[];var l=t.toString(),c=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return o;for(var u,d=c[1],h=new RegExp("(\\\\n|\\W)"+s(d)+a,"g");u=h.exec(l);)"dll-reference"!==u[3]&&o[n].push(u[3]);for(h=new RegExp("\\("+s(d)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");u=h.exec(l);)e[u[2]]||(o[n].push(u[1]),e[u[2]]=r(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var f,p=Object.keys(o),m=0;m<p.length;m++)for(var g=0;g<o[p[m]].length;g++)f=o[p[m]][g],isNaN(1*f)||(o[p[m]][g]=1*o[p[m]][g]);return o}function l(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var i={main:r.m},a=t.all?{main:Object.keys(i.main)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};l(r);)for(var a=Object.keys(r),s=0;s<a.length;s++){var c=a[s],u=r[c].pop();if(i[c]=i[c]||{},!i[c][u]&&e[c][u]){i[c][u]=!0,n[c]=n[c]||[],n[c].push(u);for(var d=o(e,e[c][u],c),h=Object.keys(d),f=0;f<h.length;f++)r[h[f]]=r[h[f]]||[],r[h[f]]=r[h[f]].concat(d[h[f]])}}return n}(i,e),s="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);";var c=new window.Blob([s],{type:"text/javascript"});if(t.bare)return c;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),d=new window.Worker(u);return d.objectURL=u,d}},"./src/config.js":
/*!***********************!*\
    !*** ./src/config.js ***!
    \***********************/function(e,t,r){r.r(t),r.d(t,{defaultConfig:function(){return n},createDefaultConfig:function(){return i}});var n={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function i(){return Object.assign({},n)}},"./src/core/features.js":
/*!******************************!*\
    !*** ./src/core/features.js ***!
    \******************************/function(e,t,r){r.r(t);var n=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),i=r(/*! ../config.js */"./src/config.js"),a=function(){function e(){}return e.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},e.supportNetworkStreamIO=function(){var e=new n.default({},(0,i.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t},e.getNetworkLoaderTypeName=function(){var e=new n.default({},(0,i.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t},e.supportNativeMediaPlayback=function(t){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var r=e.videoElement.canPlayType(t);return"probably"===r||"maybe"==r},e.getFeatureList=function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t},e}();t.default=a},"./src/core/media-info.js":
/*!********************************!*\
    !*** ./src/core/media-info.js ***!
    \********************************/function(e,t,r){r.r(t);var n=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,r=this._search(t.times,e);return{index:r,milliseconds:t.times[r],fileposition:t.filepositions[r]}},e.prototype._search=function(e,t){var r=0,n=e.length-1,i=0,a=0,s=n;for(t<e[0]&&(r=0,a=s+1);a<=s;){if((i=a+Math.floor((s-a)/2))===n||t>=e[i]&&t<e[i+1]){r=i;break}e[i]<t?a=i+1:s=i-1}return r},e}();t.default=n},"./src/core/media-segment-info.js":
/*!****************************************!*\
    !*** ./src/core/media-segment-info.js ***!
    \****************************************/function(e,t,r){r.r(t),r.d(t,{SampleInfo:function(){return n},MediaSegmentInfo:function(){return i},IDRSampleList:function(){return a},MediaSegmentInfoList:function(){return s}});var n=function(e,t,r,n,i){this.dts=e,this.pts=t,this.duration=r,this.originalDts=n,this.isSyncPoint=i,this.fileposition=null},i=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(e){e.isSyncPoint=!0,this.syncPoints.push(e)},e}(),a=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0==this._list.length)return null;var t=this._list,r=0,n=t.length-1,i=0,a=0,s=n;for(e<t[0].dts&&(r=0,a=s+1);a<=s;){if((i=a+Math.floor((s-a)/2))===n||e>=t[i].dts&&e<t[i+1].dts){r=i;break}t[i].dts<e?a=i+1:s=i-1}return this._list[r]},e}(),s=function(){function e(e){this._type=e,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(e){var t=this._list;if(0===t.length)return-2;var r=t.length-1,n=0,i=0,a=r,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>t[n].lastSample.originalDts&&e<t[n+1].originalBeginDts){s=n;break}t[n].originalBeginDts<e?i=n+1:a=n-1}return s},e.prototype._searchNearestSegmentAfter=function(e){return this._searchNearestSegmentBefore(e)+1},e.prototype.append=function(e){var t=this._list,r=e,n=this._lastAppendLocation,i=0;-1!==n&&n<t.length&&r.originalBeginDts>=t[n].lastSample.originalDts&&(n===t.length-1||n<t.length-1&&r.originalBeginDts<t[n+1].originalBeginDts)?i=n+1:t.length>0&&(i=this._searchNearestSegmentBefore(r.originalBeginDts)+1),this._lastAppendLocation=i,this._list.splice(i,0,r)},e.prototype.getLastSegmentBefore=function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null},e.prototype.getLastSampleBefore=function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null},e.prototype.getLastSyncPointBefore=function(e){for(var t=this._searchNearestSegmentBefore(e),r=this._list[t].syncPoints;0===r.length&&t>0;)t--,r=this._list[t].syncPoints;return r.length>0?r[r.length-1]:null},e}()},"./src/core/mse-controller.js":
/*!************************************!*\
    !*** ./src/core/mse-controller.js ***!
    \************************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./mse-events.js */"./src/core/mse-events.js"),l=r(/*! ./media-segment-info.js */"./src/core/media-segment-info.js"),c=r(/*! ../utils/exception.js */"./src/utils/exception.js"),u=function(){function e(e){this.TAG="MSEController",this._config=e,this._emitter=new(i()),this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new l.IDRSampleList}return e.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new c.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},e.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var r=this._pendingSegments[t];r.splice(0,r.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var n=this._sourceBuffers[t];if(n){if("closed"!==e.readyState){try{e.removeSourceBuffer(n)}catch(Wk){a.default.e(this.TAG,Wk.message)}n.removeEventListener("error",this.e.onSourceBufferError),n.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(Wk){a.default.e(this.TAG,Wk.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var r=e,n=""+r.container;r.codec&&r.codec.length>0&&(n+=";codecs="+r.codec);var i=!1;if(a.default.v(this.TAG,"Received Initialization Segment, mimeType: "+n),this._lastInitSegments[r.type]=r,n!==this._mimeTypes[r.type]){if(this._mimeTypes[r.type])a.default.v(this.TAG,"Notice: "+r.type+" mimeType changed, origin: "+this._mimeTypes[r.type]+", target: "+n);else{i=!0;try{var l=this._sourceBuffers[r.type]=this._mediaSource.addSourceBuffer(n);l.addEventListener("error",this.e.onSourceBufferError),l.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(Wk){return a.default.e(this.TAG,Wk.message),void this._emitter.emit(o.default.ERROR,{code:Wk.code,msg:Wk.message})}}this._mimeTypes[r.type]=n}t||this._pendingSegments[r.type].push(r),i||this._sourceBuffers[r.type]&&!this._sourceBuffers[r.type].updating&&this._doAppendSegments(),s.default.safari&&"audio/mpeg"===r.container&&r.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=r.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var r=this._sourceBuffers[t.type];!r||r.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.seek=function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var r=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{r.abort()}catch(Wk){a.default.e(this.TAG,Wk.message)}this._idrList.clear();var n=this._pendingSegments[t];if(n.splice(0,n.length),"closed"!==this._mediaSource.readyState){for(var i=0;i<r.buffered.length;i++){var o=r.buffered.start(i),l=r.buffered.end(i);this._pendingRemoveRanges[t].push({start:o,end:l})}if(r.updating||this._doRemoveRanges(),s.default.safari){var c=this._lastInitSegments[t];c&&(this._pendingSegments[t].push(c),r.updating||this._doAppendSegments())}}}},e.prototype.endOfStream=function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},e.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){var n=r.buffered;if(n.length>=1&&e-n.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},e.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){for(var n=r.buffered,i=!1,a=0;a<n.length;a++){var s=n.start(a),o=n.end(a);if(s<=e&&e<o+3){if(e-s>=this._config.autoCleanupMaxBackwardDuration){i=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:s,end:l})}}else o<e&&(i=!0,this._pendingRemoveRanges[t].push({start:s,end:o}))}i&&!r.updating&&this._doRemoveRanges()}}},e.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,r=this._pendingMediaDuration;r>0&&(isNaN(t)||r>t)&&(a.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+r),this._mediaSource.duration=r),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],r=this._pendingRemoveRanges[e];r.length&&!t.updating;){var n=r.shift();t.remove(n.start,n.end)}},e.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var r=e[t].shift();if(r.timestampOffset){var n=this._sourceBuffers[t].timestampOffset,i=r.timestampOffset/1e3;Math.abs(n-i)>.1&&(a.default.v(this.TAG,"Update MPEG audio timestampOffset from "+n+" to "+i),this._sourceBuffers[t].timestampOffset=i),delete r.timestampOffset}if(!r.data||0===r.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(r.data),this._isBufferFull=!1,"video"===t&&r.hasOwnProperty("info")&&this._idrList.appendArray(r.info.syncPoints)}catch(Wk){this._pendingSegments[t].unshift(r),22===Wk.code?(this._isBufferFull||this._emitter.emit(o.default.BUFFER_FULL),this._isBufferFull=!0):(a.default.e(this.TAG,Wk.message),this._emitter.emit(o.default.ERROR,{code:Wk.code,msg:Wk.message}))}}},e.prototype._onSourceOpen=function(){if(a.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(o.default.SOURCE_OPEN)},e.prototype._onSourceEnded=function(){a.default.v(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){a.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},e.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(o.default.UPDATE_END)},e.prototype._onSourceBufferError=function(e){a.default.e(this.TAG,"SourceBuffer Error: "+e)},e}();t.default=u},"./src/core/mse-events.js":
/*!********************************!*\
    !*** ./src/core/mse-events.js ***!
    \********************************/function(e,t,r){r.r(t),t.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"}},"./src/core/transmuxer.js":
/*!********************************!*\
    !*** ./src/core/transmuxer.js ***!
    \********************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),s=r.n(a),o=r(/*! ../utils/logger.js */"./src/utils/logger.js"),l=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),c=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),u=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),d=r(/*! ./media-info.js */"./src/core/media-info.js"),h=function(){function e(e,t){if(this.TAG="Transmuxer",this._emitter=new(i()),t.enableWorker&&"undefined"!=typeof Worker)try{this._worker=s()(/*! ./transmuxing-worker */"./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[e,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch(Wk){o.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new c.default(e,t)}else this._controller=new c.default(e,t);if(this._controller){var r=this._controller;r.on(u.default.IO_ERROR,this._onIOError.bind(this)),r.on(u.default.DEMUX_ERROR,this._onDemuxError.bind(this)),r.on(u.default.INIT_SEGMENT,this._onInitSegment.bind(this)),r.on(u.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),r.on(u.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),r.on(u.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),r.on(u.default.MEDIA_INFO,this._onMediaInfo.bind(this)),r.on(u.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),r.on(u.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),r.on(u.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),r.on(u.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(u.default.INIT_SEGMENT,e,t)}))},e.prototype._onMediaSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(u.default.MEDIA_SEGMENT,e,t)}))},e.prototype._onLoadingComplete=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(u.default.LOADING_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(u.default.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(u.default.MEDIA_INFO,e)}))},e.prototype._onMetaDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(u.default.METADATA_ARRIVED,e)}))},e.prototype._onScriptDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(u.default.SCRIPTDATA_ARRIVED,e)}))},e.prototype._onStatisticsInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(u.default.STATISTICS_INFO,e)}))},e.prototype._onIOError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(u.default.IO_ERROR,e,t)}))},e.prototype._onDemuxError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(u.default.DEMUX_ERROR,e,t)}))},e.prototype._onRecommendSeekpoint=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(u.default.RECOMMEND_SEEKPOINT,e)}))},e.prototype._onLoggingConfigChanged=function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})},e.prototype._onWorkerMessage=function(e){var t=e.data,r=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case u.default.INIT_SEGMENT:case u.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,r.type,r.data);break;case u.default.LOADING_COMPLETE:case u.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case u.default.MEDIA_INFO:Object.setPrototypeOf(r,d.default.prototype),this._emitter.emit(t.msg,r);break;case u.default.METADATA_ARRIVED:case u.default.SCRIPTDATA_ARRIVED:case u.default.STATISTICS_INFO:this._emitter.emit(t.msg,r);break;case u.default.IO_ERROR:case u.default.DEMUX_ERROR:this._emitter.emit(t.msg,r.type,r.info);break;case u.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,r);break;case"logcat_callback":o.default.emitter.emit("log",r.type,r.logcat)}},e}();t.default=h},"./src/core/transmuxing-controller.js":
/*!********************************************!*\
    !*** ./src/core/transmuxing-controller.js ***!
    \********************************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./media-info.js */"./src/core/media-info.js"),l=r(/*! ../demux/flv-demuxer.js */"./src/demux/flv-demuxer.js"),c=r(/*! ../remux/mp4-remuxer.js */"./src/remux/mp4-remuxer.js"),u=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),d=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),h=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),f=function(){function e(e,t){this.TAG="TransmuxingController",this._emitter=new(i()),this._config=t,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach((function(n){n.timestampBase=r,r+=n.duration,n.cors=e.cors,n.withCredentials=e.withCredentials,t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy)})),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return e.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(e,t){this._currentSegmentIndex=e;var r=this._mediaDataSource.segments[e],n=this._ioctl=new d.default(r,this._config,e);n.onError=this._onIOException.bind(this),n.onSeeked=this._onIOSeeked.bind(this),n.onComplete=this._onIOComplete.bind(this),n.onRedirect=this._onIORedirect.bind(this),n.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):n.onDataArrival=this._onInitChunkArrival.bind(this),n.open(t)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var r=this._mediaInfo.segments[t];if(null==r)this._pendingSeekTime=e;else{var n=r.getNearestKeyframe(e);this._remuxer.seek(n.milliseconds),this._ioctl.seek(n.fileposition),this._pendingResolveSeekPoint=n.milliseconds}}else{var i=this._mediaInfo.segments[t];null==i?(this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t)):(n=i.getNearestKeyframe(e),this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,n.fileposition),this._pendingResolveSeekPoint=n.milliseconds,this._reportSegmentMediaInfo(t))}this._enableStatisticsReporter()}},e.prototype._searchSegmentIndexContains=function(e){for(var t=this._mediaDataSource.segments,r=t.length-1,n=0;n<t.length;n++)if(e<t[n].timestampBase){r=n-1;break}return r},e.prototype._onInitChunkArrival=function(e,t){var r=this,n=null,i=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,i=this._demuxer.parseChunks(e,t);else if((n=l.default.probe(e)).match){this._demuxer=new l.default(n,this._config),this._remuxer||(this._remuxer=new c.default(this._config));var s=this._mediaDataSource;null==s.duration||isNaN(s.duration)||(this._demuxer.overridedDuration=s.duration),"boolean"==typeof s.hasAudio&&(this._demuxer.overridedHasAudio=s.hasAudio),"boolean"==typeof s.hasVideo&&(this._demuxer.overridedHasVideo=s.hasVideo),this._demuxer.timestampBase=s.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),i=this._demuxer.parseChunks(e,t)}else n=null,a.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then((function(){r._internalAbort()})),this._emitter.emit(h.default.DEMUX_ERROR,u.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),i=0;return i},e.prototype._onMediaInfo=function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.default.prototype));var r=Object.assign({},e);Object.setPrototypeOf(r,o.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=r,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)}))},e.prototype._onMetaDataArrived=function(e){this._emitter.emit(h.default.METADATA_ARRIVED,e)},e.prototype._onScriptDataArrived=function(e){this._emitter.emit(h.default.SCRIPTDATA_ARRIVED,e)},e.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},e.prototype._onIOComplete=function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer.flushStashedSamples(),this._emitter.emit(h.default.LOADING_COMPLETE),this._disableStatisticsReporter())},e.prototype._onIORedirect=function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(h.default.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(e,t){a.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(h.default.IO_ERROR,e,t),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(e,t){a.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(h.default.DEMUX_ERROR,e,t)},e.prototype._onRemuxerInitSegmentArrival=function(e,t){this._emitter.emit(h.default.INIT_SEGMENT,e,t)},e.prototype._onRemuxerMediaSegmentArrival=function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(h.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var r=t.info.syncPoints,n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&r.length>0&&r[0].originalDts===n&&(n=r[0].pts),this._emitter.emit(h.default.RECOMMEND_SEEKPOINT,n)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype._reportSegmentMediaInfo=function(e){var t=this._mediaInfo.segments[e],r=Object.assign({},t);r.duration=this._mediaInfo.duration,r.segmentCount=this._mediaInfo.segmentCount,delete r.segments,delete r.keyframesIndex,this._emitter.emit(h.default.MEDIA_INFO,r)},e.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(h.default.STATISTICS_INFO,e)},e}();t.default=f},"./src/core/transmuxing-events.js":
/*!****************************************!*\
    !*** ./src/core/transmuxing-events.js ***!
    \****************************************/function(e,t,r){r.r(t),t.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},"./src/core/transmuxing-worker.js":
/*!****************************************!*\
    !*** ./src/core/transmuxing-worker.js ***!
    \****************************************/function(e,t,r){r.r(t);var n=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),i=r(/*! ../utils/polyfill.js */"./src/utils/polyfill.js"),a=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),s=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");t.default=function(e){var t=null,r=function(t,r){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:r}})}.bind(this);function o(t,r){var n={msg:s.default.INIT_SEGMENT,data:{type:t,data:r}};e.postMessage(n,[r.data])}function l(t,r){var n={msg:s.default.MEDIA_SEGMENT,data:{type:t,data:r}};e.postMessage(n,[r.data])}function c(){var t={msg:s.default.LOADING_COMPLETE};e.postMessage(t)}function u(){var t={msg:s.default.RECOVERED_EARLY_EOF};e.postMessage(t)}function d(t){var r={msg:s.default.MEDIA_INFO,data:t};e.postMessage(r)}function h(t){var r={msg:s.default.METADATA_ARRIVED,data:t};e.postMessage(r)}function f(t){var r={msg:s.default.SCRIPTDATA_ARRIVED,data:t};e.postMessage(r)}function p(t){var r={msg:s.default.STATISTICS_INFO,data:t};e.postMessage(r)}function m(t,r){e.postMessage({msg:s.default.IO_ERROR,data:{type:t,info:r}})}function g(t,r){e.postMessage({msg:s.default.DEMUX_ERROR,data:{type:t,info:r}})}function v(t){e.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:t})}i.default.install(),e.addEventListener("message",(function(i){switch(i.data.cmd){case"init":(t=new a.default(i.data.param[0],i.data.param[1])).on(s.default.IO_ERROR,m.bind(this)),t.on(s.default.DEMUX_ERROR,g.bind(this)),t.on(s.default.INIT_SEGMENT,o.bind(this)),t.on(s.default.MEDIA_SEGMENT,l.bind(this)),t.on(s.default.LOADING_COMPLETE,c.bind(this)),t.on(s.default.RECOVERED_EARLY_EOF,u.bind(this)),t.on(s.default.MEDIA_INFO,d.bind(this)),t.on(s.default.METADATA_ARRIVED,h.bind(this)),t.on(s.default.SCRIPTDATA_ARRIVED,f.bind(this)),t.on(s.default.STATISTICS_INFO,p.bind(this)),t.on(s.default.RECOMMEND_SEEKPOINT,v.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(i.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var y=i.data.param;n.default.applyConfig(y),!0===y.enableCallback?n.default.addLogListener(r):n.default.removeLogListener(r)}}))}},"./src/demux/amf-parser.js":
/*!*********************************!*\
    !*** ./src/demux/amf-parser.js ***!
    \*********************************/function(e,t,r){r.r(t);var n,i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ../utils/utf8-conv.js */"./src/utils/utf8-conv.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0]),l=function(){function e(){}return e.parseScriptData=function(t,r,n){var a={};try{var s=e.parseValue(t,r,n),o=e.parseValue(t,r+s.size,n-s.size);a[s.data]=o.data}catch(l){i.default.e("AMF",l.toString())}return a},e.parseObject=function(t,r,n){if(n<3)throw new s.IllegalStateException("Data not enough when parse ScriptDataObject");var i=e.parseString(t,r,n),a=e.parseValue(t,r+i.size,n-i.size),o=a.objectEnd;return{data:{name:i.data,value:a.data},size:i.size+a.size,objectEnd:o}},e.parseVariable=function(t,r,n){return e.parseObject(t,r,n)},e.parseString=function(e,t,r){if(r<2)throw new s.IllegalStateException("Data not enough when parse String");var n=new DataView(e,t,r).getUint16(0,!o);return{data:n>0?(0,a.default)(new Uint8Array(e,t+2,n)):"",size:2+n}},e.parseLongString=function(e,t,r){if(r<4)throw new s.IllegalStateException("Data not enough when parse LongString");var n=new DataView(e,t,r).getUint32(0,!o);return{data:n>0?(0,a.default)(new Uint8Array(e,t+4,n)):"",size:4+n}},e.parseDate=function(e,t,r){if(r<10)throw new s.IllegalStateException("Data size invalid when parse Date");var n=new DataView(e,t,r),i=n.getFloat64(0,!o),a=n.getInt16(8,!o);return{data:new Date(i+=60*a*1e3),size:10}},e.parseValue=function(t,r,n){if(n<1)throw new s.IllegalStateException("Data not enough when parse Value");var a,l=new DataView(t,r,n),c=1,u=l.getUint8(0),d=!1;try{switch(u){case 0:a=l.getFloat64(1,!o),c+=8;break;case 1:a=!!l.getUint8(1),c+=1;break;case 2:var h=e.parseString(t,r+1,n-1);a=h.data,c+=h.size;break;case 3:a={};var f=0;for(9==(16777215&l.getUint32(n-4,!o))&&(f=3);c<n-4;){var p=e.parseObject(t,r+c,n-c-f);if(p.objectEnd)break;a[p.data.name]=p.data.value,c+=p.size}c<=n-3&&9==(16777215&l.getUint32(c-1,!o))&&(c+=3);break;case 8:for(a={},c+=4,f=0,9==(16777215&l.getUint32(n-4,!o))&&(f=3);c<n-8;){var m=e.parseVariable(t,r+c,n-c-f);if(m.objectEnd)break;a[m.data.name]=m.data.value,c+=m.size}c<=n-3&&9==(16777215&l.getUint32(c-1,!o))&&(c+=3);break;case 9:a=void 0,c=1,d=!0;break;case 10:a=[];var g=l.getUint32(1,!o);c+=4;for(var v=0;v<g;v++){var y=e.parseValue(t,r+c,n-c);a.push(y.data),c+=y.size}break;case 11:var _=e.parseDate(t,r+1,n-1);a=_.data,c+=_.size;break;case 12:var E=e.parseString(t,r+1,n-1);a=E.data,c+=E.size;break;default:c=n,i.default.w("AMF","Unsupported AMF value type "+u)}}catch(S){i.default.e("AMF",S.toString())}return{data:a,size:c,objectEnd:d}},e}();t.default=l},"./src/demux/demux-errors.js":
/*!***********************************!*\
    !*** ./src/demux/demux-errors.js ***!
    \***********************************/function(e,t,r){r.r(t),t.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},"./src/demux/exp-golomb.js":
/*!*********************************!*\
    !*** ./src/demux/exp-golomb.js ***!
    \*********************************/function(e,t,r){r.r(t);var n=r(/*! ../utils/exception.js */"./src/utils/exception.js"),i=function(){function e(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return e.prototype.destroy=function(){this._buffer=null},e.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new n.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},e.prototype.readBits=function(e){if(e>32)throw new n.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(i,this._current_word_bits_left),s=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,r=r<<a|s},e.prototype.readBool=function(){return 1===this.readBits(1)},e.prototype.readByte=function(){return this.readBits(8)},e.prototype._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},e.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},e.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},e}();t.default=i},"./src/demux/flv-demuxer.js":
/*!**********************************!*\
    !*** ./src/demux/flv-demuxer.js ***!
    \**********************************/function(e,t,r){r.r(t);var n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),i=r(/*! ./amf-parser.js */"./src/demux/amf-parser.js"),a=r(/*! ./sps-parser.js */"./src/demux/sps-parser.js"),s=r(/*! ./demux-errors.js */"./src/demux/demux-errors.js"),o=r(/*! ../core/media-info.js */"./src/core/media-info.js"),l=r(/*! ../utils/exception.js */"./src/utils/exception.js"),c=function(){function e(e,t){var r;this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new o.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0])}return e.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},e.probe=function(e){var t=new Uint8Array(e),r={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var n=(4&t[4])>>>2!=0,i=0!=(1&t[4]),a=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}(t,5);return a<9?r:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:n,hasVideoTrack:i}},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new o.default},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.parseChunks=function(t,r){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new l.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,a=this._littleEndian;if(0===r){if(!(t.byteLength>13))return 0;i=e.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,r+i!==this._dataOffset&&n.default.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(s=new DataView(t,i)).getUint32(0,!a)&&n.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4);i<t.byteLength;){this._dispatch=!0;var s=new DataView(t,i);if(i+11+4>t.byteLength)break;var o=s.getUint8(0),c=16777215&s.getUint32(0,!a);if(i+11+c+4>t.byteLength)break;if(8===o||9===o||18===o){var u=s.getUint8(4),d=s.getUint8(5),h=s.getUint8(6)|d<<8|u<<16|s.getUint8(7)<<24;0!=(16777215&s.getUint32(7,!a))&&n.default.w(this.TAG,"Meet tag which has StreamID != 0!");var f=i+11;switch(o){case 8:this._parseAudioData(t,f,c,h);break;case 9:this._parseVideoData(t,f,c,h,r+i);break;case 18:this._parseScriptData(t,f,c)}var p=s.getUint32(11+c,!a);p!==11+c&&n.default.w(this.TAG,"Invalid PrevTagSize "+p),i+=11+c+4}else n.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),i+=11+c+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},e.prototype._parseScriptData=function(e,t,r){var a=i.default.parseScriptData(e,t,r);if(a.hasOwnProperty("onMetaData")){if(null==a.onMetaData||"object"!=typeof a.onMetaData)return void n.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&n.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=a;var s=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},s)),"boolean"==typeof s.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=s.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof s.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=s.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof s.audiodatarate&&(this._mediaInfo.audioDataRate=s.audiodatarate),"number"==typeof s.videodatarate&&(this._mediaInfo.videoDataRate=s.videodatarate),"number"==typeof s.width&&(this._mediaInfo.width=s.width),"number"==typeof s.height&&(this._mediaInfo.height=s.height),"number"==typeof s.duration){if(!this._durationOverrided){var o=Math.floor(s.duration*this._timescale);this._duration=o,this._mediaInfo.duration=o}}else this._mediaInfo.duration=0;if("number"==typeof s.framerate){var l=Math.floor(1e3*s.framerate);if(l>0){var c=l/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=c,this._referenceFrameRate.fps_num=l,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=c}}if("object"==typeof s.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var u=s.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(u),s.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=s,n.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(a).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},a))},e.prototype._parseKeyframesIndex=function(e){for(var t=[],r=[],n=1;n<e.times.length;n++){var i=this._timestampBase+Math.floor(1e3*e.times[n]);t.push(i),r.push(e.filepositions[n])}return{times:t,filepositions:r}},e.prototype._parseAudioData=function(e,t,r,i){if(r<=1)n.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var a=new DataView(e,t,r).getUint8(0),o=a>>>4;if(2===o||10===o){var l=0,c=(12&a)>>>2;if(c>=0&&c<=4){l=this._flvSoundRateTable[c];var u=1&a,d=this._audioMetadata,h=this._audioTrack;if(d||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(d=this._audioMetadata={}).type="audio",d.id=h.id,d.timescale=this._timescale,d.duration=this._duration,d.audioSampleRate=l,d.channelCount=0===u?1:2),10===o){var f=this._parseAACAudioData(e,t+1,r-1);if(null==f)return;if(0===f.packetType){d.config&&n.default.w(this.TAG,"Found another AudioSpecificConfig!");var p=f.data;d.audioSampleRate=p.samplingRate,d.channelCount=p.channelCount,d.codec=p.codec,d.originalCodec=p.originalCodec,d.config=p.config,d.refSampleDuration=1024/d.audioSampleRate*d.timescale,n.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",d),(v=this._mediaInfo).audioCodec=d.originalCodec,v.audioSampleRate=d.audioSampleRate,v.audioChannelCount=d.channelCount,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',v.isComplete()&&this._onMediaInfo(v)}else if(1===f.packetType){var m=this._timestampBase+i,g={unit:f.data,length:f.data.byteLength,dts:m,pts:m};h.samples.push(g),h.length+=f.data.length}else n.default.e(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}else if(2===o){if(!d.codec){var v;if(null==(p=this._parseMP3AudioData(e,t+1,r-1,!0)))return;d.audioSampleRate=p.samplingRate,d.channelCount=p.channelCount,d.codec=p.codec,d.originalCodec=p.originalCodec,d.refSampleDuration=1152/d.audioSampleRate*d.timescale,n.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",d),(v=this._mediaInfo).audioCodec=d.codec,v.audioSampleRate=d.audioSampleRate,v.audioChannelCount=d.channelCount,v.audioDataRate=p.bitRate,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',v.isComplete()&&this._onMediaInfo(v)}var y=this._parseMP3AudioData(e,t+1,r-1,!1);if(null==y)return;m=this._timestampBase+i;var _={unit:y,length:y.byteLength,dts:m,pts:m};h.samples.push(_),h.length+=y.length}}else this._onError(s.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+c)}else this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+o)}},e.prototype._parseAACAudioData=function(e,t,r){if(!(r<=1)){var i={},a=new Uint8Array(e,t,r);return i.packetType=a[0],0===a[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,r-1):i.data=a.subarray(1),i}n.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(e,t,r){var n,i,a=new Uint8Array(e,t,r),o=null,l=0,c=null;if(l=n=a[0]>>>3,(i=(7&a[0])<<1|a[1]>>>7)<0||i>=this._mpegSamplingRates.length)this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var u=this._mpegSamplingRates[i],d=(120&a[1])>>>3;if(!(d<0||d>=8)){5===l&&(c=(7&a[1])<<1|a[2]>>>7,a[2]);var h=self.navigator.userAgent.toLowerCase();return-1!==h.indexOf("firefox")?i>=6?(l=5,o=new Array(4),c=i-3):(l=2,o=new Array(2),c=i):-1!==h.indexOf("android")?(l=2,o=new Array(2),c=i):(l=5,c=i,o=new Array(4),i>=6?c=i-3:1===d&&(l=2,o=new Array(2),c=i)),o[0]=l<<3,o[0]|=(15&i)>>>1,o[1]=(15&i)<<7,o[1]|=(15&d)<<3,5===l&&(o[1]|=(15&c)>>>1,o[2]=(1&c)<<7,o[2]|=8,o[3]=0),{config:o,samplingRate:u,channelCount:d,codec:"mp4a.40."+l,originalCodec:"mp4a.40."+n}}this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},e.prototype._parseMP3AudioData=function(e,t,r,i){if(!(r<4)){this._littleEndian;var a=new Uint8Array(e,t,r),s=null;if(i){if(255!==a[0])return;var o=a[1]>>>3&3,l=(6&a[1])>>1,c=(240&a[2])>>>4,u=(12&a[2])>>>2,d=3!=(a[3]>>>6&3)?2:1,h=0,f=0;switch(o){case 0:h=this._mpegAudioV25SampleRateTable[u];break;case 2:h=this._mpegAudioV20SampleRateTable[u];break;case 3:h=this._mpegAudioV10SampleRateTable[u]}switch(l){case 1:c<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[c]);break;case 2:c<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[c]);break;case 3:c<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[c])}s={bitRate:f,samplingRate:h,channelCount:d,codec:"mp3",originalCodec:"mp3"}}else s=a;return s}n.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseVideoData=function(e,t,r,i,a){if(r<=1)n.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var o=new Uint8Array(e,t,r)[0],l=(240&o)>>>4,c=15&o;7===c?this._parseAVCVideoPacket(e,t+1,r-1,i,a,l):this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+c)}},e.prototype._parseAVCVideoPacket=function(e,t,r,i,a,o){if(r<4)n.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var l=this._littleEndian,c=new DataView(e,t,r),u=c.getUint8(0),d=(16777215&c.getUint32(0,!l))<<8>>8;if(0===u)this._parseAVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===u)this._parseAVCVideoData(e,t+4,r-4,i,a,o,d);else if(2!==u)return void this._onError(s.default.FORMAT_ERROR,"Flv: Invalid video packet type "+u)}},e.prototype._parseAVCDecoderConfigurationRecord=function(e,t,r){if(r<7)n.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var i=this._videoMetadata,o=this._videoTrack,l=this._littleEndian,c=new DataView(e,t,r);i?void 0!==i.avcc&&n.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(i=this._videoMetadata={}).type="video",i.id=o.id,i.timescale=this._timescale,i.duration=this._duration);var u=c.getUint8(0),d=c.getUint8(1);if(c.getUint8(2),c.getUint8(3),1===u&&0!==d)if(this._naluLengthSize=1+(3&c.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&c.getUint8(5);if(0!==h){h>1&&n.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+h);for(var f=6,p=0;p<h;p++){var m=c.getUint16(f,!l);if(f+=2,0!==m){var g=new Uint8Array(e,t+f,m);f+=m;var v=a.default.parseSPS(g);if(0===p){i.codecWidth=v.codec_size.width,i.codecHeight=v.codec_size.height,i.presentWidth=v.present_size.width,i.presentHeight=v.present_size.height,i.profile=v.profile_string,i.level=v.level_string,i.bitDepth=v.bit_depth,i.chromaFormat=v.chroma_format,i.sarRatio=v.sar_ratio,i.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var y=i.frameRate.fps_den,_=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(y/_);for(var E=g.subarray(1,4),S="avc1.",b=0;b<3;b++){var T=E[b].toString(16);T.length<2&&(T="0"+T),S+=T}i.codec=S;var R=this._mediaInfo;R.width=i.codecWidth,R.height=i.codecHeight,R.fps=i.frameRate.fps,R.profile=i.profile,R.level=i.level,R.refFrames=v.ref_frames,R.chromaFormat=v.chroma_format_string,R.sarNum=i.sarRatio.width,R.sarDen=i.sarRatio.height,R.videoCodec=S,R.hasAudio?null!=R.audioCodec&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.videoCodec+'"',R.isComplete()&&this._onMediaInfo(R)}}}var A=c.getUint8(f);if(0!==A){for(A>1&&n.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+A),f++,p=0;p<A;p++)m=c.getUint16(f,!l),f+=2,0!==m&&(f+=m);i.avcc=new Uint8Array(r),i.avcc.set(new Uint8Array(e,t,r),0),n.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}else this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(s.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},e.prototype._parseAVCVideoData=function(e,t,r,i,a,s,o){for(var l=this._littleEndian,c=new DataView(e,t,r),u=[],d=0,h=0,f=this._naluLengthSize,p=this._timestampBase+i,m=1===s;h<r;){if(h+4>=r){n.default.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+h+", dataSize = "+r);break}var g=c.getUint32(h,!l);if(3===f&&(g>>>=8),g>r-f)return void n.default.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var v=31&c.getUint8(h+f);5===v&&(m=!0);var y=new Uint8Array(e,t+h,f+g),_={type:v,data:y};u.push(_),d+=y.byteLength,h+=f+g}if(u.length){var E=this._videoTrack,S={units:u,length:d,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(S.fileposition=a),E.samples.push(S),E.length+=d}},e}();t.default=c},"./src/demux/sps-parser.js":
/*!*********************************!*\
    !*** ./src/demux/sps-parser.js ***!
    \*********************************/function(e,t,r){r.r(t);var n=r(/*! ./exp-golomb.js */"./src/demux/exp-golomb.js"),i=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)},e.parseSPS=function(t){var r=e._ebsp2rbsp(t),i=new n.default(r);i.readByte();var a=i.readByte();i.readByte();var s=i.readByte();i.readUEG();var o=e.getProfileString(a),l=e.getLevelString(s),c=1,u=420,d=8;if((100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a||138===a||144===a)&&(3===(c=i.readUEG())&&i.readBits(1),c<=3&&(u=[0,420,422,444][c]),d=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var h=3!==c?8:12,f=0;f<h;f++)i.readBool()&&(f<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();var m=i.readUEG();for(f=0;f<m;f++)i.readSEG()}var g=i.readUEG();i.readBits(1);var v=i.readUEG(),y=i.readUEG(),_=i.readBits(1);0===_&&i.readBits(1),i.readBits(1);var E=0,S=0,b=0,T=0;i.readBool()&&(E=i.readUEG(),S=i.readUEG(),b=i.readUEG(),T=i.readUEG());var R=1,A=1,w=0,L=!0,C=0,I=0;if(i.readBool()){if(i.readBool()){var k=i.readByte();k>0&&k<16?(R=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][k-1],A=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][k-1]):255===k&&(R=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var O=i.readBits(32),D=i.readBits(32);L=i.readBool(),w=(C=D)/(I=2*O)}}var P=1;1===R&&1===A||(P=R/A);var x=0,M=0;0===c?(x=1,M=2-_):(x=3===c?1:2,M=(1===c?2:1)*(2-_));var N=16*(v+1),F=16*(y+1)*(2-_);N-=(E+S)*x,F-=(b+T)*M;var U=Math.ceil(N*P);return i.destroy(),i=null,{profile_string:o,level_string:l,bit_depth:d,ref_frames:g,chroma_format:u,chroma_format_string:e.getChromaFormatString(u),frame_rate:{fixed:L,fps:w,fps_den:I,fps_num:C},sar_ratio:{width:R,height:A},codec_size:{width:N,height:F},present_size:{width:U,height:F}}},e._skipScalingList=function(e,t){for(var r=8,n=8,i=0;i<t;i++)0!==n&&(n=(r+e.readSEG()+256)%256),r=0===n?r:n},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}();t.default=i},"./src/flv.js":
/*!********************!*\
    !*** ./src/flv.js ***!
    \********************/function(e,t,r){r.r(t);var n=r(/*! ./utils/polyfill.js */"./src/utils/polyfill.js"),i=r(/*! ./core/features.js */"./src/core/features.js"),a=r(/*! ./io/loader.js */"./src/io/loader.js"),s=r(/*! ./player/flv-player.js */"./src/player/flv-player.js"),o=r(/*! ./player/native-player.js */"./src/player/native-player.js"),l=r(/*! ./player/player-events.js */"./src/player/player-events.js"),c=r(/*! ./player/player-errors.js */"./src/player/player-errors.js"),u=r(/*! ./utils/logging-control.js */"./src/utils/logging-control.js"),d=r(/*! ./utils/exception.js */"./src/utils/exception.js");n.default.install();var h={createPlayer:function(e,t){var r=e;if(null==r||"object"!=typeof r)throw new d.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!r.hasOwnProperty("type"))throw new d.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");return"flv"===r.type?new s.default(r,t):new o.default(r,t)},isSupported:function(){return i.default.supportMSEH264Playback()},getFeatureList:function(){return i.default.getFeatureList()}};h.BaseLoader=a.BaseLoader,h.LoaderStatus=a.LoaderStatus,h.LoaderErrors=a.LoaderErrors,h.Events=l.default,h.ErrorTypes=c.ErrorTypes,h.ErrorDetails=c.ErrorDetails,h.FlvPlayer=s.default,h.NativePlayer=o.default,h.LoggingControl=u.default,Object.defineProperty(h,"version",{enumerable:!0,get:function(){return"1.6.2"}}),t.default=h},"./src/index.js":
/*!**********************!*\
    !*** ./src/index.js ***!
    \**********************/function(e,t,r){e.exports=r(/*! ./flv.js */"./src/flv.js").default},"./src/io/fetch-stream-loader.js":
/*!***************************************!*\
    !*** ./src/io/fetch-stream-loader.js ***!
    \***************************************/function(e,t,r){r.r(t);var n,i=r(/*! ../utils/browser.js */"./src/utils/browser.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t,r){var n=e.call(this,"fetch-stream-loader")||this;return n.TAG="FetchStreamLoader",n._seekHandler=t,n._config=r,n._needStash=!0,n._requestAbort=!1,n._contentLength=null,n._receivedLength=0,n}return o(t,e),t.isSupported=function(){try{var e=i.default.msedge&&i.default.version.minor>=15048,t=!i.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(r){return!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){var r=this;this._dataSource=e,this._range=t;var n=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(n=e.redirectedURL);var i=this._seekHandler.getConfig(n,t),o=new self.Headers;if("object"==typeof i.headers){var l=i.headers;for(var c in l)l.hasOwnProperty(c)&&o.append(c,l[c])}var u={method:"GET",headers:o,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var c in this._config.headers)o.append(c,this._config.headers[c]);!1===e.cors&&(u.mode="same-origin"),e.withCredentials&&(u.credentials="include"),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,u.signal=this._abortController.signal),this._status=a.LoaderStatus.kConnecting,self.fetch(i.url,u).then((function(e){if(r._requestAbort)return r._status=a.LoaderStatus.kIdle,void e.body.cancel();if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==i.url&&r._onURLRedirect){var t=r._seekHandler.removeURLParameters(e.url);r._onURLRedirect(t)}var n=e.headers.get("Content-Length");return null!=n&&(r._contentLength=parseInt(n),0!==r._contentLength&&r._onContentLengthKnown&&r._onContentLengthKnown(r._contentLength)),r._pump.call(r,e.body.getReader())}if(r._status=a.LoaderStatus.kError,!r._onError)throw new s.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);r._onError(a.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})).catch((function(e){if(!r._abortController||!r._abortController.signal.aborted){if(r._status=a.LoaderStatus.kError,!r._onError)throw e;r._onError(a.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}}))},t.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.LoaderStatus.kBuffering||!i.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(e){}},t.prototype._pump=function(e){var t=this;return e.read().then((function(r){if(r.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=a.LoaderStatus.kError;var n=a.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new s.RuntimeException(i.msg);t._onError(n,i)}else t._status=a.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted)return void(t._status=a.LoaderStatus.kComplete);if(!0===t._requestAbort)return t._status=a.LoaderStatus.kComplete,e.cancel();t._status=a.LoaderStatus.kBuffering;var o=r.value.buffer,l=t._range.from+t._receivedLength;t._receivedLength+=o.byteLength,t._onDataArrival&&t._onDataArrival(o,l,t._receivedLength),t._pump(e)}})).catch((function(e){if(t._abortController&&t._abortController.signal.aborted)t._status=a.LoaderStatus.kComplete;else if(11!==e.code||!i.default.msedge){t._status=a.LoaderStatus.kError;var r=0,n=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(r=a.LoaderErrors.EXCEPTION,n={code:e.code,msg:e.message}):(r=a.LoaderErrors.EARLY_EOF,n={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new s.RuntimeException(n.msg);t._onError(r,n)}}))},t}(a.BaseLoader);t.default=l},"./src/io/io-controller.js":
/*!*********************************!*\
    !*** ./src/io/io-controller.js ***!
    \*********************************/function(e,t,r){r.r(t);var n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),i=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ./fetch-stream-loader.js */"./src/io/fetch-stream-loader.js"),o=r(/*! ./xhr-moz-chunked-loader.js */"./src/io/xhr-moz-chunked-loader.js"),l=r(/*! ./xhr-range-loader.js */"./src/io/xhr-range-loader.js"),c=r(/*! ./websocket-loader.js */"./src/io/websocket-loader.js"),u=r(/*! ./range-seek-handler.js */"./src/io/range-seek-handler.js"),d=r(/*! ./param-seek-handler.js */"./src/io/param-seek-handler.js"),h=r(/*! ../utils/exception.js */"./src/utils/exception.js"),f=function(){function e(e,t,r){this.TAG="IOController",this._config=t,this._extraData=r,this._stashInitialSize=393216,null!=t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new i.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loaderClass===l.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new u.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",r=e.seekParamEnd||"bend";this._seekHandler=new d.default(t,r)}else{if("custom"!==e.seekType)throw new h.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new h.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}},e.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=c.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(o.default.isSupported())this._loaderClass=o.default;else{if(!l.default.isSupported())throw new h.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=l.default}},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},e.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},e.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},e.prototype._internalSeek=function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var r={from:e,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()},e.prototype.updateUrl=function(e){if(!e||"string"!=typeof e||0===e.length)throw new h.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e},e.prototype._expandBuffer=function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(n,0)}this._stashBuffer=r,this._bufferSize=t}},e.prototype._normalizeSpeed=function(e){var t=this._speedNormalizeList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}},e.prototype._adjustStashSize=function(e){var t=0;(t=this._config.isLive||e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t},e.prototype._dispatchChunks=function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)},e.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},e.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(e,t,r){if(!this._onDataArrival)throw new h.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var n=this._speedSampler.lastSecondKBps;if(0!==n){var i=this._normalizeSpeed(n);this._speedNormalized!==i&&(this._speedNormalized=i,this._adjustStashSize(i))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)(o=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else if(o=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var a=this._stashBuffer.slice(0,this._stashUsed);(l=this._dispatchChunks(a,this._stashByteStart))<a.byteLength?l>0&&(c=new Uint8Array(a,l),o.set(c,0),this._stashUsed=c.byteLength,this._stashByteStart+=l):(this._stashUsed=0,this._stashByteStart+=l),this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else(l=this._dispatchChunks(e,t))<e.byteLength&&((s=e.byteLength-l)>this._bufferSize&&(this._expandBuffer(s),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,l),0),this._stashUsed+=s,this._stashByteStart=t+l);else if(0===this._stashUsed){var s;(l=this._dispatchChunks(e,t))<e.byteLength&&((s=e.byteLength-l)>this._bufferSize&&this._expandBuffer(s),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e,l),0),this._stashUsed+=s,this._stashByteStart=t+l)}else{var o,l;if(this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength,(l=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&l>0){var c=new Uint8Array(this._stashBuffer,l);o.set(c,0)}this._stashUsed-=l,this._stashByteStart+=l}}},e.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(t,this._stashByteStart),i=t.byteLength-r;if(r<t.byteLength){if(!e){if(r>0){var a=new Uint8Array(this._stashBuffer,0,this._bufferSize),s=new Uint8Array(t,r);a.set(s,0),this._stashUsed=s.byteLength,this._stashByteStart+=r}return 0}n.default.w(this.TAG,i+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,i}return 0},e.prototype._onLoaderComplete=function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(e,t){switch(n.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=a.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case a.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(n.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}e=a.LoaderErrors.UNRECOVERABLE_EARLY_EOF;case a.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case a.LoaderErrors.CONNECTING_TIMEOUT:case a.LoaderErrors.HTTP_STATUS_CODE_INVALID:case a.LoaderErrors.EXCEPTION:}if(!this._onError)throw new h.RuntimeException("IOException: "+t.msg);this._onError(e,t)},e}();t.default=f},"./src/io/loader.js":
/*!**************************!*\
    !*** ./src/io/loader.js ***!
    \**************************/function(e,t,r){r.r(t),r.d(t,{LoaderStatus:function(){return i},LoaderErrors:function(){return a},BaseLoader:function(){return s}});var n=r(/*! ../utils/exception.js */"./src/utils/exception.js"),i={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},a={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function e(e){this._type=e||"undefined",this._status=i.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return e.prototype.destroy=function(){this._status=i.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===i.kConnecting||this._status===i.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),e.prototype.open=function(e,t){throw new n.NotImplementedException("Unimplemented abstract function!")},e.prototype.abort=function(){throw new n.NotImplementedException("Unimplemented abstract function!")},e}()},"./src/io/param-seek-handler.js":
/*!**************************************!*\
    !*** ./src/io/param-seek-handler.js ***!
    \**************************************/function(e,t,r){r.r(t);var n=function(){function e(e,t){this._startName=e,this._endName=t}return e.prototype.getConfig=function(e,t){var r=e;if(0!==t.from||-1!==t.to){var n=!0;-1===r.indexOf("?")&&(r+="?",n=!1),n&&(r+="&"),r+=this._startName+"="+t.from.toString(),-1!==t.to&&(r+="&"+this._endName+"="+t.to.toString())}return{url:r,headers:{}}},e.prototype.removeURLParameters=function(e){var t=e.split("?")[0],r=void 0,n=e.indexOf("?");-1!==n&&(r=e.substring(n+1));var i="";if(null!=r&&r.length>0)for(var a=r.split("&"),s=0;s<a.length;s++){var o=a[s].split("="),l=s>0;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(i+="&"),i+=a[s])}return 0===i.length?t:t+"?"+i},e}();t.default=n},"./src/io/range-seek-handler.js":
/*!**************************************!*\
    !*** ./src/io/range-seek-handler.js ***!
    \**************************************/function(e,t,r){r.r(t);var n=function(){function e(e){this._zeroStart=e||!1}return e.prototype.getConfig=function(e,t){var r={};if(0!==t.from||-1!==t.to){var n=void 0;n=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",r.Range=n}else this._zeroStart&&(r.Range="bytes=0-");return{url:e,headers:r}},e.prototype.removeURLParameters=function(e){return e},e}();t.default=n},"./src/io/speed-sampler.js":
/*!*********************************!*\
    !*** ./src/io/speed-sampler.js ***!
    \*********************************/function(e,t,r){r.r(t);var n=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}();t.default=n},"./src/io/websocket-loader.js":
/*!************************************!*\
    !*** ./src/io/websocket-loader.js ***!
    \************************************/function(e,t,r){r.r(t);var n,i=r(/*! ./loader.js */"./src/io/loader.js"),a=r(/*! ../utils/exception.js */"./src/utils/exception.js"),s=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=function(e){function t(){var t=e.call(this,"websocket-loader")||this;return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return s(t,e),t.isSupported=function(){try{return void 0!==self.WebSocket}catch(e){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=i.LoaderStatus.kConnecting}catch(n){this._status=i.LoaderStatus.kError;var r={code:n.code,msg:n.message};if(!this._onError)throw new a.RuntimeException(r.msg);this._onError(i.LoaderErrors.EXCEPTION,r)}},t.prototype.abort=function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=i.LoaderStatus.kComplete},t.prototype._onWebSocketOpen=function(e){this._status=i.LoaderStatus.kBuffering},t.prototype._onWebSocketClose=function(e){!0!==this._requestAbort?(this._status=i.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var r=new FileReader;r.onload=function(){t._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(e.data)}else{this._status=i.LoaderStatus.kError;var n={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new a.RuntimeException(n.msg);this._onError(i.LoaderErrors.EXCEPTION,n)}},t.prototype._dispatchArrayBuffer=function(e){var t=e,r=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)},t.prototype._onWebSocketError=function(e){this._status=i.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new a.RuntimeException(t.msg);this._onError(i.LoaderErrors.EXCEPTION,t)},t}(i.BaseLoader);t.default=o},"./src/io/xhr-moz-chunked-loader.js":
/*!******************************************!*\
    !*** ./src/io/xhr-moz-chunked-loader.js ***!
    \******************************************/function(e,t,r){r.r(t);var n,i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t,r){var n=e.call(this,"xhr-moz-chunked-loader")||this;return n.TAG="MozChunkedLoader",n._seekHandler=t,n._config=r,n._needStash=!0,n._xhr=null,n._requestAbort=!1,n._contentLength=null,n._receivedLength=0,n}return o(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(t){return i.default.w("MozChunkedLoader",t.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(r=e.redirectedURL);var n=this._seekHandler.getConfig(r,t);this._requestURL=n.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",n.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),e.withCredentials&&(i.withCredentials=!0),"object"==typeof n.headers){var s=n.headers;for(var o in s)s.hasOwnProperty(o)&&i.setRequestHeader(o,s[o])}if("object"==typeof this._config.headers)for(var o in s=this._config.headers)s.hasOwnProperty(o)&&i.setRequestHeader(o,s[o]);this._status=a.LoaderStatus.kConnecting,i.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.LoaderStatus.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var r=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(r)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=a.LoaderStatus.kError,!this._onError)throw new s.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(a.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=a.LoaderStatus.kBuffering}},t.prototype._onProgress=function(e){if(this._status!==a.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)}},t.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._status!==a.LoaderStatus.kError&&(this._status=a.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(e){this._status=a.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&e.loaded<this._contentLength?(t=a.LoaderErrors.EARLY_EOF,r={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=a.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new s.RuntimeException(r.msg);this._onError(t,r)},t}(a.BaseLoader);t.default=l},"./src/io/xhr-range-loader.js":
/*!************************************!*\
    !*** ./src/io/xhr-range-loader.js ***!
    \************************************/function(e,t,r){r.r(t);var n,i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),s=r(/*! ./loader.js */"./src/io/loader.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c=function(e){function t(t,r){var n=e.call(this,"xhr-range-loader")||this;return n.TAG="RangeLoader",n._seekHandler=t,n._config=r,n._needStash=!1,n._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],n._currentChunkSizeKB=384,n._currentSpeedNormalized=0,n._zeroSpeedChunkCount=0,n._xhr=null,n._speedSampler=new a.default,n._requestAbort=!1,n._waitForTotalLength=!1,n._totalLengthReceived=!1,n._currentRequestURL=null,n._currentRedirectedURL=null,n._currentRequestRange=null,n._totalLength=null,n._contentLength=null,n._receivedLength=0,n._lastTimeLoaded=0,n}return l(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(t){return i.default.w("RangeLoader",t.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.open=function(e,t){this._dataSource=e,this._range=t,this._status=s.LoaderStatus.kConnecting;var r=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(r=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||r?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},t.prototype._openSubRange=function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,r=t+e;null!=this._contentLength&&r-this._range.from>=this._contentLength&&(r=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:r},this._internalOpen(this._dataSource,this._currentRequestRange)},t.prototype._internalOpen=function(e,t){this._lastTimeLoaded=0;var r=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?r=this._currentRedirectedURL:null!=e.redirectedURL&&(r=e.redirectedURL));var n=this._seekHandler.getConfig(r,t);this._currentRequestURL=n.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",n.url,!0),i.responseType="arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoad.bind(this),i.onerror=this._onXhrError.bind(this),e.withCredentials&&(i.withCredentials=!0),"object"==typeof n.headers){var a=n.headers;for(var s in a)a.hasOwnProperty(s)&&i.setRequestHeader(s,a[s])}if("object"==typeof this._config.headers)for(var s in a=this._config.headers)a.hasOwnProperty(s)&&i.setRequestHeader(s,a[s]);i.send()},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=s.LoaderStatus.kComplete},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=s.LoaderStatus.kBuffering}else{if(this._status=s.LoaderStatus.kError,!this._onError)throw new o.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}},t.prototype._onProgress=function(e){if(this._status!==s.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var r=e.total;this._internalAbort(),null!=r&0!==r&&(this._totalLength=r)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(n)}},t.prototype._normalizeSpeed=function(e){var t=this._chunkSizeKBList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}},t.prototype._onLoad=function(e){if(this._status!==s.LoaderStatus.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var r=this._normalizeSpeed(t);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var n=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(n,i,this._receivedLength),a&&(this._status=s.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(e){this._status=s.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=s.LoaderErrors.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=s.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new o.RuntimeException(r.msg);this._onError(t,r)},t}(s.BaseLoader);t.default=c},"./src/player/flv-player.js":
/*!**********************************!*\
    !*** ./src/player/flv-player.js ***!
    \**********************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./player-events.js */"./src/player/player-events.js"),l=r(/*! ../core/transmuxer.js */"./src/core/transmuxer.js"),c=r(/*! ../core/transmuxing-events.js */"./src/core/transmuxing-events.js"),u=r(/*! ../core/mse-controller.js */"./src/core/mse-controller.js"),d=r(/*! ../core/mse-events.js */"./src/core/mse-events.js"),h=r(/*! ./player-errors.js */"./src/player/player-errors.js"),f=r(/*! ../config.js */"./src/config.js"),p=r(/*! ../utils/exception.js */"./src/utils/exception.js"),m=function(){function e(e,t){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(i()),this._config=(0,f.createDefaultConfig)(),"object"==typeof t&&Object.assign(this._config,t),"flv"!==e.type.toLowerCase())throw new p.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=s.default.chrome&&(s.default.version.major<50||50===s.default.version.major&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(r||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return e.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===o.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){r._emitter.emit(o.default.MEDIA_INFO,r.mediaInfo)})):e===o.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){r._emitter.emit(o.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new u.default(this._config),this._msectl.on(d.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(d.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(d.default.SOURCE_OPEN,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(d.default.ERROR,(function(e){t._emitter.emit(o.default.ERROR,h.ErrorTypes.MEDIA_ERROR,h.ErrorDetails.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(r){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},e.prototype.load=function(){var e=this;if(!this._mediaElement)throw new p.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new p.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new l.default(this._mediaDataSource,this._config),this._transmuxer.on(c.default.INIT_SEGMENT,(function(t,r){e._msectl.appendInitSegment(r)})),this._transmuxer.on(c.default.MEDIA_SEGMENT,(function(t,r){if(e._msectl.appendMediaSegment(r),e._config.lazyLoad&&!e._config.isLive){var n=e._mediaElement.currentTime;r.info.endDts>=1e3*(n+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(a.default.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}})),this._transmuxer.on(c.default.LOADING_COMPLETE,(function(){e._msectl.endOfStream(),e._emitter.emit(o.default.LOADING_COMPLETE)})),this._transmuxer.on(c.default.RECOVERED_EARLY_EOF,(function(){e._emitter.emit(o.default.RECOVERED_EARLY_EOF)})),this._transmuxer.on(c.default.IO_ERROR,(function(t,r){e._emitter.emit(o.default.ERROR,h.ErrorTypes.NETWORK_ERROR,t,r)})),this._transmuxer.on(c.default.DEMUX_ERROR,(function(t,r){e._emitter.emit(o.default.ERROR,h.ErrorTypes.MEDIA_ERROR,t,{code:-1,msg:r})})),this._transmuxer.on(c.default.MEDIA_INFO,(function(t){e._mediaInfo=t,e._emitter.emit(o.default.MEDIA_INFO,Object.assign({},t))})),this._transmuxer.on(c.default.METADATA_ARRIVED,(function(t){e._emitter.emit(o.default.METADATA_ARRIVED,t)})),this._transmuxer.on(c.default.SCRIPTDATA_ARRIVED,(function(t){e._emitter.emit(o.default.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(c.default.STATISTICS_INFO,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(o.default.STATISTICS_INFO,Object.assign({},e._statisticsInfo))})),this._transmuxer.on(c.default.RECOMMEND_SEEKPOINT,(function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)})),this._transmuxer.open()))},e.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),e.prototype._fillStatisticsInfo=function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();r=i.totalVideoFrames,n=i.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=n),e},e.prototype._onmseUpdateEnd=function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,r=0,n=0;n<e.length;n++){var i=e.start(n),s=e.end(n);if(i<=t&&t<s){r=s;break}}r>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(a.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},e.prototype._onmseBufferFull=function(){a.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},e.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},e.prototype._checkProgressAndResume=function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,r=!1,n=0;n<t.length;n++){var i=t.start(n),s=t.end(n);if(e>=i&&e<s){e>=s-this._config.lazyLoadRecoverDuration&&(r=!0);break}}r&&(window.clearInterval(this._progressChecker),this._progressChecker=null,r&&(a.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},e.prototype._isTimepointBuffered=function(e){for(var t=this._mediaElement.buffered,r=0;r<t.length;r++){var n=t.start(r),i=t.end(r);if(e>=n&&e<i)return!0}return!1},e.prototype._internalSeek=function(e){var t=this._isTimepointBuffered(e),r=!1,n=0;if(e<1&&this._mediaElement.buffered.length>0){var i=this._mediaElement.buffered.start(0);(i<1&&e<i||s.default.safari)&&(r=!0,n=s.default.safari?.1:i)}if(r)this._requestSetTime=!0,this._mediaElement.currentTime=n;else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)},e.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},e.prototype._checkAndResumeStuckPlayback=function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var r=t.buffered;r.length>0&&t.currentTime<r.start(0)&&(a.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+r.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=r.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},e.prototype._onvSeeking=function(e){var t=this._mediaElement.currentTime,r=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&r.length>0){var n=r.start(0);if(n<1&&t<n||s.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=s.default.safari?.1:n)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var i=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=i&&(this._requestSetTime=!0,this._mediaElement.currentTime=i.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},e.prototype._onvCanPlay=function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},e.prototype._onvStalled=function(e){this._checkAndResumeStuckPlayback(!0)},e.prototype._onvProgress=function(e){this._checkAndResumeStuckPlayback()},e}();t.default=m},"./src/player/native-player.js":
/*!*************************************!*\
    !*** ./src/player/native-player.js ***!
    \*************************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ./player-events.js */"./src/player/player-events.js"),s=r(/*! ../config.js */"./src/config.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=function(){function e(e,t){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(i()),this._config=(0,s.createDefaultConfig)(),"object"==typeof t&&Object.assign(this._config,t),"flv"===e.type.toLowerCase())throw new o.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new o.InvalidArgumentException("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return e.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===a.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(a.default.MEDIA_INFO,r.mediaInfo)})):e===a.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(a.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.load=function(){if(!this._mediaElement)throw new o.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();r=i.totalVideoFrames,n=i.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=n),e},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(a.default.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(a.default.STATISTICS_INFO,this.statisticsInfo)},e}();t.default=l},"./src/player/player-errors.js":
/*!*************************************!*\
    !*** ./src/player/player-errors.js ***!
    \*************************************/function(e,t,r){r.r(t),r.d(t,{ErrorTypes:function(){return a},ErrorDetails:function(){return s}});var n=r(/*! ../io/loader.js */"./src/io/loader.js"),i=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),a={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:n.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:n.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:n.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:n.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:i.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:i.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:i.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":
/*!*************************************!*\
    !*** ./src/player/player-events.js ***!
    \*************************************/function(e,t,r){r.r(t),t.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"}},"./src/remux/aac-silent.js":
/*!*********************************!*\
    !*** ./src/remux/aac-silent.js ***!
    \*********************************/function(e,t,r){r.r(t);var n=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.default=n},"./src/remux/mp4-generator.js":
/*!************************************!*\
    !*** ./src/remux/mp4-generator.js ***!
    \************************************/function(e,t,r){r.r(t);var n=function(){function e(){}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=e.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(e){for(var t=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,a=0;a<i;a++)t+=n[a].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);var s=8;for(a=0;a<i;a++)r.set(n[a],s),s+=n[a].byteLength;return r},e.generateInitSegment=function(t){var r=e.box(e.types.ftyp,e.constants.FTYP),n=e.moov(t),i=new Uint8Array(r.byteLength+n.byteLength);return i.set(r,0),i.set(n,r.byteLength),i},e.moov=function(t){var r=e.mvhd(t.timescale,t.duration),n=e.trak(t),i=e.mvex(t);return e.box(e.types.moov,r,n,i)},e.mvhd=function(t,r){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.tkhd=function(t){var r=t.id,n=t.duration,i=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,a>>>8&255,255&a,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))},e.mdhd=function(t){var r=t.timescale,n=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))},e.hdlr=function(t){var r=null;return r="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,r)},e.minf=function(t){var r=null;return r="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,r,e.dinf(),e.stbl(t))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))},e.mp3=function(t){var r=t.channelCount,n=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types[".mp3"],i)},e.mp4a=function(t){var r=t.channelCount,n=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types.mp4a,i,e.esds(t))},e.esds=function(t){var r=t.config||[],n=r.length,i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(r).concat([6,1,2]));return e.box(e.types.esds,i)},e.avc1=function(t){var r=t.avcc,n=t.codecWidth,i=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,r))},e.mvex=function(t){return e.box(e.types.mvex,e.trex(t))},e.trex=function(t){var r=t.id,n=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)},e.moof=function(t,r){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,r))},e.mfhd=function(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,r)},e.traf=function(t,r){var n=t.id,i=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),s=e.sdtp(t),o=e.trun(t,s.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,i,a,o,s)},e.sdtp=function(t){for(var r=t.samples||[],n=r.length,i=new Uint8Array(4+n),a=0;a<n;a++){var s=r[a].flags;i[a+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return e.box(e.types.sdtp,i)},e.trun=function(t,r){var n=t.samples||[],i=n.length,a=12+16*i,s=new Uint8Array(a);r+=8+a,s.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<i;o++){var l=n[o].duration,c=n[o].size,u=n[o].flags,d=n[o].cts;s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*o)}return e.box(e.types.trun,s)},e.mdat=function(t){return e.box(e.types.mdat,t)},e}();n.init(),t.default=n},"./src/remux/mp4-remuxer.js":
/*!**********************************!*\
    !*** ./src/remux/mp4-remuxer.js ***!
    \**********************************/function(e,t,r){r.r(t);var n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),i=r(/*! ./mp4-generator.js */"./src/remux/mp4-generator.js"),a=r(/*! ./aac-silent.js */"./src/remux/aac-silent.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ../core/media-segment-info.js */"./src/core/media-segment-info.js"),l=r(/*! ../utils/exception.js */"./src/utils/exception.js"),c=function(){function e(e){this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new o.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new o.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!s.default.chrome||!(s.default.version.major<50||50===s.default.version.major&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},e.prototype.bindDataSource=function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(e.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e},enumerable:!1,configurable:!0}),e.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},e.prototype.seek=function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},e.prototype.remux=function(e,t){if(!this._onMediaSegment)throw new l.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)},e.prototype._onTrackMetadataReceived=function(e,t){var r=null,n="mp4",a=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(n="mpeg",a="",r=new Uint8Array):r=i.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,r=i.default.generateInitSegment(t)}if(!this._onInitSegment)throw new l.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:r.buffer,codec:a,container:e+"/"+n,mediaDuration:t.duration})},e.prototype._calculateDtsBase=function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.flushStashedSamples=function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,r={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(r.samples.push(e),r.length=e.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(n.samples.push(t),n.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(r,!0),this._remuxAudio(n,!0)},e.prototype._remuxAudio=function(e,t){if(null!=this._audioMeta){var r,l=e,c=l.samples,u=void 0,d=-1,h=this._audioMeta.refSampleDuration,f="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,p=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(c&&0!==c.length&&(1!==c.length||t)){var g=0,v=null,y=0;f?(g=0,y=l.length):(g=8,y=8+l.length);var _=null;if(c.length>1&&(y-=(_=c.pop()).length),null!=this._audioStashedLastSample){var E=this._audioStashedLastSample;this._audioStashedLastSample=null,c.unshift(E),y+=E.length}null!=_&&(this._audioStashedLastSample=_);var S=c[0].dts-this._dtsBase;if(this._audioNextDts)u=S-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())u=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var b=this._audioSegmentInfoList.getLastSampleBefore(S);if(null!=b){var T=S-(b.originalDts+b.duration);T<=3&&(T=0),u=S-(b.dts+b.duration+T)}else u=0}if(m){var R=S-u,A=this._videoSegmentInfoList.getLastSegmentBefore(S);if(null!=A&&A.beginDts<R){if(N=a.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var w=A.beginDts,L=R-A.beginDts;n.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+w+", duration: "+L),c.unshift({unit:N,dts:w,pts:w}),y+=N.byteLength}}else m=!1}for(var C=[],I=0;I<c.length;I++){var k=(E=c[I]).unit,O=E.dts-this._dtsBase,D=(w=O,!1),P=null,x=0;if(!(O<-.001)){if("mp3"!==this._audioMeta.codec){var M=O;if(this._audioNextDts&&(M=this._audioNextDts),(u=O-M)<=-3*h){n.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+O+" ms ,curRefDts: "+M+" ms)  due to dtsCorrection: "+u+" ms overlap.");continue}if(u>=3*h&&this._fillAudioTimestampGap&&!s.default.safari){D=!0;var N,F=Math.floor(u/h);n.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+O+" ms, curRefDts: "+M+" ms, dtsCorrection: "+Math.round(u)+" ms, generate: "+F+" frames"),w=Math.floor(M),x=Math.floor(M+h)-w,null==(N=a.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(n.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),N=k),P=[];for(var U=0;U<F;U++){M+=h;var B=Math.floor(M),j=Math.floor(M+h)-B,H={dts:B,pts:B,cts:0,unit:N,size:N.byteLength,duration:j,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};P.push(H),y+=H.size}this._audioNextDts=M+h}else w=Math.floor(M),x=Math.floor(M+h)-w,this._audioNextDts=M+h}else w=O-u,x=I!==c.length-1?c[I+1].dts-this._dtsBase-u-w:null!=_?_.dts-this._dtsBase-u-w:C.length>=1?C[C.length-1].duration:Math.floor(h),this._audioNextDts=w+x;-1===d&&(d=w),C.push({dts:w,pts:w,cts:0,unit:E.unit,size:E.unit.byteLength,duration:x,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),D&&C.push.apply(C,P)}}if(0===C.length)return l.samples=[],void(l.length=0);for(f?v=new Uint8Array(y):((v=new Uint8Array(y))[0]=y>>>24&255,v[1]=y>>>16&255,v[2]=y>>>8&255,v[3]=255&y,v.set(i.default.types.mdat,4)),I=0;I<C.length;I++)k=C[I].unit,v.set(k,g),g+=k.byteLength;var V=C[C.length-1];r=V.dts+V.duration;var G=new o.MediaSegmentInfo;G.beginDts=d,G.endDts=r,G.beginPts=d,G.endPts=r,G.originalBeginDts=C[0].originalDts,G.originalEndDts=V.originalDts+V.duration,G.firstSample=new o.SampleInfo(C[0].dts,C[0].pts,C[0].duration,C[0].originalDts,!1),G.lastSample=new o.SampleInfo(V.dts,V.pts,V.duration,V.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(G),l.samples=C,l.sequenceNumber++;var z=null;z=f?new Uint8Array:i.default.moof(l,d),l.samples=[],l.length=0;var K={type:"audio",data:this._mergeBoxes(z,v).buffer,sampleCount:C.length,info:G};f&&p&&(K.timestampOffset=d),this._onMediaSegment("audio",K)}}},e.prototype._remuxVideo=function(e,t){if(null!=this._videoMeta){var r,n,a=e,s=a.samples,l=void 0,c=-1,u=-1;if(s&&0!==s.length&&(1!==s.length||t)){var d=8,h=null,f=8+e.length,p=null;if(s.length>1&&(f-=(p=s.pop()).length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(m),f+=m.length}null!=p&&(this._videoStashedLastSample=p);var g=s[0].dts-this._dtsBase;if(this._videoNextDts)l=g-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())l=0;else{var v=this._videoSegmentInfoList.getLastSampleBefore(g);if(null!=v){var y=g-(v.originalDts+v.duration);y<=3&&(y=0),l=g-(v.dts+v.duration+y)}else l=0}for(var _=new o.MediaSegmentInfo,E=[],S=0;S<s.length;S++){var b=(m=s[S]).dts-this._dtsBase,T=m.isKeyframe,R=b-l,A=m.cts,w=R+A;-1===c&&(c=R,u=w);var L=0;if(L=S!==s.length-1?s[S+1].dts-this._dtsBase-l-R:null!=p?p.dts-this._dtsBase-l-R:E.length>=1?E[E.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),T){var C=new o.SampleInfo(R,w,L,m.dts,!0);C.fileposition=m.fileposition,_.appendSyncPoint(C)}E.push({dts:R,pts:w,cts:A,units:m.units,size:m.length,isKeyframe:T,duration:L,originalDts:b,flags:{isLeading:0,dependsOn:T?2:1,isDependedOn:T?1:0,hasRedundancy:0,isNonSync:T?0:1}})}for((h=new Uint8Array(f))[0]=f>>>24&255,h[1]=f>>>16&255,h[2]=f>>>8&255,h[3]=255&f,h.set(i.default.types.mdat,4),S=0;S<E.length;S++)for(var I=E[S].units;I.length;){var k=I.shift().data;h.set(k,d),d+=k.byteLength}var O=E[E.length-1];if(r=O.dts+O.duration,n=O.pts+O.duration,this._videoNextDts=r,_.beginDts=c,_.endDts=r,_.beginPts=u,_.endPts=n,_.originalBeginDts=E[0].originalDts,_.originalEndDts=O.originalDts+O.duration,_.firstSample=new o.SampleInfo(E[0].dts,E[0].pts,E[0].duration,E[0].originalDts,E[0].isKeyframe),_.lastSample=new o.SampleInfo(O.dts,O.pts,O.duration,O.originalDts,O.isKeyframe),this._isLive||this._videoSegmentInfoList.append(_),a.samples=E,a.sequenceNumber++,this._forceFirstIDR){var D=E[0].flags;D.dependsOn=2,D.isNonSync=0}var P=i.default.moof(a,c);a.samples=[],a.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(P,h).buffer,sampleCount:E.length,info:_})}}},e.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},e}();t.default=c},"./src/utils/browser.js":
/*!******************************!*\
    !*** ./src/utils/browser.js ***!
    \******************************/function(e,t,r){r.r(t);var n={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},a={};if(i.browser){a[i.browser]=!0;var s=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},s.length>1&&(a.version.minor=parseInt(s[1],10)),s.length>2&&(a.version.build=parseInt(s[2],10))}if(i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;var o="msie";i.browser=o,a[o]=!0}if(a.edge){delete a.edge;var l="msedge";i.browser=l,a[l]=!0}if(a.opr){var c="opera";i.browser=c,a[c]=!0}if(a.safari&&a.android){var u="android";i.browser=u,a[u]=!0}for(var d in a.name=i.browser,a.platform=i.platform,n)n.hasOwnProperty(d)&&delete n[d];Object.assign(n,a)}(),t.default=n},"./src/utils/exception.js":
/*!********************************!*\
    !*** ./src/utils/exception.js ***!
    \********************************/function(e,t,r){r.r(t),r.d(t,{RuntimeException:function(){return a},IllegalStateException:function(){return s},InvalidArgumentException:function(){return o},NotImplementedException:function(){return l}});var n,i=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=function(){function e(e){this._message=e}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),s=function(e){function t(t){return e.call(this,t)||this}return i(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(a),o=function(e){function t(t){return e.call(this,t)||this}return i(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(a),l=function(e){function t(t){return e.call(this,t)||this}return i(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(a)},"./src/utils/logger.js":
/*!*****************************!*\
    !*** ./src/utils/logger.js ***!
    \*****************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=function(){function e(){}return e.e=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",n),e.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))},e.i=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",n),e.ENABLE_INFO&&(console.info?console.info(n):console.log(n))},e.w=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",n),e.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))},e.d=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",n),e.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))},e.v=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",n),e.ENABLE_VERBOSE&&console.log(n)},e}();a.GLOBAL_TAG="flv.js",a.FORCE_GLOBAL_TAG=!1,a.ENABLE_ERROR=!0,a.ENABLE_INFO=!0,a.ENABLE_WARN=!0,a.ENABLE_DEBUG=!0,a.ENABLE_VERBOSE=!0,a.ENABLE_CALLBACK=!1,a.emitter=new(i()),t.default=a},"./src/utils/logging-control.js":
/*!**************************************!*\
    !*** ./src/utils/logging-control.js ***!
    \**************************************/function(e,t,r){r.r(t);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ./logger.js */"./src/utils/logger.js"),s=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return a.default.FORCE_GLOBAL_TAG},set:function(t){a.default.FORCE_GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return a.default.GLOBAL_TAG},set:function(t){a.default.GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return a.default.ENABLE_VERBOSE&&a.default.ENABLE_DEBUG&&a.default.ENABLE_INFO&&a.default.ENABLE_WARN&&a.default.ENABLE_ERROR},set:function(t){a.default.ENABLE_VERBOSE=t,a.default.ENABLE_DEBUG=t,a.default.ENABLE_INFO=t,a.default.ENABLE_WARN=t,a.default.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return a.default.ENABLE_DEBUG},set:function(t){a.default.ENABLE_DEBUG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableVerbose",{get:function(){return a.default.ENABLE_VERBOSE},set:function(t){a.default.ENABLE_VERBOSE=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return a.default.ENABLE_INFO},set:function(t){a.default.ENABLE_INFO=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return a.default.ENABLE_WARN},set:function(t){a.default.ENABLE_WARN=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return a.default.ENABLE_ERROR},set:function(t){a.default.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:a.default.GLOBAL_TAG,forceGlobalTag:a.default.FORCE_GLOBAL_TAG,enableVerbose:a.default.ENABLE_VERBOSE,enableDebug:a.default.ENABLE_DEBUG,enableInfo:a.default.ENABLE_INFO,enableWarn:a.default.ENABLE_WARN,enableError:a.default.ENABLE_ERROR,enableCallback:a.default.ENABLE_CALLBACK}},e.applyConfig=function(e){a.default.GLOBAL_TAG=e.globalTag,a.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,a.default.ENABLE_VERBOSE=e.enableVerbose,a.default.ENABLE_DEBUG=e.enableDebug,a.default.ENABLE_INFO=e.enableInfo,a.default.ENABLE_WARN=e.enableWarn,a.default.ENABLE_ERROR=e.enableError,a.default.ENABLE_CALLBACK=e.enableCallback},e._notifyChange=function(){var t=e.emitter;if(t.listenerCount("change")>0){var r=e.getConfig();t.emit("change",r)}},e.registerListener=function(t){e.emitter.addListener("change",t)},e.removeListener=function(t){e.emitter.removeListener("change",t)},e.addLogListener=function(t){a.default.emitter.addListener("log",t),a.default.emitter.listenerCount("log")>0&&(a.default.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(t){a.default.emitter.removeListener("log",t),0===a.default.emitter.listenerCount("log")&&(a.default.ENABLE_CALLBACK=!1,e._notifyChange())},e}();s.emitter=new(i()),t.default=s},"./src/utils/polyfill.js":
/*!*******************************!*\
    !*** ./src/utils/polyfill.js ***!
    \*******************************/function(e,t,r){r.r(t);var n=function(){function e(){}return e.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t},"function"!=typeof self.Promise&&r(/*! es6-promise */"./node_modules/es6-promise/dist/es6-promise.js").polyfill()},e}();n.install(),t.default=n},"./src/utils/utf8-conv.js":
/*!********************************!*\
    !*** ./src/utils/utf8-conv.js ***!
    \********************************/function(e,t,r){function n(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}r.r(t),t.default=function(e){for(var t=[],r=e,i=0,a=e.length;i<a;)if(r[i]<128)t.push(String.fromCharCode(r[i])),++i;else{if(r[i]<192);else if(r[i]<224){if(n(r,i,1)&&(s=(31&r[i])<<6|63&r[i+1])>=128){t.push(String.fromCharCode(65535&s)),i+=2;continue}}else if(r[i]<240){if(n(r,i,2)&&(s=(15&r[i])<<12|(63&r[i+1])<<6|63&r[i+2])>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),i+=3;continue}}else if(r[i]<248){var s;if(n(r,i,3)&&(s=(7&r[i])<<18|(63&r[i+1])<<12|(63&r[i+2])<<6|63&r[i+3])>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}return r.m=e,r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r("./src/index.js")}()},e.exports=r()}(iS);var aS=n(iS.exports),sS={exports:{}};!function(e,t){var r;"undefined"!=typeof window&&(r=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
    !*** ./node_modules/eventemitter3/index.js ***!
    \*********************************************/
/*! no static exports found */function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,n,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,n||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function c(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),c.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,a=r.length,s=new Array(a);n<a;n++)s[n]=r[n].fn;return s},c.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},c.prototype.emit=function(e,t,r,n,a,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,a),!0;case 6:return u.fn.call(u.context,t,r,n,a,s),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},c.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,r,n){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,c=[],u=s.length;o<u;o++)(s[o].fn!==t||n&&!s[o].once||r&&s[o].context!==r)&&c.push(s[o]);c.length?this._events[a]=1===c.length?c[0]:c:l(this,a)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,e.exports=c},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
    !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
    \*****************************************************/
/*! no static exports found */function(e,t,r){var n,i,a,s,o;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=o.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var c={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var u=s.path,d=u.substring(0,u.lastIndexOf("/")+1)+a.path;c.path=o.normalizePath(d)}else c.path=s.path,a.params||(c.params=s.params,a.query||(c.query=s.query));return null===c.path&&(c.path=r.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(c)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
    !*** ./node_modules/webworkify-webpack/index.js ***!
    \**************************************************/
/*! no static exports found */function(e,t,r){function n(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,n){var o={};o[n]=[];var l=t.toString(),c=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return o;for(var u,d=c[1],h=new RegExp("(\\\\n|\\W)"+s(d)+a,"g");u=h.exec(l);)"dll-reference"!==u[3]&&o[n].push(u[3]);for(h=new RegExp("\\("+s(d)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");u=h.exec(l);)e[u[2]]||(o[n].push(u[1]),e[u[2]]=r(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var f,p=Object.keys(o),m=0;m<p.length;m++)for(var g=0;g<o[p[m]].length;g++)f=o[p[m]][g],isNaN(1*f)||(o[p[m]][g]=1*o[p[m]][g]);return o}function l(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var i={main:r.m},a=t.all?{main:Object.keys(i.main)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};l(r);)for(var a=Object.keys(r),s=0;s<a.length;s++){var c=a[s],u=r[c].pop();if(i[c]=i[c]||{},!i[c][u]&&e[c][u]){i[c][u]=!0,n[c]=n[c]||[],n[c].push(u);for(var d=o(e,e[c][u],c),h=Object.keys(d),f=0;f<h.length;f++)r[h[f]]=r[h[f]]||[],r[h[f]]=r[h[f]].concat(d[h[f]])}}return n}(i,e),s="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);";var c=new window.Blob([s],{type:"text/javascript"});if(t.bare)return c;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),d=new window.Worker(u);return d.objectURL=u,d}},"./src/config.ts":
/*!***********************!*\
    !*** ./src/config.ts ***!
    \***********************/
/*! exports provided: hlsDefaultConfig, mergeConfig, enableStreamingMode */function(e,t,r){r.r(t),r.d(t,"hlsDefaultConfig",(function(){return T})),r.d(t,"mergeConfig",(function(){return R})),r.d(t,"enableStreamingMode",(function(){return A}));var n=r(/*! ./controller/abr-controller */"./src/controller/abr-controller.ts"),i=r(/*! ./controller/audio-stream-controller */"./src/controller/audio-stream-controller.ts"),a=r(/*! ./controller/audio-track-controller */"./src/controller/audio-track-controller.ts"),s=r(/*! ./controller/subtitle-stream-controller */"./src/controller/subtitle-stream-controller.ts"),o=r(/*! ./controller/subtitle-track-controller */"./src/controller/subtitle-track-controller.ts"),l=r(/*! ./controller/buffer-controller */"./src/controller/buffer-controller.ts"),c=r(/*! ./controller/timeline-controller */"./src/controller/timeline-controller.ts"),u=r(/*! ./controller/cap-level-controller */"./src/controller/cap-level-controller.ts"),d=r(/*! ./controller/fps-controller */"./src/controller/fps-controller.ts"),h=r(/*! ./controller/eme-controller */"./src/controller/eme-controller.ts"),f=r(/*! ./controller/cmcd-controller */"./src/controller/cmcd-controller.ts"),p=r(/*! ./utils/xhr-loader */"./src/utils/xhr-loader.ts"),m=r(/*! ./utils/fetch-loader */"./src/utils/fetch-loader.ts"),g=r(/*! ./utils/cues */"./src/utils/cues.ts"),v=r(/*! ./utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts"),y=r(/*! ./utils/logger */"./src/utils/logger.ts");function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_.apply(this,arguments)}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T=S(S({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:n.default,bufferController:l.default,capLevelController:u.default,fpsController:d.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:v.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:g.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:s.SubtitleStreamController,subtitleTrackController:o.default,timelineController:c.TimelineController,audioStreamController:i.default,audioTrackController:a.default,emeController:h.default,cmcdController:f.default});function R(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return _({},e,t)}function A(e){var t=e.loader;t!==m.default&&t!==p.default?(y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):Object(m.fetchSupported)()&&(e.loader=m.default,e.progressive=!0,e.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":
/*!******************************************!*\
    !*** ./src/controller/abr-controller.ts ***!
    \******************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/ewma-bandwidth-estimator */"./src/utils/ewma-bandwidth-estimator.ts"),a=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../utils/logger */"./src/utils/logger.ts");function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new i.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(a.Events.FRAG_LOADING,this.onFragLoading,this),e.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e.off(a.Events.FRAG_LOADING,this.onFragLoading,this),e.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(e,t){var r,n=t.frag;n.type===l.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(e,t){var r=this.hls.config;t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,o=r.config,l=r.media;if(e&&l){var u=t?t.stats:e.stats,d=t?t.duration:e.duration;if(u.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!l.paused&&l.playbackRate&&l.readyState){var h=performance.now()-u.loading.start,f=Math.abs(l.playbackRate);if(!(h<=500*d/f)){var p=r.levels,m=r.minAutoLevel,g=p[e.level],v=u.total||Math.max(u.loaded,Math.round(d*g.maxBitrate/8)),y=Math.max(1,u.bwEstimate?u.bwEstimate/8:1e3*u.loaded/h),_=(v-u.loaded)/y,E=l.currentTime,S=(s.BufferHelper.bufferInfo(l,E,o.maxBufferHole).end-E)/f;if(!(S>=2*d/f||_<=S)){var b,T=Number.POSITIVE_INFINITY;for(b=e.level-1;b>m&&!((T=d*p[b].maxBitrate/(6.4*y))<S);b--);if(!(T>=_)){var R=this.bwEstimator.getEstimate();c.logger.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+b+"\n      Current BW estimate: "+(Object(n.isFiniteNumber)(R)?(R/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+_.toFixed(3)+" s\n      Estimated load time for the next fragment: "+T.toFixed(3)+" s\n      Time to underbuffer: "+S.toFixed(3)+" s"),r.nextLoadLevel=b,this.bwEstimator.sample(h,u.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),r.trigger(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:u})}}}}}},t.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if(r.type===l.PlaylistLevelType.MAIN&&Object(n.isFiniteNumber)(r.sn)){var s=i?i.stats:r.stats,o=i?i.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[r.level],u=(c.loaded?c.loaded.bytes:0)+s.loaded,d=(c.loaded?c.loaded.duration:0)+o;c.loaded={bytes:u,duration:d},c.realBitrate=Math.round(8*u/d)}if(r.bitrateTest){var h={stats:s,frag:r,part:i,id:r.type};this.onFragBuffered(a.Events.FRAG_BUFFERED,h),r.bitrateTest=!1}}},t.onFragBuffered=function(e,t){var r=t.frag,n=t.part,i=n?n.stats:r.stats;if(!i.aborted&&r.type===l.PlaylistLevelType.MAIN&&"initSegment"!==r.sn){var a=i.parsing.end-i.loading.start;this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},t.onError=function(e,t){switch(t.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,n=r.maxAutoLevel,i=r.config,a=r.minAutoLevel,o=r.media,l=t?t.duration:e?e.duration:0,u=o?o.currentTime:0,d=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=(s.BufferHelper.bufferInfo(o,u,i.maxBufferHole).end-u)/d,p=this.findBestLevel(h,a,n,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(p>=0)return p;c.logger.trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var m=l?Math.min(l,i.maxStarvationDelay):i.maxStarvationDelay,g=i.abrBandWidthFactor,v=i.abrBandWidthUpFactor;if(!f){var y=this.bitrateTestDelay;y&&(m=(l?Math.min(l,i.maxLoadingDelay):i.maxLoadingDelay)-y,c.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),g=v=1)}return p=this.findBestLevel(h,a,n,f+m,g,v),Math.max(p,0)},t.findBestLevel=function(e,t,r,n,i,a){for(var s,o=this.fragCurrent,l=this.partCurrent,u=this.lastLoadedFragLevel,d=this.hls.levels,h=d[u],f=!(null==h||null===(s=h.details)||void 0===s||!s.live),p=null==h?void 0:h.codecSet,m=l?l.duration:o?o.duration:0,g=r;g>=t;g--){var v=d[g];if(v&&(!p||v.codecSet===p)){var y=v.details,_=(l?null==y?void 0:y.partTarget:null==y?void 0:y.averagetargetduration)||m,E=void 0;E=g<=u?i*e:a*e;var S=d[g].maxBitrate,b=S*_/E;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+g+"/"+Math.round(E)+"/"+S+"/"+_+"/"+n+"/"+b),E>S&&(!b||f&&!this.bitrateTestDelay||b<n))return g}}return-1},function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(e,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var r=this.getNextABRAutoLevel();return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}]),e}();t.default=d},"./src/controller/audio-stream-controller.ts":
/*!***************************************************!*\
    !*** ./src/controller/audio-stream-controller.ts ***!
    \***************************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),a=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),l=r(/*! ../types/level */"./src/types/level.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),u=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),d=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts"),h=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),f=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),p=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),m=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),g=r(/*! ../errors */"./src/errors.ts"),v=r(/*! ../utils/logger */"./src/utils/logger.ts");function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y.apply(this,arguments)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}var E=function(e){var t,r;function E(t,r){var n;return(n=e.call(this,t,r,"[audio-stream-controller]")||this).videoBuffer=null,n.videoTrackCC=-1,n.waitingVideoCC=-1,n.audioSwitch=!1,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.bufferFlushed=!1,n._registerListeners(),n}r=e,(t=E).prototype=Object.create(r.prototype),t.prototype.constructor=t,_(t,r);var S=E.prototype;return S.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},S._registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(a.Events.ERROR,this.onError,this),e.on(a.Events.BUFFER_RESET,this.onBufferReset,this),e.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S._unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(a.Events.ERROR,this.onError,this),e.off(a.Events.BUFFER_RESET,this.onBufferReset,this),e.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S.onInitPtsFound=function(e,t){var r=t.frag,n=t.id,a=t.initPTS;if("main"===n){var s=r.cc;this.initPTS[r.cc]=a,this.log("InitPTS for cc: "+s+" found from main: "+a),this.videoTrackCC=s,this.state===i.State.WAITING_INIT_PTS&&this.tick()}},S.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=i.State.STOPPED);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=i.State.IDLE):(this.loadedmetadata=!1,this.state=i.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},S.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_TRACK:var t,r=this.levels,n=this.trackId,a=null==r||null===(t=r[n])||void 0===t?void 0:t.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=i.State.WAITING_INIT_PTS}break;case i.State.FRAG_LOADING_WAITING_RETRY:var o,l=performance.now(),c=this.retryDate;(!c||l>=c||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=i.State.IDLE);break;case i.State.WAITING_INIT_PTS:var u=this.waitingData;if(u){var d=u.frag,h=u.part,f=u.cache,m=u.complete;if(void 0!==this.initPTS[d.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.FRAG_LOADING;var g={frag:d,part:h,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),m&&e.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)v.logger.log("Waiting fragment cc ("+d.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var y=this.getLoadPosition(),_=s.BufferHelper.bufferInfo(this.mediaBuffer,y,this.config.maxBufferHole);Object(p.fragmentWithinToleranceTest)(_.end,this.config.maxFragLookUpTolerance,d)<0&&(v.logger.log("Waiting fragment cc ("+d.cc+") @ "+d.start+" cancelled because another fragment at "+_.end+" is needed"),this.clearWaitingFragment())}}else this.state=i.State.IDLE}this.onTickEnd()},S.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.IDLE)},S.onTickEnd=function(){var e=this.media;if(e&&e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length&&(this.loadedmetadata=!0),this.lastCurrentTime=e.currentTime}},S.doTickIdle=function(){var e,t,r=this.hls,n=this.levels,s=this.media,o=this.trackId,l=r.config;if(n&&n[o]&&(s||!this.startFragRequested&&l.startFragPrefetch)){var d=n[o].details;if(!d||d.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(d))this.state=i.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,u.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO));var h=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.AUDIO);if(null!==h){var f=h.len,p=this.getMaxBufferLength(),m=this.audioSwitch;if(!(f>=p)||m){if(!m&&this._streamEnded(h,d))return r.trigger(a.Events.BUFFER_EOS,{type:"audio"}),void(this.state=i.State.ENDED);var g=d.fragments[0].start,v=h.end;if(m){var y=this.getLoadPosition();v=y,d.PTSKnown&&y<g&&(h.end>g||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}var _=this.getNextFragment(v,d);_?"identity"!==(null===(e=_.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=_.decryptdata)&&void 0!==t&&t.key?this.loadFragment(_,d,v):this.loadKey(_,d):this.bufferFlushed=!0}}}}},S.getMaxBufferLength=function(){var t=e.prototype.getMaxBufferLength.call(this),r=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,c.PlaylistLevelType.MAIN);return null===r?t:Math.max(t,r.len)},S.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},S.onAudioTracksUpdated=function(e,t){var r=t.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(e){return new l.Level(e)}))},S.onAudioTrackSwitching=function(e,t){var r=!!t.url;this.trackId=t.id;var n=this.fragCurrent;null!=n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=i.State.IDLE):this.state=i.State.STOPPED,this.tick()},S.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},S.onLevelLoaded=function(e,t){this.mainDetails=t.details},S.onAudioTrackLoaded=function(e,t){var r,n=this.levels,a=t.details,s=t.id;if(n){this.log("Track "+s+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var o=n[s],l=0;if(a.live||null!==(r=o.details)&&void 0!==r&&r.live){var c=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!c)return;!o.details&&a.hasProgramDateTime&&c.hasProgramDateTime?(Object(m.alignMediaPlaylistByPDT)(a,c),l=a.fragments[0].start):l=this.alignPlaylists(a,o.details)}o.details=a,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(o.details,l),this.state!==i.State.WAITING_TRACK||this.waitForCdnTuneIn(a)||(this.state=i.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+s)},S._handleFragmentLoadProgress=function(e){var t,r=e.frag,n=e.part,a=e.payload,s=this.config,o=this.trackId,l=this.levels;if(l){var u=l[o];console.assert(u,"Audio track is defined on fragment load progress");var p=u.details;console.assert(p,"Audio track details are defined on fragment load progress");var m=s.defaultAudioCodec||u.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new h.default(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var y=this.initPTS[r.cc],_=null===(t=r.initSegment)||void 0===t?void 0:t.data;if(void 0!==y){var E=n?n.index:-1,S=-1!==E,b=new f.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,a.byteLength,E,S);g.push(a,_,m,"",r,n,p.totalduration,!1,b,y)}else v.logger.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+o),(this.waitingData=this.waitingData||{frag:r,part:n,cache:new d.default,complete:!1}).cache.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=i.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},S._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:e.prototype._handleFragmentLoadComplete.call(this,t)},S.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},S.onBufferCreated=function(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},S.onFragBuffered=function(e,t){var r=t.frag,n=t.part;r.type===c.PlaylistLevelType.AUDIO&&(this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(n?" p: "+n.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,n)))},S.onError=function(t,r){switch(r.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,r);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==i.State.ERROR&&this.state!==i.State.STOPPED&&(this.state=r.fatal?i.State.ERROR:i.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===r.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var n=!0,a=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO);a&&a.len>.5&&(n=!this.reduceMaxBufferLength(a.len)),n&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},S.onBufferFlushed=function(e,t){t.type===u.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},S._handleTransmuxComplete=function(e){var t,r="audio",n=this.hls,s=e.remuxResult,o=e.chunkMeta,l=this.getCurrentContext(o);if(!l)return this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(o.level);var c=l.frag,d=l.part,h=s.audio,f=s.text,p=s.id3,m=s.initSegment;if(!this.fragContextChanged(c)){if(this.state=i.State.PARSING,this.audioSwitch&&h&&this.completeAudioSwitch(),null!=m&&m.tracks&&(this._bufferInitSegment(m.tracks,c,o),n.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:r,tracks:m.tracks})),h){var g=h.startPTS,v=h.endPTS,_=h.startDTS,E=h.endDTS;d&&(d.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:g,endPTS:v,startDTS:_,endDTS:E}),c.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,g,v,_,E),this.bufferFragmentData(h,c,d,o)}if(null!=p&&null!==(t=p.samples)&&void 0!==t&&t.length){var S=y({frag:c,id:r},p);n.trigger(a.Events.FRAG_PARSING_METADATA,S)}if(f){var b=y({frag:c,id:r},f);n.trigger(a.Events.FRAG_PARSING_USERDATA,b)}}},S._bufferInitSegment=function(e,t,r){if(this.state===i.State.PARSING){e.video&&delete e.video;var n=e.audio;if(n){n.levelCodec=n.codec,n.id="audio",this.log("Init audio buffer, container:"+n.container+", codecs[parsed]=["+n.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,e);var s=n.initSegment;if(null!=s&&s.byteLength){var o={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:s};this.hls.trigger(a.Events.BUFFER_APPENDING,o)}this.tick()}}},S.loadFragment=function(t,r,a){var s=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||s===o.FragmentState.NOT_LOADED||s===o.FragmentState.PARTIAL)&&("initSegment"===t.sn?this._loadInitSegment(t):r.live&&!Object(n.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=i.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,a)))},S.completeAudioSwitch=function(){var t=this.hls,r=this.media,n=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:n})},E}(i.default);t.default=E},"./src/controller/audio-track-controller.ts":
/*!**************************************************!*\
    !*** ./src/controller/audio-track-controller.ts ***!
    \**************************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),s=r(/*! ../types/loader */"./src/types/loader.ts");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}var c=function(e){var t,r;function a(t){var r;return(r=e.call(this,t,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}r=e,(t=a).prototype=Object.create(r.prototype),t.prototype.constructor=t,l(t,r);var c=a.prototype;return c.registerListeners=function(){var e=this.hls;e.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(n.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(n.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,e.prototype.destroy.call(this)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},c.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},c.onAudioTrackLoaded=function(e,t){var r=t.id,n=t.details,i=this.tracksInGroup[r];if(i){var a=i.details;i.details=t.details,this.log("audioTrack "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,t,a))}else this.warn("Invalid audio track id "+r)},c.onLevelLoading=function(e,t){this.switchLevel(t.level)},c.onLevelSwitching=function(e,t){this.switchLevel(t.level)},c.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r;var i=this.tracks.filter((function(e){return!r||e.groupId===r}));this.selectDefaultTrack&&!i.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var a={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(n.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},c.onError=function(t,r){e.prototype.onError.call(this,t,r),!r.fatal&&r.context&&r.context.type===s.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},c.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=t[this.trackId];this.log("Now switching to audio-track index "+e);var i=t[e],a=i.id,s=i.groupId,o=void 0===s?"":s,l=i.name,c=i.type,u=i.url;if(this.trackId=e,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(n.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:o,name:l,type:c,url:u}),!i.details||i.details.live){var d=this.switchParams(i.url,null==r?void 0:r.details);this.loadPlaylist(d)}}},c.selectInitialTrack=function(){var e=this.tracksInGroup;console.assert(e.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,r=this.findTrackId(t)||this.findTrackId();-1!==r?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},c.findTrackId=function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1},c.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var r=t.id,i=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(Wk){this.warn("Could not construct new URL with HLS Delivery Directives: "+Wk)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(n.Events.AUDIO_TRACK_LOADING,{url:a,id:r,groupId:i,deliveryDirectives:e||null})}},function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(a,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}]),a}(a.default);t.default=c},"./src/controller/base-playlist-controller.ts":
/*!****************************************************!*\
    !*** ./src/controller/base-playlist-controller.ts ***!
    \****************************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return l}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../types/level */"./src/types/level.ts"),a=r(/*! ./level-helper */"./src/controller/level-helper.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=s.logger.log.bind(s.logger,t+":"),this.warn=s.logger.warn.bind(s.logger,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(e,t){t.fatal&&t.type===o.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var r=null==t?void 0:t.renditionReports;if(r)for(var a=0;a<r.length;a++){var s=r[a],o=""+s.URI;if(o===e.substr(-o.length)){var l=parseInt(s["LAST-MSN"]),c=parseInt(s["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var u=Math.min(t.age-t.partTarget,t.targetduration);void 0!==c&&u>t.partTarget&&(c+=1)}if(Object(n.isFiniteNumber)(l))return new i.HlsUrlParameters(l,Object(n.isFiniteNumber)(c)?c:void 0,i.HlsSkip.No)}}},t.loadPlaylist=function(e){},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,r){var n=this,i=t.details,s=t.stats,o=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(i.advancedDateTime=Date.now()-o,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log("live playlist "+e+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),r&&i.fragments.length>0&&Object(a.mergeDetails)(r,i),!this.canLoad||!i.live)return;var l,c=void 0,u=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var d=this.hls.config.lowLatencyMode,h=i.lastPartSn,f=i.endSN,p=i.lastPartIndex,m=h===f;-1!==p?(c=m?f+1:h,u=m?d?0:p:p+1):c=f+1;var g=i.age,v=g+i.ageHeader,y=Math.min(v-i.partTarget,1.5*i.targetduration);if(y>0){if(r&&y>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+y+" with playlist age: "+i.age),y=0;else{var _=Math.floor(y/i.targetduration);c+=_,void 0!==u&&(u+=Math.round(y%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+y+" skip sn "+_+" to part "+u)}i.tuneInGoal=y}if(l=this.getDeliveryDirectives(i,t.deliveryDirectives,c,u),d||!m)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(i,t.deliveryDirectives,c,u);var E=Object(a.computeReloadInterval)(i,s);void 0!==c&&i.canBlockReload&&(E-=i.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(E)+" ms"),this.timer=self.setTimeout((function(){return n.loadPlaylist(l)}),E)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,r,n){var a=Object(i.getSkipValue)(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,a=i.HlsSkip.No),new i.HlsUrlParameters(r,n,a)},t.retryLoadingOrFail=function(e){var t,r=this,n=this.hls.config,i=this.retryCount<n.levelLoadingMaxRetry;if(i)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var a=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return r.loadPlaylist()}),a),this.warn("retry playlist loading #"+this.retryCount+" in "+a+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return i},e}()},"./src/controller/base-stream-controller.ts":
/*!**************************************************!*\
    !*** ./src/controller/base-stream-controller.ts ***!
    \**************************************************/
/*! exports provided: State, default */function(e,t,r){r.r(t),r.d(t,"State",(function(){return S})),r.d(t,"default",(function(){return b}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../task-loop */"./src/task-loop.ts"),a=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),l=r(/*! ../events */"./src/events.ts"),c=r(/*! ../errors */"./src/errors.ts"),u=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),d=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),h=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),f=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),p=r(/*! ./level-helper */"./src/controller/level-helper.ts"),m=r(/*! ../loader/fragment-loader */"./src/loader/fragment-loader.ts"),g=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),v=r(/*! ../utils/time-ranges */"./src/utils/time-ranges.ts"),y=r(/*! ../types/loader */"./src/types/loader.ts");function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},E(e,t)}var S={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},b=function(e){var t,r;function i(t,r,n){var i;return(i=e.call(this)||this).hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=S.STOPPED,i.media=void 0,i.mediaBuffer=void 0,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.loadedmetadata=!1,i.fragLoadError=0,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.logPrefix=n,i.log=o.logger.log.bind(o.logger,n+":"),i.warn=o.logger.warn.bind(o.logger,n+":"),i.hls=t,i.fragmentLoader=new m.default(t.config),i.fragmentTracker=r,i.config=t.config,i.decrypter=new g.default(t,t.config),t.on(l.Events.KEY_LOADED,i.onKeyLoaded,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,E(t,r);var b=i.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(e){},b.stopLoad=function(){this.fragmentLoader.abort();var e=this.fragCurrent;e&&this.fragmentTracker.removeFragment(e),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=S.STOPPED},b._streamEnded=function(e,t){var r=this.fragCurrent,n=this.fragmentTracker;if(!t.live&&r&&r.sn>=t.endSN&&!e.nextStart){var i=t.partList;if(null!=i&&i.length){var o=i[i.length-1];return s.BufferHelper.isBuffered(this.media,o.start+o.duration/2)}var l=n.getState(r);return l===a.FragmentState.PARTIAL||l===a.FragmentState.OK}return!1},b.onMediaAttached=function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===S.STOPPED&&this.startLoad(n.startPosition)},b.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,r=this.media,i=this.mediaBuffer,a=this.state,o=r?r.currentTime:0,l=s.BufferHelper.bufferInfo(i||r,o,e.maxBufferHole);if(this.log("media seeking to "+(Object(n.isFiniteNumber)(o)?o.toFixed(3):o)+", state: "+a),a===S.ENDED)this.resetLoadingState();else if(t&&!l.len){var c=e.maxFragLookUpTolerance,u=t.start-c,d=o>t.start+t.duration+c;(o<u||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.resetLoadingState())}r&&(this.lastCurrentTime=o),this.loadedmetadata||l.len||(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(e,t){if(this.state===S.KEY_LOADING&&t.frag===this.fragCurrent&&this.levels){this.state=S.IDLE;var r=this.levels[t.frag.level].details;r&&this.loadFragment(t.frag,r,t.frag.start)}},b.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=S.STOPPED,this.hls.off(l.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(e,t){this.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=S.KEY_LOADING,this.fragCurrent=e,this.hls.trigger(l.Events.KEY_LOADING,{frag:e})},b.loadFragment=function(e,t,r){this._loadFragForPlayback(e,t,r)},b._loadFragForPlayback=function(e,t,r){var n=this;this._doFragLoad(e,t,r,(function(t){if(n.fragContextChanged(e))return n.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void n.fragmentTracker.removeFragment(e);e.stats.chunkCount++,n._handleFragmentLoadProgress(t)})).then((function(t){if(t){n.fragLoadError=0;var r=n.state;if(!n.fragContextChanged(e))return"payload"in t&&(n.log("Loaded fragment "+e.sn+" of level "+e.level),n.hls.trigger(l.Events.FRAG_LOADED,t),n.state===S.BACKTRACKING)?(n.fragmentTracker.backtrack(e,t),void n.resetFragmentLoading(e)):void n._handleFragmentLoadComplete(t);(r===S.FRAG_LOADING||r===S.BACKTRACKING||!n.fragCurrent&&r===S.PARSING)&&(n.fragmentTracker.removeFragment(e),n.state=S.IDLE)}})).catch((function(t){n.warn(t),n.resetFragmentLoading(e)}))},b.flushMainBuffer=function(e,t,r){if(void 0===r&&(r=null),e-t){var n={startOffset:e,endOffset:t,type:r};this.fragLoadError=0,this.hls.trigger(l.Events.BUFFER_FLUSHING,n)}},b._loadInitSegment=function(e){var t=this;this._doFragLoad(e).then((function(r){if(!r||t.fragContextChanged(e)||!t.levels)throw new Error("init load aborted");return r})).then((function(r){var n=t.hls,i=r.payload,a=e.decryptdata;if(i&&i.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return t.decrypter.webCryptoDecrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer).then((function(t){var i=self.performance.now();return n.trigger(l.Events.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:s,tdecrypt:i}}),r.payload=t,r}))}return r})).then((function(r){var n=t.fragCurrent,i=t.hls,a=t.levels;if(!a)throw new Error("init load aborted, missing levels");var s=a[e.level].details;console.assert(s,"Level details are defined when init segment is loaded");var o=e.stats;t.state=S.IDLE,t.fragLoadError=0,e.data=new Uint8Array(r.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),r.frag===n&&i.trigger(l.Events.FRAG_BUFFERED,{stats:o,frag:n,part:null,id:e.type}),t.tick()})).catch((function(r){t.warn(r),t.resetFragmentLoading(e)}))},b.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},b.fragBufferedComplete=function(e,t){var r=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level+" "+v.default.toString(s.BufferHelper.getBuffered(r))),this.state=S.IDLE,this.tick()},b._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var r=e.frag,n=e.part,i=e.partsLoaded,a=!i||0===i.length||i.some((function(e){return!e})),s=new u.ChunkMetadata(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(s)}},b._handleFragmentLoadProgress=function(e){},b._doFragLoad=function(e,t,r,i){var a=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(e.start,r||0),this.config.lowLatencyMode&&t){var s=t.partList;if(s&&i){r>e.end&&t.fragmentHint&&(e=t.fragmentHint);var o=this.getNextPart(s,e,r);if(o>-1){var c=s[o];return this.log("Loading part sn: "+e.sn+" p: "+c.index+" cc: "+e.cc+" of playlist ["+t.startSN+"-"+t.endSN+"] parts [0-"+o+"-"+(s.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=c.start+c.duration,this.state=S.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:e,part:s[o],targetBufferTime:r}),this.doFragPartsLoad(e,s,o,i).catch((function(e){return a.handleFragLoadError(e)}))}if(!e.url||this.loadedEndOfParts(s,r))return Promise.resolve(null)}}return this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(t?"of ["+t.startSN+"-"+t.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),Object(n.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=S.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragmentLoader.load(e,i).catch((function(e){return a.handleFragLoadError(e)}))},b.doFragPartsLoad=function(e,t,r,n){var i=this;return new Promise((function(a,s){var o=[];!function r(c){var u=t[c];i.fragmentLoader.loadPart(e,u,n).then((function(n){o[u.index]=n;var s=n.part;i.hls.trigger(l.Events.FRAG_LOADED,n);var d=t[c+1];if(!d||d.fragment!==e)return a({frag:e,part:s,partsLoaded:o});r(c+1)})).catch(s)}(r)}))},b.handleFragLoadError=function(e){var t=e.data;return t&&t.details===c.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(l.Events.ERROR,t),null},b._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===S.PARSING){var r=t.frag,n=t.part,i=t.level,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(r,n,i,e.partial)}else this.fragCurrent||(this.state=S.IDLE)},b.getCurrentContext=function(e){var t=this.levels,r=e.level,n=e.sn,i=e.part;if(!t||!t[r])return this.warn("Levels object was unset while buffering fragment "+n+" of level "+r+". The current chunk will not be buffered."),null;var a=t[r],s=i>-1?Object(p.getPartWith)(a,n,i):null,o=s?s.fragment:Object(p.getFragmentWithSN)(a,n,this.fragCurrent);return o?{frag:o,part:s,level:a}:null},b.bufferFragmentData=function(e,t,r,n){if(e&&this.state===S.PARSING){var i=e.data1,a=e.data2,s=i;if(i&&a&&(s=Object(d.appendUint8Array)(i,a)),s&&s.length){var o={type:e.type,frag:t,part:r,chunkMeta:n,parent:t.type,data:s};this.hls.trigger(l.Events.BUFFER_APPENDING,o),e.dropped&&e.independent&&!r&&this.flushBufferGap(t)}}},b.flushBufferGap=function(e){var t=this.media;if(t)if(s.BufferHelper.isBuffered(t,t.currentTime)){var r=t.currentTime,n=s.BufferHelper.bufferInfo(t,r,0),i=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),o=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}else this.flushMainBuffer(0,e.start)},b.getFwdBufferInfo=function(e,t){var r=this.config,i=this.getLoadPosition();if(!Object(n.isFiniteNumber)(i))return null;var a=s.BufferHelper.bufferInfo(e,i,r.maxBufferHole);if(0===a.len&&void 0!==a.nextStart){var o=this.fragmentTracker.getBufferedFrag(i,t);if(o&&a.nextStart<o.end)return s.BufferHelper.bufferInfo(e,i,Math.max(a.nextStart,r.maxBufferHole))}return a},b.getMaxBufferLength=function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)},b.reduceMaxBufferLength=function(e){var t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},b.getNextFragment=function(e,t){var r,n,i=t.fragments,a=i.length;if(!a)return null;var s,o=this.config,l=i[0].start;if(t.live){var c=o.initialLiveManifestSize;if(a<c)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+c+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(s=this.getInitialLiveFragment(t,i),this.startPosition=s?this.hls.liveSyncPosition||s.start:e)}else e<=l&&(s=i[0]);if(!s){var u=o.lowLatencyMode?t.partEnd:t.fragmentEnd;s=this.getFragmentAtPosition(e,u,t)}return null===(r=s)||void 0===r||!r.initSegment||null!==(n=s)&&void 0!==n&&n.initSegment.data||this.bitrateTest||(s=s.initSegment),s},b.getNextPart=function(e,t,r){for(var n=-1,i=!1,a=!0,s=0,o=e.length;s<o;s++){var l=e[s];if(a=a&&!l.independent,n>-1&&r<l.start)break;var c=l.loaded;!c&&(i||l.independent||a)&&l.fragment===t&&(n=s),i=c}return n},b.loadedEndOfParts=function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded},b.getInitialLiveFragment=function(e,t){var r=this.fragPrevious,n=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),n=Object(f.findFragmentByPDT)(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){var a=t[i-e.startSN];r.cc===a.cc&&(n=a,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=Object(f.findFragWithCC)(t,r.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)}}else{var s=this.hls.liveSyncPosition;null!==s&&(n=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n},b.getFragmentAtPosition=function(e,t,r){var n,i=this.config,s=this.fragPrevious,o=r.fragments,l=r.endSN,c=r.fragmentHint,u=i.maxFragLookUpTolerance,d=!!(i.lowLatencyMode&&r.partList&&c);if(d&&c&&!this.bitrateTest&&(o=o.concat(c),l=c.sn),e<t){var h=e>t-u?0:u;n=Object(f.findFragmentByPTS)(s,o,e,h)}else n=o[o.length-1];if(n){var p=n.sn-r.startSN,m=s&&n.level===s.level,g=o[p+1];if(this.fragmentTracker.getState(n)===a.FragmentState.BACKTRACKED){n=null;for(var v=p;o[v]&&this.fragmentTracker.getState(o[v])===a.FragmentState.BACKTRACKED;)n=s?o[v--]:o[--v];n||(n=g)}else s&&n.sn===s.sn&&!d&&m&&(n.sn<l&&this.fragmentTracker.getState(g)!==a.FragmentState.OK?(this.log("SN "+n.sn+" just loaded, load next one: "+g.sn),n=g):n=null)}return n},b.synchronizeToLiveEdge=function(e){var t=this.config,r=this.media;if(r){var n=this.hls.liveSyncPosition,i=r.currentTime,a=e.fragments[0].start,s=e.edge,o=i>=a-t.maxFragLookUpTolerance&&i<=s;if(null!==n&&r.duration>n&&(i<n||!o)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||i<s-l)&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+n.toFixed(3)),r.currentTime=n))}}},b.alignPlaylists=function(e,t){var r=this.levels,i=this.levelLastLoaded,a=this.fragPrevious,s=null!==i?r[i]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var l=e.fragments[0].start,c=!t,u=e.alignedSliding&&Object(n.isFiniteNumber)(l);if(c||!u&&!l){Object(h.alignStream)(a,s,e);var d=e.fragments[0].start;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(a?a.sn:"na")+" fragments: "+o),d}return l},b.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},b.setStartPosition=function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var i=e.startTimeOffset;Object(n.isFiniteNumber)(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset "+i+" found in playlist, adjust startPosition to "+r),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},b.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},b.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part"+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},b.resetFragmentLoading=function(e){this.fragCurrent&&this.fragContextChanged(e)||(this.state=S.IDLE)},b.onFragmentOrKeyLoadError=function(e,t){if(!t.fatal){var r=t.frag;if(r&&r.type===e){var n=this.fragCurrent;console.assert(n&&r.sn===n.sn&&r.level===n.level&&r.urlId===n.urlId,"Frag load error must match current frag to retry");var i=this.config;if(this.fragLoadError+1<=i.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(r.level))return;var a=Math.min(Math.pow(2,this.fragLoadError)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);this.warn("Fragment "+r.sn+" of "+e+" "+r.level+" failed to load, retrying in "+a+"ms"),this.retryDate=self.performance.now()+a,this.fragLoadError++,this.state=S.FRAG_LOADING_WAITING_RETRY}else t.levelRetry?(e===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=S.IDLE):(o.logger.error(t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.hls.stopLoad(),this.state=S.ERROR)}}},b.afterBufferFlushed=function(e,t,r){if(e){var n=s.BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===S.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=S.IDLE},b.resetLiveStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;if(null!=t&&t.live)return this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},b.updateLevelTiming=function(e,t,r,n){var i=this,a=r.details;console.assert(!!a,"level.details must be defined"),Object.keys(e.elementaryStreams).reduce((function(t,s){var o=e.elementaryStreams[s];if(o){var c=o.endPTS-o.startPTS;if(c<=0)return i.warn("Could not parse fragment "+e.sn+" "+s+" duration reliably ("+c+") resetting transmuxer to fallback to playlist timing"),i.resetTransmuxer(),t||!1;var u=n?0:Object(p.updateFragPTSDTS)(a,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return i.hls.trigger(l.Events.LEVEL_PTS_UPDATED,{details:a,level:r,drift:u,type:s,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1)?(this.state=S.PARSED,this.hls.trigger(l.Events.FRAG_PARSED,{frag:e,part:t})):this.resetLoadingState()},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function(e,t,r){t&&_(e.prototype,t),r&&_(e,r)}(i,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}]),i}(i.default)},"./src/controller/buffer-controller.ts":
/*!*********************************************!*\
    !*** ./src/controller/buffer-controller.ts ***!
    \*********************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return f}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../errors */"./src/errors.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),l=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),c=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),u=r(/*! ./buffer-operation-queue */"./src/controller/buffer-operation-queue.ts"),d=Object(l.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,f=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.hls,r=t.media,n=t.mediaSource;a.logger.log("[buffer-controller]: Media source opened"),r&&(t.updateMediaElementDuration(),e.trigger(i.Events.MEDIA_ATTACHED,{media:r})),n&&n.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){a.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){a.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null},t.registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.BUFFER_RESET,this.onBufferReset,this),e.on(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(i.Events.BUFFER_EOS,this.onBufferEos,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(i.Events.FRAG_PARSED,this.onFragParsed,this),e.on(i.Events.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.BUFFER_RESET,this.onBufferReset,this),e.off(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(i.Events.BUFFER_EOS,this.onBufferEos,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(i.Events.FRAG_PARSED,this.onFragParsed,this),e.off(i.Events.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new u.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},t.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&d){var n=this.mediaSource=new d;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(n),this._objectUrl=r.src}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(a.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(pL){a.logger.warn("[buffer-controller]: onMediaDetaching: "+pL.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):a.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(i.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(pL){a.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",pL)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var r=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(n){var i=r.tracks[e];if(i&&"function"==typeof i.buffer.changeType){var a=t[e],s=a.codec,o=a.levelCodec,l=a.container;if((i.levelCodec||i.codec).replace(h,"$1")!==(o||s).replace(h,"$1")){var c=l+";codecs="+(o||s);r.appendChangeType(e,c)}}}else r.pendingTracks[e]=t[e]})),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var r=this,n=this.operationQueue,i={execute:function(){var i=r.sourceBuffer[e];i&&(a.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),i.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){a.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};n.append(i,e)},t.onBufferAppending=function(e,t){var r=this,n=this.hls,l=this.operationQueue,c=this.tracks,u=t.data,d=t.type,h=t.frag,f=t.part,p=t.chunkMeta,m=p.buffering[d],g=self.performance.now();m.start=g;var v=h.stats.buffering,y=f?f.stats.buffering:null;0===v.start&&(v.start=g),y&&0===y.start&&(y.start=g);var _=c.audio,E="audio"===d&&1===p.id&&"audio/mpeg"===(null==_?void 0:_.container),S={execute:function(){if(m.executeStart=self.performance.now(),E){var e=r.sourceBuffer[d];if(e){var t=h.start-e.timestampOffset;Math.abs(t)>=.1&&(a.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+t+") sn: "+h.sn+")"),e.timestampOffset=h.start)}}r.appendExecutor(u,d)},onStart:function(){},onComplete:function(){var e=self.performance.now();m.executeEnd=m.end=e,0===v.first&&(v.first=e),y&&0===y.first&&(y.first=e);var t=r.sourceBuffer,n={};for(var a in t)n[a]=o.BufferHelper.getBuffered(t[a]);r.appendError=0,r.hls.trigger(i.Events.BUFFER_APPENDED,{type:d,frag:h,part:f,chunkMeta:p,parent:h.type,timeRanges:n})},onError:function(e){a.logger.error("[buffer-controller]: Error encountered while trying to append to the "+d+" SourceBuffer",e);var t={type:s.ErrorTypes.MEDIA_ERROR,parent:h.type,details:s.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=s.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,t.details=s.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>n.config.appendErrorMaxRetry&&(a.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),n.trigger(i.Events.ERROR,t)}};l.append(S,d)},t.onBufferFlushing=function(e,t){var r=this,n=this.operationQueue,s=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(i.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){a.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?n.append(s(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){n.append(s(e),e)}))},t.onFragParsed=function(e,t){var r=this,n=t.frag,s=t.part,o=[],l=s?s.elementaryStreams:n.elementaryStreams;l[c.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(l[c.ElementaryStreamTypes.AUDIO]&&o.push("audio"),l[c.ElementaryStreamTypes.VIDEO]&&o.push("video")),0===o.length&&a.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers((function(){var e=self.performance.now();n.stats.buffering.end=e,s&&(s.stats.buffering.end=e);var t=s?s.stats:n.stats;r.hls.trigger(i.Events.FRAG_BUFFERED,{frag:n,part:s,stats:t,id:n.type})}),o)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce((function(e,n){var i=r.sourceBuffer[n];return t.type&&t.type!==n||i&&!i.ended&&(i.ended=!0,a.logger.log("[buffer-controller]: "+n+" sourceBuffer now EOS")),e&&!(i&&!i.ended)}),!0)&&this.blockBuffers((function(){var e=r.mediaSource;e&&"open"===e.readyState&&e.endOfStream()}))},t.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,a=this.sourceBuffer;if(r&&null!==t){var s=this.getSourceBufferTypes();if(s.length){var l=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(n.isFiniteNumber)(l)&&!(l<0)){var c=r.currentTime,u=t.levelTargetDuration,d=Math.max(l,u),h=Math.floor(c/u)*u-d;s.forEach((function(r){var n=a[r];if(n){var s=o.BufferHelper.getBuffered(n);s.length>0&&h>s.start(0)&&(e.trigger(i.Events.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live&&e.trigger(i.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),e.trigger(i.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:r}))}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,s=e.fragments[0].start+e.totalduration,o=r.duration,l=Object(n.isFiniteNumber)(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(a.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(s>l&&s>o||!Object(n.isFiniteNumber)(o))&&(a.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),i.duration=s)}},t.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){var n=Math.max(0,r[0].start),i=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,i)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;if(n&&!e||2===n){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(0===a.length)return void this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach((function(e){t.executeNext(e)}))}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var o in e)if(!t[o]){var l=e[o];if(!l)throw Error("source buffer exists for track "+o+", however track does not");var c=l.levelCodec||l.codec,u=l.container+";codecs="+c;a.logger.log("[buffer-controller]: creating sourceBuffer("+u+")");try{var d=t[o]=r.addSourceBuffer(u),h=o;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[o]={buffer:d,codec:c,container:l.container,levelCodec:l.levelCodec,id:l.id},n++}catch(pL){a.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+pL.message),this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:pL,mimeType:u})}}n&&this.hls.trigger(i.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){a.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(t)},t.removeExecutor=function(e,t,r){var i=this.media,s=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[e];if(!i||!s||!l)return a.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var c=Object(n.isFiniteNumber)(i.duration)?i.duration:1/0,u=Object(n.isFiniteNumber)(s.duration)?s.duration:1/0,d=Math.max(0,t),h=Math.min(r,c,u);h>d?(a.logger.log("[buffer-controller]: Removing ["+d+","+h+"] from the "+e+" SourceBuffer"),console.assert(!l.updating,e+" sourceBuffer must not be updating"),l.remove(d,h)):o.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var r=this.operationQueue,n=this.sourceBuffer[t];if(!n)return a.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);n.ended=!1,console.assert(!n.updating,t+" sourceBuffer must not be updating"),n.appendBuffer(e)},t.blockBuffers=function(e,t){var r=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return a.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var n=this.operationQueue,i=t.map((function(e){return n.appendBlocker(e)}));Promise.all(i).then((function(){e(),t.forEach((function(e){var t=r.sourceBuffer[e];t&&t.updating||n.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,r){var n=this.sourceBuffer[e];if(n){var i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),n.addEventListener(t,i)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":
/*!**************************************************!*\
    !*** ./src/controller/buffer-operation-queue.ts ***!
    \**************************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return i}));var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,r=new Promise((function(e){t=e})),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),r},t.executeNext=function(e){var t=this.buffers,r=this.queues,i=t[e],a=r[e];if(a.length){var s=a[0];try{s.execute()}catch(o){n.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(o),i&&i.updating||(a.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./src/controller/cap-level-controller.ts":
/*!************************************************!*\
    !*** ./src/controller/cap-level-controller.ts ***!
    \************************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../events */"./src/events.ts");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var e=this.hls;e.on(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var e=this.hls;e.off(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(t,r){e.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},t.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null},t.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.getMaxLevel=function(t){var r=this,n=this.hls.levels;if(!n.length)return-1;var i=n.filter((function(n,i){return e.isLevelAllowed(i,r.restrictedLevels)&&i<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},e.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},e.getMaxLevelByMediaSize=function(e,t,r){if(!e||!e.length)return-1;for(var n,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=r)&&(n=o,!(i=e[s+1])||n.width!==i.width||n.height!==i.height)){a=s;break}}return a},function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"mediaWidth",get:function(){return this.getDimensions().width*e.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*e.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=self.devicePixelRatio}catch(t){}return e}}]),e}();t.default=a},"./src/controller/cmcd-controller.ts":
/*!*******************************************!*\
    !*** ./src/controller/cmcd-controller.ts ***!
    \*******************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return h}));var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../types/cmcd */"./src/types/cmcd.ts"),a=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}var h=function(){function e(t){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(e){try{r.apply(e,{ot:i.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(Wk){s.logger.warn("Could not generate manifest CMCD data.",Wk)}},this.applyFragmentData=function(e){try{var t=e.frag,n=r.hls.levels[t.level],a=r.getObjectType(t),o={d:1e3*t.duration,ot:a};a!==i.CMCDObjectType.VIDEO&&a!==i.CMCDObjectType.AUDIO&&a!=i.CMCDObjectType.MUXED||(o.br=n.bitrate/1e3,o.tb=r.getTopBandwidth(a)/1e3,o.bl=r.getBufferLength(a)),r.apply(e,o)}catch(Wk){s.logger.warn("Could not generate segment CMCD data.",Wk)}},this.hls=t;var n=this.config=t.config,a=n.cmcd;null!=a&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=a.sessionId||e.uuid(),this.cid=a.contentId,this.useHeaders=!0===a.useHeaders,this.registerListeners())}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(n.Events.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(n.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},t.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(e,t){var r,n;this.audioBuffer=null===(r=t.tracks.audio)||void 0===r?void 0:r.buffer,this.videoBuffer=null===(n=t.tracks.video)||void 0===n?void 0:n.buffer},t.createData=function(){var e;return{v:i.CMCDVersion,sf:i.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(e=this.media)||void 0===e?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,r){void 0===r&&(r={}),d(r,this.createData());var n=r.ot===i.CMCDObjectType.INIT||r.ot===i.CMCDObjectType.VIDEO||r.ot===i.CMCDObjectType.MUXED;if(this.starved&&n&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var a=e.toHeaders(r);if(!Object.keys(a).length)return;t.headers||(t.headers={}),d(t.headers,a)}else{var s=e.toQuery(r);if(!s)return;t.url=e.appendQueryToUri(t.url,s)}},t.getObjectType=function(e){var t=e.type;return"subtitle"===t?i.CMCDObjectType.TIMED_TEXT:"initSegment"===e.sn?i.CMCDObjectType.INIT:"audio"===t?i.CMCDObjectType.AUDIO:"main"===t?this.hls.audioTracks.length?i.CMCDObjectType.VIDEO:i.CMCDObjectType.MUXED:void 0},t.getTopBandwidth=function(e){var t,r=0,n=this.hls;if(e===i.CMCDObjectType.AUDIO)t=n.audioTracks;else{var a=n.maxAutoLevel,s=a>-1?a+1:n.levels.length;t=n.levels.slice(0,s)}for(var o,l=c(t);!(o=l()).done;){var u=o.value;u.bitrate>r&&(r=u.bitrate)}return r>0?r:NaN},t.getBufferLength=function(e){var t=this.hls.media,r=e===i.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return r&&t?1e3*a.BufferHelper.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new r(e)}var n=e.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(e,r,n){t(e),this.loader.load(e,r,n)},l(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},t.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new r(e)}var n=e.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(e,r,n){t(e),this.loader.load(e,r,n)},l(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},e.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.substr(t.lastIndexOf("/")+1)},e.serialize=function(e){for(var t,r=[],n=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},i=function(e){return Math.round(e)},a=function(e){return 100*i(e/100)},s={br:i,d:i,bl:a,dl:a,mtp:a,nor:function(e){return encodeURIComponent(e)},rtp:a,tb:i},o=c(Object.keys(e||{}).sort());!(t=o()).done;){var l=t.value,u=e[l];if(n(u)&&!("v"===l&&1===u||"pr"==l&&1===u)){var d=s[l];d&&(u=d(u));var h=typeof u,f=void 0;f="ot"===l||"sf"===l||"st"===l?l+"="+u:"boolean"===h?l:"number"===h?l+"="+u:l+"="+JSON.stringify(u),r.push(f)}}return r.join(",")},e.toHeaders=function(t){for(var r={},n=["Object","Request","Session","Status"],i=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,o=Object.keys(t);s<o.length;s++){var l=o[s];i[null!=a[l]?a[l]:1][l]=t[l]}for(var c=0;c<i.length;c++){var u=e.serialize(i[c]);u&&(r["CMCD-"+n[c]]=u)}return r},e.toQuery=function(t){return"CMCD="+encodeURIComponent(e.serialize(t))},e.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},e}()},"./src/controller/eme-controller.ts":
/*!******************************************!*\
    !*** ./src/controller/eme-controller.ts ***!
    \******************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(e){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=e,this._config=e.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},t._registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t._unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t.getLicenseServerUrl=function(e){switch(e){case s.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},t._attemptKeySystemAccess=function(e,t,r){var n=this,i=function(e,t,r,n){if(e===s.KeySystems.WIDEVINE)return function(e,t,r){var n={audioCapabilities:[],videoCapabilities:[]};return e.forEach((function(e){n.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:r.audioRobustness||""})})),t.forEach((function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:r.videoRobustness||""})})),[n]}(t,r,n);throw new Error("Unknown key-system: "+e)}(e,t,r,this._drmSystemOptions);a.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(e,i);this.mediaKeysPromise=o.then((function(t){return n._onMediaKeySystemAccessObtained(e,t)})),o.catch((function(t){a.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},t._onMediaKeySystemAccessObtained=function(e,t){var r=this;a.logger.log('Access for key-system "'+e+'" obtained');var n={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(n);var i=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return n.mediaKeys=t,a.logger.log('Media-keys created for key-system "'+e+'"'),r._onMediaKeysCreated(),t}));return i.catch((function(e){a.logger.error("Failed to create media-keys:",e)})),i},t._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},t._onNewMediaKeySession=function(e){var t=this;a.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(r){t._onKeySessionMessage(e,r.message)}),!1)},t._onKeySessionMessage=function(e,t){a.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){a.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)}))},t.onMediaEncrypted=function(e){var t=this;if(a.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!this.mediaKeysPromise)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var r=function(r){t._media&&(t._attemptSetMediaKeys(r),t._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};this.mediaKeysPromise.then(r).catch(r)},t._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});a.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(e,t){var r=this,s=this._mediaKeysList[0];if(!s)return a.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(s.mediaKeysSessionInitialized)a.logger.warn("Key-Session already initialized but requested again");else{var o=s.mediaKeysSession;if(!o)return a.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return a.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});a.logger.log('Generating key-session request for "'+e+'" init data type'),s.mediaKeysSessionInitialized=!0,o.generateRequest(e,t).then((function(){a.logger.debug("Key-session generation succeeded")})).catch((function(e){a.logger.error("Error generating key-session request:",e),r.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},t._createLicenseXhr=function(e,t,r){var n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,t,r);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,n,e),i=void 0}catch(s){a.logger.error(s)}try{n.readyState||n.open("POST",e,!0),i&&i.call(this.hls,n,e)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return n},t._onLicenseRequestReadyStageChange=function(e,t,r,s){if(4===e.readyState)if(200===e.status){this._requestLicenseFailureCount=0,a.logger.log("License request succeeded");var o=e.response,l=this._licenseResponseCallback;if(l)try{o=l.call(this.hls,e,t)}catch(u){a.logger.error(u)}s(o)}else{if(a.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var c=3-this._requestLicenseFailureCount+1;a.logger.warn("Retrying license request, "+c+" attempts left"),this._requestLicense(r,s)}},t._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===s.KeySystems.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},t._requestLicense=function(e,t){a.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return a.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var s=this.getLicenseServerUrl(r.mediaKeySystemDomain),o=this._createLicenseXhr(s,e,t);a.logger.log("Sending license request to URL: "+s);var l=this._generateLicenseRequestChallenge(r,e);o.send(l)}catch(c){a.logger.error("Failure requesting DRM license: "+c),this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(e,t){if(this._emeEnabled){var r=t.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},t.onManifestParsed=function(e,t){if(this._emeEnabled){var r=t.levels.map((function(e){return e.audioCodec})).filter((function(e){return!!e})),n=t.levels.map((function(e){return e.videoCodec})).filter((function(e){return!!e}));this._attemptKeySystemAccess(s.KeySystems.WIDEVINE,r,n)}},function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}();t.default=l},"./src/controller/fps-controller.ts":
/*!******************************************!*\
    !*** ./src/controller/fps-controller.ts ***!
    \******************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&"function"==typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,r){var a=performance.now();if(t){if(this.lastTime){var s=a-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,c=1e3*o/s,u=this.hls;if(u.trigger(n.Events.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),c>0&&o>u.config.fpsDroppedMonitoringThreshold*l){var d=u.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=d)&&(d-=1,u.trigger(n.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}();t.default=a},"./src/controller/fragment-finders.ts":
/*!********************************************!*\
    !*** ./src/controller/fragment-finders.ts ***!
    \********************************************/
/*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */function(e,t,r){r.r(t),r.d(t,"findFragmentByPDT",(function(){return a})),r.d(t,"findFragmentByPTS",(function(){return s})),r.d(t,"fragmentWithinToleranceTest",(function(){return o})),r.d(t,"pdtWithinToleranceTest",(function(){return l})),r.d(t,"findFragWithCC",(function(){return c}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/binary-search */"./src/utils/binary-search.ts");function a(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(n.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(var i=0;i<e.length;++i){var a=e[i];if(l(t,r,a))return a}return null}function s(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var a=null;if(e?a=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(a=t[0]),a&&0===o(r,n,a))return a;var s=i.default.search(t,o.bind(null,r,n));return s||a}function o(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function l(e,t,r){var n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>e}function c(e,t){return i.default.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}},"./src/controller/fragment-tracker.ts":
/*!********************************************!*\
    !*** ./src/controller/fragment-tracker.ts ***!
    \********************************************/
/*! exports provided: FragmentState, FragmentTracker */function(e,t,r){r.r(t),r.d(t,"FragmentState",(function(){return n})),r.d(t,"FragmentTracker",(function(){return s}));var n,i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../types/loader */"./src/types/loader.ts");!function(e){e.NOT_LOADED="NOT_LOADED",e.BACKTRACKED="BACKTRACKED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK"}(n||(n={}));var s=function(){function e(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){if(t===a.PlaylistLevelType.MAIN){var r=this.activeFragment,n=this.activeParts;if(!r)return null;if(n)for(var i=n.length;i--;){var s=n[i],o=s?s.end:r.appendedPTS;if(s.start<=e&&void 0!==o&&e<=o)return i>9&&(this.activeParts=n.slice(i-9)),s}else if(r.start<=e&&void 0!==r.appendedPTS&&e<=r.appendedPTS)return r}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var r=this.fragments,n=Object.keys(r),i=n.length;i--;){var a=r[n[i]];if((null==a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null},t.detectEvictedFragments=function(e,t,r){var n=this;Object.keys(this.fragments).forEach((function(i){var a=n.fragments[i];if(a)if(a.buffered){var s=a.range[e];s&&s.time.some((function(e){var r=!n.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&n.removeFragment(a.body),r}))}else a.body.type===r&&n.removeFragment(a.body)}))},t.detectPartialFragments=function(e){var t=this,r=this.timeRanges,n=e.frag,i=e.part;if(r&&"initSegment"!==n.sn){var a=l(n),s=this.fragments[a];s&&(Object.keys(r).forEach((function(e){var a=n.elementaryStreams[e];if(a){var o=r[e],l=null!==i||!0===a.partial;s.range[e]=t.getBufferedTimes(n,i,l,o)}})),s.backtrack=s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},t.fragBuffered=function(e){var t=l(e),r=this.fragments[t];r&&(r.backtrack=r.loaded=null,r.buffered=!0)},t.getBufferedTimes=function(e,t,r,n){for(var i={time:[],partial:r},a=t?t.start:e.start,s=t?t.end:e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,c=0;c<n.length;c++){var u=n.start(c)-this.bufferPadding,d=n.end(c)+this.bufferPadding;if(l>=u&&o<=d){i.time.push({startPTS:Math.max(a,n.start(c)),endPTS:Math.min(s,n.end(c))});break}if(a<d&&s>u)i.partial=!0,i.time.push({startPTS:Math.max(a,n.start(c)),endPTS:Math.min(s,n.end(c))});else if(s<=u)break}return i},t.getPartialFragment=function(e){var t,r,n,i=null,a=0,s=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach((function(c){var u=l[c];u&&o(u)&&(r=u.body.start-s,n=u.body.end+s,e>=r&&e<=n&&(t=Math.min(e-r,n-e),a<=t&&(i=u.body,a=t)))})),i},t.getState=function(e){var t=l(e),r=this.fragments[t];return r?r.buffered?o(r)?n.PARTIAL:n.OK:r.backtrack?n.BACKTRACKED:n.APPENDING:n.NOT_LOADED},t.backtrack=function(e,t){var r=l(e),n=this.fragments[r];if(!n||n.backtrack)return null;var i=n.backtrack=t||n.loaded;return n.loaded=null,i},t.getBacktrackData=function(e){var t=l(e),r=this.fragments[t];if(r){var n,i=r.backtrack;if(null!=i&&null!==(n=i.payload)&&void 0!==n&&n.byteLength)return i;this.removeFragment(e)}return null},t.isTimeBuffered=function(e,t,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1},t.onFragLoaded=function(e,t){var r=t.frag,n=t.part;if("initSegment"!==r.sn&&!r.bitrateTest&&!n){var i=l(r);this.fragments[i]={body:r,loaded:t,backtrack:null,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var r=this,n=t.frag,i=t.part,s=t.timeRanges;if(n.type===a.PlaylistLevelType.MAIN)if(this.activeFragment=n,i){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(i)}else this.activeParts=null;this.timeRanges=s,Object.keys(s).forEach((function(e){var t=s[e];if(r.detectEvictedFragments(e,t),!i)for(var a=0;a<t.length;a++)n.appendedPTS=Math.max(t.end(a),n.appendedPTS||0)}))},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=l(e);return!!this.fragments[t]},t.removeFragmentsInRange=function(e,t,r){var n=this;Object.keys(this.fragments).forEach((function(i){var a=n.fragments[i];if(a&&a.buffered){var s=a.body;s.type===r&&s.start<t&&s.end>e&&n.removeFragment(s)}}))},t.removeFragment=function(e){var t=l(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function o(e){var t,r;return e.buffered&&((null===(t=e.range.video)||void 0===t?void 0:t.partial)||(null===(r=e.range.audio)||void 0===r?void 0:r.partial))}function l(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":
/*!******************************************!*\
    !*** ./src/controller/gap-controller.ts ***!
    \******************************************/
/*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */function(e,t,r){r.r(t),r.d(t,"STALL_MINIMUM_DURATION_MS",(function(){return o})),r.d(t,"MAX_START_GAP_JUMP",(function(){return l})),r.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return c})),r.d(t,"SKIP_BUFFER_RANGE_START",(function(){return u})),r.d(t,"default",(function(){return d}));var n=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=250,l=2,c=.1,u=.05,d=function(){function e(e,t,r,n){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n}var t=e.prototype;return t.destroy=function(){this.hls=this.fragmentTracker=this.media=null},t.poll=function(e){var t=this.config,r=this.media,i=this.stalled,a=r.currentTime,c=r.seeking,u=this.seeking&&!c,d=!this.seeking&&c;if(this.seeking=c,a===e){if((d||u)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&n.BufferHelper.getBuffered(r).length){var h=n.BufferHelper.bufferInfo(r,a,0),f=h.len>0,p=h.nextStart||0;if(f||p){if(c){var m=h.len>l,g=!p||p-a>l&&!this.fragmentTracker.getPartialFragment(a);if(m||g)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var v,y=Math.max(p,h.start||0)-a,_=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,E=(null==_||null===(v=_.details)||void 0===v?void 0:v.live)?2*_.details.targetduration:l;if(y>0&&y<=E)return void this._trySkipBufferHole(null)}var S=self.performance.now();if(null!==i){var b=S-i;!c&&b>=o&&this._reportStall(h.len);var T=n.BufferHelper.bufferInfo(r,a,t.maxBufferHole);this._tryFixBufferStall(T,b)}else this.stalled=S}}}else if(this.moved=!0,null!==i){if(this.stallReported){var R=self.performance.now()-i;s.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(R)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media.currentTime,a=n.getPartialFragment(i);a&&this._trySkipBufferHole(a)||e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(s.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,s.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,r=this.hls,o=this.media,l=o.currentTime,d=0,h=n.BufferHelper.getBuffered(o),f=0;f<h.length;f++){var p=h.start(f);if(l+t.maxBufferHole>=d&&l<p){var m=Math.max(p+u,o.currentTime+c);return s.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+m),this.moved=!0,this.stalled=null,o.currentTime=m,e&&r.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+m,frag:e}),m}d=h.end(f)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=r.currentTime,o=(this.nudgeRetry||0)+1;if(this.nudgeRetry=o,o<e.nudgeMaxRetry){var l=n+o*e.nudgeOffset;s.logger.warn("Nudging 'currentTime' from "+n+" to "+l),r.currentTime=l,t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else s.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}()},"./src/controller/id3-track-controller.ts":
/*!************************************************!*\
    !*** ./src/controller/id3-track-controller.ts ***!
    \************************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),a=r(/*! ../demux/id3 */"./src/demux/id3.ts"),s=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners()},t._registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t._unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&(Object(i.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Object(i.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var r=t.frag,n=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,s=0;s<n.length;s++){var o=a.getID3Frames(n[s].data);if(o){var l=n[s].pts,c=s<n.length-1?n[s+1].pts:r.end;c-l<=0&&(c=l+.25);for(var u=0;u<o.length;u++){var d=o[u];if(!a.isTimeStampFrame(d)){var h=new i(l,c,"");h.value=d,this.id3Track.addCue(h)}}}}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,n=t.endOffset,a=t.type;if(!a||"audio"===a){var s=this.id3Track;s&&Object(i.removeCuesInRange)(s,r,n)}},e}();t.default=s},"./src/controller/latency-controller.ts":
/*!**********************************************!*\
    !*** ./src/controller/latency-controller.ts ***!
    \**********************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return o}));var n=r(/*! ../errors */"./src/errors.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts");function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(i.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(i.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(i.Events.ERROR,this.onError)},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(e,t){t.details===n.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var n=this.config,i=n.lowLatencyMode,a=n.maxLiveSyncPlaybackRate;if(i&&1!==a){var s=this.targetLatency;if(null!==s){var o=r-s,l=o<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&l&&o>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,a)),u=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,u))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},t.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,n=e.targetduration,i=this.config,a=i.liveSyncDuration,s=i.liveSyncDurationCount,o=i.lowLatencyMode,l=this.hls.userConfig,c=o&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||0===c)&&(c=void 0!==a?a:s*n);var u=n;return c+Math.min(1*this.stallCount,u)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var n=r.edge,i=e-t-this.edgeStalled,a=n-r.totalduration,s=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return r?e.buffered.end(r-1):t.edge-this.currentTime}}]),e}()},"./src/controller/level-controller.ts":
/*!********************************************!*\
    !*** ./src/controller/level-controller.ts ***!
    \********************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return p}));var n=r(/*! ../types/level */"./src/types/level.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),o=r(/*! ./level-helper */"./src/controller/level-helper.ts"),l=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts");function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),p=function(e){var t,r;function l(t){var r;return(r=e.call(this,t,"[level-controller]")||this)._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.onParsedComplete=void 0,r._registerListeners(),r}r=e,(t=l).prototype=Object.create(r.prototype),t.prototype.constructor=t,h(t,r);var p=l.prototype;return p._registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(i.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(i.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},p.startLoad=function(){this._levels.forEach((function(e){e.loadError=0})),e.prototype.startLoad.call(this)},p.onManifestLoaded=function(e,t){var r,l,c=[],u=[],d=[],h={},p=!1,m=!1,g=!1;if(t.levels.forEach((function(e){var t=e.attrs;p=p||!(!e.width||!e.height),m=m||!!e.videoCodec,g=g||!!e.audioCodec,f&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0);var r=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;(l=h[r])?l.url.push(e.url):(l=new n.Level(e),h[r]=l,c.push(l)),t&&(t.AUDIO&&Object(o.addGroupId)(l,"audio",t.AUDIO),t.SUBTITLES&&Object(o.addGroupId)(l,"text",t.SUBTITLES))})),(p||m)&&g&&(c=c.filter((function(e){var t=e.videoCodec,r=e.width,n=e.height;return!!t||!(!r||!n)}))),c=c.filter((function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||Object(s.isCodecSupportedInMp4)(t,"audio"))&&(!r||Object(s.isCodecSupportedInMp4)(r,"video"))})),t.audioTracks&&(u=t.audioTracks.filter((function(e){return!e.audioCodec||Object(s.isCodecSupportedInMp4)(e.audioCodec,"audio")})),Object(o.assignTrackIdsByGroup)(u)),t.subtitles&&(d=t.subtitles,Object(o.assignTrackIdsByGroup)(d)),c.length>0){r=c[0].bitrate,c.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=c;for(var v=0;v<c.length;v++)if(c[v].bitrate===r){this._firstLevel=v,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+r);break}var y=g&&!m,_={levels:c,audioTracks:u,subtitleTracks:d,firstLevel:this._firstLevel,stats:t.stats,audio:g,video:m,altAudio:!y&&u.some((function(e){return!!e.url}))};this.hls.trigger(i.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(t,r){if(e.prototype.onError.call(this,t,r),!r.fatal){var n=r.context,i=this._levels[this.currentLevelIndex];if(n&&(n.type===c.PlaylistContextType.AUDIO_TRACK&&i.audioGroupIds&&n.groupId===i.audioGroupIds[i.urlId]||n.type===c.PlaylistContextType.SUBTITLE_TRACK&&i.textGroupIds&&n.groupId===i.textGroupIds[i.urlId]))this.redundantFailover(this.currentLevelIndex);else{var s,o=!1,l=!0;switch(r.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var u=this._levels[r.frag.level];u?(u.fragmentError++,u.fragmentError>this.hls.config.fragLoadingMaxRetry&&(s=r.frag.level)):s=r.frag.level}break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:n&&(n.deliveryDirectives&&(l=!1),s=n.level),o=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:s=r.level,o=!0}void 0!==s&&this.recoverLevel(r,s,o,l)}}},p.recoverLevel=function(e,t,r,n){var i=e.details,a=this._levels[t];if(a.loadError++,r){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}if(n){var s=a.url.length;if(s>1&&a.loadError<s)e.levelRetry=!0,this.redundantFailover(t);else if(-1===this.manualLevelIndex){var o=0===t?this._levels.length-1:t-1;this.currentLevelIndex!==o&&0===this._levels[o].loadError&&(this.warn(i+": switch to "+o),e.levelRetry=!0,this.hls.nextAutoLevel=o)}}},p.redundantFailover=function(e){var t=this._levels[e],r=t.url.length;if(r>1){var n=(t.urlId+1)%r;this.warn("Switching to redundant URL-id "+n),this._levels.forEach((function(e){e.urlId=n})),this.level=e}},p.onFragLoaded=function(e,t){var r=t.frag;if(void 0!==r&&r.type===c.PlaylistLevelType.MAIN){var n=this._levels[r.level];void 0!==n&&(n.fragmentError=0,n.loadError=0)}},p.onLevelLoaded=function(e,t){var r,n,i=t.level,a=t.details,s=this._levels[i];if(!s)return this.warn("Invalid level index "+i),void(null!==(n=t.deliveryDirectives)&&void 0!==n&&n.skip&&(a.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(i,t,s.details)):null!==(r=t.deliveryDirectives)&&void 0!==r&&r.skip&&(a.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(e,t){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var n=-1,i=this.hls.audioTracks[t.id].groupId,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===i){n=a;break}n!==r.urlId&&(r.urlId=n,this.startLoad())}},p.loadPlaylist=function(e){var t=this.currentLevelIndex,r=this._levels[t];if(this.canLoad&&r&&r.url.length>0){var n=r.urlId,a=r.url[n];if(e)try{a=e.addDirectives(a)}catch(Wk){this.warn("Could not construct new URL with HLS Delivery Directives: "+Wk)}this.log("Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+n+" "+a),this.clearTimer(),this.hls.trigger(i.Events.LEVEL_LOADING,{url:a,level:t,id:n,deliveryDirectives:e||null})}},p.removeLevel=function(e,t){var r=function(e,r){return r!==t},n=this._levels.filter((function(n,i){return i!==e||n.url.length>1&&void 0!==t&&(n.url=n.url.filter(r),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(r)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(r)),n.urlId=0,!0)})).map((function(e,t){var r=e.details;return null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t})),e}));this._levels=n,this.hls.trigger(i.Events.LEVELS_UPDATED,{levels:n})},function(e,t,r){t&&d(e.prototype,t),r&&d(e,r)}(l,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,r=this._levels;if(0!==r.length&&(this.currentLevelIndex!==e||null===(t=r[e])||void 0===t||!t.details)){if(e<0||e>=r.length){var n=e<0;if(this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:n,reason:"invalid level idx"}),n)return;e=Math.min(e,r.length-1)}this.clearTimer();var s=this.currentLevelIndex,o=r[s],l=r[e];this.log("switching to level "+e+" from "+s),this.currentLevelIndex=e;var c=u({},l,{level:e,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete c._urlId,this.hls.trigger(i.Events.LEVEL_SWITCHING,c);var d=l.details;if(!d||d.live){var h=this.switchParams(l.uri,null==o?void 0:o.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),l}(l.default)},"./src/controller/level-helper.ts":
/*!****************************************!*\
    !*** ./src/controller/level-helper.ts ***!
    \****************************************/
/*! exports provided: addGroupId, assignTrackIdsByGroup, updatePTS, updateFragPTSDTS, mergeDetails, mapPartIntersection, mapFragmentIntersection, adjustSliding, addSliding, computeReloadInterval, getFragmentWithSN, getPartWith */function(e,t,r){r.r(t),r.d(t,"addGroupId",(function(){return a})),r.d(t,"assignTrackIdsByGroup",(function(){return s})),r.d(t,"updatePTS",(function(){return o})),r.d(t,"updateFragPTSDTS",(function(){return c})),r.d(t,"mergeDetails",(function(){return u})),r.d(t,"mapPartIntersection",(function(){return d})),r.d(t,"mapFragmentIntersection",(function(){return h})),r.d(t,"adjustSliding",(function(){return f})),r.d(t,"addSliding",(function(){return p})),r.d(t,"computeReloadInterval",(function(){return m})),r.d(t,"getFragmentWithSN",(function(){return g})),r.d(t,"getPartWith",(function(){return v}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/logger */"./src/utils/logger.ts");function a(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function s(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}function o(e,t,r){l(e[t],e[r])}function l(e,t){var r=t.startPTS;if(Object(n.isFiniteNumber)(r)){var i,a=0;t.sn>e.sn?(a=r-e.start,i=e):(a=e.start-r,i=t),i.duration!==a&&(i.duration=a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function c(e,t,r,a,s,o){a-r<=0&&(i.logger.warn("Fragment should have a positive duration",t),a=r+t.duration,o=s+t.duration);var c=r,u=a,d=t.startPTS,h=t.endPTS;if(Object(n.isFiniteNumber)(d)){var f=Math.abs(d-r);Object(n.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(f,t.deltaPTS):t.deltaPTS=f,c=Math.max(r,d),r=Math.min(r,d),s=Math.min(s,t.startDTS),u=Math.min(a,h),a=Math.max(a,h),o=Math.max(o,t.endDTS)}t.duration=a-r;var p=r-t.start;t.appendedPTS=a,t.start=t.startPTS=r,t.maxStartPTS=c,t.startDTS=s,t.endPTS=a,t.minEndPTS=u,t.endDTS=o;var m,g=t.sn;if(!e||g<e.startSN||g>e.endSN)return 0;var v=g-e.startSN,y=e.fragments;for(y[v]=t,m=v;m>0;m--)l(y[m],y[m-1]);for(m=v;m<y.length-1;m++)l(y[m],y[m+1]);return e.fragmentHint&&l(y[y.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,p}function u(e,t){for(var r=null,a=e.fragments,s=a.length-1;s>=0;s--){var o=a[s].initSegment;if(o){r=o;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var l,u=0;if(h(e,t,(function(e,i){e.relurl&&(u=e.cc-i.cc),Object(n.isFiniteNumber)(e.startPTS)&&Object(n.isFiniteNumber)(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.appendedPTS=e.appendedPTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(l=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,i.urlId=e.urlId,e.initSegment&&(i.initSegment=e.initSegment,r=e.initSegment)})),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null===(t=r)||void 0===t?void 0:t.relurl)||(e.initSegment=r)})),t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed)){i.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var p=t.skippedSegments;p--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var m=t.fragments;if(u){i.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<m.length;g++)m[g].cc+=u}t.skippedSegments&&(t.startCC=t.fragments[0].cc),d(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),l?c(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):f(e,t),m.length&&(t.totalduration=t.edge-m[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var v=t.advancedDateTime;if(t.advanced&&v){var y=t.edge;t.driftStart||(t.driftStartTime=v,t.driftStart=y),t.driftEndTime=v,t.driftEnd=y}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function d(e,t,r){if(e&&t)for(var n=0,i=0,a=e.length;i<=a;i++){var s=e[i],o=t[i+n];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?r(s,o):n--}}function h(e,t,r){for(var n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=i;c<=a;c++){var u=l[s+c],d=o[c];n&&!d&&c<n&&(d=t.fragments[c]=u),u&&d&&r(u,d)}}function f(e,t){var r=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;r<0||r>=n.length||p(t,n[r].start)}function p(e,t){if(t){for(var r=e.fragments,n=e.skippedSegments;n<r.length;n++)r[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function m(e,t){var r,n=1e3*e.levelTargetDuration,i=n/2,a=e.age,s=a>0&&a<3*n,o=t.loading.end-t.loading.start,l=e.availabilityDelay;if(!1===e.updated)if(s){var c=333*e.misses;r=Math.max(Math.min(i,2*o),c),e.availabilityDelay=(e.availabilityDelay||0)+r}else r=i;else s?(l=Math.min(l||n/2,a),e.availabilityDelay=l,r=l+n-a):r=n-o;return Math.round(r)}function g(e,t,r){if(!e||!e.details)return null;var n=e.details,i=n.fragments[t-n.startSN];return i||((i=n.fragmentHint)&&i.sn===t?i:t<n.startSN&&r&&r.sn===t?r:null)}function v(e,t,r){if(!e||!e.details)return null;var n=e.details.partList;if(n)for(var i=n.length;i--;){var a=n[i];if(a.index===r&&a.fragment.sn===t)return a}return null}},"./src/controller/stream-controller.ts":
/*!*********************************************!*\
    !*** ./src/controller/stream-controller.ts ***!
    \*********************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return y}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),a=r(/*! ../is-supported */"./src/is-supported.ts"),s=r(/*! ../events */"./src/events.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),l=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),u=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),d=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),h=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),f=r(/*! ./gap-controller */"./src/controller/gap-controller.ts"),p=r(/*! ../errors */"./src/errors.ts"),m=r(/*! ../utils/logger */"./src/utils/logger.ts");function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}var y=function(e){var t,r;function y(t,r){var n;return(n=e.call(this,t,r,"[stream-controller]")||this).audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.stalled=!1,n.couldBacktrack=!1,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}r=e,(t=y).prototype=Object.create(r.prototype),t.prototype.constructor=t,v(t,r);var _=y.prototype;return _._registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(s.Events.ERROR,this.onError,this),e.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(s.Events.ERROR,this.onError,this),e.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},_.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=r.startLevel;-1===n&&(r.config.testBandwidth?(n=0,this.bitrateTest=!0):n=r.nextAutoLevel),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},_.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},_.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var e,t=this.levels,r=this.level,n=null==t||null===(e=t[r])||void 0===e?void 0:e.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var a,s=self.performance.now(),o=this.retryDate;(!o||s>=o||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=i.State.IDLE)}this.onTickEnd()},_.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},_.doTickIdle=function(){var e,t,r=this.hls,n=this.levelLastLoaded,a=this.levels,o=this.media,d=r.config,h=r.nextLoadLevel;if(null!==n&&(o||!this.startFragRequested&&d.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&a&&a[h]){var f=a[h];this.level=r.nextLoadLevel=h;var p=f.details;if(!p||this.state===i.State.WAITING_LEVEL||p.live&&this.levelLastLoaded!==h)this.state=i.State.WAITING_LEVEL;else{var m=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:o,c.PlaylistLevelType.MAIN);if(null!==m&&!(m.len>=this.getMaxBufferLength(f.maxBitrate))){if(this._streamEnded(m,p)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(s.Events.BUFFER_EOS,g),void(this.state=i.State.ENDED)}var v=m.end,y=this.getNextFragment(v,p);if(this.couldBacktrack&&!this.fragPrevious&&y&&"initSegment"!==y.sn){var _=y.sn-p.startSN;_>1&&(y=p.fragments[_-1],this.fragmentTracker.removeFragment(y))}if(y&&this.fragmentTracker.getState(y)===l.FragmentState.OK&&this.nextLoadPosition>v){var E=this.audioOnly&&!this.altAudio?u.ElementaryStreamTypes.AUDIO:u.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(o,E,c.PlaylistLevelType.MAIN),y=this.getNextFragment(this.nextLoadPosition,p)}y&&(!y.initSegment||y.initSegment.data||this.bitrateTest||(y=y.initSegment),"identity"!==(null===(e=y.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=y.decryptdata)&&void 0!==t&&t.key?this.loadFragment(y,p,v):this.loadKey(y,p))}}}},_.loadFragment=function(t,r,n){var i,a=this.fragmentTracker.getState(t);if(this.fragCurrent=t,a===l.FragmentState.BACKTRACKED){var s=this.fragmentTracker.getBacktrackData(t);if(s)return this._handleFragmentLoadProgress(s),void this._handleFragmentLoadComplete(s);a=l.FragmentState.NOT_LOADED}a===l.FragmentState.NOT_LOADED||a===l.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,n)):a===l.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(i=this.media)||void 0===i?void 0:i.buffered.length)&&this.fragmentTracker.removeAllFragments()},_.getAppendedFrag=function(e){var t=this.fragmentTracker.getAppendedFrag(e,c.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},_.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,c.PlaylistLevelType.MAIN)},_.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},_.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,n=this.getAppendedFrag(t.currentTime);if(n&&n.start>1&&this.flushMainBuffer(0,n.start-1),!t.paused&&e){var i=e[this.hls.nextLoadLevel],a=this.fragLastKbps;r=a&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*a)+1:0}else r=0;var s=this.getBufferedFrag(t.currentTime+r);if(s){var o=this.followingBufferedFrag(s);if(o){this.abortCurrentFrag();var l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,u=Math.max(s.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},_.abortCurrentFrag=function(){var e=this.fragCurrent;this.fragCurrent=null,null!=e&&e.loader&&e.loader.abort(),this.state===i.State.KEY_LOADING&&(this.state=i.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},_.flushMainBuffer=function(t,r){e.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},_.onMediaAttached=function(t,r){e.prototype.onMediaAttached.call(this,t,r);var n=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new f.default(this.config,n,this.fragmentTracker,this.hls)},_.onMediaDetaching=function(){var t=this.media;t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},_.onMediaPlaying=function(){this.tick()},_.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;Object(n.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},_.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(s.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},_.onManifestParsed=function(e,t){var r,n=!1,i=!1;t.levels.forEach((function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(n=!0),-1!==r.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=n&&i&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},_.onLevelLoading=function(e,t){var r=this.levels;if(r&&this.state===i.State.IDLE){var n=r[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(n.details))&&(this.state=i.State.WAITING_LEVEL)}},_.onLevelLoaded=function(e,t){var r,n=this.levels,a=t.level,o=t.details,l=o.totalduration;if(n){this.log("Level "+a+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+l);var c=this.fragCurrent;!c||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||c.level!==t.level&&c.loader&&(this.state=i.State.IDLE,c.loader.abort());var u=n[a],d=0;if(o.live||null!==(r=u.details)&&void 0!==r&&r.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details)}if(u.details=o,this.levelLastLoaded=a,this.hls.trigger(s.Events.LEVEL_UPDATED,{details:o,level:a}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=i.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,d),this.tick()}else this.warn("Levels were reset while loading level "+a)},_._handleFragmentLoadProgress=function(e){var t,r=e.frag,n=e.part,i=e.payload,a=this.levels;if(a){var s=a[r.level],o=s.details;if(o){var l=s.videoCodec,u=o.PTSKnown||!o.live,f=null===(t=r.initSegment)||void 0===t?void 0:t.data,p=this._getAudioCodec(s),m=this.transmuxer=this.transmuxer||new d.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=n?n.index:-1,v=-1!==g,y=new h.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,v),_=this.initPTS[r.cc];m.push(i,f,p,l,r,n,o.totalduration,u,y,_)}else this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},_.onAudioTrackSwitching=function(e,t){var r=this.altAudio,n=!!t.url,i=t.id;if(!n){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;null!=a&&a.loader&&(this.log("Switching to main audio track, cancel main fragment load"),a.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;r&&o.trigger(s.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:i})}},_.onAudioTrackSwitched=function(e,t){var r=t.id,n=!!this.hls.audioTracks[r].url;if(n){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n,this.tick()},_.onBufferCreated=function(e,t){var r,n,i=t.tracks,a=!1;for(var s in i){var o=i[s];if("main"===o.id){if(n=s,r=o,"video"===s){var l=i[s];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},_.onFragBuffered=function(e,t){var r=t.frag,n=t.part;if(!r||r.type===c.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(n?" p: "+n.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var a=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}},_.onError=function(e,t){switch(t.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,t);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=i.State.ERROR):t.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===t.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var r=!0,n=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN);n&&n.len>.5&&(r=!this.reduceMaxBufferLength(n.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},_.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){var r=o.BufferHelper.getBuffered(e);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):t.poll(this.lastCurrentTime),this.lastCurrentTime=e.currentTime}},_.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},_.onBufferFlushed=function(e,t){var r=t.type;if(r!==u.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var n=(r===u.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,r,c.PlaylistLevelType.MAIN)}},_.onLevelsUpdated=function(e,t){this.levels=t.levels},_.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},_.seekToStartPos=function(){var e=this.media,t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void m.logger.log("could not seek to "+r+", already seeking at "+t);var n=o.BufferHelper.getBuffered(e),i=(n.length?n.start(0):0)-r;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(m.logger.log("adjusting start position by "+i+" to match buffer start"),r+=i,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+t),e.currentTime=r}},_._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},_._loadBitrateTestFrag=function(e){var t=this;this._doFragLoad(e).then((function(r){var n=t.hls;if(r&&!n.nextLoadLevel&&!t.fragContextChanged(e)){t.fragLoadError=0,t.state=i.State.IDLE,t.startFragRequested=!1,t.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),n.trigger(s.Events.FRAG_LOADED,r)}}))},_._handleTransmuxComplete=function(e){var t,r="main",a=this.hls,o=e.remuxResult,l=e.chunkMeta,c=this.getCurrentContext(l);if(!c)return this.warn("The loading context changed while buffering fragment "+l.sn+" of level "+l.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(l.level);var d=c.frag,h=c.part,f=c.level,p=o.video,m=o.text,g=o.id3,v=o.initSegment,y=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(d)){if(this.state=i.State.PARSING,v){v.tracks&&(this._bufferInitSegment(f,v.tracks,d,l),a.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:d,id:r,tracks:v.tracks}));var _=v.initPTS,E=v.timescale;Object(n.isFiniteNumber)(_)&&(this.initPTS[d.cc]=_,a.trigger(s.Events.INIT_PTS_FOUND,{frag:d,id:r,initPTS:_,timescale:E}))}if(p&&!1!==o.independent){if(f.details){var S=p.startPTS,b=p.endPTS,T=p.startDTS,R=p.endDTS;if(h)h.elementaryStreams[p.type]={startPTS:S,endPTS:b,startDTS:T,endDTS:R};else if(p.firstKeyFrame&&p.independent&&(this.couldBacktrack=!0),p.dropped&&p.independent){if(this.getLoadPosition()+this.config.maxBufferHole<S)return void this.backtrack(d);d.setElementaryStreamInfo(p.type,d.start,b,d.start,R,!0)}d.setElementaryStreamInfo(p.type,S,b,T,R),this.bufferFragmentData(p,d,h,l)}}else if(!1===o.independent)return void this.backtrack(d);if(y){var A=y.startPTS,w=y.endPTS,L=y.startDTS,C=y.endDTS;h&&(h.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:A,endPTS:w,startDTS:L,endDTS:C}),d.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,A,w,L,C),this.bufferFragmentData(y,d,h,l)}if(null!=g&&null!==(t=g.samples)&&void 0!==t&&t.length){var I={frag:d,id:r,samples:g.samples};a.trigger(s.Events.FRAG_PARSING_METADATA,I)}if(m){var k={frag:d,id:r,samples:m.samples};a.trigger(s.Events.FRAG_PARSING_USERDATA,k)}}},_._bufferInitSegment=function(e,t,r,n){var a=this;if(this.state===i.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var o=t.audio,l=t.video,c=t.audiovideo;if(o){var u=e.audioCodec,d=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==o.metadata.channelCount&&-1===d.indexOf("firefox")&&(u="mp4a.40.5")),-1!==d.indexOf("android")&&"audio/mpeg"!==o.container&&(u="mp4a.40.2",this.log("Android: force audio codec to "+u)),e.audioCodec&&e.audioCodec!==u&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+u+'"'),o.levelCodec=u,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(u||"")+"/"+(e.audioCodec||"")+"/"+o.codec+"]")}l&&(l.levelCodec=e.videoCodec,l.id="main",this.log("Init video buffer, container:"+l.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+l.codec+"]")),c&&this.log("Init audiovideo buffer, container:"+c.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+c.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var i=t[e].initSegment;null!=i&&i.byteLength&&a.hls.trigger(s.Events.BUFFER_APPENDING,{type:e,data:i,frag:r,part:null,chunkMeta:n,parent:r.type})})),this.tick()}},_.backtrack=function(e){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(e);var t=this.fragmentTracker.backtrack(e);this.fragPrevious=null,this.nextLoadPosition=e.start,t?this.resetFragmentLoading(e):this.state=i.State.BACKTRACKING},_.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(o.BufferHelper.isBuffered(e,r)?t=this.getAppendedFrag(r):o.BufferHelper.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){var n=this.fragPlaying,i=t.level;n&&t.sn===n.sn&&n.level===i&&t.urlId===n.urlId||(this.hls.trigger(s.Events.FRAG_CHANGED,{frag:t}),n&&n.level===i||this.hls.trigger(s.Events.LEVEL_SWITCHED,{level:i}),this.fragPlaying=t)}}},function(e,t,r){t&&g(e.prototype,t),r&&g(e,r)}(y,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),y}(i.default)},"./src/controller/subtitle-stream-controller.ts":
/*!******************************************************!*\
    !*** ./src/controller/subtitle-stream-controller.ts ***!
    \******************************************************/
/*! exports provided: SubtitleStreamController */function(e,t,r){r.r(t),r.d(t,"SubtitleStreamController",(function(){return p}));var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),s=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),o=r(/*! ./level-helper */"./src/controller/level-helper.ts"),l=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),c=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),d=r(/*! ../types/level */"./src/types/level.ts");function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}var p=function(e){var t,r;function p(t,r){var n;return(n=e.call(this,t,r,"[subtitle-stream-controller]")||this).levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}r=e,(t=p).prototype=Object.create(r.prototype),t.prototype.constructor=t,f(t,r);var m=p.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(n.Events.ERROR,this.onError,this),e.on(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m._unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(n.Events.ERROR,this.onError,this),e.off(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(500),this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},m.onLevelLoaded=function(e,t){this.mainDetails=t.details},m.onSubtitleFragProcessed=function(e,t){var r=t.frag,n=t.success;if(this.fragPrevious=r,this.state=c.State.IDLE,n){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var a,s=r.start,o=0;o<i.length;o++)if(s>=i[o].start&&s<=i[o].end){a=i[o];break}var l=r.start+r.duration;a?a.end=l:(a={start:s,end:l},i.push(a)),this.fragmentTracker.fragBuffered(r)}}},m.onBufferFlushing=function(e,t){var r=t.startOffset,n=t.endOffset;if(0===r&&n!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,a=this.levels;if(!a.length||!a[i]||!a[i].details)return;var s=n-a[i].details.targetduration;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=s)e.shift();else{if(!(e[t].start<s))break;e[t].start=s,t++}})),this.fragmentTracker.removeFragmentsInRange(r,s,u.PlaylistLevelType.SUBTITLE)}},m.onError=function(e,t){var r,n=t.frag;n&&n.type===u.PlaylistLevelType.SUBTITLE&&(null!==(r=this.fragCurrent)&&void 0!==r&&r.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},m.onSubtitleTracksUpdated=function(e,t){var r=this,n=t.subtitleTracks;this.tracksBuffered=[],this.levels=n.map((function(e){return new d.Level(e)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(e){r.tracksBuffered[e.id]=[]})),this.mediaBuffer=null},m.onSubtitleTrackSwitch=function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}else this.clearInterval()},m.onSubtitleTrackLoaded=function(e,t){var r,n=t.details,i=t.id,l=this.currentTrackId,u=this.levels;if(u.length){var d=u[l];if(!(i>=u.length||i!==l)&&d){if(this.mediaBuffer=this.mediaBufferTimeRanges,n.live||null!==(r=d.details)&&void 0!==r&&r.live){var h=this.mainDetails;if(n.deltaUpdateFailed||!h)return;var f=h.fragments[0];d.details?0===this.alignPlaylists(n,d.details)&&f&&Object(o.addSliding)(n,f.start):n.hasProgramDateTime&&h.hasProgramDateTime?Object(s.alignMediaPlaylistByPDT)(n,h):f&&Object(o.addSliding)(n,f.start)}d.details=n,this.levelLastLoaded=i,this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE&&(Object(a.findFragmentByPTS)(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0))}}},m._handleFragmentLoadComplete=function(e){var t=e.frag,r=e.payload,i=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){var s=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).then((function(e){var r=performance.now();a.trigger(n.Events.FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:s,tdecrypt:r}})}))}},m.doTick=function(){if(this.media){if(this.state===c.State.IDLE){var e,t=this.currentTrackId,r=this.levels;if(!r.length||!r[t]||!r[t].details)return;var n=r[t].details,s=n.targetduration,o=this.config,u=this.media,d=i.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,u.currentTime-s,o.maxBufferHole),h=d.end;if(d.len>this.getMaxBufferLength()+s)return;console.assert(n,"Subtitle track details are defined on idle subtitle stream controller tick");var f,p=n.fragments,m=p.length,g=n.edge,v=this.fragPrevious;if(h<g){var y=o.maxFragLookUpTolerance;!(f=Object(a.findFragmentByPTS)(v,p,h,y))&&v&&v.start<p[0].start&&(f=p[0])}else f=p[m-1];null!==(e=f)&&void 0!==e&&e.encrypted?this.loadKey(f,n):f&&this.fragmentTracker.getState(f)===l.FragmentState.NOT_LOADED&&this.loadFragment(f,n,h)}}else this.state=c.State.IDLE},m.loadFragment=function(t,r,n){this.fragCurrent=t,e.prototype.loadFragment.call(this,t,r,n)},function(e,t,r){t&&h(e.prototype,t),r&&h(e,r)}(p,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),p}(c.default)},"./src/controller/subtitle-track-controller.ts":
/*!*****************************************************!*\
    !*** ./src/controller/subtitle-track-controller.ts ***!
    \*****************************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),a=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),s=r(/*! ../types/loader */"./src/types/loader.ts");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}var c=function(e){var t,r;function a(t){var r;return(r=e.call(this,t,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r.subtitleDisplay=!0,r.registerListeners(),r}r=e,(t=a).prototype=Object.create(r.prototype),t.prototype.constructor=t,l(t,r);var c=a.prototype;return c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,e.prototype.destroy.call(this)},c.registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(n.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(n.Events.ERROR,this.onError,this)},c.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},c.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},c.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),u(this.media.textTracks).forEach((function(e){Object(i.clearCurrentCues)(e)})),this.subtitleTrack=-1,this.media=null)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},c.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},c.onSubtitleTrackLoaded=function(e,t){var r=t.id,n=t.details,i=this.trackId,a=this.tracksInGroup[i];if(a){var s=a.details;a.details=t.details,this.log("subtitle track "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,t,s))}else this.warn("Invalid subtitle track id "+r)},c.onLevelLoading=function(e,t){this.switchLevel(t.level)},c.onLevelSwitching=function(e,t){this.switchLevel(t.level)},c.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var r=t.textGroupIds[t.urlId];if(this.groupId!==r){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter((function(e){return!r||e.groupId===r}));this.tracksInGroup=a;var s=this.findTrackId(null==i?void 0:i.name)||this.findTrackId();this.groupId=r;var o={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(n.Events.SUBTITLE_TRACKS_UPDATED,o),-1!==s&&this.setSubtitleTrack(s,i)}}},c.findTrackId=function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1},c.onError=function(t,r){e.prototype.onError.call(this,t,r),!r.fatal&&r.context&&r.context.type===s.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},c.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var r=t.id,i=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(Wk){this.warn("Could not construct new URL with HLS Delivery Directives: "+Wk)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADING,{url:a,id:r,groupId:i,deliveryDirectives:e||null})}},c.toggleTrackModes=function(e){var t=this,r=this.media,n=this.subtitleDisplay,i=this.trackId;if(r){var a=u(r.textTracks),s=a.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(a).forEach((function(e){e.mode="disabled"}));else{var o=s[i];o&&(o.mode="disabled")}var l=s[e];l&&(l.mode=n?"showing":"hidden")}},c.setSubtitleTrack=function(e,t){var r,i=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!==(r=i[e])&&void 0!==r&&r.details)||e<-1||e>=i.length)){this.clearTimer();var a=i[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,a){var s=a.id,o=a.groupId,l=void 0===o?"":o,c=a.name,u=a.type,d=a.url;this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:s,groupId:l,name:c,type:u,url:d});var h=this.switchParams(a.url,null==t?void 0:t.details);this.loadPlaylist(h)}else this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},c.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=u(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(a,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}]),a}(a.default);function u(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];"subtitles"===n.kind&&n.label&&t.push(e[r])}return t}t.default=c},"./src/controller/timeline-controller.ts":
/*!***********************************************!*\
    !*** ./src/controller/timeline-controller.ts ***!
    \***********************************************/
/*! exports provided: TimelineController */function(e,t,r){r.r(t),r.d(t,"TimelineController",(function(){return h}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/cea-608-parser */"./src/utils/cea-608-parser.ts"),s=r(/*! ../utils/output-filter */"./src/utils/output-filter.ts"),o=r(/*! ../utils/webvtt-parser */"./src/utils/webvtt-parser.ts"),l=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),c=r(/*! ../utils/imsc1-ttml-parser */"./src/utils/imsc1-ttml-parser.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),d=r(/*! ../utils/logger */"./src/utils/logger.ts"),h=function(){function e(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new s.default(this,"textTrack1"),r=new s.default(this,"textTrack2"),n=new s.default(this,"textTrack3"),o=new s.default(this,"textTrack4");this.cea608Parser1=new a.default(1,t,r),this.cea608Parser2=new a.default(3,n,o)}e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(i.Events.FRAG_LOADING,this.onFragLoading,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(i.Events.FRAG_LOADING,this.onFragLoading,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,t,r,n,a){for(var s,o,l,c,u=!1,d=a.length;d--;){var h=a[d],f=(s=h[0],o=h[1],l=t,c=r,Math.min(o,c)-Math.max(s,l));if(f>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],r),u=!0,f/(r-t)>.5))return}if(u||a.push([t,r]),this.config.renderTextTracksNatively){var p=this.captionsTracks[e];this.Cues.newCue(p,t,r,n)}else{var m=this.Cues.newCue(null,t,r,n);this.hls.trigger(i.Events.CUES_PARSED,{type:"captions",cues:m,track:e})}},t.onInitPtsFound=function(e,t){var r=this,n=t.frag,a=t.id,s=t.initPTS,o=t.timescale,l=this.unparsedVttFrags;"main"===a&&(this.initPTS[n.cc]=s,this.timescale[n.cc]=o),l.length&&(this.unparsedVttFrags=[],l.forEach((function(e){r.onFragLoaded(i.Events.FRAG_LOADED,e)})))},t.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var n=t.textTracks[r];if(n[e])return n}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,n=this.media,i=t[e],a=i.label,s=i.languageCode,o=this.getExistingTrack(e);if(o)r[e]=o,Object(l.clearCurrentCues)(r[e]),Object(l.sendAddTrackEvent)(r[e],n);else{var c=this.createTextTrack("captions",a,s);c&&(c[e]=!0,r[e]=c)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},t.createTextTrack=function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)},t.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Object(l.clearCurrentCues)(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Object(l.clearCurrentCues)(t[r])}},t.onSubtitleTracksUpdated=function(e,t){var r=this;this.textTracks=[];var n=t.subtitleTracks||[],a=n.some((function(e){return e.textCodec===c.IMSC1_CODEC}));if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var s=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,t){var n;if(t<o.length){for(var i=null,a=0;a<o.length;a++)if(f(o[a],e)){i=o[a];break}i&&(n=i)}n?Object(l.clearCurrentCues)(n):(n=r.createTextTrack("subtitles",e.name,e.lang))&&(n.mode="disabled"),n&&(n.groupId=e.groupId,r.textTracks.push(n))}))}else if(!s&&this.tracks&&this.tracks.length){var u=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},t.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var n="textTrack"+t[1],i=r.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))},t.onFragLoading=function(e,t){var r=this.cea608Parser1,n=this.cea608Parser2,i=this.lastSn,a=this.lastPartIndex;if(this.enabled&&r&&n&&t.frag.type===u.PlaylistLevelType.MAIN){var s,o,l=t.frag.sn,c=null!=(s=null==t||null===(o=t.part)||void 0===o?void 0:o.index)?s:-1;l===i+1||l===i&&c===a+1||(r.reset(),n.reset()),this.lastSn=l,this.lastPartIndex=c}},t.onFragLoaded=function(e,t){var r=t.frag,a=t.payload,s=this.initPTS,o=this.unparsedVttFrags;if(r.type===u.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!Object(n.isFiniteNumber)(s[r.cc]))return o.push(t),void(s.length&&this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var l=r.decryptdata,d="stats"in t;if(null==l||null==l.key||"AES-128"!==l.method||d){var h=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===c.IMSC1_CODEC?this._parseIMSC1(r,a):this._parseVTTs(r,a,f)}}else this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,t){var r=this,n=this.hls;Object(c.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(t){r._appendCues(t,e.level),n.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){d.logger.log("Failed to parse IMSC1: "+t),n.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))},t._parseVTTs=function(e,t,r){var n=this,a=this.hls;Object(o.parseWebVTT)(t,this.initPTS[e.cc],this.timescale[e.cc],r,e.cc,e.start,(function(t){n._appendCues(t,e.level),a.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(r){n._fallbackToIMSC1(e,t),d.logger.log("Failed to parse VTT cue: "+r),a.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})}))},t._fallbackToIMSC1=function(e,t){var r=this,n=this.tracks[e.level];n.textCodec||Object(c.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(){n.textCodec=c.IMSC1_CODEC,r._parseIMSC1(e,t)}),(function(){n.textCodec="wvtt"}))},t._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if("disabled"===n.mode)return;e.forEach((function(e){return Object(l.addCueToTrack)(n,e)}))}else{var a=this.tracks[t].default?"default":"subtitles"+t;r.trigger(i.Events.CUES_PARSED,{type:"subtitles",cues:e,track:a})}},t.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===u.PlaylistLevelType.SUBTITLE){if(!Object(n.isFiniteNumber)(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(i.Events.FRAG_LOADED,t)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&r&&n)for(var i=0;i<t.samples.length;i++){var a=t.samples[i].bytes;if(a){var s=this.extractCea608Data(a);r.addData(t.samples[i].pts,s[0]),n.addData(t.samples[i].pts,s[1])}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,n=t.endOffset,i=t.endOffsetSubtitles,a=t.type,s=this.media;if(s&&!(s.currentTime<n)){if(!a||"video"===a){var o=this.captionsTracks;Object.keys(o).forEach((function(e){return Object(l.removeCuesInRange)(o[e],r,n)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==i){var c=this.textTracks;Object.keys(c).forEach((function(e){return Object(l.removeCuesInRange)(c[e],r,i)}))}}},t.extractCea608Data=function(e){for(var t=31&e[0],r=2,n=[[],[]],i=0;i<t;i++){var a=e[r++],s=127&e[r++],o=127&e[r++],l=3&a;0===s&&0===o||0!=(4&a)&&(0!==l&&1!==l||(n[l].push(s),n[l].push(o)))}return n},e}();function f(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}},"./src/crypt/aes-crypto.ts":
/*!*********************************!*\
    !*** ./src/crypt/aes-crypto.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return n}));var n=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}()},"./src/crypt/aes-decryptor.ts":
/*!************************************!*\
    !*** ./src/crypt/aes-decryptor.ts ***!
    \************************************/
/*! exports provided: removePadding, default */function(e,t,r){r.r(t),r.d(t,"removePadding",(function(){return i})),r.d(t,"default",(function(){return a}));var n=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts");function i(e){var t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?Object(n.sliceUint8)(e,0,t-r):e}var a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r},t.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],s=r[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],h=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var v=h[f],y=h[v],_=h[y],E=257*h[g]^16843008*g;n[f]=E<<24|E>>>8,i[f]=E<<16|E>>>16,a[f]=E<<8|E>>>24,s[f]=E,E=16843009*_^65537*y^257*v^16843008*f,l[g]=E<<24|E>>>8,c[g]=E<<16|E>>>16,u[g]=E<<8|E>>>24,d[g]=E,f?(f=v^h[h[h[_^v]]],p^=h[h[p]]):f=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,s,o,l,c=this.ksRows=4*(i+6+1),u=this.keySchedule=new Uint32Array(c),d=this.invKeySchedule=new Uint32Array(c),h=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],g=p[1],v=p[2],y=p[3];for(a=0;a<c;a++)a<i?o=u[a]=t[a]:(l=o,a%i==0?(l=h[(l=l<<8|l>>>24)>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[a/i|0]<<24):i>6&&a%i==4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),u[a]=o=(u[a-i]^l)>>>0);for(s=0;s<c;s++)a=c-s,l=3&s?u[a]:u[a-4],d[s]=s<4||a<=4?l:m[h[l>>>24]]^g[h[l>>>16&255]]^v[h[l>>>8&255]]^y[h[255&l]],d[s]=d[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r){for(var n,i,a,s,o,l,c,u,d,h,f,p,m,g,v=this.keySize+6,y=this.invKeySchedule,_=this.invSBox,E=this.invSubMix,S=E[0],b=E[1],T=E[2],R=E[3],A=this.uint8ArrayToUint32Array_(r),w=A[0],L=A[1],C=A[2],I=A[3],k=new Int32Array(e),O=new Int32Array(k.length),D=this.networkToHostOrderSwap;t<k.length;){for(d=D(k[t]),h=D(k[t+1]),f=D(k[t+2]),p=D(k[t+3]),o=d^y[0],l=p^y[1],c=f^y[2],u=h^y[3],m=4,g=1;g<v;g++)n=S[o>>>24]^b[l>>16&255]^T[c>>8&255]^R[255&u]^y[m],i=S[l>>>24]^b[c>>16&255]^T[u>>8&255]^R[255&o]^y[m+1],a=S[c>>>24]^b[u>>16&255]^T[o>>8&255]^R[255&l]^y[m+2],s=S[u>>>24]^b[o>>16&255]^T[l>>8&255]^R[255&c]^y[m+3],o=n,l=i,c=a,u=s,m+=4;n=_[o>>>24]<<24^_[l>>16&255]<<16^_[c>>8&255]<<8^_[255&u]^y[m],i=_[l>>>24]<<24^_[c>>16&255]<<16^_[u>>8&255]<<8^_[255&o]^y[m+1],a=_[c>>>24]<<24^_[u>>16&255]<<16^_[o>>8&255]<<8^_[255&l]^y[m+2],s=_[u>>>24]<<24^_[o>>16&255]<<16^_[l>>8&255]<<8^_[255&c]^y[m+3],O[t]=D(n^w),O[t+1]=D(s^L),O[t+2]=D(a^C),O[t+3]=D(i^I),w=d,L=h,C=f,I=p,t+=4}return O.buffer},e}()},"./src/crypt/decrypter.ts":
/*!********************************!*\
    !*** ./src/crypt/decrypter.ts ***!
    \********************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return c}));var n=r(/*! ./aes-crypto */"./src/crypt/aes-crypto.ts"),i=r(/*! ./fast-aes-key */"./src/crypt/fast-aes-key.ts"),a=r(/*! ./aes-decryptor */"./src/crypt/aes-decryptor.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),l=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),c=function(){function e(e,t,r){var n=(void 0===r?{}:r).removePKCS7Padding,i=void 0===n||n;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(s){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var t=e.prototype;return t.destroy=function(){this.observer=null},t.isSync=function(){return this.config.enableSoftwareAES},t.flush=function(){var e=this.currentResult;if(e){var t=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Object(a.removePadding)(t):t}this.reset()},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,r,n){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(e),t,r);var i=this.flush();i&&n(i.buffer)}else this.webCryptoDecrypt(new Uint8Array(e),t,r).then(n)},t.softwareDecrypt=function(e,t,r){var n=this.currentIV,i=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt"),s&&(e=Object(o.appendUint8Array)(s,e),this.remainderData=null);var c=this.getValidChunk(e);if(!c.length)return null;n&&(r=n);var u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new a.default),u.expandKey(t);var d=i;return this.currentResult=u.decrypt(c.buffer,0,r),this.currentIV=Object(l.sliceUint8)(c,-16).buffer,d||null},t.webCryptoDecrypt=function(e,t,r){var a=this,s=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new i.default(s,t)),this.fastAesKey.expandKey().then((function(t){return s?new n.default(s,r).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))})).catch((function(n){return a.onWebCryptoError(n,e,t,r)}))},t.onWebCryptoError=function(e,t,r,n){return s.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(t,r,n)},t.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=Object(l.sliceUint8)(e,0,r),this.remainderData=Object(l.sliceUint8)(e,r)),t},t.logOnce=function(e){this.logEnabled&&(s.logger.log("[decrypter.ts]: "+e),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":
/*!***********************************!*\
    !*** ./src/crypt/fast-aes-key.ts ***!
    \***********************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return n}));var n=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":
/*!*********************************!*\
    !*** ./src/demux/aacdemuxer.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),i=r(/*! ./adts */"./src/demux/adts.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../demux/id3 */"./src/demux/id3.ts");function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}var l=function(e){var t,r;function n(t,r){var n;return(n=e.call(this)||this).observer=void 0,n.config=void 0,n.observer=t,n.config=r,n}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r);var l=n.prototype;return l.resetInitSegment=function(t,r,n){e.prototype.resetInitSegment.call(this,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}},n.probe=function(e){if(!e)return!1;for(var t=(s.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(i.probe(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1},l.canParse=function(e,t){return i.canParse(e,t)},l.appendFrame=function(e,t,r){i.initTrackConfig(e,this.observer,t,r,e.manifestCodec);var n=i.appendFrame(e,t,r,this.initPTS,this.frameIndex);if(n&&0===n.missing)return n},n}(n.default);l.minProbeByteLength=9,t.default=l},"./src/demux/adts.ts":
/*!***************************!*\
    !*** ./src/demux/adts.ts ***!
    \***************************/
/*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */function(e,t,r){r.r(t),r.d(t,"getAudioConfig",(function(){return s})),r.d(t,"isHeaderPattern",(function(){return o})),r.d(t,"getHeaderLength",(function(){return l})),r.d(t,"getFullFrameLength",(function(){return c})),r.d(t,"canGetFrameLength",(function(){return u})),r.d(t,"isHeader",(function(){return d})),r.d(t,"canParse",(function(){return h})),r.d(t,"probe",(function(){return f})),r.d(t,"initTrackConfig",(function(){return p})),r.d(t,"getFrameDuration",(function(){return m})),r.d(t,"parseFrameHeader",(function(){return g})),r.d(t,"appendFrame",(function(){return v}));var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../events */"./src/events.ts");function s(e,t,r,s){var o,l,c,u,d=navigator.userAgent.toLowerCase(),h=s,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&t[r+2])>>>6);var p=(60&t[r+2])>>>2;if(!(p>f.length-1))return c=(1&t[r+2])<<2,c|=(192&t[r+3])>>>6,n.logger.log("manifest codec:"+s+", ADTS type:"+o+", samplingIndex:"+p),/firefox/i.test(d)?p>=6?(o=5,u=new Array(4),l=p-3):(o=2,u=new Array(2),l=p):-1!==d.indexOf("android")?(o=2,u=new Array(2),l=p):(o=5,u=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&p>=6?l=p-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(p>=6&&1===c||/vivaldi/i.test(d))||!s&&1===c)&&(o=2,u=new Array(2)),l=p)),u[0]=o<<3,u[0]|=(14&p)>>1,u[1]|=(1&p)<<7,u[1]|=c<<3,5===o&&(u[1]|=(14&l)>>1,u[2]=(1&l)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:f[p],channelCount:c,codec:"mp4a.40."+o,manifestCodec:h};e.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function o(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function c(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function u(e,t){return t+5<e.length}function d(e,t){return t+1<e.length&&o(e,t)}function h(e,t){return u(e,t)&&o(e,t)&&c(e,t)<=e.length-t}function f(e,t){if(d(e,t)){var r=l(e,t);if(t+r>=e.length)return!1;var n=c(e,t);if(n<=r)return!1;var i=t+n;return i===e.length||d(e,i)}return!1}function p(e,t,r,i,a){if(!e.samplerate){var o=s(t,r,i,a);if(!o)return;e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,n.logger.log("parsed codec:"+e.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function m(e){return 9216e4/e}function g(e,t,r,n,i){var a=l(e,t),s=c(e,t);if((s-=a)>0)return{headerLength:a,frameLength:s,stamp:r+n*i}}function v(e,t,r,n,i){var a=g(t,r,n,i,m(e.samplerate));if(a){var s,o=a.frameLength,l=a.headerLength,c=a.stamp,u=l+o,d=Math.max(0,r+u-t.length);d?(s=new Uint8Array(u-l)).set(t.subarray(r+l,t.length),0):s=t.subarray(r+l,r+u);var h={unit:s,pts:c};return d||e.samples.push(h),{sample:h,length:u,missing:d}}}},"./src/demux/base-audio-demuxer.ts":
/*!*****************************************!*\
    !*** ./src/demux/base-audio-demuxer.ts ***!
    \*****************************************/
/*! exports provided: initPTSFn, default */function(e,t,r){r.r(t),r.d(t,"initPTSFn",(function(){return c}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),s=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),o=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),l=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(){},t.resetContiguity=function(){},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,r){},t.demux=function(e,t){this.cachedData&&(e=Object(s.appendUint8Array)(this.cachedData,e),this.cachedData=null);var r,n,l=i.getID3Data(e,0),u=l?l.length:0,d=this._audioTrack,h=this._id3Track,f=l?i.getTimeStamp(l):void 0,p=e.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=c(f,t)),l&&l.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:l}),n=this.initPTS;u<p;){if(this.canParse(e,u)){var m=this.appendFrame(d,e,u);m?(this.frameIndex++,n=m.sample.pts,r=u+=m.length):u=p}else i.canParse(e,u)?(l=i.getID3Data(e,u),h.samples.push({pts:n,dts:n,data:l}),r=u+=l.length):u++;if(u===p&&r!==p){var g=Object(o.sliceUint8)(e,r);this.cachedData?this.cachedData=Object(s.appendUint8Array)(this.cachedData,g):this.cachedData=g}}return{audioTrack:d,avcTrack:Object(a.dummyTrack)(),id3Track:h,textTrack:Object(a.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(a.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(a.dummyTrack)()}},t.destroy=function(){},e}(),c=function(e,t){return Object(n.isFiniteNumber)(e)?90*e:9e4*t};t.default=l},"./src/demux/chunk-cache.ts":
/*!**********************************!*\
    !*** ./src/demux/chunk-cache.ts ***!
    \**********************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return n}));var n=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var r=new Uint8Array(t),n=0,i=0;i<e.length;i++){var a=e[i];r.set(a,n),n+=a.length}return r}(t,r),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":
/*!******************************************!*\
    !*** ./src/demux/dummy-demuxed-track.ts ***!
    \******************************************/
/*! exports provided: dummyTrack */function(e,t,r){function n(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(t),r.d(t,"dummyTrack",(function(){return n}))},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
    !*** ./src/demux/exp-golomb.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},t.readSPS=function(){var e,t,r,n=0,i=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),c=this.readUEG.bind(this),u=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var m=o();if(l(5),d(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var g=c();if(3===g&&d(1),f(),f(),d(1),u())for(t=3!==g?8:12,r=0;r<t;r++)u()&&p(r<6?16:64)}f();var v=c();if(0===v)c();else if(1===v)for(d(1),h(),h(),e=c(),r=0;r<e;r++)h();f(),d(1);var y=c(),_=c(),E=l(1);0===E&&d(1),d(1),u()&&(n=c(),i=c(),a=c(),s=c());var S=[1,1];if(u()&&u())switch(o()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(y+1)-2*n-2*i),height:(2-E)*(_+1)*16-(E?2:4)*(a+s),pixelRatio:S}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=i},"./src/demux/id3.ts":
/*!**************************!*\
    !*** ./src/demux/id3.ts ***!
    \**************************/
/*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */function(e,t,r){r.r(t),r.d(t,"isHeader",(function(){return i})),r.d(t,"isFooter",(function(){return a})),r.d(t,"getID3Data",(function(){return s})),r.d(t,"canParse",(function(){return l})),r.d(t,"getTimeStamp",(function(){return c})),r.d(t,"isTimeStampFrame",(function(){return u})),r.d(t,"getID3Frames",(function(){return h})),r.d(t,"decodeFrame",(function(){return f})),r.d(t,"utf8ArrayToStr",(function(){return y})),r.d(t,"testables",(function(){return _}));var n,i=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},a=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s=function(e,t){for(var r=t,n=0;i(e,t);)n+=10,n+=o(e,t+6),a(e,t+10)&&(n+=10),t+=n;if(n>0)return e.subarray(r,r+n)},o=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},l=function(e,t){return i(e,t)&&o(e,t+6)+10<=e.length-t},c=function(e){for(var t=h(e),r=0;r<t.length;r++){var n=t[r];if(u(n))return v(n)}},u=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},d=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=o(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},h=function(e){for(var t=0,r=[];i(e,t);){for(var n=o(e,t+6),s=(t+=10)+n;t+8<s;){var l=d(e.subarray(t)),c=f(l);c&&r.push(c),t+=l.size+10}a(e,t)&&(t+=10)}return r},f=function(e){return"PRIV"===e.type?p(e):"W"===e.type[0]?g(e):m(e)},p=function(e){if(!(e.size<2)){var t=y(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},m=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=y(e.data.subarray(t),!0);t+=r.length+1;var n=y(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=y(e.data.subarray(1));return{key:e.type,data:i}}},g=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=y(e.data.subarray(t),!0);t+=r.length+1;var n=y(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=y(e.data);return{key:e.type,data:i}},v=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},y=function(e,t){void 0===t&&(t=!1);var r=E();if(r){var n=r.decode(e);if(t){var i=n.indexOf("\0");return-1!==i?n.substring(0,i):n}return n.replace(/\0/g,"")}for(var a,s,o,l=e.length,c="",u=0;u<l;){if(0===(a=e[u++])&&t)return c;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(a);break;case 12:case 13:s=e[u++],c+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[u++],o=e[u++],c+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0)}}return c},_={decodeTextFrame:m};function E(){return n||void 0===self.TextDecoder||(n=new self.TextDecoder("utf-8")),n}},"./src/demux/mp3demuxer.ts":
/*!*********************************!*\
    !*** ./src/demux/mp3demuxer.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),i=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}var l=function(e){var t,r;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r);var l=n.prototype;return l.resetInitSegment=function(t,r,n){e.prototype.resetInitSegment.call(this,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}},n.probe=function(e){if(!e)return!1;for(var t=(i.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(s.probe(e,t))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},l.canParse=function(e,t){return s.canParse(e,t)},l.appendFrame=function(e,t,r){if(null!==this.initPTS)return s.appendFrame(e,t,r,this.initPTS,this.frameIndex)},n}(n.default);l.minProbeByteLength=4,t.default=l},"./src/demux/mp4demuxer.ts":
/*!*********************************!*\
    !*** ./src/demux/mp4demuxer.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),i=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),a=function(){function e(e,t){this.remainderData=null,this.config=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.resetContiguity=function(){},e.probe=function(e){return Object(n.findBox)({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.demux=function(e){var t=e,r=Object(i.dummyTrack)();if(this.config.progressive){this.remainderData&&(t=Object(n.appendUint8Array)(this.remainderData,e));var a=Object(n.segmentValidRange)(t);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=t;return{audioTrack:Object(i.dummyTrack)(),avcTrack:r,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},t.flush=function(){var e=Object(i.dummyTrack)();return e.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(i.dummyTrack)(),avcTrack:e,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}();a.minProbeByteLength=1024,t.default=a},"./src/demux/mpegaudio.ts":
/*!********************************!*\
    !*** ./src/demux/mpegaudio.ts ***!
    \********************************/
/*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */function(e,t,r){r.r(t),r.d(t,"appendFrame",(function(){return l})),r.d(t,"parseHeader",(function(){return c})),r.d(t,"isHeaderPattern",(function(){return u})),r.d(t,"isHeader",(function(){return d})),r.d(t,"canParse",(function(){return h})),r.d(t,"probe",(function(){return f}));var n=null,i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],s=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o=[0,1,1,4];function l(e,t,r,n,i){if(!(r+24>t.length)){var a=c(t,r);if(a&&r+a.frameLength<=t.length){var s=n+i*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function c(e,t){var r=e[t+1]>>3&3,l=e[t+1]>>1&3,c=e[t+2]>>4&15,u=e[t+2]>>2&3;if(1!==r&&0!==c&&15!==c&&3!==u){var d=e[t+2]>>1&1,h=e[t+3]>>6,f=1e3*i[14*(3===r?3-l:3===l?3:4)+c-1],p=a[3*(3===r?0:2===r?1:2)+u],m=3===h?1:2,g=s[r][l],v=o[l],y=8*g*v,_=Math.floor(g*f/p+d)*v;if(null===n){var E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);n=E?parseInt(E[1]):0}return!!n&&n<=87&&2===l&&f>=224e3&&0===h&&(e[t+3]=128|e[t+3]),{sampleRate:p,channelCount:m,frameLength:_,samplesPerFrame:y}}}function u(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function d(e,t){return t+1<e.length&&u(e,t)}function h(e,t){return u(e,t)&&4<=e.length-t}function f(e,t){if(t+1<e.length&&u(e,t)){var r=c(e,t),n=4;null!=r&&r.frameLength&&(n=r.frameLength);var i=t+n;return i===e.length||d(e,i)}return!1}},"./src/demux/sample-aes.ts":
/*!*********************************!*\
    !*** ./src/demux/sample-aes.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),i=r(/*! ./tsdemuxer */"./src/demux/tsdemuxer.ts"),a=function(){function e(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new n.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,t)},t.decryptAacSample=function(e,t,r,n){var i=e[t].unit,a=i.subarray(16,i.length-i.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,(function(a){var s=new Uint8Array(a);i.set(s,16),n||o.decryptAacSamples(e,t+1,r)}))},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,n),!n)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r},t.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),n=0,i=32;i<e.length-16;i+=160,n+=16)e.set(r.subarray(n,n+16),i);return e},t.decryptAvcSample=function(e,t,r,n,a,s){var o=Object(i.discardEPB)(a.data),l=this.getAvcEncryptedData(o),c=this;this.decryptBuffer(l.buffer,(function(i){a.data=c.getAvcDecryptedUnit(o,i),s||c.decryptAvcSamples(e,t,r+1,n)}))},t.decryptAvcSamples=function(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,n,a,s),!s)return}}}},e}();t.default=a},"./src/demux/transmuxer-interface.ts":
/*!*******************************************!*\
    !*** ./src/demux/transmuxer-interface.ts ***!
    \*******************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return d}));var n=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),c=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),u=Object(l.getMediaSource)()||{isTypeSupported:function(){return!1}},d=function(){function e(e,t,r,l){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=e,this.id=t,this.onTransmuxComplete=r,this.onFlush=l;var h=e.config,f=function(t,r){(r=r||{}).frag=d.frag,r.id=d.id,e.trigger(t,r)};this.observer=new c.EventEmitter,this.observer.on(i.Events.FRAG_DECRYPTED,f),this.observer.on(i.Events.ERROR,f);var p={mp4:u.isTypeSupported("video/mp4"),mpeg:u.isTypeSupported("audio/mpeg"),mp3:u.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(h.enableWorker&&"undefined"!=typeof Worker){var g;s.logger.log("demuxing in webworker");try{g=this.worker=n(/*! ../demux/transmuxer-worker.ts */"./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(t){e.trigger(i.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},g.postMessage({cmd:"init",typeSupported:p,vendor:m,id:t,config:JSON.stringify(h)})}catch(pL){s.logger.warn("Error in worker:",pL),s.logger.error("Error while initializing DemuxerWorker, fallback to inline"),g&&self.URL.revokeObjectURL(g.objectURL),this.transmuxer=new a.default(this.observer,p,h,m,t),this.worker=null}}else this.transmuxer=new a.default(this.observer,p,h,m,t)}var t=e.prototype;return t.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.observer=null},t.push=function(e,t,r,n,i,o,l,c,u,d){var h,f,p=this;u.transmuxing.start=self.performance.now();var m=this.transmuxer,g=this.worker,v=o?o.start:i.start,y=i.decryptdata,_=this.frag,E=!(_&&i.cc===_.cc),S=!(_&&u.level===_.level),b=_?u.sn-_.sn:-1,T=this.part?u.part-this.part.index:1,R=!S&&(1===b||0===b&&1===T),A=self.performance.now();(S||b||0===i.stats.parsing.start)&&(i.stats.parsing.start=A),!o||!T&&R||(o.stats.parsing.start=A);var w=!(_&&(null===(h=i.initSegment)||void 0===h?void 0:h.url)===(null===(f=_.initSegment)||void 0===f?void 0:f.url)),L=new a.TransmuxState(E,R,c,S,v,w);if(!R||E||w){s.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+"\n        discontinuity: "+E+"\n        trackSwitch: "+S+"\n        contiguous: "+R+"\n        accurateTimeOffset: "+c+"\n        timeOffset: "+v+"\n        initSegmentChange: "+w);var C=new a.TransmuxConfig(r,n,t,l,d);this.configureTransmuxer(C)}if(this.frag=i,this.part=o,g)g.postMessage({cmd:"demux",data:e,decryptdata:y,chunkMeta:u,state:L},e instanceof ArrayBuffer?[e]:[]);else if(m){var I=m.push(e,y,u,L);Object(a.isPromise)(I)?I.then((function(e){p.handleTransmuxComplete(e)})):this.handleTransmuxComplete(I)}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e);Object(a.isPromise)(i)?i.then((function(r){t.handleFlushResult(r,e)})):this.handleFlushResult(i,e)}},t.handleFlushResult=function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},t.configureTransmuxer=function(e){var t=this.worker,r=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):r&&r.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}()},"./src/demux/transmuxer-worker.ts":
/*!****************************************!*\
    !*** ./src/demux/transmuxer-worker.ts ***!
    \****************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return o}));var n=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");function o(e){var t=new s.EventEmitter,r=function(t,r){e.postMessage({event:t,data:r})};t.on(i.Events.FRAG_DECRYPTED,r),t.on(i.Events.ERROR,r),e.addEventListener("message",(function(i){var s=i.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.transmuxer=new n.default(t,s.typeSupported,o,s.vendor,s.id),Object(a.enableLogs)(o.debug),r("init",null);break;case"configure":e.transmuxer.configure(s.config);break;case"demux":var c=e.transmuxer.push(s.data,s.decryptdata,s.chunkMeta,s.state);Object(n.isPromise)(c)?c.then((function(t){l(e,t)})):l(e,c);break;case"flush":var d=s.chunkMeta,h=e.transmuxer.flush(d);Object(n.isPromise)(h)?h.then((function(t){u(e,t,d)})):u(e,h,d)}}))}function l(e,t){if((r=t.remuxResult).audio||r.video||r.text||r.id3||r.initSegment){var r,n=[],i=t.remuxResult,a=i.audio,s=i.video;a&&c(n,a),s&&c(n,s),e.postMessage({event:"transmuxComplete",data:t},n)}}function c(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function u(e,t,r){t.forEach((function(t){l(e,t)})),e.postMessage({event:"flush",data:r})}},"./src/demux/transmuxer.ts":
/*!*********************************!*\
    !*** ./src/demux/transmuxer.ts ***!
    \*********************************/
/*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */function(e,t,r){r.r(t),r.d(t,"default",(function(){return y})),r.d(t,"isPromise",(function(){return E})),r.d(t,"TransmuxConfig",(function(){return S})),r.d(t,"TransmuxState",(function(){return b}));var n,i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),o=r(/*! ../demux/aacdemuxer */"./src/demux/aacdemuxer.ts"),l=r(/*! ../demux/mp4demuxer */"./src/demux/mp4demuxer.ts"),c=r(/*! ../demux/tsdemuxer */"./src/demux/tsdemuxer.ts"),u=r(/*! ../demux/mp3demuxer */"./src/demux/mp3demuxer.ts"),d=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),h=r(/*! ../remux/passthrough-remuxer */"./src/remux/passthrough-remuxer.ts"),f=r(/*! ./chunk-cache */"./src/demux/chunk-cache.ts"),p=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),m=r(/*! ../utils/logger */"./src/utils/logger.ts");try{n=self.performance.now.bind(self.performance)}catch(pL){m.logger.debug("Unable to use Performance API on this environment"),n=self.Date.now}var g=[{demux:c.default,remux:d.default},{demux:l.default,remux:h.default},{demux:o.default,remux:d.default},{demux:u.default,remux:d.default}],v=1024;g.forEach((function(e){var t=e.demux;v=Math.max(v,t.minProbeByteLength)}));var y=function(){function e(e,t,r,n,i){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new f.default,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n,this.id=i}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,r,i){var a=this,s=r.transmuxing;s.executeStart=n();var o=new Uint8Array(e),l=this.cache,c=this.config,u=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=function(e,t){var r=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t),r}(o,t);if(h&&"AES-128"===h.method){var f=this.getDecrypter();if(!c.enableSoftwareAES)return this.decryptionPromise=f.webCryptoDecrypt(o,h.key.buffer,h.iv.buffer).then((function(e){var t=a.push(e,null,r);return a.decryptionPromise=null,t})),this.decryptionPromise;var m=f.softwareDecrypt(o,h.key.buffer,h.iv.buffer);if(!m)return s.executeEnd=n(),_(r);o=new Uint8Array(m)}var g=i||u,v=g.contiguous,y=g.discontinuity,E=g.trackSwitch,S=g.accurateTimeOffset,b=g.timeOffset,T=g.initSegmentChange,R=d.audioCodec,A=d.videoCodec,w=d.defaultInitPts,L=d.duration,C=d.initSegmentData;if((y||E||T)&&this.resetInitSegment(C,R,A,L),(y||T)&&this.resetInitialTimestamp(w),v||this.resetContiguity(),this.needsProbing(o,y,E)){if(l.dataLength){var I=l.flush();o=Object(p.appendUint8Array)(I,o)}this.configureTransmuxer(o,d)}var k=this.transmux(o,h,b,S,r),O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,s.executeEnd=n(),k},t.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=n();var s=this.decrypter,o=this.cache,l=this.currentTransmuxState,c=this.decryptionPromise;if(c)return c.then((function(){return t.flush(e)}));var u=[],d=l.timeOffset;if(s){var h=s.flush();h&&u.push(this.push(h,null,e))}var f=o.dataLength;o.reset();var p=this.demuxer,m=this.remuxer;if(!p||!m)return f>=v&&this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=n(),[_(e)];var g=p.flush(d);return E(g)?g.then((function(r){return t.flushRemux(u,r,e),u})):(this.flushRemux(u,g,e),u)},t.flushRemux=function(e,t,r){var i=t.audioTrack,a=t.avcTrack,s=t.id3Track,o=t.textTrack,l=this.currentTransmuxState,c=l.accurateTimeOffset,u=l.timeOffset;m.logger.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var d=this.remuxer.remux(i,a,s,o,u,c,!0,this.id);e.push({remuxResult:d,chunkMeta:r}),r.transmuxing.executeEnd=n()},t.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,r,n){var i=this.demuxer,a=this.remuxer;i&&a&&(i.resetInitSegment(t,r,n),a.resetInitSegment(e,t,r))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,r,n,i){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,n,i):this.transmuxUnencrypted(e,r,n,i)},t.transmuxUnencrypted=function(e,t,r,n){var i=this.demuxer.demux(e,t,!1,!this.config.progressive),a=i.audioTrack,s=i.avcTrack,o=i.id3Track,l=i.textTrack;return{remuxResult:this.remuxer.remux(a,s,o,l,t,r,!1,this.id),chunkMeta:n}},t.transmuxSampleAes=function(e,t,r,n,i){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.avcTrack,e.id3Track,e.textTrack,r,n,!1,a.id),chunkMeta:i}}))},t.configureTransmuxer=function(e,t){for(var r,n=this.config,i=this.observer,a=this.typeSupported,s=this.vendor,o=t.audioCodec,c=t.defaultInitPts,u=t.duration,d=t.initSegmentData,f=t.videoCodec,p=0,v=g.length;p<v;p++)if(g[p].demux.probe(e)){r=g[p];break}r||(m.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:l.default,remux:h.default});var y=this.demuxer,_=this.remuxer,E=r.remux,S=r.demux;_&&_ instanceof E||(this.remuxer=new E(i,n,a,s)),y&&y instanceof S||(this.demuxer=new S(i,n,a),this.probe=S.probe),this.resetInitSegment(d,o,f,u),this.resetInitialTimestamp(c)},t.needsProbing=function(e,t,r){return!this.demuxer||!this.remuxer||t||r},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new s.default(this.observer,this.config)),e},e}(),_=function(e){return{remuxResult:{},chunkMeta:e}};function E(e){return"then"in e&&e.then instanceof Function}var S=function(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i},b=function(e,t,r,n,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":
/*!********************************!*\
    !*** ./src/demux/tsdemuxer.ts ***!
    \********************************/
/*! exports provided: discardEPB, default */function(e,t,r){r.r(t),r.d(t,"discardEPB",(function(){return E}));var n=r(/*! ./adts */"./src/demux/adts.ts"),i=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts"),a=r(/*! ./exp-golomb */"./src/demux/exp-golomb.ts"),s=r(/*! ./id3 */"./src/demux/id3.ts"),o=r(/*! ./sample-aes */"./src/demux/sample-aes.ts"),l=r(/*! ../events */"./src/events.ts"),c=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts"),d=r(/*! ../errors */"./src/errors.ts"),h={video:1,audio:2,id3:3,text:4},f=function(){function e(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}e.probe=function(t){var r=e.syncOffset(t);return!(r<0||(r&&u.logger.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),0))},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:h[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",n),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3",n),this._txtTrack=e.createTrack("text",n),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=n},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},t.demux=function(t,r,n,i){var a;void 0===n&&(n=!1),void 0===i&&(i=!1),n||(this.sampleAes=null);var s=this._avcTrack,o=this._audioTrack,h=this._id3Track,f=s.pid,p=s.pesData,y=o.pid,_=h.pid,E=o.pesData,S=h.pesData,b=!1,T=this.pmtParsed,R=this._pmtId,A=t.length;if(this.remainderData&&(A=(t=Object(c.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),A<188&&!i)return this.remainderData=t,{audioTrack:o,avcTrack:s,id3Track:h,textTrack:this._txtTrack};var w=Math.max(0,e.syncOffset(t));(A-=(A+w)%188)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,A,t.buffer.byteLength-A));for(var L=0,C=w;C<A;C+=188)if(71===t[C]){var I=!!(64&t[C+1]),k=((31&t[C+1])<<8)+t[C+2],O=void 0;if((48&t[C+3])>>4>1){if((O=C+5+t[C+4])===C+188)continue}else O=C+4;switch(k){case f:I&&(p&&(a=v(p))&&this.parseAVCPES(a,!1),p={data:[],size:0}),p&&(p.data.push(t.subarray(O,C+188)),p.size+=C+188-O);break;case y:I&&(E&&(a=v(E))&&(o.isAAC?this.parseAACPES(a):this.parseMPEGPES(a)),E={data:[],size:0}),E&&(E.data.push(t.subarray(O,C+188)),E.size+=C+188-O);break;case _:I&&(S&&(a=v(S))&&this.parseID3PES(a),S={data:[],size:0}),S&&(S.data.push(t.subarray(O,C+188)),S.size+=C+188-O);break;case 0:I&&(O+=t[O]+1),R=this._pmtId=m(t,O);break;case R:I&&(O+=t[O]+1);var D=g(t,O,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,n);(f=D.avc)>0&&(s.pid=f),(y=D.audio)>0&&(o.pid=y,o.isAAC=D.isAAC),(_=D.id3)>0&&(h.pid=_),b&&!T&&(u.logger.log("reparse from beginning"),b=!1,C=w-188),T=this.pmtParsed=!0;break;case 17:case 8191:break;default:b=!0}}else L++;L>0&&this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+L+" TS packet/s that do not start with 0x47"}),s.pesData=p,o.pesData=E,h.pesData=S;var P={audioTrack:o,avcTrack:s,id3Track:h,textTrack:this._txtTrack};return i&&this.extractRemainingSamples(P),P},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,r=e.audioTrack,n=e.avcTrack,i=e.id3Track,a=n.pesData,s=r.pesData,o=i.pesData;a&&(t=v(a))?(this.parseAVCPES(t,!0),n.pesData=null):n.pesData=a,s&&(t=v(s))?(r.isAAC?this.parseAACPES(t):this.parseMPEGPES(t),r.pesData=null):(null!=s&&s.size&&u.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=s),o&&(t=v(o))?(this.parseID3PES(t),i.pesData=null):i.pesData=o},t.demuxSampleAes=function(e,t,r){var n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new o.default(this.observer,this.config,t);return this.decrypt(n,i)},t.decrypt=function(e,t){return new Promise((function(r){var n=e.audioTrack,i=e.avcTrack;n.samples&&n.isAAC?t.decryptAacSamples(n.samples,0,(function(){i.samples?t.decryptAvcSamples(i.samples,0,0,(function(){r(e)})):r(e)})):i.samples&&t.decryptAvcSamples(i.samples,0,0,(function(){r(e)}))}))},t.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},t.parseAVCPES=function(e,t){var r,n=this,i=this._avcTrack,o=this.parseAVCNALu(e.data),l=this.avcSample,c=!1;e.data=null,l&&o.length&&!i.audFound&&(y(l,i),l=this.avcSample=p(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:r=!0,l||(l=n.avcSample=p(!0,e.pts,e.dts,"")),l.frame=!0;var o=t.data;if(c&&o.length>4){var u=new a.default(o).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(l.key=!0)}break;case 5:r=!0,l||(l=n.avcSample=p(!0,e.pts,e.dts,"")),l.key=!0,l.frame=!0;break;case 6:r=!0;var d=new a.default(E(t.data));d.readUByte();for(var h=0,f=0,m=!1,g=0;!m&&d.bytesAvailable>1;){h=0;do{h+=g=d.readUByte()}while(255===g);f=0;do{f+=g=d.readUByte()}while(255===g);if(4===h&&0!==d.bytesAvailable){if(m=!0,181===d.readUByte()&&49===d.readUShort()&&1195456820===d.readUInt()&&3===d.readUByte()){for(var v=d.readUByte(),S=31&v,b=[v,d.readUByte()],T=0;T<S;T++)b.push(d.readUByte()),b.push(d.readUByte()),b.push(d.readUByte());_(n._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(5===h&&0!==d.bytesAvailable){if(m=!0,f>16){for(var R=[],A=0;A<16;A++)R.push(d.readUByte().toString(16)),3!==A&&5!==A&&7!==A&&9!==A||R.push("-");for(var w=f-16,L=new Uint8Array(w),C=0;C<w;C++)L[C]=d.readUByte();_(n._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:R.join(""),userData:Object(s.utf8ArrayToStr)(L),userDataBytes:L})}}else if(f<d.bytesAvailable)for(var I=0;I<f;I++)d.readUByte()}break;case 7:if(r=!0,c=!0,!i.sps){var k=new a.default(t.data).readSPS();i.width=k.width,i.height=k.height,i.pixelRatio=k.pixelRatio,i.sps=[t.data],i.duration=n._duration;for(var O=t.data.subarray(1,4),D="avc1.",P=0;P<3;P++){var x=O[P].toString(16);x.length<2&&(x="0"+x),D+=x}i.codec=D}break;case 8:r=!0,i.pps||(i.pps=[t.data]);break;case 9:r=!1,i.audFound=!0,l&&y(l,i),l=n.avcSample=p(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,l&&(l.debug+="unknown NAL "+t.type+" ")}l&&r&&l.units.push(t)})),t&&l&&(y(l,i),this.avcSample=null)},t.getLastNalUnit=function(){var e,t,r=this.avcSample;if(!r||0===r.units.length){var n=this._avcTrack.samples;r=n[n.length-1]}if(null!==(e=r)&&void 0!==e&&e.units){var i=r.units;t=i[i.length-1]}return t},t.parseAVCNALu=function(e){var t,r,n=e.byteLength,i=this._avcTrack,a=i.naluState||0,s=a,o=[],l=0,c=-1,u=0;for(-1===a&&(c=0,u=31&e[0],a=0,l=1);l<n;)if(t=e[l++],a)if(1!==a)if(t)if(1===t){if(c>=0){var d={data:e.subarray(c,l-a-1),type:u};o.push(d)}else{var h=this.getLastNalUnit();if(h&&(s&&l<=4-s&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-s)),(r=l-a-1)>0)){var f=new Uint8Array(h.data.byteLength+r);f.set(h.data,0),f.set(e.subarray(0,r),h.data.byteLength),h.data=f,h.state=0}}l<n?(c=l,u=31&e[l],a=0):a=-1}else a=0;else a=3;else a=t?0:2;else a=t?0:1;if(c>=0&&a>=0){var p={data:e.subarray(c,n),type:u,state:a};o.push(p)}if(0===o.length){var m=this.getLastNalUnit();if(m){var g=new Uint8Array(m.data.byteLength+e.byteLength);g.set(m.data,0),g.set(e,m.data.byteLength),m.data=g}}return i.naluState=a,o},t.parseAACPES=function(e){var t,r,i,a,s,o=0,c=this._audioTrack,h=this.aacOverFlow,f=e.data;if(h){this.aacOverFlow=null;var p=h.sample.unit.byteLength,m=Math.min(h.missing,p),g=p-m;h.sample.unit.set(f.subarray(0,m),g),c.samples.push(h.sample),o=h.missing}for(t=o,r=f.length;t<r-1&&!n.isHeader(f,t);t++);if(t===o||(t<r-1?(i="AAC PES did not start with ADTS header,offset:"+t,a=!1):(i="no ADTS header found in AAC PES",a=!0),u.logger.warn("parsing error:"+i),this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:i}),!a)){if(n.initTrackConfig(c,this.observer,f,t,this.audioCodec),void 0!==e.pts)s=e.pts;else{if(!h)return void u.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var v=n.getFrameDuration(c.samplerate);s=h.sample.pts+v}for(var y=0;t<r;){if(n.isHeader(f,t)){if(t+5<r){var _=n.appendFrame(c,f,t,s,y);if(_){if(!_.missing){t+=_.length,y++;continue}this.aacOverFlow=_}}break}t++}}},t.parseMPEGPES=function(e){var t=e.data,r=t.length,n=0,a=0,s=e.pts;if(void 0!==s)for(;a<r;)if(i.isHeader(t,a)){var o=i.appendFrame(this._audioTrack,t,a,s,n);if(!o)break;a+=o.length,n++}else a++;else u.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e){void 0!==e.pts?this._id3Track.samples.push(e):u.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function p(e,t,r,n){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:n,length:0}}function m(e,t){return(31&e[t+10])<<8|e[t+11]}function g(e,t,r,n){var i={audio:-1,avc:-1,id3:-1,isAAC:!0},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){var s=(31&e[t+1])<<8|e[t+2];switch(e[t]){case 207:if(!n){u.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=s);break;case 21:-1===i.id3&&(i.id3=s);break;case 219:if(!n){u.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=s);break;case 3:case 4:r?-1===i.audio&&(i.audio=s,i.isAAC=!1):u.logger.log("MPEG audio found, not supported in this browser");break;case 36:u.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return i}function v(e){var t,r,n,i,a,s=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;var c=t[7];192&c&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&c?i-(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(u.logger.warn(Math.round((i-a)/9e4)+"s delta between PTS and DTS, align them"),i=a):a=i);var d=(n=t[8])+9;if(e.size<=d)return null;e.size-=d;for(var h=new Uint8Array(e.size),f=0,p=o.length;f<p;f++){var m=(t=o[f]).byteLength;if(d){if(d>m){d-=m;continue}t=t.subarray(d),m-=d,d=0}h.set(t,s),s+=m}return r&&(r-=n+3),{data:h,pts:i,dts:a,len:r}}return null}function y(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,n=r.length;if(!n)return void t.dropped++;var i=r[n-1];e.pts=i.pts,e.dts=i.dts}t.samples.push(e)}e.debug.length&&u.logger.log(e.pts+"/"+e.dts+":"+e.debug)}function _(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var n=r-1;n>=0;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)}function E(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;var i=t-r.length,a=new Uint8Array(i),s=0;for(n=0;n<i;s++,n++)s===r[0]&&(s++,r.shift()),a[n]=e[s];return a}f.minProbeByteLength=188,t.default=f},"./src/errors.ts":
/*!***********************!*\
    !*** ./src/errors.ts ***!
    \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,r){var n,i;r.r(t),r.d(t,"ErrorTypes",(function(){return n})),r.d(t,"ErrorDetails",(function(){return i})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(n||(n={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"}(i||(i={}))},"./src/events.ts":
/*!***********************!*\
    !*** ./src/events.ts ***!
    \***********************/
/*! exports provided: Events */function(e,t,r){var n;r.r(t),r.d(t,"Events",(function(){return n})),function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"}(n||(n={}))},"./src/hls.ts":
/*!********************!*\
    !*** ./src/hls.ts ***!
    \********************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return y}));var n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),i=r(/*! ./loader/playlist-loader */"./src/loader/playlist-loader.ts"),a=r(/*! ./loader/key-loader */"./src/loader/key-loader.ts"),s=r(/*! ./controller/id3-track-controller */"./src/controller/id3-track-controller.ts"),o=r(/*! ./controller/latency-controller */"./src/controller/latency-controller.ts"),l=r(/*! ./controller/level-controller */"./src/controller/level-controller.ts"),c=r(/*! ./controller/fragment-tracker */"./src/controller/fragment-tracker.ts"),u=r(/*! ./controller/stream-controller */"./src/controller/stream-controller.ts"),d=r(/*! ./is-supported */"./src/is-supported.ts"),h=r(/*! ./utils/logger */"./src/utils/logger.ts"),f=r(/*! ./config */"./src/config.ts"),p=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),m=r(/*! ./events */"./src/events.ts"),g=r(/*! ./errors */"./src/errors.ts");function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(f.mergeConfig)(e.DefaultConfig,t);this.userConfig=t,Object(h.enableLogs)(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(f.enableStreamingMode)(r);var n=r.abrController,d=r.bufferController,m=r.capLevelController,g=r.fpsController,v=this.abrController=new n(this),y=this.bufferController=new d(this),_=this.capLevelController=new m(this),E=new g(this),S=new i.default(this),b=new a.default(this),T=new s.default(this),R=this.levelController=new l.default(this),A=new c.FragmentTracker(this),w=this.streamController=new u.default(this,A);_.setStreamController(w),E.setStreamController(w);var L=[R,w];this.networkControllers=L;var C=[S,b,v,y,_,E,T,A];this.audioTrackController=this.createController(r.audioTrackController,null,L),this.createController(r.audioStreamController,A,L),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,L),this.createController(r.subtitleStreamController,A,L),this.createController(r.timelineController,null,C),this.emeController=this.createController(r.emeController,null,C),this.cmcdController=this.createController(r.cmcdController,null,C),this.latencyController=this.createController(o.default,null,C),this.coreComponents=C}e.isSupported=function(){return Object(d.isSupported)()};var t=e.prototype;return t.createController=function(e,t,r){if(e){var n=t?new e(this,t):new e(this);return r&&r.push(n),n}return null},t.on=function(e,t,r){void 0===r&&(r=this),this._emitter.on(e,t,r)},t.once=function(e,t,r){void 0===r&&(r=this),this._emitter.once(e,t,r)},t.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},t.off=function(e,t,r,n){void 0===r&&(r=this),this._emitter.off(e,t,r,n)},t.listeners=function(e){return this._emitter.listeners(e)},t.emit=function(e,t,r){return this._emitter.emit(e,t,r)},t.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){h.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(m.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1},t.listenerCount=function(e){return this._emitter.listenerCount(e)},t.destroy=function(){h.logger.log("destroy"),this.trigger(m.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0},t.attachMedia=function(e){h.logger.log("attachMedia"),this._media=e,this.trigger(m.Events.MEDIA_ATTACHING,{media:e})},t.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(m.Events.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=n.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});h.logger.log("loadSource:"+i),t&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(m.Events.MANIFEST_LOADING,{url:e})},t.startLoad=function(e){void 0===e&&(e=-1),h.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},t.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},t.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){h.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},t.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},function(e,t,r){t&&v(e.prototype,t),r&&v(e,r)}(e,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){h.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){h.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){h.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){h.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){h.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(h.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,n=0;n<r;n++)if(e[n].maxBitrate>t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return m.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:f.hlsDefaultConfig},set:function(t){e.defaultConfig=t}}]),e}();y.defaultConfig=void 0},"./src/is-supported.ts":
/*!*****************************!*\
    !*** ./src/is-supported.ts ***!
    \*****************************/
/*! exports provided: isSupported, changeTypeSupported */function(e,t,r){r.r(t),r.d(t,"isSupported",(function(){return a})),r.d(t,"changeTypeSupported",(function(){return s}));var n=r(/*! ./utils/mediasource-helper */"./src/utils/mediasource-helper.ts");function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function a(){var e=Object(n.getMediaSource)();if(!e)return!1;var t=i(),r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!a}function s(){var e,t=i();return"function"==typeof(null==t||null===(e=t.prototype)||void 0===e?void 0:e.changeType)}},"./src/loader/fragment-loader.ts":
/*!***************************************!*\
    !*** ./src/loader/fragment-loader.ts ***!
    \***************************************/
/*! exports provided: default, LoadError */function(e,t,r){r.r(t),r.d(t,"default",(function(){return u})),r.d(t,"LoadError",(function(){return h}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../errors */"./src/errors.ts");function a(e){var t="function"==typeof Map?new Map:void 0;return a=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return s(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)},a(e)}function s(e,t,r){return s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&o(i,r.prototype),i},s.apply(null,arguments)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var c=Math.pow(2,17),u=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var r=this,n=e.url;if(!n)return Promise.reject(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(n,l){r.loader&&r.loader.destroy();var u=r.loader=e.loader=s?new s(a):new o(a),f=d(e),p={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:c};e.stats=u.stats,u.load(f,p,{onSuccess:function(t,i,a,s){r.resetLoader(e,u),n({frag:e,part:null,payload:t.data,networkDetails:s})},onError:function(t,n,a){r.resetLoader(e,u),l(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:t,networkDetails:a}))},onAbort:function(t,n,a){r.resetLoader(e,u),l(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:a}))},onTimeout:function(t,n,a){r.resetLoader(e,u),l(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:a}))},onProgress:function(r,n,i,a){t&&t({frag:e,part:null,payload:i,networkDetails:a})}})}))},t.loadPart=function(e,t,r){var n=this;this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(l,u){n.loader&&n.loader.destroy();var f=n.loader=e.loader=s?new s(a):new o(a),p=d(e,t),m={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:c};t.stats=f.stats,f.load(p,m,{onSuccess:function(i,a,s,o){n.resetLoader(e,f),n.updateStatsFromPart(e,t);var c={frag:e,part:t,payload:i.data,networkDetails:o};r(c),l(c)},onError:function(r,a,s){n.resetLoader(e,f),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:r,networkDetails:s}))},onAbort:function(r,a,s){e.stats.aborted=t.stats.aborted,n.resetLoader(e,f),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:s}))},onTimeout:function(r,a,s){n.resetLoader(e,f),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:s}))}})}))},t.updateStatsFromPart=function(e,t){var r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(r.loaded/i),a),o=(a-s)*Math.round(r.loaded/s);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);var l=r.loading,c=n.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function d(e,t){void 0===t&&(t=null);var r=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},a=r.byteRangeStartOffset,s=r.byteRangeEndOffset;return Object(n.isFiniteNumber)(a)&&Object(n.isFiniteNumber)(s)&&(i.rangeStart=a,i.rangeEnd=s),i}var h=function(e){var t,r;function n(t){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return(r=e.call.apply(e,[this].concat(i))||this).data=void 0,r.data=t,r}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r),n}(a(Error))},"./src/loader/fragment.ts":
/*!********************************!*\
    !*** ./src/loader/fragment.ts ***!
    \********************************/
/*! exports provided: ElementaryStreamTypes, BaseSegment, Fragment, Part */function(e,t,r){r.r(t),r.d(t,"ElementaryStreamTypes",(function(){return n})),r.d(t,"BaseSegment",(function(){return f})),r.d(t,"Fragment",(function(){return p})),r.d(t,"Part",(function(){return m}));var n,i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),a=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ./level-key */"./src/loader/level-key.ts"),l=r(/*! ./load-stats */"./src/loader/load-stats.ts");function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}!function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"}(n||(n={}));var f=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[n.AUDIO]=null,t[n.VIDEO]=null,t[n.AUDIOVIDEO]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var r=e.split("@",2),n=[];1===r.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(r[1]),n[1]=parseInt(r[0])+n[0],this._byteRange=n},h(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),p=function(e){function t(t,r){var n;return(n=e.call(this,r)||this)._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkey=void 0,n.type=void 0,n.loader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.appendedPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new l.LoadStats,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.type=t,n}c(t,e);var r=t.prototype;return r.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},r.setDecryptDataFromLevelKey=function(e,t){var r=e;return"AES-128"===(null==e?void 0:e.method)&&e.uri&&!e.iv&&((r=o.LevelKey.fromURI(e.uri)).method=e.method,r.iv=this.createInitializationVector(t),r.keyFormat="identity"),r},r.setElementaryStreamInfo=function(e,t,r,n,i,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,i)):s[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:a}},r.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[n.AUDIO]=null,e[n.VIDEO]=null,e[n.AUDIOVIDEO]=null},h(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&s.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(i.isFiniteNumber)(this.programDateTime))return null;var e=Object(i.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;return!(null===(e=this.decryptdata)||void 0===e||!e.keyFormat||!this.decryptdata.uri)}}]),t}(f),m=function(e){function t(t,r,n,i,a){var s;(s=e.call(this,n)||this).fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new l.LoadStats,s.duration=t.decimalFloatingPoint("DURATION"),s.gap=t.bool("GAP"),s.independent=t.bool("INDEPENDENT"),s.relurl=t.enumeratedString("URI"),s.fragment=r,s.index=i;var o=t.enumeratedString("BYTERANGE");return o&&s.setByteRange(o,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return c(t,e),h(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(f)},"./src/loader/key-loader.ts":
/*!**********************************!*\
    !*** ./src/loader/key-loader.ts ***!
    \**********************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return s}));var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=function(){function e(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){this.hls.on(n.Events.KEY_LOADING,this.onKeyLoading,this)},t._unregisterListeners=function(){this.hls.off(n.Events.KEY_LOADING,this.onKeyLoading)},t.destroy=function(){for(var e in this._unregisterListeners(),this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},t.onKeyLoading=function(e,t){var r=t.frag,i=r.type,s=this.loaders[i];if(r.decryptdata){var o=r.decryptdata.uri;if(o!==this.decrypturl||null===this.decryptkey){var l=this.hls.config;if(s&&(a.logger.warn("abort previous key loader for type:"+i),s.abort()),!o)return void a.logger.warn("key uri is falsy");var c=l.loader,u=r.loader=this.loaders[i]=new c(l);this.decrypturl=o,this.decryptkey=null;var d={url:o,frag:r,responseType:"arraybuffer"},h={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(d,h,f)}else this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(n.Events.KEY_LOADED,{frag:r}))}else a.logger.warn("Missing decryption data on fragment in onKeyLoading")},t.loadsuccess=function(e,t,r){var i=r.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=null,delete this.loaders[i.type],this.hls.trigger(n.Events.KEY_LOADED,{frag:i})):a.logger.error("after key load, decryptdata unset")},t.loaderror=function(e,t){var r=t.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},t.loadtimeout=function(e,t){var r=t.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},e}()},"./src/loader/level-details.ts":
/*!*************************************!*\
    !*** ./src/loader/level-details.ts ***!
    \*************************************/
/*! exports provided: LevelDetails */function(e,t,r){r.r(t),r.d(t,"LevelDetails",(function(){return a}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=e}return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(n.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}()},"./src/loader/level-key.ts":
/*!*********************************!*\
    !*** ./src/loader/level-key.ts ***!
    \*********************************/
/*! exports provided: LevelKey */function(e,t,r){r.r(t),r.d(t,"LevelKey",(function(){return a}));var n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(e,t){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=t?Object(n.buildAbsoluteURL)(e,t,{alwaysNormalize:!0}):e}return e.fromURL=function(t,r){return new e(t,r)},e.fromURI=function(t){return new e(t)},function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"uri",get:function(){return this._uri}}]),e}()},"./src/loader/load-stats.ts":
/*!**********************************!*\
    !*** ./src/loader/load-stats.ts ***!
    \**********************************/
/*! exports provided: LoadStats */function(e,t,r){r.r(t),r.d(t,"LoadStats",(function(){return n}));var n=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":
/*!***********************************!*\
    !*** ./src/loader/m3u8-parser.ts ***!
    \***********************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return g}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),a=r(/*! ./fragment */"./src/loader/fragment.ts"),s=r(/*! ./level-details */"./src/loader/level-details.ts"),o=r(/*! ./level-key */"./src/loader/level-key.ts"),l=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts"),c=r(/*! ../utils/logger */"./src/utils/logger.ts"),u=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),d=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),m=/\.(mp4|m4s|m4v|m4a)$/i,g=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.id===t)return n}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).substr(-4)}return e},e.resolve=function(e,t){return i.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,r){var n,i=[],a={},s=!1;for(d.lastIndex=0;null!=(n=d.exec(t));)if(n[1]){var o=new l.AttrList(n[1]),c={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:e.resolve(n[2],r)},u=o.decimalResolution("RESOLUTION");u&&(c.width=u.width,c.height=u.height),v((o.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=e.convertAVC1ToAVCOTI(c.videoCodec)),i.push(c)}else if(n[3]){var h=new l.AttrList(n[3]);h["DATA-ID"]&&(s=!0,a[h["DATA-ID"]]=h)}return{levels:i,sessionData:s?a:null}},e.parseMasterPlaylistMedia=function(t,r,n,i){var a;void 0===i&&(i=[]);var s=[],o=0;for(h.lastIndex=0;null!==(a=h.exec(t));){var c=new l.AttrList(a[1]);if(c.TYPE===n){var u={attrs:c,bitrate:0,id:o++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:n,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?e.resolve(c.URI,r):""};if(i.length){var d=e.findGroup(i,u.groupId)||i[0];y(u,d,"audioCodec"),y(u,d,"textCodec")}s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,r,u,d){var h,g,v,y=new s.LevelDetails(t),E=y.fragments,S=null,b=0,T=0,R=0,A=0,w=null,L=new a.Fragment(u,t),C=-1,I=!1;for(f.lastIndex=0,y.m3u8=e;null!==(h=f.exec(e));){I&&(I=!1,(L=new a.Fragment(u,t)).start=R,L.sn=b,L.cc=A,L.level=r,S&&(L.initSegment=S,L.rawProgramDateTime=S.rawProgramDateTime));var k=h[1];if(k){L.duration=parseFloat(k);var O=(" "+h[2]).slice(1);L.title=O||null,L.tagList.push(O?["INF",k,O]:["INF",k])}else if(h[3])Object(n.isFiniteNumber)(L.duration)&&(L.start=R,v&&(L.levelkey=v),L.sn=b,L.level=r,L.cc=A,L.urlId=d,E.push(L),L.relurl=(" "+h[3]).slice(1),_(L,w),w=L,R+=L.duration,b++,T=0,I=!0);else if(h[4]){var D=(" "+h[4]).slice(1);w?L.setByteRange(D,w):L.setByteRange(D)}else if(h[5])L.rawProgramDateTime=(" "+h[5]).slice(1),L.tagList.push(["PROGRAM-DATE-TIME",L.rawProgramDateTime]),-1===C&&(C=E.length);else{if(!(h=h[0].match(p))){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(g=1;g<h.length&&void 0===h[g];g++);var P=(" "+h[g]).slice(1),x=(" "+h[g+1]).slice(1),M=h[g+2]?(" "+h[g+2]).slice(1):"";switch(P){case"PLAYLIST-TYPE":y.type=x.toUpperCase();break;case"MEDIA-SEQUENCE":b=y.startSN=parseInt(x);break;case"SKIP":var N=new l.AttrList(x),F=N.decimalInteger("SKIPPED-SEGMENTS");if(Object(n.isFiniteNumber)(F)){y.skippedSegments=F;for(var U=F;U--;)E.unshift(null);b+=F}var B=N.enumeratedString("RECENTLY-REMOVED-DATERANGES");B&&(y.recentlyRemovedDateranges=B.split("\t"));break;case"TARGETDURATION":y.targetduration=parseFloat(x);break;case"VERSION":y.version=parseInt(x);break;case"EXTM3U":break;case"ENDLIST":y.live=!1;break;case"#":(x||M)&&L.tagList.push(M?[x,M]:[x]);break;case"DIS":A++;case"GAP":L.tagList.push([P]);break;case"BITRATE":L.tagList.push([P,x]);break;case"DISCONTINUITY-SEQ":A=parseInt(x);break;case"KEY":var j,H=new l.AttrList(x),V=H.enumeratedString("METHOD"),G=H.URI,z=H.hexadecimalInteger("IV"),K=H.enumeratedString("KEYFORMATVERSIONS"),W=H.enumeratedString("KEYID"),Y=null!=(j=H.enumeratedString("KEYFORMAT"))?j:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Y)>-1){c.logger.warn("Keyformat "+Y+" is not supported from the manifest");continue}if("identity"!==Y)continue;V&&(v=o.LevelKey.fromURL(t,G),G&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(V)>=0&&(v.method=V,v.keyFormat=Y,W&&(v.keyID=W),K&&(v.keyFormatVersions=K),v.iv=z));break;case"START":var q=new l.AttrList(x).decimalFloatingPoint("TIME-OFFSET");Object(n.isFiniteNumber)(q)&&(y.startTimeOffset=q);break;case"MAP":var Z=new l.AttrList(x);L.relurl=Z.URI,Z.BYTERANGE&&L.setByteRange(Z.BYTERANGE),L.level=r,L.sn="initSegment",v&&(L.levelkey=v),L.initSegment=null,S=L,I=!0;break;case"SERVER-CONTROL":var X=new l.AttrList(x);y.canBlockReload=X.bool("CAN-BLOCK-RELOAD"),y.canSkipUntil=X.optionalFloat("CAN-SKIP-UNTIL",0),y.canSkipDateRanges=y.canSkipUntil>0&&X.bool("CAN-SKIP-DATERANGES"),y.partHoldBack=X.optionalFloat("PART-HOLD-BACK",0),y.holdBack=X.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var J=new l.AttrList(x);y.partTarget=J.decimalFloatingPoint("PART-TARGET");break;case"PART":var Q=y.partList;Q||(Q=y.partList=[]);var $=T>0?Q[Q.length-1]:void 0,ee=T++,te=new a.Part(new l.AttrList(x),L,t,ee,$);Q.push(te),L.duration+=te.duration;break;case"PRELOAD-HINT":var re=new l.AttrList(x);y.preloadHint=re;break;case"RENDITION-REPORT":var ne=new l.AttrList(x);y.renditionReports=y.renditionReports||[],y.renditionReports.push(ne);break;default:c.logger.warn("line parsed but not handled: "+h)}}}w&&!w.relurl?(E.pop(),R-=w.duration,y.partList&&(y.fragmentHint=w)):y.partList&&(_(L,w),L.cc=A,y.fragmentHint=L);var ie=E.length,ae=E[0],se=E[ie-1];if((R+=y.skippedSegments*y.targetduration)>0&&ie&&se){y.averagetargetduration=R/ie;var oe=se.sn;y.endSN="initSegment"!==oe?oe:0,ae&&(y.startCC=ae.cc,ae.initSegment||y.fragments.every((function(e){return e.relurl&&(t=e.relurl,m.test(null!=(r=null===(n=i.parseURL(t))||void 0===n?void 0:n.path)?r:""));var t,r,n}))&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(L=new a.Fragment(u,t)).relurl=se.relurl,L.level=r,L.sn="initSegment",ae.initSegment=L,y.needSidxRanges=!0))}else y.endSN=0,y.startCC=0;return y.fragmentHint&&(R+=y.fragmentHint.duration),y.totalduration=R,y.endCC=A,C>0&&function(e,t){for(var r=e[t],n=t;n--;){var i=e[n];if(!i)return;i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(E,C),y},e}();function v(e,t){["video","audio","text"].forEach((function(r){var n=e.filter((function(e){return Object(u.isCodecType)(e,r)}));if(n.length){var i=n.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[r+"Codec"]=i.length>0?i[0]:n[0],e=e.filter((function(e){return-1===n.indexOf(e)}))}})),t.unknownCodecs=e}function y(e,t,r){var n=t[r];n&&(e[r]=n)}function _(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(n.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":
/*!***************************************!*\
    !*** ./src/loader/playlist-loader.ts ***!
    \***************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),l=r(/*! ./m3u8-parser */"./src/loader/m3u8-parser.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),u=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts");function d(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}var h=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return e.loader=i,this.loaders[e.type]=i,i},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var r=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var r=t.id,n=t.level,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:null,level:n,responseType:"text",type:c.PlaylistContextType.LEVEL,url:i,deliveryDirectives:a})},t.onAudioTrackLoading=function(e,t){var r=t.id,n=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:a})},t.onSubtitleTrackLoading=function(e,t){var r=t.id,n=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:a})},t.load=function(e){var t,r,n,i,a,o,l=this.hls.config,u=this.getInternalLoader(e);if(u){var d=u.context;if(d&&d.url===e.url)return void s.logger.trace("[playlist-loader]: playlist request ongoing");s.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),u.abort()}switch(e.type){case c.PlaylistContextType.MANIFEST:r=l.manifestLoadingMaxRetry,n=l.manifestLoadingTimeOut,i=l.manifestLoadingRetryDelay,a=l.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:r=0,n=l.levelLoadingTimeOut;break;default:r=l.levelLoadingMaxRetry,n=l.levelLoadingTimeOut,i=l.levelLoadingRetryDelay,a=l.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(e),null!==(t=e.deliveryDirectives)&&void 0!==t&&t.part&&(e.type===c.PlaylistContextType.LEVEL&&null!==e.level?o=this.hls.levels[e.level].details:e.type===c.PlaylistContextType.AUDIO_TRACK&&null!==e.id?o=this.hls.audioTracks[e.id].details:e.type===c.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(o=this.hls.subtitleTracks[e.id].details),o)){var h=o.partTarget,f=o.targetduration;h&&f&&(n=Math.min(1e3*Math.max(3*h,.8*f),n))}var p={timeout:n,maxRetry:r,retryDelay:i,maxRetryDelay:a,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(e,p,m)},t.loadsuccess=function(e,t,r,n){if(void 0===n&&(n=null),r.isSidxRequest)return this.handleSidxRequest(e,r),void this.handlePlaylistLoaded(e,t,r,n);this.resetInternalLoader(r.type);var i=e.data;0===i.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,r,n):this.handleMasterPlaylist(e,t,r,n)):this.handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},t.loaderror=function(e,t,r){void 0===r&&(r=null),this.handleNetworkError(t,r,!1,e)},t.loadtimeout=function(e,t,r){void 0===r&&(r=null),this.handleNetworkError(t,r,!0)},t.handleMasterPlaylist=function(e,t,r,n){var a=this.hls,o=e.data,c=d(e,r),h=l.default.parseMasterPlaylist(o,c),f=h.levels,p=h.sessionData;if(f.length){var m=f.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),g=f.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),v=l.default.parseMasterPlaylistMedia(o,c,"AUDIO",m),y=l.default.parseMasterPlaylistMedia(o,c,"SUBTITLES",g),_=l.default.parseMasterPlaylistMedia(o,c,"CLOSED-CAPTIONS");v.length&&(v.some((function(e){return!e.url}))||!f[0].audioCodec||f[0].attrs.AUDIO||(s.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new u.AttrList({}),bitrate:0,url:""}))),a.trigger(i.Events.MANIFEST_LOADED,{levels:f,audioTracks:v,subtitles:y,captions:_,url:c,stats:t,networkDetails:n,sessionData:p})}else this.handleManifestParsingError(e,r,"no level found in manifest",n)},t.handleTrackOrLevelPlaylist=function(e,t,r,s){var o=this.hls,h=r.id,f=r.level,p=r.type,m=d(e,r),g=Object(n.isFiniteNumber)(h)?h:0,v=Object(n.isFiniteNumber)(f)?f:g,y=function(e){switch(e.type){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}(r),_=l.default.parseLevelPlaylist(e.data,m,v,y,g);if(_.fragments.length){if(p===c.PlaylistContextType.MANIFEST){var E={attrs:new u.AttrList({}),bitrate:0,details:_,name:"",url:m};o.trigger(i.Events.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:m,stats:t,networkDetails:s,sessionData:null})}if(t.parsing.end=performance.now(),_.needSidxRanges){var S,b=null===(S=_.fragments[0].initSegment)||void 0===S?void 0:S.url;this.load({url:b,isSidxRequest:!0,type:p,level:f,levelDetails:_,id:h,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else r.levelDetails=_,this.handlePlaylistLoaded(e,t,r,s)}else o.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:m,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},t.handleSidxRequest=function(e,t){var r=Object(o.parseSegmentIndex)(new Uint8Array(e.data));if(r){var n=r.references,i=t.levelDetails;n.forEach((function(e,t){var n=e.info,a=i.fragments[t];0===a.byteRange.length&&a.setByteRange(String(1+n.end-n.start)+"@"+String(n.start)),a.initSegment&&a.initSegment.setByteRange(String(r.moovEndOffset)+"@0")}))}},t.handleManifestParsingError=function(e,t,r,n){this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===c.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:t,networkDetails:n})},t.handleNetworkError=function(e,t,r,n){void 0===r&&(r=!1),s.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var o=a.ErrorDetails.UNKNOWN,l=!1,u=this.getInternalLoader(e);switch(e.type){case c.PlaylistContextType.MANIFEST:o=r?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case c.PlaylistContextType.LEVEL:o=r?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case c.PlaylistContextType.AUDIO_TRACK:o=r?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:o=r?a.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:a.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);var d={type:a.ErrorTypes.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,networkDetails:t};n&&(d.response=n),this.hls.trigger(i.Events.ERROR,d)},t.handlePlaylistLoaded=function(e,t,r,n){var a=r.type,s=r.level,o=r.id,l=r.groupId,u=r.loader,d=r.levelDetails,h=r.deliveryDirectives;if(null!=d&&d.targetduration){if(u)switch(d.live&&(u.getCacheAge&&(d.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),a){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(i.Events.LEVEL_LOADED,{details:d,level:s||0,id:o||0,stats:t,networkDetails:n,deliveryDirectives:h});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(i.Events.AUDIO_TRACK_LOADED,{details:d,id:o||0,groupId:l||"",stats:t,networkDetails:n,deliveryDirectives:h});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADED,{details:d,id:o||0,groupId:l||"",stats:t,networkDetails:n,deliveryDirectives:h})}}else this.handleManifestParsingError(e,r,"invalid target duration",n)},e}();t.default=h},"./src/polyfills/number.ts":
/*!*********************************!*\
    !*** ./src/polyfills/number.ts ***!
    \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(e,t,r){r.r(t),r.d(t,"isFiniteNumber",(function(){return n})),r.d(t,"MAX_SAFE_INTEGER",(function(){return i}));var n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":
/*!*********************************!*\
    !*** ./src/remux/aac-helper.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();t.default=n},"./src/remux/mp4-generator.ts":
/*!************************************!*\
    !*** ./src/remux/mp4-generator.ts ***!
    \************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=Math.pow(2,32)-1,i=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t=8,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=n.length,s=a;a--;)t+=n[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(n[a],t),t+=n[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var i=Math.floor(r/(n+1)),a=Math.floor(r%(n+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,r))},e.moov=function(t){for(var r=t.length,n=[];r--;)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,r){r*=t;var i=Math.floor(r/(n+1)),a=Math.floor(r%(n+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var r,n,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var r,n,i,a=[],s=[];for(r=0;r<t.sps.length;r++)i=(n=t.sps[r]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));for(r=0;r<t.pps.length;r++)i=(n=t.pps[r]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,c=t.height,u=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,s=t.height,o=Math.floor(i/(n+1)),l=Math.floor(i%(n+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,r){var i=e.sdtp(t),a=t.id,s=Math.floor(r/(n+1)),o=Math.floor(r%(n+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,i.length+16+20+8+16+8+8),i)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var n,i,a,s,o,l,c=t.samples||[],u=c.length,d=12+16*u,h=new Uint8Array(d);for(r+=8+d,h.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),n=0;n<u;n++)a=(i=c[n]).duration,s=i.size,o=i.flags,l=i.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*n);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var r=e.moov(t),n=new Uint8Array(e.FTYP.byteLength+r.byteLength);return n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0,t.default=i},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
    !*** ./src/remux/mp4-remuxer.ts ***!
    \**********************************/
/*! exports provided: default, normalizePts */function(e,t,r){r.r(t),r.d(t,"default",(function(){return m})),r.d(t,"normalizePts",(function(){return g}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./aac-helper */"./src/remux/aac-helper.ts"),a=r(/*! ./mp4-generator */"./src/remux/mp4-generator.ts"),s=r(/*! ../events */"./src/events.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=r(/*! ../utils/logger */"./src/utils/logger.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),u=r(/*! ../utils/timescale-conversion */"./src/utils/timescale-conversion.ts");function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}var h=null,f=null,p=!1,m=function(){function e(e,t,r,n){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===h){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);h=i?parseInt(i[1]):0}if(null===f){var a=navigator.userAgent.match(/Safari\/(\d+)/i);f=a?parseInt(a[1]):0}p=!!h&&h<75||!!f&&f<600}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){l.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){l.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){l.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,r=e.reduce((function(e,r){var n=r.pts-e;return n<-4294967296?(t=!0,g(e,r.pts)):n>0?e:r.pts}),e[0].pts);return t&&l.logger.debug("PTS rollover detected"),r},t.remux=function(e,t,r,n,i,a,s,o){var u,d,h,f,p,m,v=i,y=i,_=e.pid>-1,E=t.pid>-1,S=t.samples.length,b=e.samples.length>0,T=S>1;if((!_||b)&&(!E||T)||this.ISGenerated||s){this.ISGenerated||(h=this.generateIS(e,t,i));var R=this.isVideoContiguous,A=-1;if(T&&(A=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!R&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,A>0){l.logger.warn("[mp4-remuxer]: Dropped "+A+" out of "+S+" video samples due to a missing keyframe");var w=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(A),t.dropped+=A,y+=(t.samples[0].pts-w)/(t.timescale||9e4)}else-1===A&&(l.logger.warn("[mp4-remuxer]: No keyframe found out of "+S+" video samples"),m=!1);if(this.ISGenerated){if(b&&T){var L=this.getVideoStartPts(t.samples),C=(g(e.samples[0].pts,L)-L)/t.inputTimeScale;v+=Math.max(0,C),y+=Math.max(0,-C)}if(b){if(e.samplerate||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,i)),d=this.remuxAudio(e,v,this.isAudioContiguous,a,E||T||o===c.PlaylistLevelType.AUDIO?y:void 0),T){var I=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,i)),u=this.remuxVideo(t,y,R,I)}}else T&&(u=this.remuxVideo(t,y,R,0));u&&(u.firstKeyFrame=A,u.independent=-1!==A)}}return this.ISGenerated&&(r.samples.length&&(p=this.remuxID3(r,i)),n.samples.length&&(f=this.remuxText(n,i))),{audio:d,video:u,initSegment:h,independent:m,text:f,id3:p}},t.generateIS=function(e,t,r){var i,s,o,l=e.samples,c=t.samples,u=this.typeSupported,d={},h=!Object(n.isFiniteNumber)(this._initPTS),f="audio/mp4";if(h&&(i=s=1/0),e.config&&l.length&&(e.timescale=e.samplerate,e.isAAC||(u.mpeg?(f="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3")),d.audio={id:"audio",container:f,codec:e.codec,initSegment:!e.isAAC&&u.mpeg?new Uint8Array(0):a.default.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(o=e.inputTimeScale,i=s=l[0].pts-Math.round(o*r))),t.sps&&t.pps&&c.length&&(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:a.default.initSegment([t]),metadata:{width:t.width,height:t.height}},h)){o=t.inputTimeScale;var p=this.getVideoStartPts(c),m=Math.round(o*r);s=Math.min(s,g(c[0].dts,p)-m),i=Math.min(i,p-m)}if(Object.keys(d).length)return this.ISGenerated=!0,h&&(this._initPTS=i,this._initDTS=s),{tracks:d,initPTS:i,timescale:o}},t.remuxVideo=function(e,t,r,n){var i,c,f,m=e.inputTimeScale,y=e.samples,_=[],E=y.length,S=this._initPTS,b=this.nextAvcDts,T=8,R=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,w=0,L=!1;r&&null!==b||(b=t*m-(y[0].pts-g(y[0].dts,y[0].pts)));for(var C=0;C<E;C++){var I=y[C];I.pts=g(I.pts-S,b),I.dts=g(I.dts-S,b),I.dts>I.pts&&(w=Math.max(Math.min(w,I.pts-I.dts),-18e3)),I.dts<y[C>0?C-1:C].dts&&(L=!0)}L&&y.sort((function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n})),c=y[0].dts,f=y[y.length-1].dts;var k=Math.round((f-c)/(E-1));if(w<0){if(w<-2*k){l.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(u.toMsFromMpegTsClock)(-k,!0)+" ms");for(var O=w,D=0;D<E;D++)y[D].dts=O=Math.max(O,y[D].pts-k),y[D].pts=Math.max(O,y[D].pts)}else{l.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(u.toMsFromMpegTsClock)(w,!0)+" ms to overcome this issue");for(var P=0;P<E;P++)y[P].dts=y[P].dts+w}c=y[0].dts}if(r){var x=c-b,M=x>k;if(M||x<-1){M?l.logger.warn("AVC: "+Object(u.toMsFromMpegTsClock)(x,!0)+" ms ("+x+"dts) hole between fragments detected, filling it"):l.logger.warn("AVC: "+Object(u.toMsFromMpegTsClock)(-x,!0)+" ms ("+x+"dts) overlapping between fragments detected"),c=b;var N=y[0].pts-x;y[0].dts=c,y[0].pts=N,l.logger.log("Video: First PTS/DTS adjusted: "+Object(u.toMsFromMpegTsClock)(N,!0)+"/"+Object(u.toMsFromMpegTsClock)(c,!0)+", delta: "+Object(u.toMsFromMpegTsClock)(x,!0)+" ms")}}p&&(c=Math.max(0,c));for(var F=0,U=0,B=0;B<E;B++){for(var j=y[B],H=j.units,V=H.length,G=0,z=0;z<V;z++)G+=H[z].data.length;U+=G,F+=V,j.length=G,j.dts=Math.max(j.dts,c),j.pts=Math.max(j.pts,j.dts,0),R=Math.min(j.pts,R),A=Math.max(j.pts,A)}f=y[E-1].dts;var K,W=U+4*F+8;try{K=new Uint8Array(W)}catch(pL){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:W,reason:"fail allocating video mdat "+W})}var Y=new DataView(K.buffer);Y.setUint32(0,W),K.set(a.default.types.mdat,4);for(var q=0;q<E;q++){for(var Z=y[q],X=Z.units,J=0,Q=0,$=X.length;Q<$;Q++){var ee=X[Q],te=ee.data,re=ee.data.byteLength;Y.setUint32(T,re),T+=4,K.set(te,T),T+=re,J+=4+re}if(q<E-1)i=y[q+1].dts-Z.dts;else{var ne=this.config,ie=Z.dts-y[q>0?q-1:q].dts;if(ne.stretchShortVideoTrack&&null!==this.nextAudioPts){var ae=Math.floor(ne.maxBufferHole*m),se=(n?R+n*m:this.nextAudioPts)-Z.pts;se>ae?((i=se-ie)<0&&(i=ie),l.logger.log("[mp4-remuxer]: It is approximately "+se/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=ie}else i=ie}var oe=Math.round(Z.pts-Z.dts);_.push(new v(Z.key,i,J,oe))}if(_.length&&h&&h<70){var le=_[0].flags;le.dependsOn=2,le.isNonSync=0}console.assert(void 0!==i,"mp4SampleDuration must be computed"),this.nextAvcDts=b=f+i,this.isVideoContiguous=!0;var ce={data1:a.default.moof(e.sequenceNumber++,c,d({},e,{samples:_})),data2:K,startPTS:R/m,endPTS:(A+i)/m,startDTS:c/m,endDTS:b/m,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(K.length,"MDAT length must not be zero"),ce},t.remuxAudio=function(e,t,r,n,c){var u=e.inputTimeScale,h=u/(e.samplerate?e.samplerate:u),f=e.isAAC?1024:1152,p=f*h,m=this._initPTS,y=!e.isAAC&&this.typeSupported.mpeg,_=[],E=e.samples,S=y?0:8,b=this.nextAudioPts||-1,T=t*u;if(this.isAudioContiguous=r=r||E.length&&b>0&&(n&&Math.abs(T-b)<9e3||Math.abs(g(E[0].pts-m,T)-b)<20*p),E.forEach((function(e){e.pts=g(e.pts-m,T)})),!r||b<0){if(E=E.filter((function(e){return e.pts>=0})),!E.length)return;b=0===c?0:n?Math.max(0,T):E[0].pts}if(e.isAAC)for(var R=void 0!==c,A=this.config.maxAudioFramesDrift,w=0,L=b;w<E.length;w++){var C=E[w],I=C.pts,k=I-L,O=Math.abs(1e3*k/u);if(k<=-A*p&&R)0===w&&(l.logger.warn("Audio frame @ "+(I/u).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*k/u)+" ms."),this.nextAudioPts=b=L=I);else if(k>=A*p&&O<1e4&&R){var D=Math.round(k/p);(L=I-D*p)<0&&(D--,L+=p),0===w&&(this.nextAudioPts=b=L),l.logger.warn("[mp4-remuxer]: Injecting "+D+" audio frame @ "+(L/u).toFixed(3)+"s due to "+Math.round(1e3*k/u)+" ms gap.");for(var P=0;P<D;P++){var x=Math.max(L,0),M=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);M||(l.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),M=C.unit.subarray()),E.splice(w,0,{unit:M,pts:x}),L+=p,w++}}C.pts=L,L+=p}for(var N,F=null,U=null,B=0,j=E.length;j--;)B+=E[j].unit.byteLength;for(var H=0,V=E.length;H<V;H++){var G=E[H],z=G.unit,K=G.pts;if(null!==U)_[H-1].duration=Math.round((K-U)/h);else{if(r&&e.isAAC&&(K=b),F=K,!(B>0))return;B+=S;try{N=new Uint8Array(B)}catch(pL){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating audio mdat "+B})}y||(new DataView(N.buffer).setUint32(0,B),N.set(a.default.types.mdat,4))}N.set(z,S);var W=z.byteLength;S+=W,_.push(new v(!0,f,W,0)),U=K}var Y=_.length;if(Y){var q=_[_.length-1];this.nextAudioPts=b=U+h*q.duration;var Z=y?new Uint8Array(0):a.default.moof(e.sequenceNumber++,F/h,d({},e,{samples:_}));e.samples=[];var X=F/u,J=b/u,Q={data1:Z,data2:N,startPTS:X,endPTS:J,startDTS:X,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:Y};return this.isAudioContiguous=!0,console.assert(N.length,"MDAT length must not be zero"),Q}},t.remuxEmptyAudio=function(e,t,r,n){var a=e.inputTimeScale,s=a/(e.samplerate?e.samplerate:a),o=this.nextAudioPts,c=(null!==o?o:n.startDTS*a)+this._initDTS,u=n.endDTS*a+this._initDTS,d=1024*s,h=Math.ceil((u-c)/d),f=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(l.logger.warn("[mp4-remuxer]: remux empty Audio"),f){for(var p=[],m=0;m<h;m++){var g=c+m*d;p.push({unit:f,pts:g,dts:g})}return e.samples=p,this.remuxAudio(e,t,r,!1)}l.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t.remuxID3=function(e,t){var r=e.samples.length;if(r){for(var n=e.inputTimeScale,i=this._initPTS,a=this._initDTS,s=0;s<r;s++){var o=e.samples[s];o.pts=g(o.pts-i,t*n)/n,o.dts=g(o.dts-a,t*n)/n}var l=e.samples;return e.samples=[],{samples:l}}},t.remuxText=function(e,t){var r=e.samples.length;if(r){for(var n=e.inputTimeScale,i=this._initPTS,a=0;a<r;a++){var s=e.samples[a];s.pts=g(s.pts-i,t*n)/n}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}},e}();function g(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}var v=function(e,t,r,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=n,this.flags=new y(e)},y=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":
/*!******************************************!*\
    !*** ./src/remux/passthrough-remuxer.ts ***!
    \******************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),a=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndDTS=null},t.resetNextTimestamp=function(){this.lastEndDTS=null},t.resetInitSegment=function(e,t,r){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=Object(i.parseInitSegment)(e);t||(t=c(n.audio,a.ElementaryStreamTypes.AUDIO)),r||(r=c(n.video,a.ElementaryStreamTypes.VIDEO));var o={};n.audio&&n.video?o.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:n.audio?o.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?o.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:s.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},t.remux=function(e,t,r,a,o){var c=this.initPTS,u=this.lastEndDTS,d={audio:void 0,video:void 0,text:a,id3:r,initSegment:void 0};Object(n.isFiniteNumber)(u)||(u=this.lastEndDTS=o||0);var h=t.samples;if(!h||!h.length)return d;var f={initPTS:void 0,timescale:1},p=this.initData;if(p&&p.length||(this.generateInitSegment(h),p=this.initData),!p||!p.length)return s.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(n.isFiniteNumber)(c)||(this.initPTS=f.initPTS=c=l(p,h,u));var m=Object(i.getDuration)(h,p),g=u,v=m+g;Object(i.offsetStartDTS)(p,h,c),m>0?this.lastEndDTS=v:(s.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!p.audio,_=!!p.video,E="";y&&(E+="audio"),_&&(E+="video");var S={data1:h,startPTS:g,startDTS:g,endPTS:v,endDTS:v,type:E,hasAudio:y,hasVideo:_,nb:1,dropped:0};return d.audio="audio"===S.type?S:void 0,d.video="audio"!==S.type?S:void 0,d.text=a,d.id3=r,d.initSegment=f,d},e}(),l=function(e,t,r){return Object(i.getStartDTS)(e,t)-r};function c(e,t){var r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r?"hvc1.1.c.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===a.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}t.default=o},"./src/task-loop.ts":
/*!**************************!*\
    !*** ./src/task-loop.ts ***!
    \**************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return n}));var n=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}()},"./src/types/cmcd.ts":
/*!***************************!*\
    !*** ./src/types/cmcd.ts ***!
    \***************************/
/*! exports provided: CMCDVersion, CMCDObjectType, CMCDStreamingFormat, CMCDStreamType */function(e,t,r){r.r(t),r.d(t,"CMCDVersion",(function(){return s})),r.d(t,"CMCDObjectType",(function(){return n})),r.d(t,"CMCDStreamingFormat",(function(){return i})),r.d(t,"CMCDStreamType",(function(){return a}));var n,i,a,s=1;!function(e){e.MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o"}(n||(n={})),function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"}(i||(i={})),function(e){e.VOD="v",e.LIVE="l"}(a||(a={}))},"./src/types/level.ts":
/*!****************************!*\
    !*** ./src/types/level.ts ***!
    \****************************/
/*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i;function a(e,t){var r=e.canSkipUntil,n=e.canSkipDateRanges,a=e.endSN;return r&&(void 0!==t?t-a:0)<r?n?i.v2:i.Yes:i.No}r.r(t),r.d(t,"HlsSkip",(function(){return i})),r.d(t,"getSkipValue",(function(){return a})),r.d(t,"HlsUrlParameters",(function(){return s})),r.d(t,"Level",(function(){return o})),function(e){e.No="",e.Yes="YES",e.v2="v2"}(i||(i={}));var s=function(){function e(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},e}(),o=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}]),e}()},"./src/types/loader.ts":
/*!*****************************!*\
    !*** ./src/types/loader.ts ***!
    \*****************************/
/*! exports provided: PlaylistContextType, PlaylistLevelType */function(e,t,r){var n,i;r.r(t),r.d(t,"PlaylistContextType",(function(){return n})),r.d(t,"PlaylistLevelType",(function(){return i})),function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(n||(n={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(i||(i={}))},"./src/types/transmuxer.ts":
/*!*********************************!*\
    !*** ./src/types/transmuxer.ts ***!
    \*********************************/
/*! exports provided: ChunkMetadata */function(e,t,r){r.r(t),r.d(t,"ChunkMetadata",(function(){return n}));var n=function(e,t,r,n,i,a){void 0===n&&(n=0),void 0===i&&(i=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i,this.partial=a}},"./src/utils/attr-list.ts":
/*!********************************!*\
    !*** ./src/utils/attr-list.ts ***!
    \********************************/
/*! exports provided: AttrList */function(e,t,r){r.r(t),r.d(t,"AttrList",(function(){return a}));var n=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function e(t){for(var r in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=n.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,r={};for(i.lastIndex=0;null!==(t=i.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},e}()},"./src/utils/binary-search.ts":
/*!************************************!*\
    !*** ./src/utils/binary-search.ts ***!
    \************************************/
/*! exports provided: default */function(e,t,r){r.r(t),t.default={search:function(e,t){for(var r=0,n=e.length-1,i=null,a=null;r<=n;){var s=t(a=e[i=(r+n)/2|0]);if(s>0)r=i+1;else{if(!(s<0))return a;n=i-1}}return null}}},"./src/utils/buffer-helper.ts":
/*!************************************!*\
    !*** ./src/utils/buffer-helper.ts ***!
    \************************************/
/*! exports provided: BufferHelper */function(e,t,r){r.r(t),r.d(t,"BufferHelper",(function(){return a}));var n=r(/*! ./logger */"./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function e(){}return e.isBuffered=function(t,r){try{if(t)for(var n=e.getBuffered(t),i=0;i<n.length;i++)if(r>=n.start(i)&&r<=n.end(i))return!0}catch(Wk){}return!1},e.bufferInfo=function(t,r,n){try{if(t){var i,a=e.getBuffered(t),s=[];for(i=0;i<a.length;i++)s.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(s,r,n)}}catch(Wk){}return{len:0,start:r,end:r,nextStart:void 0}},e.bufferedInfo=function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){var r=e.start-t.start;return r||t.end-e.end}));var n=[];if(r)for(var i=0;i<e.length;i++){var a=n.length;if(a){var s=n[a-1].end;e[i].start-s<r?e[i].end>s&&(n[a-1].end=e[i].end):n.push(e[i])}else n.push(e[i])}else n=e;for(var o,l=0,c=t,u=t,d=0;d<n.length;d++){var h=n[d].start,f=n[d].end;if(t+r>=h&&t<f)c=h,l=(u=f)-t;else if(t+r<h){o=h;break}}return{len:l,start:c||0,end:u||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(t){return n.logger.log("failed to get media.buffered",t),i}},e}()},"./src/utils/cea-608-parser.ts":
/*!*************************************!*\
    !*** ./src/utils/cea-608-parser.ts ***!
    \*************************************/
/*! exports provided: Row, CaptionScreen, default */function(e,t,r){r.r(t),r.d(t,"Row",(function(){return y})),r.d(t,"CaptionScreen",(function(){return _}));var n,i=r(/*! ../utils/logger */"./src/utils/logger.ts"),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function(e){var t=e;return a.hasOwnProperty(e)&&(t=a[e]),String.fromCharCode(t)},o=15,l=100,c={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},f=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(n||(n={}));var p=function(){function e(){this.time=null,this.verboseLevel=n.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&i.logger.log(this.time+" ["+e+"] "+t)},e}(),m=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},g=function(){function e(e,t,r,n,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),v=function(){function e(e,t,r,n,i,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new g(t,r,n,i,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),y=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<l;t++)this.chars.push(new v);this.logger=e,this.pos=0,this.currPenState=new g}var t=e.prototype;return t.equals=function(e){for(var t=!0,r=0;r<l;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(n.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(this.logger.log(n.DEBUG,"Too large cursor position "+this.pos),this.pos=l)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=s(e);this.pos>=l?this.logger.log(n.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,r=0;r<l;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),_=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<o;t++)this.rows.push(new y(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<o;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,r=0;r<o;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<o;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<o;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(n.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(n.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<o;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var s=a.rows[i].cueStartTime,l=this.logger.time;if(s&&null!==l&&s<l)for(var c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[i+c])}}this.currRow=t;var u=this.rows[this.currRow];if(null!==e.indent){var d=e.indent,h=Math.max(d-1,0);u.setCursor(e.indent),e.color=u.chars[h].penState.foreground}var f={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(f)},t.setBkgData=function(e){this.logger.log(n.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(n.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(n.INFO,"Rolling up")}else this.logger.log(n.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],r="",n=-1,i=0;i<o;i++){var a=this.rows[i].getTextString();a&&(n=i+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},t.getTextAndFormat=function(){return this.rows},e}(),E=function(){function e(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new _(r),this.nonDisplayedMemory=new _(r),this.lastOutputScreen=new _(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(n.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(n.INFO,r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(n.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(n.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(n.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(n.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(n.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(n.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(n.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(n.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(n.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(n.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(n.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(n.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(n.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(n.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(n.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(n.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),S=function(){function e(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new p;this.channels=[null,new E(e,t,n),new E(e+1,r,n)],this.cmdHistory={a:null,b:null},this.logger=n}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var r,i,a,s=!1;this.logger.time=e;for(var o=0;o<t.length;o+=2)if(i=127&t[o],a=127&t[o+1],0!==i||0!==a){if(this.logger.log(n.DATA,"["+m([t[o],t[o+1]])+"] -> ("+m([i,a])+")"),(r=this.parseCmd(i,a))||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(s=this.parseChars(i,a))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(s):this.logger.log(n.WARNING,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(n.WARNING,"Couldn't parse cleaned data "+m([i,a])+" orig: "+m([t[o],t[o+1]]))}},t.parseCmd=function(e,t){var r=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(T(e,t,r))return b(null,null,r),this.logger.log(n.DEBUG,"Repeated command ("+m([e,t])+") is dropped"),!0;var i=20===e||21===e||23===e?1:2,a=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),b(e,t,r),this.currentChannel=i,!0},t.parseMidrow=function(e,t){var r=0;if((17===e||25===e)&&t>=32&&t<=47){if((r=17===e?1:2)!==this.currentChannel)return this.logger.log(n.ERROR,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(n.DEBUG,"MIDROW ("+m([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var r,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(T(e,t,n))return b(null,null,n),!0;var i=e<=23?1:2;r=t>=64&&t<=95?1===i?c[e]:d[e]:1===i?u[e]:h[e];var a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(r,t)),b(e,t,n),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},t.parseChars=function(e,t){var r,i,a=null,o=null;if(e>=25?(r=2,o=e-8):(r=1,o=e),o>=17&&o<=19?(i=17===o?t+80:18===o?t+112:t+144,this.logger.log(n.INFO,"Special char '"+s(i)+"' in channel "+r),a=[i]):e>=32&&e<=127&&(a=0===t?[e]:[e,t]),a){var l=m(a);this.logger.log(n.DEBUG,"Char codes =  "+l.join(",")),b(e,t,this.cmdHistory)}return a},t.parseBackgroundAttributes=function(e,t){var r;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var n={};16===e||24===e?(r=Math.floor((t-32)/2),n.background=f[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(n),b(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},e}();function b(e,t,r){r.a=e,r.b=t}function T(e,t,r){return r.a===e&&r.b===t}t.default=S},"./src/utils/codecs.ts":
/*!*****************************!*\
    !*** ./src/utils/codecs.ts ***!
    \*****************************/
/*! exports provided: isCodecType, isCodecSupportedInMp4 */function(e,t,r){r.r(t),r.d(t,"isCodecType",(function(){return i})),r.d(t,"isCodecSupportedInMp4",(function(){return a}));var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(e,t){var r=n[t];return!!r&&!0===r[e.slice(0,4)]}function a(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.ts":
/*!***************************!*\
    !*** ./src/utils/cues.ts ***!
    \***************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ./vttparser */"./src/utils/vttparser.ts"),i=r(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts"),a=r(/*! ./texttrack-utils */"./src/utils/texttrack-utils.ts"),s=/\s/,o={newCue:function(e,t,r,o){for(var l,c,u,d,h,f=[],p=self.VTTCue||self.TextTrackCue,m=0;m<o.rows.length;m++)if(u=!0,d=0,h="",!(l=o.rows[m]).isEmpty()){for(var g=0;g<l.chars.length;g++)s.test(l.chars[g].uchar)&&u?d++:(h+=l.chars[g].uchar,u=!1);l.cueStartTime=t,t===r&&(r+=1e-4),d>=16?d--:d++;var v=Object(n.fixLineBreaks)(h.trim()),y=Object(i.generateCueId)(t,r,v);e&&e.cues&&e.cues.getCueById(y)||((c=new p(t,r,v)).id=y,c.line=m+1,c.align="left",c.position=10+Math.min(80,10*Math.floor(8*d/32)),f.push(c))}return e&&f.length&&(f.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),f.forEach((function(t){return Object(a.addCueToTrack)(e,t)}))),f}};t.default=o},"./src/utils/discontinuities.ts":
/*!**************************************!*\
    !*** ./src/utils/discontinuities.ts ***!
    \**************************************/
/*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT, alignFragmentByPDTDelta, alignMediaPlaylistByPDT */function(e,t,r){r.r(t),r.d(t,"findFirstFragWithCC",(function(){return s})),r.d(t,"shouldAlignOnDiscontinuities",(function(){return o})),r.d(t,"findDiscontinuousReferenceFrag",(function(){return l})),r.d(t,"adjustSlidingStart",(function(){return u})),r.d(t,"alignStream",(function(){return d})),r.d(t,"alignPDT",(function(){return h})),r.d(t,"alignFragmentByPDTDelta",(function(){return f})),r.d(t,"alignMediaPlaylistByPDT",(function(){return p}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./logger */"./src/utils/logger.ts"),a=r(/*! ../controller/level-helper */"./src/controller/level-helper.ts");function s(e,t){for(var r=null,n=0,i=e.length;n<i;n++){var a=e[n];if(a&&a.cc===t){r=a;break}}return r}function o(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}function l(e,t){var r=e.fragments,n=t.fragments;if(n.length&&r.length){var a=s(r,n[0].cc);if(a&&(!a||a.startPTS))return a;i.logger.log("No frag in previous level to align on")}else i.logger.log("No fragments to align")}function c(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function u(e,t){for(var r=t.fragments,n=0,i=r.length;n<i;n++)c(r[n],e);t.fragmentHint&&c(t.fragmentHint,e),t.alignedSliding=!0}function d(e,t,r){t&&(function(e,t,r){if(o(e,r,t)){var a=l(r.details,t);a&&Object(n.isFiniteNumber)(a.start)&&(i.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),u(a.start,t))}}(e,r,t),!r.alignedSliding&&t.details&&h(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||Object(a.adjustSliding)(t.details,r))}function h(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime,a=e.fragments[0].programDateTime,s=(a-r)/1e3+t.fragments[0].start;s&&Object(n.isFiniteNumber)(s)&&(i.logger.log("Adjusting PTS using programDateTime delta "+(a-r)+"ms, sliding:"+s.toFixed(3)+" "+e.url+" "),u(s,e))}}function f(e,t){var r=e.programDateTime;if(r){var n=(r-t)/1e3;e.start=e.startPTS=n,e.endPTS=n+e.duration}}function p(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime-1e3*t.fragments[0].start;e.fragments.forEach((function(e){f(e,r)})),e.fragmentHint&&f(e.fragmentHint,r),e.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":
/*!***********************************************!*\
    !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
    \***********************************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../utils/ewma */"./src/utils/ewma.ts"),i=function(){function e(e,t,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(e),this.fast_=new n.default(t)}var t=e.prototype;return t.update=function(e,t){var r=this.slow_,i=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new n.default(e,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new n.default(t,i.getEstimate(),i.getTotalWeight()))},t.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();t.default=i},"./src/utils/ewma.ts":
/*!***************************!*\
    !*** ./src/utils/ewma.ts ***!
    \***************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}();t.default=n},"./src/utils/fetch-loader.ts":
/*!***********************************!*\
    !*** ./src/utils/fetch-loader.ts ***!
    \***********************************/
/*! exports provided: fetchSupported, default */function(e,t,r){r.r(t),r.d(t,"fetchSupported",(function(){return d}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),a=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return o(e,arguments,c(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,e)},s(e)}function o(e,t,r){return o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&l(i,r.prototype),i},o.apply(null,arguments)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)}function d(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var h=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||f,this.controller=new self.AbortController,this.stats=new i.LoadStats}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,r){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var s=function(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(u({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}(e,this.controller.signal),o=r.onProgress,l="arraybuffer"===e.responseType,c=l?"byteLength":"length";this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){i.abortInternal(),r.onTimeout(a,e,i.response)}),t.timeout),self.fetch(this.request).then((function(r){if(i.response=i.loader=r,!r.ok){var s=r.status,c=r.statusText;throw new p(c||"fetch, bad network response",s,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),o&&Object(n.isFiniteNumber)(t.highWaterMark)?i.loadProgressively(r,a,e,t.highWaterMark,o):l?r.arrayBuffer():r.text()})).then((function(s){var l=i.response;self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=s[c];var u={url:l.url,data:s};o&&!Object(n.isFiniteNumber)(t.highWaterMark)&&o(a,e,s,l),r.onSuccess(u,a,e,l)})).catch((function(t){if(self.clearTimeout(i.requestTimeout),!a.aborted){var n=t.code||0;r.onError({code:n,text:t.message},e,t.details)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.loadProgressively=function(e,t,r,n,i){void 0===n&&(n=0);var s=new a.default,o=e.body.getReader();return function a(){return o.read().then((function(o){if(o.done)return s.dataLength&&i(t,r,s.flush(),e),Promise.resolve(new ArrayBuffer(0));var l=o.value,c=l.length;return t.loaded+=c,c<n||s.dataLength?(s.push(l),s.dataLength>=n&&i(t,r,s.flush(),e)):i(t,r,l,e),a()})).catch((function(){return Promise.reject()}))}()},e}();function f(e,t){return new self.Request(e.url,t)}var p=function(e){var t,r;function n(t,r,n){var i;return(i=e.call(this,t)||this).code=void 0,i.details=void 0,i.code=r,i.details=n,i}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,l(t,r),n}(s(Error));t.default=h},"./src/utils/imsc1-ttml-parser.ts":
/*!****************************************!*\
    !*** ./src/utils/imsc1-ttml-parser.ts ***!
    \****************************************/
/*! exports provided: IMSC1_CODEC, parseIMSC1 */function(e,t,r){r.r(t),r.d(t,"IMSC1_CODEC",(function(){return u})),r.d(t,"parseIMSC1",(function(){return p}));var n=r(/*! ./mp4-tools */"./src/utils/mp4-tools.ts"),i=r(/*! ./vttparser */"./src/utils/vttparser.ts"),a=r(/*! ./vttcue */"./src/utils/vttcue.ts"),s=r(/*! ../demux/id3 */"./src/demux/id3.ts"),o=r(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),l=r(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts");function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c.apply(this,arguments)}var u="stpp.ttml.im1t",d=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,f={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(e,t,r,i,u){var d=Object(n.findBox)(new Uint8Array(e),["mdat"]);if(0!==d.length){var h=d[0],p=Object(s.utf8ArrayToStr)(new Uint8Array(e,h.start,h.end-h.start)),S=Object(o.toTimescaleFromScale)(t,1,r);try{i(function(e,t){var r=new DOMParser,n=r.parseFromString(e,"text/xml"),i=n.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");var s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((function(e,t){return e[t]=i.getAttribute("ttp:"+t)||s[t],e}),{}),u="preserve"!==i.getAttribute("xml:space"),d=g(m(i,"styling","style")),h=g(m(i,"layout","region")),p=m(i,"body","[begin]");return[].map.call(p,(function(e){var r=v(e,u);if(!r||!e.hasAttribute("begin"))return null;var n=E(e.getAttribute("begin"),o),i=E(e.getAttribute("dur"),o),s=E(e.getAttribute("end"),o);if(null===n)throw _(e);if(null===s){if(null===i)throw _(e);s=n+i}var p=new a.default(n-t,s-t,r);p.id=Object(l.generateCueId)(p.startTime,p.endTime,p.text);var m=h[e.getAttribute("region")],g=d[e.getAttribute("style")];p.position=10,p.size=80;var S=function(e,t){var r="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(n,i){var a=y(t,r,i)||y(e,r,i);return a&&(n[i]=a),n}),{})}(m,g),b=S.textAlign;if(b){var T=f[b];T&&(p.lineAlign=T),p.align=b}return c(p,S),p})).filter((function(e){return null!==e}))}(p,S))}catch(Wk){u(Wk)}}else u(new Error("Could not parse IMSC1 mdat"))}function m(e,t,r){var n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function g(e){return e.reduce((function(e,t){var r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function v(e,t){return[].slice.call(e.childNodes).reduce((function(e,r,n){var i;return"br"===r.nodeName&&n?e+"\n":null!==(i=r.childNodes)&&void 0!==i&&i.length?v(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function y(e,t,r){return e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function _(e){return new Error("Could not parse ttml timestamp "+e)}function E(e,t){if(!e)return null;var r=Object(i.parseTimeStamp)(e);return null===r&&(d.test(e)?r=function(e,t){var r=d.exec(e),n=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/t.frameRate}(e,t):h.test(e)&&(r=function(e,t){var r=h.exec(e),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),r}},"./src/utils/logger.ts":
/*!*****************************!*\
    !*** ./src/utils/logger.ts ***!
    \*****************************/
/*! exports provided: enableLogs, logger */function(e,t,r){r.r(t),r.d(t,"enableLogs",(function(){return o})),r.d(t,"logger",(function(){return l}));var n=function(){},i={trace:n,debug:n,log:n,warn:n,info:n,error:n},a=i;function s(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach((function(t){a[t]=e[t]?e[t].bind(e):function(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):n}(t)}))}function o(e){if(self.console&&!0===e||"object"==typeof e){s(e,"debug","log","info","warn","error");try{a.log()}catch(t){a=i}}else a=i}var l=i},"./src/utils/mediakeys-helper.ts":
/*!***************************************!*\
    !*** ./src/utils/mediakeys-helper.ts ***!
    \***************************************/
/*! exports provided: KeySystems, requestMediaKeySystemAccess */function(e,t,r){var n;r.r(t),r.d(t,"KeySystems",(function(){return n})),r.d(t,"requestMediaKeySystemAccess",(function(){return i})),function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(n||(n={}));var i="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
    !*** ./src/utils/mediasource-helper.ts ***!
    \*****************************************/
/*! exports provided: getMediaSource */function(e,t,r){function n(){return self.MediaSource||self.WebKitMediaSource}r.r(t),r.d(t,"getMediaSource",(function(){return n}))},"./src/utils/mp4-tools.ts":
/*!********************************!*\
    !*** ./src/utils/mp4-tools.ts ***!
    \********************************/
/*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */function(e,t,r){r.r(t),r.d(t,"bin2str",(function(){return o})),r.d(t,"readUint16",(function(){return l})),r.d(t,"readUint32",(function(){return c})),r.d(t,"writeUint32",(function(){return u})),r.d(t,"findBox",(function(){return d})),r.d(t,"parseSegmentIndex",(function(){return h})),r.d(t,"parseInitSegment",(function(){return f})),r.d(t,"getStartDTS",(function(){return p})),r.d(t,"getDuration",(function(){return m})),r.d(t,"computeRawDurationFromSamples",(function(){return g})),r.d(t,"offsetStartDTS",(function(){return v})),r.d(t,"segmentValidRange",(function(){return y})),r.d(t,"appendUint8Array",(function(){return _}));var n=r(/*! ./typed-array */"./src/utils/typed-array.ts"),i=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),a=Math.pow(2,32)-1,s=[].push;function o(e){return String.fromCharCode.apply(null,e)}function l(e,t){"data"in e&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function c(e,t){"data"in e&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r}function u(e,t,r){"data"in e&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function d(e,t){var r,n,i,a=[];if(!t.length)return a;"data"in e?(r=e.data,n=e.start,i=e.end):(n=0,i=(r=e).byteLength);for(var l=n;l<i;){var u=c(r,l),h=u>1?l+u:i;if(o(r.subarray(l+4,l+8))===t[0])if(1===t.length)a.push({data:r,start:l+8,end:h});else{var f=d({data:r,start:l+8,end:h},t.slice(1));f.length&&s.apply(a,f)}l=h}return a}function h(e){var t=d(e,["moov"])[0],r=t?t.end:null,n=d(e,["sidx"]);if(!n||!n[0])return null;var i=[],a=n[0],s=a.data[0],o=0===s?8:16,u=c(a,o);o+=4,o+=0===s?8:16,o+=2;var h=a.end+0,f=l(a,o);o+=2;for(var p=0;p<f;p++){var m=o,g=c(a,m);m+=4;var v=2147483647&g;if(1==(2147483648&g)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var y=c(a,m);m+=4,i.push({referenceSize:v,subsegmentDuration:y,info:{duration:y/u,start:h,end:h+v-1}}),h+=v,o=m+=4}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:f,references:i,moovEndOffset:r}}function f(e){for(var t=[],r=d(e,["moov","trak"]),n=0;n<r.length;n++){var a=r[n],s=d(a,["tkhd"])[0];if(s){var l=s.data[s.start],u=0===l?12:20,h=c(s,u),f=d(a,["mdia","mdhd"])[0];if(f){var p=c(f,u=0===(l=f.data[f.start])?12:20),m=d(a,["mdia","hdlr"])[0];if(m){var g=o(m.data.subarray(m.start+8,m.start+12)),v={soun:i.ElementaryStreamTypes.AUDIO,vide:i.ElementaryStreamTypes.VIDEO}[g];if(v){var y=d(a,["mdia","minf","stbl","stsd"])[0],_=void 0;y&&(_=o(y.data.subarray(y.start+12,y.start+16))),t[h]={timescale:p,type:v},t[v]={timescale:p,id:h,codec:_}}}}}}return d(e,["moov","mvex","trex"]).forEach((function(e){var r=c(e,4),n=t[r];n&&(n.default={duration:c(e,12),flags:c(e,20)})})),t}function p(e,t){return d(t,["moof","traf"]).reduce((function(t,r){var n=d(r,["tfdt"])[0],i=n.data[n.start],a=d(r,["tfhd"]).reduce((function(t,r){var a=c(r,4),s=e[a];if(s){var o=c(n,4);1===i&&(o*=Math.pow(2,32),o+=c(n,8));var l=o/(s.timescale||9e4);if(isFinite(l)&&(null===t||l<t))return l}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)||0}function m(e,t){for(var r=0,n=0,a=0,s=d(e,["moof","traf"]),o=0;o<s.length;o++){var l=s[o],u=d(l,["tfhd"])[0],f=t[c(u,4)];if(f){var p=f.default,m=c(u,0)|(null==p?void 0:p.flags),v=null==p?void 0:p.duration;8&m&&(v=c(u,2&m?12:8));for(var y=f.timescale||9e4,_=d(l,["trun"]),E=0;E<_.length;E++)!(r=g(_[E]))&&v&&(r=v*c(_[E],4)),f.type===i.ElementaryStreamTypes.VIDEO?n+=r/y:f.type===i.ElementaryStreamTypes.AUDIO&&(a+=r/y)}}if(0===n&&0===a){var S=h(e);if(null!=S&&S.references)return S.references.reduce((function(e,t){return e+t.info.duration||0}),0)}return n||a}function g(e){var t=c(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var n=0,i=c(e,4),a=0;a<i;a++)256&t&&(n+=c(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return n}function v(e,t,r){d(t,["moof","traf"]).forEach((function(t){d(t,["tfhd"]).forEach((function(n){var i=c(n,4),s=e[i];if(s){var o=s.timescale||9e4;d(t,["tfdt"]).forEach((function(e){var t=e.data[e.start],n=c(e,4);if(0===t)u(e,4,n-r*o);else{n*=Math.pow(2,32),n+=c(e,8),n-=r*o,n=Math.max(n,0);var i=Math.floor(n/(a+1)),s=Math.floor(n%(a+1));u(e,4,i),u(e,8,s)}}))}}))}))}function y(e){var t={valid:null,remainder:null},r=d(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;var i=r[r.length-1];return t.valid=Object(n.sliceUint8)(e,0,i.start-8),t.remainder=Object(n.sliceUint8)(e,i.start-8),t}function _(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}},"./src/utils/output-filter.ts":
/*!************************************!*\
    !*** ./src/utils/output-filter.ts ***!
    \************************************/
/*! exports provided: default */function(e,t,r){r.r(t),r.d(t,"default",(function(){return n}));var n=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":
/*!**************************************!*\
    !*** ./src/utils/texttrack-utils.ts ***!
    \**************************************/
/*! exports provided: sendAddTrackEvent, addCueToTrack, clearCurrentCues, removeCuesInRange, getCuesInRange */function(e,t,r){r.r(t),r.d(t,"sendAddTrackEvent",(function(){return i})),r.d(t,"addCueToTrack",(function(){return a})),r.d(t,"clearCurrentCues",(function(){return s})),r.d(t,"removeCuesInRange",(function(){return o})),r.d(t,"getCuesInRange",(function(){return l}));var n=r(/*! ./logger */"./src/utils/logger.ts");function i(e,t){var r;try{r=new Event("addtrack")}catch(pL){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function a(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(pL){n.logger.debug("[texttrack-utils]: "+pL);var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===r&&(e.mode=r)}function s(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function o(e,t,r){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var i=l(e.cues,t,r),a=0;a<i.length;a++)e.removeCue(i[a]);"disabled"===n&&(e.mode=n)}function l(e,t,r){var n=[],i=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;for(var n=0,i=r;n<=i;){var a=Math.floor((i+n)/2);if(t<e[a].startTime)i=a-1;else{if(!(t>e[a].startTime&&n<r))return a;n=a+1}}return e[n].startTime-t<t-e[i].startTime?n:i}(e,t);if(i>-1)for(var a=i,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=r)n.push(o);else if(o.startTime>r)return n}return n}},"./src/utils/time-ranges.ts":
/*!**********************************!*\
    !*** ./src/utils/time-ranges.ts ***!
    \**********************************/
/*! exports provided: default */function(e,t,r){r.r(t),t.default={toString:function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}}},"./src/utils/timescale-conversion.ts":
/*!*******************************************!*\
    !*** ./src/utils/timescale-conversion.ts ***!
    \*******************************************/
/*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */function(e,t,r){r.r(t),r.d(t,"toTimescaleFromBase",(function(){return i})),r.d(t,"toTimescaleFromScale",(function(){return a})),r.d(t,"toMsFromMpegTsClock",(function(){return s})),r.d(t,"toMpegTsClockFromTimescale",(function(){return o}));var n=9e4;function i(e,t,r,n){void 0===r&&(r=1),void 0===n&&(n=!1);var i=e*t*r;return n?Math.round(i):i}function a(e,t,r,n){return void 0===r&&(r=1),void 0===n&&(n=!1),i(e,t,1/r,n)}function s(e,t){return void 0===t&&(t=!1),i(e,1e3,1/n,t)}function o(e,t){return void 0===t&&(t=1),i(e,n,1/t)}},"./src/utils/typed-array.ts":
/*!**********************************!*\
    !*** ./src/utils/typed-array.ts ***!
    \**********************************/
/*! exports provided: sliceUint8 */function(e,t,r){function n(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}r.r(t),r.d(t,"sliceUint8",(function(){return n}))},"./src/utils/vttcue.ts":
/*!*****************************!*\
    !*** ./src/utils/vttcue.ts ***!
    \*****************************/
/*! exports provided: default */function(e,t,r){r.r(t),t.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function n(e){return r(t,e)}function i(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var s in a)e[s]=a[s]}return e}function a(t,a,s){var o=this,l={enumerable:!0};o.hasBeenReset=!1;var c="",u=!1,d=t,h=a,f=s,p=null,m="",g=!0,v="auto",y="start",_=50,E="middle",S=50,b="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return m},set:function(t){var n=function(t){return r(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");m=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return y},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return b},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),o.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}()},"./src/utils/vttparser.ts":
/*!********************************!*\
    !*** ./src/utils/vttparser.ts ***!
    \********************************/
/*! exports provided: parseTimeStamp, fixLineBreaks, VTTParser */function(e,t,r){r.r(t),r.d(t,"parseTimeStamp",(function(){return a})),r.d(t,"fixLineBreaks",(function(){return d})),r.d(t,"VTTParser",(function(){return h}));var n=r(/*! ./vttcue */"./src/utils/vttcue.ts"),i=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}();function a(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(n||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var s=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},e}();function o(e,t,r,n){var i=n?e.split(n):[e];for(var a in i)if("string"==typeof i[a]){var s=i[a].split(r);2===s.length&&t(s[0],s[1])}}var l=new n.default(0,0,""),c="middle"===l.align?"middle":"center";function u(e,t,r){var n=e;function i(){var t=a(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function u(){e=e.replace(/^\s+/,"")}if(u(),t.startTime=i(),u(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),u(),t.endTime=i(),u(),function(e,t){var n=new s;o(e,(function(e,t){var i;switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){n.set(e,r[a].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),n.integer(e,i[0]),n.percent(e,i[0])&&n.set("snapToLines",!1),n.alt(e,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",c,"end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",c,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var i=n.get("line","auto");"auto"===i&&-1===l.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",c);var a=n.get("position","auto");"auto"===a&&50===l.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function d(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var h=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=d(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var n=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(i=r()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:i=r(),t.state){case"HEADER":/:/.test(i)?o(i,(function(e,t){}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new n.default(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{u(i,t.cue,t.regionList)}catch(c){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=-1!==i.indexOf("--\x3e");if(!i||l&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch(c){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":
/*!************************************!*\
    !*** ./src/utils/webvtt-parser.ts ***!
    \************************************/
/*! exports provided: generateCueId, parseWebVTT */function(e,t,r){r.r(t),r.d(t,"generateCueId",(function(){return h})),r.d(t,"parseWebVTT",(function(){return p}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./vttparser */"./src/utils/vttparser.ts"),a=r(/*! ../demux/id3 */"./src/demux/id3.ts"),s=r(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),o=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),l=/\r\n|\n\r|\n|\r/g,c=function(e,t,r){return void 0===r&&(r=0),e.substr(r,t.length)===t},u=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),a=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(n.isFiniteNumber)(t)&&Object(n.isFiniteNumber)(r)&&Object(n.isFiniteNumber)(i)&&Object(n.isFiniteNumber)(a)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*r,t+=6e4*i,t+=36e5*a},d=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function h(e,t,r){return d(e.toString())+d(t.toString())+d(r)}var f=function(e,t,r){var n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!==(a=i)&&void 0!==a&&a.new;){var a;e.ccOffset+=n.start-i.start,n.new=!1,i=e[(n=i).prevCC]}e.presentationOffset=r};function p(e,t,r,n,d,p,m,g){var v,y=new i.VTTParser,_=Object(a.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(l,"\n").split("\n"),E=[],S=Object(s.toMpegTsClockFromTimescale)(t,r),b="00:00.000",T=0,R=0,A=!0,w=!1;y.oncue=function(e){var t=n[d],r=n.ccOffset,i=(T-S)/9e4;if(null!=t&&t.new&&(void 0!==R?r=n.ccOffset=t.start:f(n,d,i)),i&&(r=i-n.presentationOffset),w){var a=e.endTime-e.startTime,s=Object(o.normalizePts)(9e4*(e.startTime+r-R),9e4*p)/9e4;e.startTime=s,e.endTime=s+a}var l=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(l)),e.id||(e.id=h(e.startTime,e.endTime,l)),e.endTime>0&&E.push(e)},y.onparsingerror=function(e){v=e},y.onflush=function(){v?g(v):m(E)},_.forEach((function(e){if(A){if(c(e,"X-TIMESTAMP-MAP=")){A=!1,w=!0,e.substr(16).split(",").forEach((function(e){c(e,"LOCAL:")?b=e.substr(6):c(e,"MPEGTS:")&&(T=parseInt(e.substr(7)))}));try{R=u(b)/1e3}catch(Wk){w=!1,v=Wk}return}""===e&&(A=!1)}y.parse(e+"\n")})),y.flush()}},"./src/utils/xhr-loader.ts":
/*!*********************************!*\
    !*** ./src/utils/xhr-loader.ts ***!
    \*********************************/
/*! exports provided: default */function(e,t,r){r.r(t);var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),a=/^age:\s*[\d.]+\s*$/m,s=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.config,t=this.context;if(e){var r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var i=this.xhrSetup;try{if(i)try{i(r,t.url)}catch(o){r.open("GET",t.url,!0),i(r,t.url)}r.readyState||r.open("GET",t.url,!0);var a=this.context.headers;if(a)for(var s in a)r.setRequestHeader(s,a[s])}catch(o){return void this.callbacks.onError({code:r.status,text:o.message},t,r)}t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),r.send()}},t.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,a=this.config;if(!r.aborted&&i>=2)if(self.clearTimeout(this.requestTimeout),0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),4===i){t.onreadystatechange=null,t.onprogress=null;var s=t.status;if(s>=200&&s<300){var o,l;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),l="arraybuffer"===e.responseType?(o=t.response).byteLength:(o=t.responseText).length,r.loaded=r.total=l,!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(r,e,o,t),!this.callbacks)return;var u={url:t.responseURL,data:o};this.callbacks.onSuccess(u,r,e,t)}else r.retry>=a.maxRetry||s>=400&&s<499?(n.logger.error(s+" while loading "+e.url),this.callbacks.onError({code:s,text:t.statusText},e,t)):(n.logger.warn(s+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},t.loadtimeout=function(){n.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&a.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},e}();t.default=s}}).default},e.exports=r())}(sS);var oS=n(sS.exports);const lS=[/.*chrome\/([1-6]\d|7[0-1])\..*MiuiBrowser.*/gi,/.*chrome\/([1-6]\d|70)\..*HeyTapBrowser.*/gi,/.*chrome\/([1-5]\d|6[0-2])\..*VivoBrowser.*/gi];window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;class cS{static async checkSystemRequirements(){return await this.webRTCCapabilityCheck()}static isChrome(){return"chrome"===nS.browserDetails.browser}static isSafari(){return"safari"===nS.browserDetails.browser}static isFirefox(){return"firefox"===nS.browserDetails.browser}static isOnlySupportUnfiedPlan(){let e=!0;if("chrome"===nS.browserDetails.browser){e=cS.getBrowserVersion()>90}else"safari"===nS.browserDetails.browser&&(e=nS.browserDetails.supportsUnifiedPlan);return e}static hlsCapabilityCheck(){let e=oS.isSupported();if(!e){const t=document.createElement("video");e=Boolean(t.canPlayType("application/vnd.apple.mpegurl"))}if(!e)throw new xh(Dh.HWLLS_ERROR_LIVE_UNSUPPORTED,"hls format unsupport.");return!0}static flvCapabilityCheck(){let e=aS.isSupported();if(e){const t=aS.getFeatureList();e=t.mseLiveFlvPlayback||t.nativeMP4H264Playback}if(!e)throw new xh(Dh.HWLLS_ERROR_LIVE_UNSUPPORTED,"flv format unsupport.");return!0}static async webRTCCapabilityCheck(){if(!window||!navigator)throw new xh(Dh.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"window or navigator error");if(!window.RTCPeerConnection)throw new xh(Dh.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"RTCPeerConnection Object not exist");let e=null;try{let t=new RTCPeerConnection;e=await t.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0}),cS.isChrome()&&!/H264/i.test(e.sdp)&&(t.close(),t=new RTCPeerConnection,e=await t.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0})),t.close()}catch(Wk){throw new xh(Dh.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"RTCPeerConnection construct error: ".concat(Wk.message))}if(!/H264/i.test(e.sdp))throw new xh(Dh.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"RTCPeerConnection unsupport AVC codec.");if("chrome"===nS.browserDetails.browser&&!cS.browserSupportCheckByPolicy())throw new xh(Dh.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"browser version not support: ".concat(navigator.userAgent));return!0}static browserSupportCheckByPolicy(){let e=!1;const t=lS;for(const r of t)if(r.test(navigator.userAgent)){e=!0;break}return!e}static getBrowserVersion(){if("safari"===nS.browserDetails.browser){const e=/.*Version\/(\d+).*/gi.exec(navigator.userAgent);if(e&&2===e.length)return parseInt(e[1])}return"chrome"===nS.browserDetails.browser?nS.browserDetails.version||91:nS.browserDetails.version}}var uS=p,dS=ve,hS=Ot,fS=function(){for(var e,t=hS(this),r=dS(t.delete),n=!0,i=0,a=arguments.length;i<a;i++)e=uS(r,t,arguments[i]),n=n&&e;return!!n};$n({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:fS});var pS=p,mS=function(e){return pS(Map.prototype.entries,e)},gS=Ot,vS=la,yS=mS,_S=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=gS(this),r=yS(t),n=vS(e,arguments.length>1?arguments[1]:void 0);return!_S(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ES=Y,SS=la,bS=p,TS=ve,RS=Ot,AS=$i,wS=mS,LS=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=RS(this),r=wS(t),n=SS(e,arguments.length>1?arguments[1]:void 0),i=new(AS(t,ES("Map"))),a=TS(i.set);return LS(r,(function(e,r){n(r,e,t)&&bS(a,i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}});var CS=Ot,IS=la,kS=mS,OS=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=CS(this),r=kS(t),n=IS(e,arguments.length>1?arguments[1]:void 0);return OS(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var DS=Ot,PS=la,xS=mS,MS=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=DS(this),r=xS(t),n=PS(e,arguments.length>1?arguments[1]:void 0);return MS(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var NS=Ot,FS=mS,US=function(e,t){return e===t||e!=e&&t!=t},BS=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return BS(FS(NS(this)),(function(t,r,n){if(US(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var jS=Ot,HS=mS,VS=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return VS(HS(jS(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var GS=Y,zS=la,KS=p,WS=ve,YS=Ot,qS=$i,ZS=mS,XS=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=YS(this),r=ZS(t),n=zS(e,arguments.length>1?arguments[1]:void 0),i=new(qS(t,GS("Map"))),a=WS(i.set);return XS(r,(function(e,r){KS(a,i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}});var JS=Y,QS=la,$S=p,eb=ve,tb=Ot,rb=$i,nb=mS,ib=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=tb(this),r=nb(t),n=QS(e,arguments.length>1?arguments[1]:void 0),i=new(rb(t,JS("Map"))),a=eb(i.set);return ib(r,(function(e,r){$S(a,i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}});var ab=ve,sb=Ot,ob=ul;$n({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=sb(this),r=ab(t.set),n=arguments.length,i=0;i<n;)ob(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}});var lb=Ot,cb=ve,ub=mS,db=ul,hb=TypeError;$n({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=lb(this),r=ub(t),n=arguments.length<2,i=n?void 0:arguments[1];if(cb(e),db(r,(function(r,a){n?(n=!1,i=a):i=e(i,a,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw hb("Reduce of empty map with no initial value");return i}});var fb=Ot,pb=la,mb=mS,gb=ul;$n({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=fb(this),r=mb(t),n=pb(e,arguments.length>1?arguments[1]:void 0);return gb(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var vb=p,yb=Ot,_b=ve,Eb=TypeError;$n({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=yb(this),n=_b(r.get),i=_b(r.has),a=_b(r.set),s=arguments.length;_b(t);var o=vb(i,r,e);if(!o&&s<3)throw Eb("Updating absent value");var l=o?vb(n,r,e):_b(s>2?arguments[2]:void 0)(e,r);return vb(a,r,e,t(l,e,r)),r}});const Sb="OPS_STATISC_ENABLE",bb="LOADING_CONFIG",Tb="ACCESS_DOMAIN",Rb="DNS_QUERY_ENABLE",Ab="GLSB_DOMAIN",wb="ParametersUtil";const Lb=new class{constructor(){this.parameters=new Map}setParameter(e,t){if(!e)return $_.error(wb,"setParameter, parameterKey is null"),!1;try{return $_.debug(wb,"setParameter, parameterKey: ".concat(e,", parameterValue: ").concat(t)),this.parameters.set(e.toLowerCase(),t),!0}catch(Wk){return $_.error(wb,"setParameter occur error: ".concat(Wk)),!1}}getParameter(e){try{return e&&this.parameters.has(e.toLowerCase())?this.parameters.get(e.toLowerCase()):null}catch(Wk){return $_.error(wb,"getParameter occur error: ".concat(Wk)),null}}};var Cb=mn.includes,Ib=Qp;function kb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ob(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?kb(Object(r),!0).forEach((function(t){Yl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kb(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Db(e){try{return e.map((e=>["object","function"].includes(typeof e)&&e.getInfo?e.getInfo():e))}catch(t){return e}}function Pb(e){return(t,r,n)=>{const i=n.value,a=e.substr(0,e.indexOf("$"));return Ob(Ob({},n),{},{async value(){let t,r;const n=X_.getCurrentLocalTimestamp();for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];const c=o||[],u=Db(c);try{$_.info(a,"".concat(i.name," begin : parameters are ").concat(JSON.stringify(u))),t=await i.apply(this,c);const e=null!=t?Db([t]):[];return $_.info(a,"".concat(i.name," end success : result is ").concat(JSON.stringify(e))),t}catch(Wk){throw $_.error(a,"".concat(i.name," end error : ").concat(Wk)),"startPlay"===i.name&&$_.uploadLog(),r=Wk,Wk}finally{var d;const i=X_.getCurrentLocalTimestamp(),a=Db([t,...c]);null===(d=this.stats_)||void 0===d||d.reportApiCallInfo(e,n,i,r,...a)}}})}}function xb(e){return(t,r,n)=>{const i=n.value,a=e.substr(0,e.indexOf("$"));return Ob(Ob({},n),{},{value(){let t,r;const n=X_.getCurrentLocalTimestamp();for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];const c=o||[],u=Db(c);try{$_.info(a,"".concat(i.name," begin : parameters are ").concat(JSON.stringify(u))),r=i.apply(this,c);const e=null!=r?Db([r]):[];return $_.info(a,"".concat(i.name," end success : result is ").concat(JSON.stringify(e))),r}catch(Wk){throw $_.error(a,"".concat(i.name," end error : ").concat(Wk)),t=Wk,Wk}finally{var d;const a=X_.getCurrentLocalTimestamp(),s=Db([r,...c]);(function(e,t,r,n){return!(e===t&&r&&r.length>1)||r[0]===n})(i.name,"setParameter",c,bb)&&(null===(d=this.stats_)||void 0===d||d.reportApiCallInfo(e,n,a,t,...s))}}})}}$n({target:"Array",proto:!0,forced:c((function(){return!Array(1).includes()}))},{includes:function(e){return Cb(this,e,arguments.length>1?arguments[1]:void 0)}}),Ib("includes");var Mb=ve,Nb=xe,Fb=N,Ub=un,Bb=TypeError,jb=function(e){return function(t,r,n,i){Mb(r);var a=Nb(t),s=Fb(a),o=Ub(a),l=e?o-1:0,c=e?-1:1;if(n<2)for(;;){if(l in s){i=s[l],l+=c;break}if(l+=c,e?l<0:o<=l)throw Bb("Reduce of empty array with no initial value")}for(;e?l>=0:o>l;l+=c)l in s&&(i=r(i,s[l],l,a));return i}},Hb={left:jb(!1),right:jb(!0)},Vb=c,Gb=Hb.left,zb=function(e,t){var r=[][e];return!!r&&Vb((function(){r.call(null,t||function(){return 1},1)}))},Kb=re,Wb=ei;$n({target:"Array",proto:!0,forced:!zb("reduce")||!Wb&&Kb>79&&Kb<83},{reduce:function(e){var t=arguments.length;return Gb(this,e,t,t>1?arguments[1]:void 0)}});class Yb{static callWithTimeout(e,t){let r;const n=new Promise(((e,t)=>{r=t}));let i=null;return t&&(i=setTimeout((()=>{clearTimeout(i),r(new xh(Dh.HWLLS_INTERNAL_ERROR))}),t)),Promise.race([e,n]).finally((()=>{clearTimeout(i)}))}static async callWithRetryTimes(e,t,r,n,i){let a=r>=0?r+1:-1,s=1,o=!1;for(;-1===a||a;){let l,c;try{c=await e(s)}catch(Wk){l=Wk,o=i&&i(l),$_.warn("FunctionUtil","callWithRetryTimes, func:".concat(e.name,", isInterrupted:").concat(o,",")+"retryTimes:".concat(r,", left times:").concat(-1===a?-1:a-1,", tryNumber:").concat(s,", err: ").concat(l))}finally{if(!((l||!l&&t)&&!o&&(-1===a||--a>0))){if(!l)return c;throw l}{const e="number"==typeof n?n:n(l);await X_.sleep(e),s++}}}}}function qb(){}function Zb(){Zb.init.call(this)}function Xb(e){return void 0===e._maxListeners?Zb.defaultMaxListeners:e._maxListeners}function Jb(e,t,r,n){var i,a,s,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),s=a[t]):(a=e._events=new qb,e._eventsCount=0),s){if("function"==typeof s?s=a[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),!s.warned&&(i=Xb(e))&&i>0&&s.length>i){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,o=l,"function"==typeof console.warn?console.warn(o):console.log(o)}}else s=a[t]=r,++e._eventsCount;return e}function Qb(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function $b(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function eT(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}qb.prototype=Object.create(null),Zb.EventEmitter=Zb,Zb.usingDomains=!1,Zb.prototype.domain=void 0,Zb.prototype._events=void 0,Zb.prototype._maxListeners=void 0,Zb.defaultMaxListeners=10,Zb.init=function(){this.domain=null,Zb.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new qb,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Zb.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Zb.prototype.getMaxListeners=function(){return Xb(this)},Zb.prototype.emit=function(e){var t,r,n,i,a,s,o,l="error"===e;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(o=this.domain,l){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(r=s[e]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=eT(e,n),a=0;a<n;++a)i[a].call(r)}(r,u,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,a=eT(e,i),s=0;s<i;++s)a[s].call(r,n)}(r,u,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var a=e.length,s=eT(e,a),o=0;o<a;++o)s[o].call(r,n,i)}(r,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,a){if(t)e.call(r,n,i,a);else for(var s=e.length,o=eT(e,s),l=0;l<s;++l)o[l].call(r,n,i,a)}(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),a=1;a<n;a++)i[a-1]=arguments[a];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,a=eT(e,i),s=0;s<i;++s)a[s].apply(r,n)}(r,u,this,i)}return!0},Zb.prototype.addListener=function(e,t){return Jb(this,e,t,!1)},Zb.prototype.on=Zb.prototype.addListener,Zb.prototype.prependListener=function(e,t){return Jb(this,e,t,!0)},Zb.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Qb(this,e,t)),this},Zb.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Qb(this,e,t)),this},Zb.prototype.removeListener=function(e,t){var r,n,i,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new qb:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){s=r[a].listener,i=a;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new qb,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,s||t)}return this},Zb.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new qb,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new qb:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new qb,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Zb.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},Zb.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):$b.call(e,t)},Zb.prototype.listenerCount=$b,Zb.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};let tT=function(e){return e[e.CUSTOMIZE_STANDARD=0]="CUSTOMIZE_STANDARD",e[e.COMMON_STANDARD=1]="COMMON_STANDARD",e}({}),rT=function(e){return e.TRACK_TYPE_AUDIO="audio",e.TRACK_TYPE_VIDEO="video",e}({}),nT=function(e){return e.CROP="crop",e.FILL="fill",e}({}),iT=function(e){return e[e.SUCC=0]="SUCC",e[e.FAIL=1]="FAIL",e[e.INTERRUPT=2]="INTERRUPT",e[e.CONNECTION_UNCOMPLETE=3]="CONNECTION_UNCOMPLETE",e[e.SUCC_AFTER_TIMEOUT=4]="SUCC_AFTER_TIMEOUT",e}({}),aT=function(e){return e[e.CLOSED=0]="CLOSED",e[e.CONNECTED=1]="CONNECTED",e}({}),sT=function(e){return e[e.EVENT_START_PULL_STREAM_REQ=201]="EVENT_START_PULL_STREAM_REQ",e[e.EVENT_STOP_PULL_STREAM_REQ=202]="EVENT_STOP_PULL_STREAM_REQ",e[e.EVENT_PULL_MEDIA_STREAM=203]="EVENT_PULL_MEDIA_STREAM",e[e.EVENT_CONNECTION_CHANNEL_STATUS=204]="EVENT_CONNECTION_CHANNEL_STATUS",e}({}),oT=function(e){return e[e.EVENT_VIDEO_QOS=1100]="EVENT_VIDEO_QOS",e[e.EVENT_AUDIO_QOS=1101]="EVENT_AUDIO_QOS",e}({}),lT=function(e){return e[e.API_CALL=501]="API_CALL",e[e.CALLBACK_API=502]="CALLBACK_API",e}({});const cT="player-state-trace",uT={MEDIA_STATISTIC:"media-statistic",NET_QUALITY:"network-quality",VIDEO_INTERRUPTED:"video-broken",AUDIO_INTERRUPTED:"audio-broken",VIDEO_RECOVERY:"video-recovery",AUDIO_RECOVERY:"audio-recovery",AUDIO_START:"audio-start",VIDEO_START:"video-start",VIDEO_STUCK:"video_stuck",FULLSCREEN_STATUS_CHANGED:"fullscreen-status-changed",PLAYER_CHANGE:"player-changed"};let dT=function(e){return e[e.NETWORK_QUALITY_INIT=-1]="NETWORK_QUALITY_INIT",e[e.NETWORK_QUALITY_UNKNOW=0]="NETWORK_QUALITY_UNKNOW",e[e.NETWORK_QUALITY_GREAT=1]="NETWORK_QUALITY_GREAT",e[e.NETWORK_QUALITY_GOOD=2]="NETWORK_QUALITY_GOOD",e[e.NETWORK_QUALITY_DEFECTS=3]="NETWORK_QUALITY_DEFECTS",e[e.NETWORK_QUALITY_WEAK=4]="NETWORK_QUALITY_WEAK",e[e.NETWORK_QUALITY_BAD=5]="NETWORK_QUALITY_BAD",e[e.NETWORK_QUALITY_DISCONNECT=6]="NETWORK_QUALITY_DISCONNECT",e}({}),hT=function(e){return e[e.DNS=0]="DNS",e[e.GSLB=1]="GSLB",e}({}),fT=function(e){return e.CONTAIN="contain",e.FILL="fill",e.COVER="cover",e}({}),pT=function(e){return e.WEBRTC="webrtc",e.HLS="hls",e.FLV="flv",e}({}),mT=function(e){return e[e.USER_DOMIAN=0]="USER_DOMIAN",e[e.SHARE_DOMAIN=1]="SHARE_DOMAIN",e}({}),gT=function(e){return e.DNS="DNS",e.HTTPDNS="HTTPDNS",e}({}),vT=function(e){return e[e.SHARE_DOMAIN_RETRY_TIMES=2]="SHARE_DOMAIN_RETRY_TIMES",e[e.USER_DOMAIN_RETRY_TIMES=3]="USER_DOMAIN_RETRY_TIMES",e}({});const yT="downgrade";var _T=$n,ET=u,ST=o,bT=L,TT=Fe,RT=V,AT=q,wT=Xl,LT=wt.f,CT=Nn,IT=ST.Symbol,kT=IT&&IT.prototype;if(ET&&RT(IT)&&(!("description"in kT)||void 0!==IT().description)){var OT={},DT=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:wT(arguments[0]),t=AT(kT,this)?new IT(e):void 0===e?IT():IT(e);return""===e&&(OT[t]=!0),t};CT(DT,IT),DT.prototype=kT,kT.constructor=DT;var PT="Symbol(test)"==String(IT("test")),xT=bT(kT.toString),MT=bT(kT.valueOf),NT=/^Symbol\((.*)\)[^)]+$/,FT=bT("".replace),UT=bT("".slice);LT(kT,"description",{configurable:!0,get:function(){var e=MT(this),t=xT(e);if(TT(OT,e))return"";var r=PT?UT(t,7,-1):FT(t,NT,"$1");return""===r?void 0:r}}),_T({global:!0,constructor:!0,forced:!0},{Symbol:DT})}function BT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?BT(Object(r),!0).forEach((function(t){Yl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BT(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class HT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;this.elements=new Array,this._size=e}push(e){return null!==e&&(null==this._size||isNaN(this._size)||this.elements.length===this._size&&this.elements.pop(),this.elements.unshift(e),!0)}size(){return this.elements.length}clear(){delete this.elements,this.elements=new Array}getElement(e){if(e<0||e>=this.size())return null;return this.elements[e]}}const VT="HWLLSInterval";const GT=new class{constructor(){Yl(this,"isFireFox",cS.isFirefox()),this.reportSymbol=Symbol("HWLLSInterval_".concat(X_.getCurrentLocalTimestamp())),this.sampleArray=new Map,this.connectionsManagers=[],this.event=new Zb,this.preMediaStats=new Map,this.executeInterval((()=>{this.execHandler()}),Oh.STATISTIC_INTERVAL),this.isVideoBroken=!1,this.videoBrokenTimestamp=0}on(e,t){this.event.on(e,t)}off(e){e?this.event.removeAllListeners(e):this.event.removeAllListeners()}getSymbol(){return this.reportSymbol}reset(e){if(e){this.sampleArray.delete(e),this.preMediaStats.delete(e),this.off("video_stuck_".concat(e)),this.off("video_start_".concat(e)),this.off("audio_start_".concat(e));for(let t=0;t<this.connectionsManagers.length;t++)if(this.connectionsManagers[t].getConnectionId()===e){this.connectionsManagers.splice(t,1);break}}else this.sampleArray.clear(),this.preMediaStats.clear(),this.off(),this.connectionsManagers.length=0}connectionRegister(e){this.connectionsManagers.push(e)}getleastestStats(e,t){if(!e)return null;var r;if(!t)return null===(r=this.sampleArray.get(e))||void 0===r?void 0:r.getElement(0);let n=this.getElementStats(e,t,0);return n||(n=this.getElementStats(e,t,1)),n}getHistoryDatas(e){return this.sampleArray.get(e)}getleastestStatsByPropertyName(e,t,r){let n=this.getElementStats(e,t,0);return n||(n=this.getElementStats(e,t,1)),n?n[r]:null}getElementStats(e,t,r){var n;const i=null===(n=this.sampleArray.get(e))||void 0===n?void 0:n.getElement(r);if(!i)return null;if(this.isFireFox){let e=null;const r=t.split("_"),n=r[0],a=r[1],s=parseInt(r[2]);return i.data.forEach((t=>{t.type===n&&t.mediaType===a&&t.ssrc===s&&(e=t)})),e}return i.data.get(t)}executeInterval(e,t){const r=()=>{this.gatherTimer=setTimeout((async()=>{clearTimeout(this.gatherTimer),await e(),r()}),t)};r()}async getStats(e,t){const r=e.getConnection();if(!r||"function"!=typeof r.getStats)return;const n=await r.getStats(),i=e.getConnectionId();n&&n.forEach(((e,r)=>{"candidate-pair"===e.type&&!0!==e.selected&&!0!==e["nominated "]&&"succeeded"!==e.state||["candidate-pair","local-candidate","inbound-rtp"].includes(e.type)&&(t.set("local-candidate"!==e.type?"".concat(e.type).concat(e.mediaType?"_":"").concat(e.mediaType||"").concat(e.ssrc?"_":"").concat(e.ssrc||""):r,e),this.streamHandler(i,e,e.mediaType))})),this.sampleArray.has(i)||this.sampleArray.set(i,new HT),this.sampleArray.get(i).push({data:t,processed:0})}streamHandler(e,t,r){let n={};this.preMediaStats.has(e)&&(n=this.preMediaStats.get(e)),"audio"!==r?"video"===r&&this.judgeVideoStreamStuck(e,t,n):!Object.prototype.hasOwnProperty.call(n,"preAudioPackets")&&t.packetsReceived>0&&(this.event.emit("audio_start_".concat(e)),this.preMediaStats.set(e,{preAudioPackets:t.packetsReceived}))}judgeVideoStreamBroken(e,t,r){const n=r>0&&r==t;if(n)if(this.isVideoBroken){X_.getCurrentLocalTimestamp()-this.videoBrokenTimestamp>=5e3&&(this.videoBrokenTimestamp=X_.getCurrentLocalTimestamp(),$_.info(VT,"video stream broken, start auto recovery , current timestamp : ".concat(this.videoBrokenTimestamp)),this.event.emit("video_broken_".concat(e)))}else this.isVideoBroken=!0,this.videoBrokenTimestamp=X_.getCurrentLocalTimestamp(),$_.info(VT,"video stream broken, start timestamp : ".concat(this.videoBrokenTimestamp,", preReceiveFrames:").concat(r,", framesReceived:").concat(t));else!n&&this.isVideoBroken&&(this.isVideoBroken=!1,this.videoBrokenTimestamp=0,$_.info(VT,"video stream recovery, timestamp : ".concat(X_.getCurrentLocalTimestamp())),this.event.emit("video_recover_".concat(e)))}judgeVideoStreamStuck(e,t,r){const n=t.framesDecoded||0;if(r&&Object.prototype.hasOwnProperty.call(r,"preReceiveFrames")){if(this.judgeVideoStreamBroken(e,n,r.preReceiveFrames),!r.frameStuckCheck&&r.frameFirstComing)return void(r.preReceiveFrames=n);n===r.preReceiveFrames?r.noChangeCount++:(0===r.preReceiveFrames||r.noChangeCount>1)&&(r.noChangeCount=1,this.event.emit("video_stuck_".concat(e),!1),0===r.preReceiveFrames&&this.event.emit("video_start_".concat(e)),r.frameFirstComing=!0),r.preReceiveFrames=n,r.noChangeCount%r.stuckThreshold==0&&this.event.emit("video_stuck_".concat(e),!0)}else{const t=jT(jT({},{frameStuckLoading:!1,frameStuckThreshold:10}),Lb.getParameter(bb)||{}),i={noChangeCount:1,preReceiveFrames:n,stuckThreshold:t.frameStuckThreshold,frameStuckCheck:t.frameStuckLoading,frameFirstComing:!1};n&&(i.frameFirstComing=!0,this.event.emit("video_stuck_".concat(e),!1),this.event.emit("video_start_".concat(e))),this.preMediaStats.set(e,Object.prototype.hasOwnProperty.call(r,"preAudioPackets")?jT(jT({},i),r):i)}}async execHandler(){for(const e of this.connectionsManagers){const t=new Map;await this.getStats(e,t)}}},zT={audio:()=>"packetsReceived",video:e=>Object.prototype.hasOwnProperty.call(e,"framesDecoded")?"framesDecoded":Object.prototype.hasOwnProperty.call(e,"framesReceived")?"framesReceived":"packetsReceived"},KT={audio200:200,video200:200,video600:600};class WT{static startUpMediaStats(e){GT.connectionRegister(e)}static shutDownMediaStats(e){GT.reset(e)}static getLeastestVideoInfo(e,t){return t?GT.getleastestStats(e,"inbound-rtp_video_".concat(t)):null}static getLeastestAudioInfo(e,t){return t?GT.getleastestStats(e,"inbound-rtp_audio_".concat(t)):null}static getConnectionNetType(e){var t;if(cS.isFirefox()&&!e)return null;const r=null===(t=GT.getleastestStats(e))||void 0===t?void 0:t.data;if(!r)return null;let n=null;for(const i of r.values())if("local-candidate"===i.type){n=i.networkType;break}return"unknown"!==n?n:"other"}static async getCandidatePairProtocol(e){var t,r,n;await X_.sleep(800);const i=null===(t=GT.getleastestStats(e))||void 0===t?void 0:t.data;return i&&(null===(r=i.get(null===(n=i.get("candidate-pair"))||void 0===n?void 0:n.localCandidateId))||void 0===r?void 0:r.protocol)||"udp"}static getMediaStatistic(e,t,r){const n=GT.getHistoryDatas(e);if(!n||n.size()<1)return null;const i=r===rT.TRACK_TYPE_AUDIO?1:2,a=[];let s=0;for(let D=0;D<n.size();D++){if((n.getElement(D).processed&i)>0)continue;n.getElement(D).processed=n.getElement(D).processed|i;const e=n.getElement(D).data;if(!e)continue;const o=e.get("inbound-rtp_".concat(r,"_").concat(t));if(o){a.push(o);const t=e.get("candidate-pair");if(!t)continue;Object.prototype.hasOwnProperty.call(t,"currentRoundTripTime")?s+=1e3*X_.getValue(t.currentRoundTripTime,0):s+=Math.abs(X_.getValue(t.lastPacketReceivedTimestamp,0)-X_.getValue(t.lastPacketSentTimestamp,0))}}const o=a.length;if(0===o)return null;const l=a[0],c=o>1?a[o-1]:{},u=zT[r](l),d=X_.getValue(l.bytesReceived,0),h=X_.getValue(l.packetsReceived,0),f=Math.max(d-X_.getValue(c.bytesReceived,0),0),p=X_.getValue(l.framesReceived,0),m=X_.getValue(l.framesDecoded,0),g=X_.getValue(l.framesDropped,0),v=Math.max(l.packetsLost-X_.getValue(c.packetsLost,0),0),{total200FreezeTime:y,total200FreezeCnt:_,total600VFreezeTime:E,total600VFreezeCnt:S,totalJetter:b,totalStatisticTime:T,validSampleCount:R}=WT.calcFreezeStatistic(a,u,r),A={rtt:Math.ceil(s/o),total200FreezeTime:y,total200FreezeCnt:_,totalStatisticTime:T,totalPacketsReceived:h,totalByteReceived:d,bitRate:Math.round(8*f/(T||1)),lostPktCnt:v,jitter:Math.round(1e3*b/R),nackCnt:X_.getValue(l.nackCount,0)};if(r===rT.TRACK_TYPE_AUDIO)return A;const w=Math.max(m-X_.getValue(c.framesDecoded,0),0),L=Math.max(l.keyFramesDecoded-X_.getValue(c.keyFramesDecoded,0),0),C=1e3*w/(T||1),I=(X_.getValue(l.jitterBufferDelay,0)-X_.getValue(c.jitterBufferDelay,0))/Math.max(X_.getValue(l.jitterBufferEmittedCount,0)-X_.getValue(c.jitterBufferEmittedCount,0),1)*1e3,k={rtt:A.rtt,jitterBufferDelay:X_.getValue(l.jitterBufferDelay,0),jitterBufferEmittedCount:X_.getValue(l.jitterBufferEmittedCount,0),framesPerSecond:l.framesPerSecond||Math.ceil(C),jbDelay:Math.ceil(Math.max(I,0)),frameDelay:1e3*Math.max((p-m-g)/X_.getValue(C,1),0)},O=Math.ceil(k.rtt+k.jbDelay+k.frameDelay);return Object.assign(A,{width:X_.getValue(l.frameWidth,0),height:X_.getValue(l.frameHeight,0),totalDecodeFrames:w,frameRate:Math.ceil(C),keyFrames:L,delayInfo:k,downloadDelay:O,framesReceived:p,framesDecoded:m,framesDropped:g,total600VFreezeTime:E,total600VFreezeCnt:S,pliCnt:X_.getValue(l.pliCount,0),firCnt:X_.getValue(l.firCount,0)}),A}static calcFreezeStatistic(e,t,r){let n=0,i=0,a=0,s=0,o=0,l=0,c=0,u=0,d=0;const h=r!==rT.TRACK_TYPE_AUDIO,f=Object.prototype.hasOwnProperty.call(e[0],"timestamp");if(e.length<2)return{total200FreezeTime:s,total200FreezeCnt:o,total600VFreezeTime:c,total600VFreezeCnt:u,totalJetter:X_.getValue(e[0].jitter,0),totalStatisticTime:Oh.STATISTIC_INTERVAL,validSampleCount:1};for(let p=0;p<e.length;p++){if(!e[p]||0===e[p].bytesReceived&&0===e[p].packetsReceived){$_.error("MediaStats","Has no data at start, ignore sample: ".concat(e[p].timestamp));continue}if(0===p){n++,d+=X_.getValue(e[p].jitter,0);continue}const m=f?Math.round(X_.getValue(e[p-1].timestamp,0)-X_.getValue(e[p].timestamp,0)):Oh.STATISTIC_INTERVAL;if(m>2e3){$_.error("MediaStats","Has huge gap between ".concat(e[p].timestamp," - ").concat(e[p-1].timestamp,", ignore sample: ").concat(e[p].timestamp,", deltaTimeStamp: ").concat(m));continue}n++,d+=X_.getValue(e[p].jitter,0),i+=m;if(0!==e[p][t])if(e[p-1][t]===e[p][t]){a+=m,h&&(l+=m)}else a>=KT["".concat(r,"200")]&&(s+=a,o++),a=0,h&&l>=KT["".concat(r,"600")]&&(c+=l,u++),l=0;else $_.error("MediaStats","first frame has not received yet, ignore stuck statistic")}return a>=KT["".concat(r,"200")]&&(s+=a,o++),h&&l>=KT["".concat(r,"600")]&&(c+=l,u++),{total200FreezeTime:s,total200FreezeCnt:o,total600VFreezeTime:c,total600VFreezeCnt:u,totalJetter:d,totalStatisticTime:i,validSampleCount:n}}}function YT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?YT(Object(r),!0).forEach((function(t){Yl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YT(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class ZT{constructor(){this.audioStatisticCache=[],this.videoStatisticCache=[],this.playTrackKpi={startPlayTime:0,iceCandidateStart:0,iceCandidateComplete:0,icePairStart:0,iceChecking:0,iceComplete:0,dtlsComplete:0,glsbRequest:0,glsbRespone:0,negotiateSDPRequest:0,negotiateSDPRespone:0,audioPlaySucc:0,videoPlaySucc:0,endPlayTime:0,videoTimeOut:0,audioTimeOut:0},this.pullMediaParams={}}updatePlayTrackKpi(e){if(this.playTrackKpi[e]=X_.getCurrentLocalTimestamp(),/^(ice|dtls).*/gi.test(e)&&this.addKeyInfoMsg(e,this.playTrackKpi[e]),["endPlayTime","videoTimeOut","audioTimeOut"].includes(e))return;let t=!0;for(const r in this.playTrackKpi)if(!["videoTimeOut","audioTimeOut","endPlayTime","glsbRespone","glsbRequest"].includes(r)&&!this.playTrackKpi[r])if(["videoPlaySucc","audioPlaySucc"].includes(r)){if(!this.sfuInfo.aSsrc&&!this.sfuInfo.vSsrc){t=!1;break}if("audioPlaySucc"===r&&this.sfuInfo.aSsrc&&!this.playTrackKpi[r]){t=!1;break}if("videoPlaySucc"===r&&this.sfuInfo.vSsrc&&!this.playTrackKpi[r]){t=!1;break}}else if(!this.playTrackKpi[r]){t=!1;break}t&&$_.info("KPI","startPlay time spent analysis( gslbDispatch cost: ".concat(this.playTrackKpi.glsbRespone-this.playTrackKpi.glsbRequest,"ms; negotiateSDP cost: ").concat(this.playTrackKpi.negotiateSDPRespone-this.playTrackKpi.negotiateSDPRequest,"ms; localICE candidate collect cost: ").concat(this.playTrackKpi.iceCandidateComplete-this.playTrackKpi.iceCandidateStart,"ms; Connection establish total cost: ").concat(this.playTrackKpi.dtlsComplete-this.playTrackKpi.icePairStart,"ms; ICE Connectivity check: ").concat(this.playTrackKpi.iceComplete-this.playTrackKpi.iceChecking,"ms; DTLS negotiate cost: ").concat(this.playTrackKpi.dtlsComplete-this.playTrackKpi.iceComplete,"ms; first frame cost: ").concat(Math.max(this.playTrackKpi.videoPlaySucc,this.playTrackKpi.audioPlaySucc)-this.playTrackKpi.startPlayTime,"ms"))}getPlayTrackKpi(){return this.playTrackKpi}getSfuInfo(){return this.sfuInfo}setSfuInfo(e){e.ipAddress&&(e.ipAddress=X_.isIpv6(e.ipAddress)?"[".concat(e.ipAddress,"]"):e.ipAddress),this.sfuInfo=e}setStreamParams(e){this.streamParams?this.streamParams=qT(qT({},this.streamParams),e):this.streamParams=e}getStreamParams(){return this.streamParams}updateAccessAddr(e){this.streamParams?this.streamParams.accessAddr=X_.isIpv6(e)?"[".concat(e,"]"):e:this.streamParams={accessAddr:X_.isIpv6(e)?"[".concat(e,"]"):e}}setPullMediaParams(e){this.pullMediaParams.clientAddr?delete e.clientAddr:e.clientAddr=X_.isIpv6(e.clientAddr)?"[".concat(e.clientAddr,"]"):e.clientAddr,this.pullMediaParams=qT(qT({},this.pullMediaParams),e)}updateClientAddr(e){e&&(this.pullMediaParams.clientAddr||(this.pullMediaParams.clientAddr=X_.isIpv6(e)?"[".concat(e,"]"):e))}getPullMediaParams(){return this.pullMediaParams}addVideoStatisticCache(e){this.videoStatisticCache.push(e)}addAudioStatisticCache(e){this.audioStatisticCache.push(e)}calcPlayDuration(){return Math.round((this.playTrackKpi.endPlayTime-this.playTrackKpi.startPlayTime)/1e3)}getMediaFreezeStatistic(e){const t=this[e===rT.TRACK_TYPE_AUDIO?"audioStatisticCache":"videoStatisticCache"];let r=0,n=0,i=0,a=0;for(const s of t)n+=s.total200FreezeCnt,r+=s.total200FreezeTime,e===rT.TRACK_TYPE_VIDEO&&(a+=s.total600VFreezeCnt,i+=s.total600VFreezeTime);return e===rT.TRACK_TYPE_VIDEO?{freeze200Count:n,freeze200Duration:r,freeze600Count:a,freeze600Duration:i}:{freeze200Count:n,freeze200Duration:r}}calcAverageStatistic(){const e={afreeze200Cnt:0,vfreeze200Cnt:0,vfreeze600Cnt:0};let t=0,r=this.audioStatisticCache.length>0?this.audioStatisticCache[this.audioStatisticCache.length-1].totalPacketsReceived:0,n=0,i=0,a=0,s=0,o=0,l=0;for(const c of this.audioStatisticCache)e.afreeze200Cnt+=c.total200FreezeCnt,a+=c.total200FreezeTime,o+=c.totalStatisticTime,t+=c.lostPktCnt,n+=c.bitRate,i+=c.jitter,l+=c.rtt;e.afreeze200Rate=Math.round(100*a/Math.max(o,1)),e.aRecvBandwidthMean=Math.round(n/Math.max(this.audioStatisticCache.length,1)),e.aRecvLostMean=Math.round(100*t/Math.max(r+t,1)),e.aRecvJitter=Math.round(i/Math.max(this.audioStatisticCache.length,1)),e.aRecvRttMean=Math.round(l/Math.max(this.audioStatisticCache.length,1)),t=0,r=this.videoStatisticCache.length>0?this.videoStatisticCache[this.videoStatisticCache.length-1].totalPacketsReceived:0,n=0,i=0,a=0,o=0,l=0;for(const c of this.videoStatisticCache)e.vfreeze200Cnt+=c.total200FreezeCnt,e.vfreeze600Cnt+=c.total600VFreezeCnt,a+=c.total200FreezeTime,s+=c.total600VFreezeTime,o+=c.totalStatisticTime,t+=c.lostPktCnt,n+=c.bitRate,i+=c.jitter,l+=c.rtt;return e.vfreeze200Rate=Math.round(100*a/Math.max(o,1)),e.vfreeze600Rate=Math.round(100*s/Math.max(o,1)),e.vRecvBandwidthMean=Math.round(n/Math.max(this.videoStatisticCache.length,1)),e.vRecvLostMean=Math.round(100*t/Math.max(r+t,1)),e.vRecvJitter=Math.round(i/Math.max(this.videoStatisticCache.length,1)),e.vRecvRttMean=Math.round(l/Math.max(this.videoStatisticCache.length,1)),e}addKeyInfoMsg(e,t){this.pullMediaParams.keyInfoMsg||(this.pullMediaParams.keyInfoMsg={}),"iceCandidateComplete"===e&&this.pullMediaParams.keyInfoMsg.iceCandidateStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.iceCandidateStart:"iceChecking"===e&&this.pullMediaParams.keyInfoMsg.icePairStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.icePairStart:"iceComplete"===e&&this.pullMediaParams.keyInfoMsg.icePairStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.icePairStart-(this.pullMediaParams.keyInfoMsg.iceChecking||0):"dtlsComplete"===e&&this.pullMediaParams.keyInfoMsg.icePairStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.icePairStart-((this.pullMediaParams.keyInfoMsg.iceChecking||0)+(this.pullMediaParams.keyInfoMsg.iceComplete||0)):this.pullMediaParams.keyInfoMsg[e]=t}}class XT{static addInstance(e){XT.globalVariableMap.set(e,new ZT)}static getInstance(e){return XT.globalVariableMap.get(e)}static delInstance(e){e?XT.globalVariableMap.delete(e):XT.globalVariableMap.clear()}}Yl(XT,"globalVariableMap",new Map);const JT=new class{constructor(){const e=navigator.connection;e&&(this.networkType=e.type,this.networkRTT=e.rtt,this.downlink=e.downlink||-1,Object.prototype.hasOwnProperty.call(navigator.connection,"onchange")&&(navigator.connection.onchange=()=>{const e=navigator.connection;this.networkType=e.type,this.networkRTT=e.rtt,this.downlink=e.downlink||-1}))}getNetworkType(){return this.networkType}getNetworkRTT(){return this.networkRTT}getNetworkInfo(){return{networkType:this.networkType,networkRTT:this.networkRTT}}};function QT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?QT(Object(r),!0).forEach((function(t){Yl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QT(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class eR{constructor(e){this.identifiedId=e,this.module_="HWLLSStat",this.commInfo={},this.commInfo.deviceId=X_.getDeviceID(),this.commInfo.v="web-".concat(Oh.SDK_VERSION,"-").concat(Oh.COMMIT_ID),this.commInfo.userAgent=navigator.userAgent}reportStartPullStreamReqEvent(e){var t,r,n;if(!this.isStatiscEnable())return;const i=null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo(),a=null===(r=XT.getInstance(this.identifiedId))||void 0===r?void 0:r.getStreamParams(),s=null===(n=XT.getInstance(this.identifiedId))||void 0===n?void 0:n.getPlayTrackKpi(),o=this.generateCommonReportInfo({accessAddr:(null==a?void 0:a.accessAddr)||"",routeType:a.routeType,SFUAddr:(null==i?void 0:i.ipAddress)||"",aPort:(null==i?void 0:i.audioPort)||0,vPort:(null==i?void 0:i.videoPort)||0,httpCode:e.httpCode,resultCode:e.retCode,resultMessage:e.retMsg,startTime:s.negotiateSDPRequest,endTime:s.negotiateSDPRespone,playQos:JSON.stringify(e.joinQos||{}),appUrl:X_.getAppUrl(),gslbCostTime:s.glsbRespone-s.glsbRequest,sigCostTime:s.negotiateSDPRespone-s.negotiateSDPRequest,platform:X_.getPlatform(),bv:X_.getBrowserVersion(),timeDiff:X_.getTimeDiff(),autoRetry:e.autoRetry},sT.EVENT_START_PULL_STREAM_REQ,"event^startPlay^SDK^ACS");z_.addRecord(o),z_.immediateReportRecords()}reportStopPullStreamReqEvent(e){var t,r;if(!this.isStatiscEnable())return;const n=null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.calcAverageStatistic(),i=XT.getInstance(this.identifiedId).getStreamParams(),a=XT.getInstance(this.identifiedId).getSfuInfo(),s=this.generateCommonReportInfo({reason:"stopPlay",elapsed:null===(r=XT.getInstance(this.identifiedId))||void 0===r?void 0:r.calcPlayDuration(),aRecvRttMean:n.aRecvRttMean,vRecvRttMean:n.vRecvRttMean,aRecvLostMean:n.aRecvLostMean,vRecvLostMean:n.vRecvLostMean,aRecvBandwidthMean:n.aRecvBandwidthMean,vRecvBandwidthMean:n.vRecvBandwidthMean,aRecvJitter:n.aRecvJitter,vRecvJitter:n.vRecvJitter,afreeze200Cnt:n.afreeze200Cnt,vfreeze200Cnt:n.vfreeze200Cnt,vfreeze600Cnt:n.vfreeze600Cnt,afreeze200Rate:n.afreeze200Rate,vfreeze200Rate:n.vfreeze200Rate,vfreeze600Rate:n.vfreeze600Rate,resultCode:0,startTime:e,endTime:X_.getCurrentLocalTimestamp(),accessAddr:(null==i?void 0:i.accessAddr)||"",SFUAddr:(null==a?void 0:a.ipAddress)||""},sT.EVENT_STOP_PULL_STREAM_REQ,"event^stopPlay^SDK^ACS");z_.addRecord(s),z_.immediateReportRecords()}reportConnectionStatus(e,t){var r;if(!this.isStatiscEnable())return;const n=null===(r=XT.getInstance(this.identifiedId))||void 0===r?void 0:r.getSfuInfo();let i={SFUAddr:null==n?void 0:n.ipAddress,ssrc:(null==n?void 0:n.vSsrc)||(null==n?void 0:n.aSsrc),on:e,protocol:t||""};i=this.generateCommonReportInfo(i,sT.EVENT_CONNECTION_CHANNEL_STATUS,"event^connectionState^SDK^ACS"),z_.addRecord(i),z_.immediateReportRecords()}reportPullMediaStreamResult(e,t,r){var n,i,a,s;if(!this.isStatiscEnable())return;const o=(null==r?void 0:r.sfuInfo)||(null===(n=XT.getInstance(this.identifiedId))||void 0===n?void 0:n.getSfuInfo()),l=(null==r?void 0:r.streamParams)||(null===(i=XT.getInstance(this.identifiedId))||void 0===i?void 0:i.getStreamParams()),c=(null==r?void 0:r.mediaParams)||(null===(a=XT.getInstance(this.identifiedId))||void 0===a?void 0:a.getPullMediaParams()),u=(null==r?void 0:r.playTrackKpi)||(null===(s=XT.getInstance(this.identifiedId))||void 0===s?void 0:s.getPlayTrackKpi()),d=e===rT.TRACK_TYPE_AUDIO;let h={accessAddr:(null==l?void 0:l.accessAddr)||"",SFUAddr:(null==o?void 0:o.ipAddress)||"",streamType:d?0:1,ssrc:d?(null==o?void 0:o.aSsrc)||0:(null==o?void 0:o.vSsrc)||0,result:t,startTime:u.icePairStart,endTime:X_.getCurrentLocalTimestamp(),playQoS:JSON.stringify((null==c?void 0:c.keyInfoMsg)||[]),mediaCostTime:(u.iceComplete||X_.getCurrentLocalTimestamp())-u.icePairStart,totalTime:(u[d?"audioPlaySucc":"videoPlaySucc"]||X_.getCurrentLocalTimestamp())-u.startPlayTime};h=this.generateCommonReportInfo(h,sT.EVENT_PULL_MEDIA_STREAM,"event^pullstreamResult^SDK^ACS"),z_.addRecord(h),z_.immediateReportRecords()}reportApiCallInfo(e,t,r,n,i){if(!this.isStatiscEnable())return;const a="API^web#".concat(e,"^APP^SDK");for(var s=arguments.length,o=new Array(s>5?s-5:0),l=5;l<s;l++)o[l-5]=arguments[l];let c={apiCallId:X_.generateUuid(),apiName:a,params:JSON.stringify(o),startTime:t,endTime:r};n?c.exception="".concat(n.code," - ").concat(n.message):c.ret=i?JSON.stringify(i):"",c=this.generateCommonReportInfo(c,lT.API_CALL,a),/checkSystemRequirements/.test(e)?(z_.addRecord(c),z_.immediateReportRecords()):z_.addRecord(c)}reportCallbackInfo(e,t,r,n,i,a){if(!this.isStatiscEnable())return;const s=a((null==i?void 0:i.stream)||i);let o={callbackId:X_.generateUuid(),callbackName:"CALLBACK^web#".concat(t,"$#").concat(e,"#^SDK^APP"),callbackType:e,params:s,startTime:r,endTime:n};o=this.generateCommonReportInfo(o,lT.CALLBACK_API,"CALLBACK^web#".concat(t,"$#").concat(e,"#^SDK^APP")),z_.addRecord(o)}reportVideoQos(e){var t;if(!this.isStatiscEnable()||!e)return;const r=null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo(),n=XT.getInstance(this.identifiedId).getStreamParams();let i={ssrc:r.vSsrc||0,accessAddr:(null==n?void 0:n.accessAddr)||"",SFUAddr:r.ipAddress||"",codec:"h264",picW:e.width,picH:e.height,bitrate:e.bitRate,frameRate:e.frameRate,lostPktCnt:e.lostPktCnt,finalLostPktCnt:e.lostPktCnt,maxContLostPkts:e.lostPktCnt,rtt:e.rtt,jitter:e.jitter,bytes:e.totalByteReceived,packets:e.totalPacketsReceived,JBDepth:0,playTotalTime:e.totalStatisticTime,decFrameCnt:e.totalDecodeFrames,freeze200Cnt:e.total200FreezeCnt,freeze200Duration:e.total200FreezeTime,freeze600Cnt:e.total600VFreezeCnt,freeze600Duration:e.total600VFreezeTime,iFrameCnt:e.keyFrames,pFrameCnt:e.totalDecodeFrames,bFrameCnt:0,downloadDelay:e.downloadDelay,delayInfo:e.delayInfo,framesReceived:e.framesReceived,framesDropped:e.framesDropped,framesDecoded:e.framesDecoded,nackCnt:e.nackCnt,pliCnt:e.pliCnt,firCnt:e.firCnt};i=this.generateCommonReportInfo(i,oT.EVENT_VIDEO_QOS,"qos^video_downstreams_qos^SDK^APP"),z_.addRecord(i)}reportAudioQos(e){var t;if(!this.isStatiscEnable()||!e)return;const r=null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo(),n=XT.getInstance(this.identifiedId).getStreamParams();let i={ssrc:r.aSsrc,accessAddr:(null==n?void 0:n.accessAddr)||"",SFUAddr:r.ipAddress||"",codec:"opus",bitrate:e.bitRate,lostPktCnt:e.lostPktCnt,finalLostPktCnt:e.lostPktCnt,maxContLostPkts:e.lostPktCnt,rtt:e.rtt,jitter:e.jitter,bytes:e.totalByteReceived,packets:e.totalPacketsReceived,JBDepth:0,playTotalTime:e.totalStatisticTime,freeze200Cnt:e.total200FreezeCnt,freeze200Duration:e.total200FreezeTime,nackCnt:e.nackCnt};i=this.generateCommonReportInfo(i,oT.EVENT_AUDIO_QOS,"qos^audio_downstreams_qos^SDK^APP"),z_.addRecord(i)}startMediaStatistic(){this.mediaStatisticTimer||(this.mediaStatisticTimer=setTimeout((()=>{try{this.mediaStatisticHandler()}catch(Wk){$_.error(this.module_,"Media Statistic occur error: ".concat(Wk))}finally{clearTimeout(this.mediaStatisticTimer),this.mediaStatisticTimer=null,this.startMediaStatistic()}}),5e3))}cancelMediaStatistic(){this.mediaStatisticHandler(),clearTimeout(this.mediaStatisticTimer),this.mediaStatisticTimer=null}mediaStatisticHandler(){var e;const t=null===(e=XT.getInstance(this.identifiedId))||void 0===e?void 0:e.getSfuInfo();if(t){if(t.aSsrc){const e=WT.getMediaStatistic(t.connectionId,t.aSsrc,rT.TRACK_TYPE_AUDIO);var r;if(e)this.reportAudioQos(e),null===(r=XT.getInstance(this.identifiedId))||void 0===r||r.addAudioStatisticCache(e)}if(t.vSsrc){const e=WT.getMediaStatistic(t.connectionId,t.vSsrc,rT.TRACK_TYPE_VIDEO);e&&(this.reportVideoQos(e),XT.getInstance(this.identifiedId).addVideoStatisticCache(e))}}}generateCommonReportInfo(e,t,r){var n,i,a;const s=null===(n=XT.getInstance(this.identifiedId))||void 0===n?void 0:n.getStreamParams(),o=null===(i=XT.getInstance(this.identifiedId))||void 0===i?void 0:i.getPullMediaParams(),l=null===(a=XT.getInstance(this.identifiedId))||void 0===a?void 0:a.getSfuInfo();return s&&(this.commInfo=$T($T({},this.commInfo),{session:null==s?void 0:s.sessionId,domain:null==s?void 0:s.streamDomain,appName:null==s?void 0:s.appName,streamName:null==s?void 0:s.streamName,svrSid:null==o?void 0:o.svrSid,clientAddr:null==o?void 0:o.clientAddr})),$T($T($T({},e),this.commInfo),{ctime:X_.getCurrentSyncTimestamp(),event:t,eventName:r,netType:JT.getNetworkType()||WT.getConnectionNetType(null==l?void 0:l.connectionId)})}isStatiscEnable(){return!1!==Lb.getParameter(Sb)}}class tR{constructor(e,t,r){Yl(this,"callbackMap_",new Map),Yl(this,"onCallbackMap_",new Map),this.identifiedId_=X_.generateStandardUuid(),this.eventEmitter_=r||new Zb,this.stats_=t||new eR(this.identifiedId_),this.moudle_=e||""}on(e,t,r){r?this.onWithTimeout(e,t):this.eventEmitter_.on(e,t)}once(e,t){this.eventEmitter_.once(e,t)}off(e,t,r){t?r?this.offWithTimeout(e,t):this.eventEmitter_.removeListener(e,t):this.eventEmitter_.removeAllListeners(e)}offAllEvents(){this.eventEmitter_.removeAllListeners(),this.callbackMap_.clear(),this.onCallbackMap_.clear()}emit(e,t){this.eventEmitter_.emit(e,t)}onWithTimeout(e,t){const r=this.getOnCallback(e,t);this.eventEmitter_.on(e,r)}offWithTimeout(e,t){const r=this.getOffCallback(e,t);var n;r&&(null===(n=this.eventEmitter_)||void 0===n||n.removeListener(e,r))}getOnCallback(e,t){const r="".concat(e,"_").concat(null==t?void 0:t.name),n=async t=>{if(this.callbackMap_.get(r)){const i=X_.getCurrentLocalTimestamp();let a;try{await Yb.callWithTimeout(this.callbackMap_.get(r)(t),1e4),a=X_.getCurrentLocalTimestamp()}catch(Wk){a=i+5e3}finally{var n;null===(n=this.stats_)||void 0===n||n.reportCallbackInfo(e.toString(),this.moudle_,i,a,t,(e=>["object","function"].includes(typeof e)&&e.getInfo?JSON.stringify(e.getInfo()):JSON.stringify(e||{})))}}};return this.callbackMap_.set(r,t),this.onCallbackMap_.set(r,n),n}getOffCallback(e,t){const r="".concat(e,"_").concat(null==t?void 0:t.name),n=this.onCallbackMap_.get(r);return this.onCallbackMap_.get(r)&&this.onCallbackMap_.delete(r),this.callbackMap_.get(r)&&this.callbackMap_.delete(r),n}get eventEmitter(){return this.eventEmitter_}get identifiedId(){return this.identifiedId_}get stats(){return this.stats_}}var rR={},nR={exports:{}},iR=nR.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(iR).forEach((function(e){iR[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var a=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(r[n[a]]=t(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&r[e.push].push(a)},n=nR.exports,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),s=a[a.length-1]);for(var o=0;o<(n[t]||[]).length;o+=1){var l=n[t][o];if(l.reg.test(i))return r(l,s,i)}})),t.media=a,t};var a=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],n=e.split(" ").map(t),i=0;i<n.length;i+=3)r.push({component:n[i],ip:n[i+1],port:n[i+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(rR);var aR=nR.exports,sR=/%[sdv%]/g,oR=function(e){var t=1,r=arguments,n=r.length;return e.replace(sR,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},lR=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return oR.apply(null,n)},cR=["v","o","s","i","u","e","p","c","b","t","r","z","a"],uR=["i","c","b","a"],dR=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||cR,n=t.innerOrder||uR,i=[];return r.forEach((function(t){aR[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(lR(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(lR(t,r,e))}))}))})),e.media.forEach((function(e){i.push(lR("m",aR.m[0],e)),n.forEach((function(t){aR[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(lR(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(lR(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},hR=dR,fR=rR.parse,pR=rR.parseParams;let mR=function(e){return e.SEND_RECV="sendrecv",e.SEND_ONLY="sendonly",e.RECV_ONLY="recvonly",e.INACTIVE="inactive",e}({});const gR=116,vR=107,yR=109,_R=110,ER=112;let SR=function(e){return e.H264="H264",e.OPUS="opus",e}({});const bR="packetization-mode",TR="profile-level-id",RR=["groups","media"],AR=["candidates","connection","direction","mid","payloads","port","protocol","rtp","type","fmtp","ssrcs"];class wR{constructor(){Yl(this,"module_","sdp")}printSdpInfo(e){const t=this.parseSdp(e);if(t){for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(RR.includes(e)||delete t[e],"media"===e&&t[e].forEach((e=>{for(const t in e)AR.includes(t)||delete e[t]})));return $_.shieldIpAddress(hR(t))}}containsValidVideoPayload(e){$_.debug(this.module_,"containsValidVideoPayload, offerSdp: ".concat(this.printSdpInfo(e)));const t=this.parseSdp(e);if(!t)return $_.error(this.module_,"containsValidVideoPayload failed,the sdp is invalid"),!1;return this.getMedias(t,rT.TRACK_TYPE_VIDEO).some((e=>{var t;return null===(t=e.rtp)||void 0===t?void 0:t.some((e=>e.codec.toUpperCase()===SR.H264))}))}transformOfferSdp(e){$_.info(this.module_,"transformOfferSdp begin");const t=this.parseSdp(e);if(!t)return void $_.error(this.module_,"transformOfferSdp failed,the sdp is invalid");this.deleteUnexpectedMedia(t);const r=this.getMedias(t,rT.TRACK_TYPE_VIDEO),n=this.getMedias(t,rT.TRACK_TYPE_AUDIO);r.forEach((e=>{this.transformVideoPayload(e),this.deleteRetransmissionSsrc(e),e.direction=mR.RECV_ONLY})),n.forEach((e=>{this.transformAudioPayload(e),this.deleteRetransmissionSsrc(e),e.direction=mR.RECV_ONLY}));const i=hR(t);return $_.debug(this.module_,"transformOfferSdp success, sdp: ".concat(this.printSdpInfo(i))),i}modifySdpCandidates(e,t){const r=this.parseSdp(e);if(!r)return void $_.error(this.module_,"modifySdpCandidates failed, the sdp is invalid : ".concat(e));const n=this.getMedias(r,rT.TRACK_TYPE_VIDEO),i=this.getMedias(r,rT.TRACK_TYPE_AUDIO);let a="",s="";if(n&&n.length>0&&(this.modifyCandidate(n[0],t),s=n[0].mid,n.length>1))for(let l=0;l<r.media.length;l++)r.media[l].type!==rT.TRACK_TYPE_AUDIO&&r.media[l].mid!==n[0].mid&&delete r.media[l];i&&i.length>0&&(this.modifyCandidate(i[0],t),a=i[0].mid);for(const l of r.groups||[])if("BUNDLE"===l.type){l.mids="".concat(a," ").concat(s);break}for(const l of r.media||[])l.type!==rT.TRACK_TYPE_AUDIO&&this.processGCCType(l);const o=hR(r);return $_.debug(this.module_,"modifySdpCandidates success, sdp: ".concat(this.printSdpInfo(o))),o}getSfuInfo(e){const t=this.parseSdp(e),r={};let n;const i=this.getMedias(t,rT.TRACK_TYPE_AUDIO);var a,s,o;i&&i.length>0&&(r.audioPort=(null===(a=i[0].candidates)||void 0===a||null===(s=a.find((e=>9!==e.port)))||void 0===s?void 0:s.port)||i[0].port,n=i[0].connection,r.aSsrc=parseInt(String(null===(o=i[0].ssrcs.find((e=>!!e.id)))||void 0===o?void 0:o.id)));n&&(r.ipAddress=n.ip);const l=this.getMedias(t,rT.TRACK_TYPE_VIDEO);var c,u,d;l&&l.length>0&&(r.videoPort=(null===(c=l[0].candidates)||void 0===c||null===(u=c.find((e=>9!==e.port)))||void 0===u?void 0:u.port)||r.audioPort||l[0].port,n=l[0].connection,r.vSsrc=parseInt(String(null===(d=l[0].ssrcs.find((e=>!!e.id)))||void 0===d?void 0:d.id)));return!r.ipAddress&&n&&(r.ipAddress=n.ip),r}parseSdp(e){if(!e)return void $_.error(this.module_,"parseSdp failed : sdp  is null ");const t=fR(e);if(0!==t.media.length)return t;$_.error(this.module_,"parseSdp failed : the media of sdp is null ")}getMedias(e,t){return e.media.filter((e=>{let{type:r}=e;return r===t}))}deleteUnexpectedMedia(e){e.media&&(e.media=e.media.filter((e=>{let{type:t}=e;return t===rT.TRACK_TYPE_VIDEO||t===rT.TRACK_TYPE_AUDIO})))}transformVideoPayload(e){if(!e.rtp)return void $_.warn(this.module_,"transformVideoPayload failed ,rtp is null");let t=null,r=null,n=0;for(const i of e.rtp){if(i.codec.toUpperCase()!==SR.H264)continue;r||(r=i.payload,$_.info(this.module_,"record firstPayload, firstPayload: ".concat(r)));const a=this.getPacketizationMode(e.fmtp,i.payload),s=this.getProfileLevelId(e.fmtp,i.payload);if(1===a&&(0===n&&(r=i.payload,n=1),"42e01f"===s)){t=i.payload,$_.info(this.module_,"set retainPayload in transformVideoPayload, retainPayload: ".concat(t));break}}t||(t=r,$_.info(this.module_,"no expected payload, use firstPayload as retainPayload, retainPayload: ".concat(t))),t?(this.deletePayload(e,t),this.modifyPayload(e,yR),this.addVideoFec(e),this.addFmtpAttr(e,yR,"max-br","5000000"),this.addFmtpAttr(e,yR,"sps-pps-idr-in-keyframe","1"),this.addFmtpAttr(e,vR,"apt","".concat(yR)),this.addFmtpAttr(e,vR,"sps-pps-idr-in-keyframe","1")):$_.error(this.module_,"transformVideoPayload failed,can not find expected payload.")}transformAudioPayload(e){if(!e.rtp)return void $_.warn(this.module_,"transformAudioPayload failed, rtp is null");let t;for(const r of e.rtp)if(r.codec.toLowerCase()===SR.OPUS){t=r.payload;break}t?(this.deletePayload(e,t),this.modifyPayload(e,gR),this.addNack(e)):$_.error(this.module_,"transformAudioPayload failed,can not find expected payload.")}deleteRetransmissionSsrc(e){if(!e.ssrcGroups||!e.ssrcs)return;const t=[];e.ssrcGroups.forEach((e=>{let{ssrcs:r}=e;const n=this.getRetransmissionSsrc(r);null!==n&&t.push(n)})),0!==t.length&&(e.ssrcGroups=void 0,e.ssrcs=e.ssrcs.filter((e=>{let{id:r}=e;return!t.includes(r.toString())})))}getPacketizationMode(e,t){if(!e)return 1;for(const r of e){if(r.payload!==t)continue;if(!r.config.includes(bR))return 1;const e=pR(r.config);return null===e[bR]?1:parseInt(String(e[bR]),10)}return 1}getProfileLevelId(e,t){if(!e)return"";for(const r of e){if(r.payload!==t)continue;if(!r.config.includes(TR))return"";const e=pR(r.config);return e[TR]?String(e[TR]):""}return""}deletePayload(e,t){e.rtp&&(e.rtp=e.rtp.filter((e=>{let{payload:r}=e;return r===t}))),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter((e=>{let{payload:r}=e;return r===t}))),e.fmtp&&(e.fmtp=e.fmtp.filter((e=>{let{payload:r}=e;return r===t}))),e.payloads=t.toString()}modifyPayload(e,t){e.rtp&&e.rtp.forEach((e=>{e.payload=t})),e.rtcpFb&&e.rtcpFb.forEach((e=>{e.payload=t})),e.fmtp&&e.fmtp.forEach((e=>{e.payload=t})),e.payloads=t.toString()}addVideoFec(e){e.rtp||(e.rtp=[]),e.rtp.push({payload:vR,codec:"rtx",rate:9e4}),e.rtp.push({payload:_R,codec:"red",rate:9e4}),e.rtp.push({payload:ER,codec:"ulpfec",rate:9e4}),e.payloads="".concat(vR," ").concat(e.payloads," ").concat(_R," ").concat(ER)}addFmtpAttr(e,t,r,n){if(!e.fmtp||0===e.fmtp.length)return e.fmtp=[],void e.fmtp.push({payload:t,config:r+"="+n});const i=e.fmtp.find((e=>e.payload===t));if(i){if(pR(i.config)[r])return;i.config=i.config+";"+r+"="+n}else e.fmtp.push({payload:t,config:r+"="+n})}addNack(e){const t=e.rtp[0].payload;e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.push({payload:t,type:"ccm",subtype:"fir"}),e.rtcpFb.push({payload:t,type:"nack"}),e.rtcpFb.push({payload:t,type:"nack",subtype:"pli"})}modifyCandidate(e,t){if(!e.candidates){const r=null==t?void 0:t.find((t=>"".concat(e.mid)==="".concat(t.sdpMid)));if(r){const t=/.*generation\s(\d+).*/.exec(r.candidate)||[],n=/.*network\-id\s(\d+).*/.exec(r.candidate)||[],i=/.*network\-cost\s(\d+).*/.exec(r.candidate)||[];e.candidates=e.candidates||[],e.candidates.push({foundation:r.foundation,component:"rtp"===r.component?1:2,transport:r.protocol,priority:r.priority,ip:r.address,port:r.port,type:r.type,raddr:r.relatedAddress,rport:r.relatedPort,tcptype:r.tcpType,generation:2===t.length?parseInt(t[1]):void 0,"network-id":2===n.length?parseInt(n[1]):void 0,"network-cost":2===i.length?parseInt(i[1]):void 0})}}}getRetransmissionSsrc(e){if(!e)return void $_.warn(this.module_,"getRetransmissionSsrc failed, ssrcs is null");const t=e.split(" ");if(2===t.length)return t[1];$_.warn(this.module_,"getRetransmissionSsrc failed, ssrcs(".concat(e,") is invalid"))}processGCCType(e){if(cS.isFirefox()&&cS.getBrowserVersion()<100){let t=e.rtcpFb.findIndex((e=>"transport-cc"===e.type));t>=0&&e.rtcpFb.splice(t,1),t=e.ext.findIndex((e=>/transport-wide-cc/i.test(e.uri))),t>=0&&e.ext.splice(t,1)}}}class LR extends wR{transformAnswerSdp(e){$_.debug(this.module_,"transformAnswerSdp, answerSdp: ".concat(this.printSdpInfo(e)));const t=this.parseSdp(e);if(!t)return void $_.error(this.module_,"transformAnswerSdp failed,the sdp is invalid");const r=this.getMedias(t,rT.TRACK_TYPE_VIDEO),n=this.getMedias(t,rT.TRACK_TYPE_AUDIO);r&&r.length>0&&r.forEach((e=>{e.direction=mR.SEND_ONLY})),n&&n.length>0&&n.forEach((e=>{e.direction=mR.SEND_ONLY}));const i=hR(t);return $_.debug(this.module_,"transformAnswerSdp success,answerSdp: ".concat(this.printSdpInfo(i))),i}}class CR extends wR{static modifyBundle(e,t){for(const r of e.groups||[])if("BUNDLE"===r.type){r.mids="".concat(r.mids," ").concat(t);break}}transformAnswerSdp(e,t){$_.debug(this.module_,"transformAnswerSdp, answerSdp: ".concat(this.printSdpInfo(e)));const r=this.parseSdp(e),n=this.parseSdp(t);if(!r||!n)return void $_.error(this.module_,"transformAnswerSdp failed,the sdp is invalid");this.getMedias(r,rT.TRACK_TYPE_AUDIO).forEach((e=>{e.direction=mR.SEND_ONLY}));let i=this.getMedias(r,rT.TRACK_TYPE_VIDEO);const a=this.getMedias(n,rT.TRACK_TYPE_VIDEO);if(a.length!==i.length){const e=i.map((e=>"".concat(e.mid)));a.forEach((t=>{if(!e.includes("".concat(t.mid))){const e=JSON.parse(JSON.stringify(i[0]));e.mid=t.mid,r.media.push(e),CR.modifyBundle(r,t.mid)}}))}i=this.getMedias(r,rT.TRACK_TYPE_VIDEO),i.forEach((e=>{e.direction=mR.SEND_ONLY}));const s=hR(r);return $_.debug(this.module_,"transformAnswerSdp success,answerSdp: ".concat(this.printSdpInfo(s))),s}}const IR="PeerConnectionsManager";class kR{constructor(e,t,r){Yl(this,"isFireFox",cS.isFirefox()),this.connectionId=r,this.eventEmitter=t,this.stats=e,cS.isOnlySupportUnfiedPlan()?(this.sdpDescMode="unified-plan",this.rtcSdp=new CR):(this.sdpDescMode="plan-b",this.rtcSdp=new LR),$_.debug(IR,"ConnectionsManager, SDP mode: ".concat(this.sdpDescMode))}getConnectionId(){return this.connectionId}isConnectionsExist(){return!!this.peerConnection}isConnectionEstablished(){var e;return!(!this.peerConnection||"connected"!==(null===(e=this.peerConnection.connection)||void 0===e?void 0:e.connectionState))}async initConnectionAndSdp(e,t,r){const n=this.createPeerConnection(),i=await this.createOffer({offerToReceiveAudio:e.receiveAudio,offerToReceiveVideo:e.receiveVideo}),a=this.rtcSdp.transformOfferSdp(i.sdp);if(await n.connection.setLocalDescription({type:"offer",sdp:a}),this.onConnection(n,t.onTrackHandler),this.iceAddressCollect(n.connection),!this.isFireFox){const e=n.connection.localDescription.sdp;$_.debug(IR,"setLocalDescription, sdp offer: ".concat(this.rtcSdp.printSdpInfo(e))),await n.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(e)})}e.receiveVideo&&cS.isChrome()&&!this.rtcSdp.containsValidVideoPayload(i.sdp)&&!r&&(this.destroyPeerConnection(),$_.error(IR,"initConnectionAndSdp, no H264 payload and try createOffer again"),await this.initConnectionAndSdp(e,t,!0))}modifySdpCandidates(){const e=this.peerConnection;let t=null;return e&&(t=this.rtcSdp.modifySdpCandidates(e.connection.localDescription.sdp,e.candidate)),t}destroyPeerConnection(e){this.peerConnection&&(clearTimeout(this.peerConnection.disConnectDelayHandleTimer),clearTimeout(this.peerConnection.connectionStatisticTimeOut),"closed"!==this.peerConnection.connection.signalingState&&(null==e||e.forEach((e=>this.peerConnection.connection.removeTrack(e))),this.peerConnection.connection.close(),this.peerConnection.connectFailedTimes=0),this.eventEmitter.removeAllListeners("STARTUP_MEDIA_STATS"),WT.shutDownMediaStats(this.connectionId),this.peerConnection=null)}async handleAnswerSdpFromServer(e){XT.getInstance(this.connectionId).updatePlayTrackKpi("icePairStart");const t=this.peerConnection.connection,r=this.rtcSdp.transformAnswerSdp(e,t.localDescription.sdp);$_.debug(IR,"handleAnswerSdpFromServer, sdp answer: ".concat(this.rtcSdp.printSdpInfo(r)));try{await t.setRemoteDescription({type:"answer",sdp:r}),this.isFireFox&&(await t.setLocalDescription({type:"offer",sdp:(await t.createOffer()).sdp}),await t.setRemoteDescription({type:"answer",sdp:r}))}catch(Wk){throw $_.error(IR,"setRemoteDescription error, answer sdp invalid or offer sdp invalid: ".concat(Wk)),new xh(Dh.HWLLS_INTERNAL_ERROR,(null==Wk?void 0:Wk.message)||"setRemoteDescription error, answer sdp invalid or offer sdp invalid")}}getSfuInfoFromSdp(e){const t=this.rtcSdp.getSfuInfo(e);return t.connectionId=this.getConnectionId(),t}getConnection(){var e;return this.isConnectionsExist()&&(null===(e=this.peerConnection)||void 0===e?void 0:e.connection)||null}async createOffer(e){const t=this.peerConnection.connection;return await t.createOffer(e)}iceCandidateListener(e){$_.info(IR,"iceCandidate add listener"),e.connection.onicecandidate=t=>{var r;$_.info(IR,"###onicecandidate: ".concat($_.shieldIpAddress(null===(r=t.candidate)||void 0===r?void 0:r.candidate))),t.candidate&&(e.candidate||(e.candidate=[]),e.candidate.push(t.candidate))}}iceRestart(e,t){this.stats.reportConnectionStatus(aT.CLOSED),e.connection.createOffer({iceRestart:!0}).then((t=>{e.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(t.sdp)}),e.connection.setRemoteDescription({sdp:e.connection.remoteDescription.sdp,type:"answer"})})).finally((()=>{t&&t()})),e.connectFailedTimes++,e.connectFailedTimes>=1&&($_.error(IR,"onconnectionstatechange, emit media error event."),this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_MEDIA_NETWORK_ERROR,errDesc:Ph[Dh.HWLLS_MEDIA_NETWORK_ERROR]}),e.connectFailedTimes=0)}onConnection(e,t){e.connection.ontrack=e=>{t(e)},e.connection.onconnectionstatechange=()=>{$_.info(IR,"onconnectionstatechange, connect state is: ".concat(e.connection.connectionState)),"connected"===e.connection.connectionState&&(XT.getInstance(this.connectionId).updatePlayTrackKpi("dtlsComplete"),clearTimeout(e.connectionStatisticTimeOut),this.eventEmitter.emit("STARTUP_MEDIA_STATS"))},e.connection.oniceconnectionstatechange=async()=>{if($_.info(IR,"oniceconnectionstatechange, iceConnectionState: ".concat(e.connection.iceConnectionState)),"disconnected"!==e.connection.iceConnectionState)if(clearTimeout(e.disConnectDelayHandleTimer),e.disConnectDelayHandleTimer=null,"failed"===e.connection.iceConnectionState||"closed"===e.connection.iceConnectionState)$_.info(IR,"[KPI] oniceconnectionstatechange, iceconnect failed, go iceRestart: ".concat(e.connection.iceConnectionState)),this.iceRestart(e);else if(["connected","completed"].includes(e.connection.iceConnectionState)){$_.info(IR,"[KPI] oniceconnectionstatechange, iceconnect state: ".concat(e.connection.iceConnectionState)),XT.getInstance(this.connectionId).updatePlayTrackKpi("iceComplete"),e.connectFailedTimes=0;const t=await WT.getCandidatePairProtocol(this.connectionId);this.stats.reportConnectionStatus(aT.CONNECTED,t)}else"checking"===e.connection.iceConnectionState&&($_.info(IR,"[KPI] oniceconnectionstatechange, iceconnect state: ".concat(e.connection.iceConnectionState)),XT.getInstance(this.connectionId).updatePlayTrackKpi("iceChecking"));else{if(e.disConnectDelayHandleTimer)return;e.disConnectDelayHandleTimer=setTimeout((()=>{$_.info(IR,"oniceconnectionstatechange, disConnect state delay handler, go iceRestart: ".concat(e.connection.iceConnectionState)),this.iceRestart(e,(()=>{clearTimeout(e.disConnectDelayHandleTimer),e.disConnectDelayHandleTimer=null}))}),5e3)}}}async iceAddressCollect(e){$_.info(IR,"[KPI] begin to do ice candidate"),XT.getInstance(this.connectionId).updatePlayTrackKpi("iceCandidateStart"),await new Promise((t=>{let r=null;const n=()=>{$_.info(IR,"[KPI] ICE collect status: ".concat(e.iceGatheringState)),"complete"===e.iceGatheringState&&(clearTimeout(r),$_.info(IR,"[KPI] ICE collect complete"),XT.getInstance(this.connectionId).updatePlayTrackKpi("iceCandidateComplete"),e.removeEventListener("icegatheringstatechange",n),t())};e.addEventListener("icegatheringstatechange",n),r=setTimeout((()=>{$_.error(IR,"[KPI] ICE collect fail"),clearTimeout(r),e.removeEventListener("icegatheringstatechange",n),t()}),6e3)}))}createPeerConnection(){const e={rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"};var t;(e.sdpSemantics=this.sdpDescMode,this.peerConnection)&&(null===(t=this.peerConnection.connection)||void 0===t||t.close());const r={connection:new RTCPeerConnection(e),connectFailedTimes:0};return this.peerConnection=r,this.iceCandidateListener(this.peerConnection),this.eventEmitter.removeAllListeners("STARTUP_MEDIA_STATS"),this.eventEmitter.once("STARTUP_MEDIA_STATS",(()=>{$_.info(IR,"startUp Media Stats"),WT.startUpMediaStats(this)})),r.connectionStatisticTimeOut=setTimeout((()=>{clearTimeout(r.connectionStatisticTimeOut),this.eventEmitter.emit("STARTUP_MEDIA_STATS")}),6e3),this.peerConnection}}const OR=new class{constructor(){Yl(this,"eventHandlers",{visibilitychange:()=>{let e="FOREGROUND";document.hidden&&(e="BACKGROUND");for(const t of this.eventBus.values())t.emit(e)}}),Yl(this,"eventListeners",{visibilitychange:e=>{"ADD"===e?document.addEventListener("visibilitychange",this.eventHandlers.visibilitychange):document.removeEventListener("visibilitychange",this.eventHandlers.visibilitychange)}}),this.eventBus=new Map,this.addListener("visibilitychange",X_.isMobileDevice.bind(X_))}register(e){const t=X_.generateRandomId(32);return this.eventBus.set(t,e),t}unregister(e){e&&this.eventBus.delete(e)}addListener(e,t){t&&!t()||this.eventListeners[e]&&this.eventListeners[e]("ADD")}removeListener(e){this.eventListeners[e]&&this.eventListeners[e]("REMOVE")}},DR="PlayerUtils";class PR{static async multiPlatformAdapter(){return new Promise((e=>{if(X_.isWKWebview()){const t=window.WeixinJSBridge;t?($_.info(DR,"multiPlatformAdapter handle begin"),t.invoke("getNetworkType",{},(()=>{e()}),!1)):document.addEventListener("WeixinJSBridgeReady",(()=>{$_.info(DR,"multiPlatformAdapter WeixinJSBridgeReady,  handle begin"),t.invoke("getNetworkType",{},(()=>{e()}),!1)}))}else e()}))}}class xR{constructor(e){Yl(this,"loadingTimer",{timer:null,lastLoadingStatus:""}),this.loadingParentDiv=e}loadingMask(e){let t=this.loadingParentDiv.querySelector("#loadingMask");if(!t&&e&&(t=X_.createLoadingMask(),this.loadingParentDiv.appendChild(t)),t){const r=e?"block":"none";if(this.loadingTimer.timer)return void(this.loadingTimer.lastLoadingStatus=r);if(t.style.display!==r&&(t.style.display=r),!e)return;this.loadingTimer.timer=setTimeout((()=>{clearTimeout(this.loadingTimer.timer),this.loadingTimer.timer=null,"none"===this.loadingTimer.lastLoadingStatus&&(t.style.display="none"),this.loadingTimer.lastLoadingStatus=""}),300)}}stopLoadingMask(){clearTimeout(this.loadingTimer.timer),this.loadingTimer.timer=null,this.loadingTimer.lastLoadingStatus="";const e=this.loadingParentDiv.querySelector("#loadingMask");var t;e&&(null===(t=this.loadingParentDiv)||void 0===t||t.removeChild(e))}}class MR{static preLoadPoster(e){if(MR.preLoadImages.has(e))return;const t=document.createElement("div");t.setAttribute("id","poster_div"),t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.display="none",t.style["z-index"]=98,t.style["justify-content"]="center",t.style["align-items"]="center",t.style.overflow="hidden";const r=new Image;if(r.src=e,t.appendChild(r),MR.preLoadImages.set(e,t),MR.preLoadImages.size>5)for(const n of MR.preLoadImages.keys()){MR.preLoadImages.delete(n);break}r.onload=()=>{t.style["background-color"]="#000",$_.info(DR,"preLoadPoster success")},r.onerror=()=>{$_.error(DR,"preLoadPoster failed"),MR.disPlayPoster(!1,e),MR.preLoadImages.delete(e)}}static attachPoster(e,t,r){const n=MR.preLoadImages.get(t);if(!n)return;const i=n.querySelector("img");r===nT.FILL?(i.style.width="100%",i.style.height="100%"):(i.style.width="auto",i.style.height="auto"),e.querySelector("#poster_div img")||e.appendChild(n)}static detachPoster(e,t){const r=MR.preLoadImages.get(t);r&&(e.removeChild(r),r.style.display="none")}static disPlayPoster(e,t){const r=MR.preLoadImages.get(t);r&&(r.style.display=e?"flex":"none")}}Yl(MR,"preLoadImages",new Map);const NR=new class{constructor(){Yl(this,"supportFullScreenApi",{}),Yl(this,"fullScreenApiMap",[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]]),this.isFullScreen=!1;for(const e of this.fullScreenApiMap)if(e[1]in document){for(let t=0;t<this.fullScreenApiMap[0].length;t++)this.supportFullScreenApi[this.fullScreenApiMap[0][t]]=e[t];break}Object.keys(this.supportFullScreenApi).length<1&&(this.supportFullScreenApi={requestFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",fullscreenElement:"webkitFullscreenElement",fullscreenEnabled:"webkitFullscreenEnabled",fullscreenchange:"webkitfullscreenchange",fullscreenerror:"webkitfullscreenerror"}),this.addFullScreenEventsListener()}enterFullScreen(e,t,r){this.videoElement=t,this.event=r;try{if(this.supportFullScreenApi.requestFullscreen){if(cS.isSafari()&&t.webkitEnterFullscreen)return void t.webkitEnterFullscreen();if(e[this.supportFullScreenApi.requestFullscreen])return $_.info(DR,"enter fullScreen with ".concat(this.supportFullScreenApi.requestFullscreen," on player element.")),void e[this.supportFullScreenApi.requestFullscreen]();this.supportFullScreenApi.requestFullscreen&&t[this.supportFullScreenApi.requestFullscreen]&&($_.info(DR,"enter fullScreen with ".concat(this.supportFullScreenApi.requestFullscreen," on video element.")),t[this.supportFullScreenApi.requestFullscreen]())}}catch(pL){$_.error(DR,"enterFullScreen occur error: ".concat(pL,"."))}}exitFullScreen(){try{this.supportFullScreenApi.exitFullscreen&&document[this.supportFullScreenApi.exitFullscreen]&&($_.info(DR,"exit fullScreen with ".concat(this.supportFullScreenApi.exitFullscreen,".")),document[this.supportFullScreenApi.exitFullscreen]())}catch(pL){$_.error(DR,"exitFullScreen occur error: ".concat(pL,"."))}}getFullScreenStatus(){return this.isFullScreen}addFullScreenEventsListener(){if(Object.keys(this.supportFullScreenApi).length<1)return void $_.error(DR,"addFullScreenEventsListener failed.");const e=()=>{var e,t;cS.isSafari()?this.isFullScreen!==!(null===(e=this.videoElement)||void 0===e||!e.webkitDisplayingFullscreen)&&(null!==(t=this.videoElement)&&void 0!==t&&t.webkitDisplayingFullscreen?($_.info(DR,"trigger enter-full-screen event."),this.isFullScreen=!0,this.event.emit(uT.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!0,isPause:this.videoElement.paused})):($_.info(DR,"trigger exit-full-screen event."),this.isFullScreen=!1,this.event.emit(uT.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!1,isPause:this.videoElement.paused}))):document[this.supportFullScreenApi.fullscreenElement]?($_.info(DR,"trigger enter-full-screen event."),this.isFullScreen=!0,this.event.emit(uT.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!0,isPause:this.videoElement.paused})):($_.info(DR,"trigger exit-full-screen event."),this.isFullScreen=!1,this.event.emit(uT.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!1,isPause:this.videoElement.paused}))};cS.isSafari()?setInterval(e,100):document.addEventListener(this.supportFullScreenApi.fullscreenchange,e)}};class FR{constructor(){this.context_=new AudioContext,this.script_=this.context_.createScriptProcessor(2048,1,1),this.script_.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);let r=0,n=0;for(let i=0;i<t.length;i++)r+=t[i]*t[i],Math.abs(t[i])>.99&&(n+=1);this.instant_=Math.sqrt(r/t.length),this.slow_=.95*this.slow_+.05*this.instant_,this.clip_=n/t.length},this.instant_=0,this.slow_=0,this.clip_=0}connectToSource(e){return new Promise(((t,r)=>{try{const r=new MediaStream;r.addTrack(e),this.mic_=this.context_.createMediaStreamSource(r),this.mic_.connect(this.script_),this.script_.connect(this.context_.destination),t()}catch(n){r(n)}}))}stop(){this.mic_.disconnect(),this.script_.disconnect(),this.context_.close()}getVolume(){return parseFloat(this.instant_.toFixed(2))}}class UR{constructor(e){this.module_="RTCPlayer",this.mediaStream_=new MediaStream,this.track_=e.track,this.playerDiv_=e.playerDiv,this.playerId_=e.playerId,this.playerElement_=null,this.state_="NONE",this.manualPauseFlag_=!1,this.event_=new Zb,this.pauseCount=0,this.customEvent=document.createEvent("CustomEvent"),this.customEvent.initEvent("appPause"),this.listenHandlers={canPlayHandler:this.canPlayHandler.bind(this),playingHandler:this.playingHandler.bind(this),playerEndedHandler:this.playerEndedHandler.bind(this),playerPausedHandler:this.playerPausedHandler.bind(this),trackEndedHandler:this.trackEndedHandler.bind(this),trackMutedHandler:this.trackMutedHandler.bind(this),trackUnmutedHandler:this.trackUnmutedHandler.bind(this),playHandler:null,backgroundHandler:this.backgroundHandler.bind(this),foregroundHandler:this.foregroundHandler.bind(this),appPauseHandler:this.appPauseHandler.bind(this),playInterruptHandler:null},this.deBounceHandlers={videoHandler:X_.debounce((()=>{$_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is paused"),this.event_.emit(cT,{event:"playerPause",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PAUSED",$_.debug("".concat(this.module_,"#").concat(this.playerId_),"try to play again"),this.event_.emit("videoCanPlay")}),800,!1),audioHandler:X_.debounce((()=>{$_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is paused"),this.event_.emit(cT,{event:"playerPause",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PAUSED",$_.debug("".concat(this.module_,"#").concat(this.playerId_),"try to play again"),this.event_.emit("audioCanPlay")}),800,!1)}}on(e,t){this.event_.on(e,t)}off(e,t){this.event_.removeListener(e,t)}stop(){this.closeAllEvents(),clearTimeout(this.playTimeOutTimer),this.playerElement_&&(this.playerElement_.srcObject=null),this.playerElement_=null,this.mediaStream_=new MediaStream,this.manualPauseFlag_=!1,this.event_.emit("playInterrupt"),$_.info(this.module_,"stop success")}replaceTrack(e){$_.info(this.module_,"replaceTrack start");const t=this.module_.indexOf("Audio")>0?this.mediaStream_.getAudioTracks():this.mediaStream_.getVideoTracks(),r=t.length?t[0]:null;r!==e&&(r&&this.mediaStream_.removeTrack(r),this.mediaStream_.addTrack(e),this.track_=e,this.manualPauseFlag_=!1)}async resume(e){return this.manualPauseFlag_=!1,new Promise(((t,r)=>{this.playerElement_?this.playerElement_.play().then((()=>{$_.info(this.module_,"audio player resume success, streamId:".concat(this.playerId_,", playParameters: ").concat(JSON.stringify(e))),t(null)})).catch((t=>{$_.error(this.module_,"player resume failed, errmsg=".concat(t," , playParameters: ").concat(JSON.stringify(e))),"NotAllowedError"===t.name?r(new xh(Dh.HWLLS_PLAY_NOT_ALLOW)):r(new xh(Dh.HWLLS_INTERNAL_ERROR,t.message))})):r(new xh(Dh.HWLLS_INTERNAL_ERROR,"resume failed, element is null"))}))}pause(){this.playerElement_&&(this.playerElement_.pause(),"STOPPED"!==this.state_&&(this.manualPauseFlag_=!0))}async doPlay(e,t,r){let n;return this.manualPauseFlag_=!1,await PR.multiPlatformAdapter(),n=this.module_.indexOf("Video")>0?", screenFit:".concat(r.objectFit):", volume:".concat(r.volume,", muted:").concat(r.muted),this.playerElement_.play().then((()=>{var t,r;$_.info(this.module_,"play success, parentDiv id:".concat(null===(t=this.playerDiv_)||void 0===t?void 0:t.id,", resolutionId or streamId:").concat(this.playerId_,", physical track id:").concat(null===(r=this.track_)||void 0===r?void 0:r.id).concat(n)),this.afterPlayStrategy(),e(null)})).catch((e=>{var r,i;$_.error(this.module_,"play failed, errmsg=".concat(e,",parentDiv id:").concat(null===(r=this.playerDiv_)||void 0===r?void 0:r.id,", resolutionId or streamId:").concat(this.playerId_,", physical track id:").concat(null===(i=this.track_)||void 0===i?void 0:i.id).concat(n)),"NotAllowedError"===e.name?t(new xh(Dh.HWLLS_PLAY_NOT_ALLOW)):t(new xh(Dh.HWLLS_INTERNAL_ERROR,e.message))})).finally((()=>{clearTimeout(this.playTimeOutTimer),this.listenHandlers.playInterruptHandler&&this.event_.removeListener("playInterrupt",this.listenHandlers.playInterruptHandler)}))}closeAllEvents(){var e,t,r,n,i,a,s,o,l,c;null===(e=this.playerElement_)||void 0===e||e.removeEventListener("canplay",this.listenHandlers.canPlayHandler),null===(t=this.playerElement_)||void 0===t||t.removeEventListener("playing",this.listenHandlers.playingHandler),null===(r=this.playerElement_)||void 0===r||r.removeEventListener("ended",this.listenHandlers.playerEndedHandler),null===(n=this.playerElement_)||void 0===n||n.removeEventListener("pause",this.listenHandlers.playerPausedHandler),null===(i=this.playerElement_)||void 0===i||i.removeEventListener("appPause",this.listenHandlers.appPauseHandler),this.deBounceHandlers.videoHandler.cancel(),this.deBounceHandlers.audioHandler.cancel(),null===(a=this.track_)||void 0===a||a.removeEventListener("ended",this.listenHandlers.trackEndedHandler),null===(s=this.track_)||void 0===s||s.removeEventListener("mute",this.listenHandlers.trackMutedHandler),null===(o=this.track_)||void 0===o||o.removeEventListener("unmute",this.listenHandlers.trackUnmutedHandler),this.listenHandlers.playHandler&&(null===(l=this.event_)||void 0===l||l.removeListener("videoCanPlay",this.listenHandlers.playHandler)),this.listenHandlers.playHandler&&(null===(c=this.event_)||void 0===c||c.removeListener("audioCanPlay",this.listenHandlers.playHandler)),this.event_.removeListener("FOREGROUND",this.listenHandlers.foregroundHandler),this.event_.removeListener("BACKGROUND",this.listenHandlers.backgroundHandler),OR.unregister(this.sysEventRegisterUid)}handleEvents(){this.playerElement_.addEventListener("canplay",this.listenHandlers.canPlayHandler),this.playerElement_.addEventListener("playing",this.listenHandlers.playingHandler),this.playerElement_.addEventListener("ended",this.listenHandlers.playerEndedHandler),this.playerElement_.addEventListener("pause",this.listenHandlers.playerPausedHandler),this.playerElement_.addEventListener("appPause",this.listenHandlers.appPauseHandler),this.track_.addEventListener("ended",this.listenHandlers.trackEndedHandler),this.track_.addEventListener("mute",this.listenHandlers.trackMutedHandler),this.track_.addEventListener("unmute",this.listenHandlers.trackUnmutedHandler),this.event_.on("FOREGROUND",this.listenHandlers.foregroundHandler),this.event_.on("BACKGROUND",this.listenHandlers.backgroundHandler),this.sysEventRegisterUid=OR.register(this.event_)}playInterruptHandler(e){e(new xh(Dh.HWLLS_INTERNAL_ERROR,"AbortError: The play() request was interrupted by a new load request."))}afterPlayStrategy(){if(!this.pauseCount&&X_.getPlatform().indexOf("Ios 15")>=0){$_.error(this.module_,X_.getPlatform());const e=setTimeout((()=>{clearTimeout(e),this.playerElement_.pause(),this.pauseCount++}),100)}}appPauseHandler(){this.manualPauseFlag_=!0}foregroundHandler(){$_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, application is foreground"),this.event_.emit(cT,{event:"foreground",type:this.module_}),this.module_.indexOf("Audio")>0&&this.track_&&this.trackEnable!==this.track_.enabled&&(this.track_.enabled=this.trackEnable),"PAUSED"===this.state_&&(this.module_.indexOf("Video")>0?this.event_.emit("videoCanPlay"):this.event_.emit("audioCanPlay"))}backgroundHandler(){$_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, application is background"),this.event_.emit(cT,{event:"background",type:this.module_}),this.module_.indexOf("Audio")>0&&this.track_&&(this.trackEnable=this.track_.enabled,this.trackEnable&&(this.track_.enabled=!1))}canPlayHandler(){$_.info("".concat(this.module_,"#").concat(this.playerId_),"[KPI] handleEvents, player is canplay status"),this.event_.emit(this.module_.indexOf("Video")>0?"videoCanPlay":"audioCanPlay"),this.module_.indexOf("Video")&&(this.videoBufferedReday=!0),this.event_.emit(cT,{event:"playerCanplay",type:"".concat(this.module_),streamId:this.playerId_})}playingHandler(e){if($_.info("".concat(this.module_,"#").concat(this.playerId_),"[KPI] handleEvents, player is starting playing"),this.event_.emit(cT,{event:"playerPlaying",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PLAYING",this.manualPauseFlag_=!1,NR.getFullScreenStatus()&&(!e.target.offsetParent||/^(<body>|<div\sid="player_container").*/.test(e.target.offsetParent.outerHTML))&&this.module_.indexOf("Video")>0){var t;const e=null===(t=this.playerDiv_)||void 0===t?void 0:t.querySelector("#audio_".concat(this.playerId_));return null==e||e.play(),void this.event_.emit(uT.FULLSCREEN_STATUS_CHANGED,{isFullScreen:NR.getFullScreenStatus(),isPause:!1})}}playerEndedHandler(){$_.info("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is ended"),this.event_.emit(cT,{event:"playerEnded",type:"".concat(this.module_),streamId:this.playerId_}),"STOPPED"!==this.state_&&(this.state_="STOPPED")}playerPausedHandler(e){if(!this.manualPauseFlag_)if(NR.getFullScreenStatus()&&(!e.target.offsetParent||/^(<body>|<div\sid="player_container").*/.test(e.target.offsetParent.outerHTML))&&this.playerElement_.paused&&this.module_.indexOf("Video")>0){var t;const e=null===(t=this.playerDiv_)||void 0===t?void 0:t.querySelector("#audio_".concat(this.playerId_));e&&(e.dispatchEvent(this.customEvent),e.pause(),this.event_.emit(uT.FULLSCREEN_STATUS_CHANGED,{isFullScreen:NR.getFullScreenStatus(),isPause:!0}))}else this.module_.indexOf("Video")>0?this.deBounceHandlers.videoHandler.exec():this.deBounceHandlers.audioHandler.exec()}trackEndedHandler(){$_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player track is ended"),this.event_.emit(cT,{event:"trackEnded",type:"".concat(this.module_),streamId:this.playerId_}),"STOPPED"!==this.state_&&(this.state_="STOPPED")}trackMutedHandler(){$_.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, track is muted"),this.event_.emit(cT,{event:"trackMute",type:"".concat(this.module_),streamId:this.playerId_}),"PAUSED"!==this.state_&&(this.state_="PAUSED")}trackUnmutedHandler(){$_.debug("".concat(this.module_,"#[").concat(this.playerId_,"]"),"handleEvents, track is unmuted"),this.event_.emit(cT,{event:"trackUnmute",type:"".concat(this.module_),streamId:this.playerId_}),"PAUSED"===this.state_&&(this.state_="PLAYING")}}class BR extends UR{constructor(e){super({track:e.track,playerDiv:e.playerDiv,playerId:e.playerId}),this.module_="RTCAudioPlayer",this.muted_=e.muted,this.volume_="number"==typeof(null==e?void 0:e.volume)?e.volume:.5,this.soundMeter_=null,this.autoPlay_=e.autoPlay}async play(){return new Promise(((e,t)=>{let r,n=!0;var i;(r=this.playerDiv_?this.playerDiv_.querySelector("#audio_".concat(this.playerId_)):this.playerElement_,r)||(r=document.createElement("audio"),r.muted=this.muted_,r.setAttribute("id","audio_".concat(this.playerId_)),this.autoPlay_&&r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),null===(i=this.playerDiv_)||void 0===i||i.appendChild(r),n=!1);0===this.mediaStream_.getAudioTracks().length&&this.mediaStream_.addTrack(this.track_),r.srcObject=this.mediaStream_,this.playerElement_=r,this.muted_?this.playerElement_.muted=!0:this.setVolume(this.volume_),this.addFirstFrameCallBackListener(),this.closeAllEvents(),this.handleEvents(),this.autoPlay_&&(clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{$_.info(this.module_,"trigger audioCanPlay event by Timer"),this.event_.emit("audioCanPlay"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{$_.info(this.module_,"audio playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,t(new xh(Dh.HWLLS_PLAY_TIMEOUT))}),n?1e4:8e3)}),n?0:2e3),this.listenHandlers.playHandler&&this.event_.removeListener("audioCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=this.doPlay.bind(this,e,t,{volume:this.volume_,muted:this.muted_}),this.event_.on("audioCanPlay",this.listenHandlers.playHandler))}))}isMuted(){var e;return Boolean(null===(e=this.playerElement_)||void 0===e?void 0:e.muted)}muteAudio(e){this.playerElement_.muted=e}setVolume(e){this.playerElement_.muted=!1,Number.isNaN(e)?this.playerElement_.volume=this.volume_:this.playerElement_.volume=e}getAudioLevel(){return this.soundMeter_||(this.soundMeter_=new FR,this.soundMeter_.connectToSource(this.track_)),this.soundMeter_.getVolume()}stop(){super.stop(),this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}async resume(){return super.resume({streamId:this.playerId_,volume:this.volume_,muted:this.muted_})}replaceTrack(e){super.replaceTrack(e),this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}async addFirstFrameCallBackListener(){if(!window.MediaStreamTrackProcessor)return;const e=new MediaStreamTrackProcessor({track:this.track_}).readable.getReader(),{done:t,value:r}=await e.read();t&&this.playerElement_&&($_.debug(this.module_,"first audio frame received."),this.event_.emit(uT.AUDIO_START),null==r||r.close())}}class jR extends UR{constructor(e){super({track:e.track,playerDiv:e.parentDiv,playerId:e.playerId}),this.module_="RTCVideoPlayer",this.objectFit_=e.objectFit,this.loadingUtils=new xR(e.parentDiv),this.autoPlay_=e.autoPlay,this.videoBufferedReday=!1,this.showLoading=e.showLoading,this.poster_=e.poster,this.poster_&&(MR.attachPoster(e.parentDiv,this.poster_.url,this.poster_.mode||nT.FILL),!this.autoPlay_&&this.poster_.startEnable&&MR.disPlayPoster(!0,this.poster_.url))}async play(){return new Promise(((e,t)=>{let r=this.playerDiv_.querySelector("#video_".concat(this.playerId_)),n=!0;r||(r=document.createElement("video"),r.muted=!0,r.setAttribute("id","video_".concat(this.playerId_)),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style["object-fit"]=this.objectFit_,this.autoPlay_&&r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),X_.isTencentX5BrowserKernel()&&r.setAttribute("x5-playsinline",""),r.setAttribute("muted",""),this.playerDiv_.appendChild(r),n=!1),0===this.mediaStream_.getVideoTracks().length&&this.mediaStream_.addTrack(this.track_),r.srcObject=this.mediaStream_,this.playerElement_=r,this.addFirstFrameCallBackListener(),this.closeAllEvents(),this.handleEvents(),this.autoPlay_&&(clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{$_.info(this.module_,"trigger videoCanPlay event by Timer"),this.event_.emit("videoCanPlay"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{$_.info(this.module_,"video playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,t(new xh(Dh.HWLLS_PLAY_TIMEOUT)),this.listenHandlers.playInterruptHandler&&this.event_.removeListener("playInterrupt",this.listenHandlers.playInterruptHandler)}),n?1e4:8e3)}),n?0:2e3),this.module_.indexOf("Video")>0&&(this.listenHandlers.playInterruptHandler&&this.event_.removeListener("playInterrupt",this.listenHandlers.playInterruptHandler),this.listenHandlers.playInterruptHandler=this.playInterruptHandler.bind(this,t),this.event_.once("playInterrupt",this.listenHandlers.playInterruptHandler)),this.listenHandlers.playHandler&&this.event_.removeListener("videoCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=this.doPlay.bind(this,e,t,{objectFit:this.objectFit_}),this.event_.on("videoCanPlay",this.listenHandlers.playHandler))}))}async resume(){return this.poster_&&MR.disPlayPoster(!1,this.poster_.url),this.manualStartedPlay()||(this.listenHandlers.playHandler&&this.event_.removeListener("videoCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=()=>{this.loadingMask(!1),this.resume()},this.event_.on("videoCanPlay",this.listenHandlers.playHandler),!this.videoBufferedReday&&this.showLoading&&this.loadingMask(!0),await PR.multiPlatformAdapter()),await super.resume({streamId:this.playerId_,screentFit:this.objectFit_})}pause(){var e;super.pause(),null!==(e=this.poster_)&&void 0!==e&&e.pauseEnable&&MR.disPlayPoster(!0,this.poster_.url)}stop(){super.stop(),this.loadingUtils.stopLoadingMask(),this.poster_&&MR.detachPoster(this.playerDiv_,this.poster_.url),this.videoBufferedReday=!1}loadingMask(e){e?(this.autoPlay_||this.manualStartedPlay())&&this.loadingUtils.loadingMask(!0):this.loadingUtils.loadingMask(!1)}addFirstFrameCallBackListener(){this.playerElement_.requestVideoFrameCallback&&this.playerElement_.requestVideoFrameCallback((()=>{$_.debug(this.module_,"first video frame received."),this.event_.emit(uT.VIDEO_START)}))}exitFullScreen(){NR.exitFullScreen()}enterFullScreen(){NR.enterFullScreen(this.playerDiv_,this.playerElement_,this.event_)}manualStartedPlay(){return this.event_.eventNames().includes("videoCanPlay")}}var HR=function(e){return e[e.Playing=0]="Playing",e[e.Closed=1]="Closed",e}(HR||{});const VR="HLLSTrack";class GR{constructor(e){this.trackType_=e.trackType,this.track_=e.track,this.playState_=HR.Closed,this.trackMuted_=!1,this.event_=e.event||new Zb,this.trackId_=X_.generateStandardUuid(),this.trackType_===rT.TRACK_TYPE_AUDIO?this.audioStart=()=>{this.event_.emit(uT.AUDIO_START)}:(this.videoStart=()=>{this.event_.emit(uT.VIDEO_START)},this.loadingHandler=e=>{var t,r;this.showLoading&&(e?null===(t=this.player_)||void 0===t||t.loadingMask(!0):null===(r=this.player_)||void 0===r||r.loadingMask(!1))},this.fullScreenStatusHandler=e=>{this.event_.emit(uT.FULLSCREEN_STATUS_CHANGED,e)}),this.statusTraceReporter_=e=>{this.event_.emit(cT,e)}}getTrackType(){return this.trackType_}getTrackId(){return this.trackId_}getElementId(){return this.elementId_}getObjectFit(){return this.objectFit_}getTrack(){return this.track_}async replaceTrack(e){var t;e&&(null===(t=this.player_)||void 0===t||t.replaceTrack(e),this.track_=e,this.track_.enabled=!this.trackMuted_)}removeTrack(){this.player_&&this.player_.stop(),this.track_=null}async play(e,t,r){const n=this.getTrackType();if($_.info(VR,"".concat(n," track begin play, elementId: ").concat(t,", playerDiv.id: ").concat(e.id,", options: ").concat(JSON.stringify(r)," ")),this.playState_===HR.Playing)return $_.info(VR,"".concat(n," track is playing, return ")),{trackType:n,error:null};if(!this.track_)return $_.error(VR,"".concat(n," track is empty")),{trackType:n,error:new xh(Dh.HWLLS_INTERNAL_ERROR,"".concat(n," track is empty"))};switch(this.elementId_=t,this.trackType_){case rT.TRACK_TYPE_AUDIO:this.player_||($_.info(VR,"create AudioPlayer"),this.player_=new BR({playerDiv:e,playerId:"player",track:this.track_,muted:r.muted,volume:this.audioVolume_,autoPlay:r.autoPlay}));break;case rT.TRACK_TYPE_VIDEO:this.objectFit_=r.objectFit,this.showLoading=r.showLoading,this.player_||($_.info(VR,"create VideoPlayer"),this.player_=new jR({parentDiv:e,playerId:"player",track:this.track_,objectFit:r.objectFit,autoPlay:r.autoPlay,showLoading:r.showLoading,poster:r.poster}),r.showLoading&&this.player_.loadingMask(!0))}this.trackType_===rT.TRACK_TYPE_AUDIO?(this.player_.off(uT.AUDIO_START,this.audioStart),this.player_.on(uT.AUDIO_START,this.audioStart)):(this.player_.off(uT.VIDEO_START,this.videoStart),this.player_.on(uT.VIDEO_START,this.videoStart),this.player_.off(uT.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.player_.on(uT.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.event_.removeListener(uT.VIDEO_STUCK,this.loadingHandler),this.event_.on(uT.VIDEO_STUCK,this.loadingHandler)),this.player_.off(cT,this.statusTraceReporter_),this.player_.on(cT,this.statusTraceReporter_),$_.info(VR,"play ".concat(n," track start")),this.playState_=HR.Playing;try{return await this.player_.play(),{trackType:n,error:null}}catch(Wk){const t=Wk instanceof xh&&/.*timeout.*/i.test(Wk.getMsg());return $_[t?"warn":"error"](VR,"play ".concat(n," failed: ").concat(Wk," ")),t||(this.playState_=HR.Closed),{trackType:n,error:Wk}}}stop(){this.player_?(this.trackType_===rT.TRACK_TYPE_AUDIO?this.player_.off(uT.AUDIO_START,this.audioStart):(this.player_.off(uT.VIDEO_START,this.videoStart),this.event_.removeListener(uT.VIDEO_STUCK,this.loadingHandler)),this.player_.stop(),this.player_=null,this.trackMuted_=!1,$_.info(VR,"".concat(this.getTrackType()," stop player success")),this.elementId_="",$_.info(VR,"".concat(this.getTrackType()," close success")),this.playState_=HR.Closed):$_.info(VR,"".concat(this.getTrackType()," player is null"))}async resume(){if(!this.player_)throw $_.info(VR,"".concat(this.getTrackType()," player is null")),new xh(Dh.HWLLS_INTERNAL_ERROR,"".concat(this.getTrackType()," player is null"));try{await this.player_.resume()}catch(Wk){throw $_.error(VR,"".concat(this.getTrackType()," resume failed: ").concat(Wk," ")),Wk}}pause(){if(!this.player_)throw $_.info(VR,"".concat(this.getTrackType()," player is null")),new xh(Dh.HWLLS_INTERNAL_ERROR,"".concat(this.getTrackType()," player is null"));this.player_.pause()}getTrackMuted(){return this.track_?!this.track_.enabled:this.trackMuted_}muteTrack(){this.track_&&(this.track_.enabled=!1),this.trackMuted_=!0}unmuteTrack(){this.track_&&(this.track_.enabled=!0),this.player_.isMuted&&this.player_.isMuted()&&this.player_.setVolume(),this.trackMuted_=!1}muteAudio(e){this.player_.muteAudio(e)}setAudioVolume(e){this.trackType_===rT.TRACK_TYPE_AUDIO&&(this.audioVolume_=e/100,this.player_&&this.player_.setVolume(this.audioVolume_))}getAudioLevel(){return this.trackType_===rT.TRACK_TYPE_AUDIO&&this.player_?this.player_.getAudioLevel():0}async replay(){if(!this.player_)throw $_.info(VR,"".concat(this.getTrackType()," player is null")),new xh(Dh.HWLLS_INTERNAL_ERROR,"".concat(this.getTrackType()," player is null"));this.trackType_===rT.TRACK_TYPE_AUDIO?(this.player_.off(uT.AUDIO_START,this.audioStart),this.player_.on(uT.AUDIO_START,this.audioStart)):(this.player_.off(uT.VIDEO_START,this.videoStart),this.player_.on(uT.VIDEO_START,this.videoStart),this.player_.off(uT.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.player_.on(uT.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.event_.removeListener(uT.VIDEO_STUCK,this.loadingHandler),this.event_.on(uT.VIDEO_STUCK,this.loadingHandler)),this.player_.off(cT,this.statusTraceReporter_),this.player_.on(cT,this.statusTraceReporter_),$_.info(VR,"rePlay ".concat(this.getTrackType()," track start")),this.playState_=HR.Playing;try{await this.player_.play()}catch(Wk){throw $_.error(VR,"replay".concat(this.getTrackType(),", replay failed: ").concat(Wk)),this.playState_=HR.Closed,Wk}}exitFullScreen(){var e;this.trackType_!==rT.TRACK_TYPE_AUDIO&&(null===(e=this.player_)||void 0===e||e.exitFullScreen())}enterFullScreen(){var e;this.trackType_!==rT.TRACK_TYPE_AUDIO&&(null===(e=this.player_)||void 0===e||e.enterFullScreen())}}var zR,KR,WR,YR,qR,ZR,XR,JR,QR,$R;const eA="RemoteStream";let tA=(zR=Pb("Stream$play#Promise<void>#PlayOptions"),KR=Pb("Stream$resume#Promise<void>#void"),WR=xb("Stream$pause#void#void"),YR=xb("Stream$stop#void#void"),qR=xb("Stream$muteAudio#boolean"),ZR=xb("Stream$muteVideo#boolean"),XR=xb("Stream$unmuteAudio#boolean"),JR=xb("Stream$unmuteVideo#boolean"),QR=xb("Stream$setAudioVolume#void#number"),$R=class extends tR{constructor(e,t){super(eA,e,t),this.traceHandler=this.playerStatusTrace.bind(this)}async play(e){if(e.objectFit){if(e.objectFit&&!/^cover|contain|fill$/.test(e.objectFit))throw $_.error(eA,"invalid play options.objectFit: ".concat(e.objectFit)),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"invalid play options.objectFit: ".concat(e.objectFit))}else e.objectFit=fT.CONTAIN;if(e.muted=!!e.muted,$_.info(eA,"stream start to play with elementId: ".concat(e.elementId,", options.objectFit: ").concat(e.objectFit,", options.muted: ").concat(e.muted)),!e.elementId)throw $_.error(eA,"elementId:".concat(e.elementId," not a invalid HTMLElement Id")),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"elementId:".concat(e.elementId," not a invalid HTMLElement Id"));const t=document.getElementById(e.elementId);if(!t)throw $_.error(eA,"document.getElementById by elementId:".concat(e.elementId," failed")),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"document.getElementById by elementId:".concat(e.elementId," failed"));let r=t.querySelector("#player_container");r?$_.info(eA,"exist player div"):(this.playDivContainer||(r=document.createElement("div"),r.setAttribute("id","player_container"),r.style.width="100%",r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",r.style["background-color"]="#000",this.playDivContainer=r),t.appendChild(this.playDivContainer),$_.info(eA,"new player div")),await this.playTracks(r,e)}async resume(){$_.info(eA,"resume begin"),await Promise.all([this.resumeAudio(),this.resumeVideo()])}pause(){$_.info(eA,"pause begin"),this.pauseAudio(),this.pauseVideo()}stop(){var e,t;$_.info(eA,"stop stream begin"),null===(e=this.audioTrack)||void 0===e||e.stop(),null===(t=this.videoTrack)||void 0===t||t.stop(),$_.info(eA,"stop stream end")}muteAudio(){try{return!!this.audioTrack&&(this.audioTrack.muteTrack(),!0)}catch(Wk){return $_.error(eA,"muteAudio failed: ".concat(Wk)),!1}}muteVideo(){try{return!!this.videoTrack&&(this.videoTrack.muteTrack(),!0)}catch(Wk){return $_.error(eA,"muteVideo failed: ".concat(Wk)),!1}}unmuteAudio(){try{return!!this.audioTrack&&(this.audioTrack.unmuteTrack(),!0)}catch(Wk){return $_.error(eA,"unmuteAudio failed: ".concat(Wk)),!1}}unmuteVideo(){try{return!!this.videoTrack&&(this.videoTrack.unmuteTrack(),!0)}catch(Wk){return $_.error(eA,"unmuteVideo failed: ".concat(Wk)),!1}}setAudioVolume(e){this.audioTrack&&this.audioTrack.setAudioVolume(e)}getAudioLevel(){return this.audioTrack?this.audioTrack.getAudioLevel():0}getAudioHRTCTrack(){return this.audioTrack}getVideoHRTCTrack(){return this.videoTrack}hasAudio(){return!!this.getAudioHRTCTrack()}hasVideo(){return!!this.getVideoHRTCTrack()}addRemoteTrack(e){e.kind===rT.TRACK_TYPE_AUDIO?this.audioTrack?this.audioTrack.replaceTrack(e):this.audioTrack=new GR({trackType:rT.TRACK_TYPE_AUDIO,track:e,event:this.eventEmitter}):this.videoTrack?this.videoTrack.replaceTrack(e):this.videoTrack=new GR({trackType:rT.TRACK_TYPE_VIDEO,track:e,event:this.eventEmitter}),$_.info(eA,"addRemoteTrack for ".concat(e.kind," success"))}destory(){var e;this.off(cT,this.traceHandler,!0),this.stop(),null===(e=this.playDivContainer)||void 0===e||e.remove(),this.playDivContainer=null}resumeAudio(){var e;return null===(e=this.audioTrack)||void 0===e?void 0:e.resume()}resumeVideo(){var e;return null===(e=this.videoTrack)||void 0===e?void 0:e.resume()}pauseAudio(){var e;null===(e=this.audioTrack)||void 0===e||e.pause()}pauseVideo(){var e;null===(e=this.videoTrack)||void 0===e||e.pause()}exitFullScreen(){var e;null===(e=this.videoTrack)||void 0===e||e.exitFullScreen()}enterFullScreen(){var e;null===(e=this.videoTrack)||void 0===e||e.enterFullScreen()}playerStatusTrace(e){$_.debug(eA,"playerStatusTrace, ".concat(JSON.stringify(e)))}async playTracks(e,t){var r,n;const i=[];if(t.video&&null!==(r=this.videoTrack)&&void 0!==r&&r.getTrack()&&i.push(this.videoTrack.play(e,t.elementId,{objectFit:t.objectFit,showLoading:t.showLoading,autoPlay:!1!==t.autoPlay,poster:t.poster})),t.audio&&null!==(n=this.audioTrack)&&void 0!==n&&n.getTrack()&&i.push(this.audioTrack.play(e,t.elementId,{muted:t.muted,autoPlay:!1!==t.autoPlay})),0===i.length)throw $_.warn(eA,"no available track for play"),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"no available track to play.");this.off(cT,this.traceHandler,!0),this.on(cT,this.traceHandler,!0),await Promise.all(i).then((e=>{const t=e.filter((e=>null!==e.error));if(t.length>0)throw t[0].error}))}},t($R.prototype,"play",[zR],Object.getOwnPropertyDescriptor($R.prototype,"play"),$R.prototype),t($R.prototype,"resume",[KR],Object.getOwnPropertyDescriptor($R.prototype,"resume"),$R.prototype),t($R.prototype,"pause",[WR],Object.getOwnPropertyDescriptor($R.prototype,"pause"),$R.prototype),t($R.prototype,"stop",[YR],Object.getOwnPropertyDescriptor($R.prototype,"stop"),$R.prototype),t($R.prototype,"muteAudio",[qR],Object.getOwnPropertyDescriptor($R.prototype,"muteAudio"),$R.prototype),t($R.prototype,"muteVideo",[ZR],Object.getOwnPropertyDescriptor($R.prototype,"muteVideo"),$R.prototype),t($R.prototype,"unmuteAudio",[XR],Object.getOwnPropertyDescriptor($R.prototype,"unmuteAudio"),$R.prototype),t($R.prototype,"unmuteVideo",[JR],Object.getOwnPropertyDescriptor($R.prototype,"unmuteVideo"),$R.prototype),t($R.prototype,"setAudioVolume",[QR],Object.getOwnPropertyDescriptor($R.prototype,"setAudioVolume"),$R.prototype),$R);var rA=z,nA=O,iA=$e("match"),aA=p,sA=Fe,oA=q,lA=Ql,cA=RegExp.prototype,uA=wt.f,dA=u,hA=o,fA=L,pA=Kn,mA=yv,gA=Kt,vA=Xr.f,yA=q,_A=function(e){var t;return rA(e)&&(void 0!==(t=e[iA])?!!t:"RegExp"==nA(e))},EA=Xl,SA=function(e){var t=e.flags;return void 0!==t||"flags"in cA||sA(e,"flags")||!oA(cA,e)?t:aA(lA,e)},bA=nc,TA=function(e,t,r){r in e||uA(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},RA=Zr,AA=c,wA=Fe,LA=Dr.enforce,CA=gi,IA=Oc,kA=xc,OA=$e("match"),DA=hA.RegExp,PA=DA.prototype,xA=hA.SyntaxError,MA=fA(PA.exec),NA=fA("".charAt),FA=fA("".replace),UA=fA("".indexOf),BA=fA("".slice),jA=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,HA=/a/g,VA=/a/g,GA=new DA(HA)!==HA,zA=bA.MISSED_STICKY,KA=bA.UNSUPPORTED_Y,WA=dA&&(!GA||zA||IA||kA||AA((function(){return VA[OA]=!1,DA(HA)!=HA||DA(VA)==VA||"/a/i"!=DA(HA,"i")})));if(pA("RegExp",WA)){for(var YA=function(e,t){var r,n,i,a,s,o,l=yA(PA,this),c=_A(e),u=void 0===t,d=[],h=e;if(!l&&c&&u&&e.constructor===YA)return e;if((c||yA(PA,e))&&(e=e.source,u&&(t=SA(h))),e=void 0===e?"":EA(e),t=void 0===t?"":EA(t),h=e,IA&&"dotAll"in HA&&(n=!!t&&UA(t,"s")>-1)&&(t=FA(t,/s/g,"")),r=t,zA&&"sticky"in HA&&(i=!!t&&UA(t,"y")>-1)&&KA&&(t=FA(t,/y/g,"")),kA&&(a=function(e){for(var t,r=e.length,n=0,i="",a=[],s={},o=!1,l=!1,c=0,u="";n<=r;n++){if("\\"===(t=NA(e,n)))t+=NA(e,++n);else if("]"===t)o=!1;else if(!o)switch(!0){case"["===t:o=!0;break;case"("===t:MA(jA,BA(e,n+1))&&(n+=2,l=!0),i+=t,c++;continue;case">"===t&&l:if(""===u||wA(s,u))throw new xA("Invalid capture group name");s[u]=!0,a[a.length]=[u,c],l=!1,u="";continue}l?u+=t:i+=t}return[i,a]}(e),e=a[0],d=a[1]),s=mA(DA(e,t),l?this:PA,YA),(n||i||d.length)&&(o=LA(s),n&&(o.dotAll=!0,o.raw=YA(function(e){for(var t,r=e.length,n=0,i="",a=!1;n<=r;n++)"\\"!==(t=NA(e,n))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+NA(e,++n);return i}(e),r)),i&&(o.sticky=!0),d.length&&(o.groups=d)),e!==h)try{gA(s,"source",""===h?"(?:)":h)}catch(Wk){}return s},qA=vA(DA),ZA=0;qA.length>ZA;)TA(YA,DA,qA[ZA++]);PA.constructor=YA,YA.prototype=PA,RA(hA,"RegExp",YA,{constructor:!0})}CA("RegExp");class XA{static checkStringParameter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;if(!e&&r<=0)return!0;if("string"!=typeof e)throw new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"invalid type: ".concat(e));const i=this.getStringBytes(e);if(i>t||i<r)throw new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"invalid length: ".concat(e));if(n){if(!new RegExp(n).test(e))throw new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"invalid format: ".concat(e))}return!0}static checkUrlFormat(e,t){return(t=t||pT.WEBRTC)===pT.WEBRTC?/webrtc:\/\/[^\/]*\/[^\/]*\/[^\/]+/gi.test(e):t===pT.FLV?/(https?|wss?):\/\/[^\/]*\/[^\/]*\/[^\/]+/gi.test(e):t===pT.HLS&&/https?:\/\/[^\/]*\/[^\/]*\/[^\/]+/gi.test(e)}static checkPlayOpt(e){return!!e.elementId&&(!(Object.prototype.hasOwnProperty.call(e,"objectFit")&&!["cover","contain","fill"].includes(e.objectFit))&&((!e.webrtcConfig||!1!==e.webrtcConfig.receiveAudio||!1!==e.webrtcConfig.receiveVideo)&&!(Object.prototype.hasOwnProperty.call(e,"domainPolicy")&&![mT.SHARE_DOMAIN,mT.USER_DOMIAN].includes(e.domainPolicy))))}static getStringBytes(e){if(!e)return 0;let t=0;if(window.TextEncoder){return t=(new TextEncoder).encode(e).length,t}const r=e.length;for(let n=0;n<r;n++)e.charCodeAt(n)>255?t+=2:t++;return t}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function JA(e){let t=e.length;for(;--t>=0;)e[t]=0}const QA=256,$A=286,ew=30,tw=15,rw=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),nw=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),iw=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),aw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sw=new Array(576);JA(sw);const ow=new Array(60);JA(ow);const lw=new Array(512);JA(lw);const cw=new Array(256);JA(cw);const uw=new Array(29);JA(uw);const dw=new Array(ew);function hw(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let fw,pw,mw;function gw(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}JA(dw);const vw=e=>e<256?lw[e]:lw[256+(e>>>7)],yw=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},_w=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,yw(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Ew=(e,t,r)=>{_w(e,r[2*t],r[2*t+1])},Sw=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},bw=(e,t,r)=>{const n=new Array(16);let i,a,s=0;for(i=1;i<=tw;i++)s=s+r[i-1]<<1,n[i]=s;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=Sw(n[t]++,t))}},Tw=e=>{let t;for(t=0;t<$A;t++)e.dyn_ltree[2*t]=0;for(t=0;t<ew;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Rw=e=>{e.bi_valid>8?yw(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Aw=(e,t,r,n)=>{const i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]},ww=(e,t,r)=>{const n=e.heap[r];let i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Aw(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Aw(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},Lw=(e,t,r)=>{let n,i,a,s,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,i=e.pending_buf[e.sym_buf+o++],0===n?Ew(e,i,t):(a=cw[i],Ew(e,a+QA+1,t),s=rw[a],0!==s&&(i-=uw[a],_w(e,i,s)),n--,a=vw(n),Ew(e,a,r),s=nw[a],0!==s&&(n-=dw[a],_w(e,n,s)))}while(o<e.sym_next);Ew(e,256,t)},Cw=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let s,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<a;s++)0!==r[2*s]?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):r[2*s+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=n[2*l+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)ww(e,r,s);l=a;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ww(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,r[2*l]=r[2*s]+r[2*o],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,r[2*s+1]=r[2*o+1]=l,e.heap[1]=l++,ww(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,n=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,d,h,f,p,m=0;for(h=0;h<=tw;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],h=r[2*r[2*u+1]+1]+1,h>l&&(h=l,m++),r[2*u+1]=h,u>n||(e.bl_count[h]++,f=0,u>=o&&(f=s[u-o]),p=r[2*u],e.opt_len+=p*(h+f),a&&(e.static_len+=p*(i[2*u+1]+f)));if(0!==m){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(h=l;0!==h;h--)for(u=e.bl_count[h];0!==u;)d=e.heap[--c],d>n||(r[2*d+1]!==h&&(e.opt_len+=(h-r[2*d+1])*r[2*d],r[2*d+1]=h),u--)}})(e,t),bw(r,c,e.bl_count)},Iw=(e,t,r)=>{let n,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=t[2*(n+1)+1],++o<l&&i===s||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4))},kw=(e,t,r)=>{let n,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),n=0;n<=r;n++)if(i=s,s=t[2*(n+1)+1],!(++o<l&&i===s)){if(o<c)do{Ew(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(Ew(e,i,e.bl_tree),o--),Ew(e,16,e.bl_tree),_w(e,o-3,2)):o<=10?(Ew(e,17,e.bl_tree),_w(e,o-3,3)):(Ew(e,18,e.bl_tree),_w(e,o-11,7));o=0,a=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4)}};let Ow=!1;const Dw=(e,t,r,n)=>{_w(e,0+(n?1:0),3),Rw(e),yw(e,r),yw(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var Pw=(e,t,r,n)=>{let i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<QA;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Cw(e,e.l_desc),Cw(e,e.d_desc),s=(e=>{let t;for(Iw(e,e.dyn_ltree,e.l_desc.max_code),Iw(e,e.dyn_dtree,e.d_desc.max_code),Cw(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*aw[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?Dw(e,t,r,n):4===e.strategy||a===i?(_w(e,2+(n?1:0),3),Lw(e,sw,ow)):(_w(e,4+(n?1:0),3),((e,t,r,n)=>{let i;for(_w(e,t-257,5),_w(e,r-1,5),_w(e,n-4,4),i=0;i<n;i++)_w(e,e.bl_tree[2*aw[i]+1],3);kw(e,e.dyn_ltree,t-1),kw(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Lw(e,e.dyn_ltree,e.dyn_dtree)),Tw(e),n&&Rw(e)},xw={_tr_init:e=>{Ow||((()=>{let e,t,r,n,i;const a=new Array(16);for(r=0,n=0;n<28;n++)for(uw[n]=r,e=0;e<1<<rw[n];e++)cw[r++]=n;for(cw[r-1]=n,i=0,n=0;n<16;n++)for(dw[n]=i,e=0;e<1<<nw[n];e++)lw[i++]=n;for(i>>=7;n<ew;n++)for(dw[n]=i<<7,e=0;e<1<<nw[n]-7;e++)lw[256+i++]=n;for(t=0;t<=tw;t++)a[t]=0;for(e=0;e<=143;)sw[2*e+1]=8,e++,a[8]++;for(;e<=255;)sw[2*e+1]=9,e++,a[9]++;for(;e<=279;)sw[2*e+1]=7,e++,a[7]++;for(;e<=287;)sw[2*e+1]=8,e++,a[8]++;for(bw(sw,287,a),e=0;e<ew;e++)ow[2*e+1]=5,ow[2*e]=Sw(e,5);fw=new hw(sw,rw,257,$A,tw),pw=new hw(ow,nw,0,ew,tw),mw=new hw(new Array(0),iw,0,19,7)})(),Ow=!0),e.l_desc=new gw(e.dyn_ltree,fw),e.d_desc=new gw(e.dyn_dtree,pw),e.bl_desc=new gw(e.bl_tree,mw),e.bi_buf=0,e.bi_valid=0,Tw(e)},_tr_stored_block:Dw,_tr_flush_block:Pw,_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(cw[r]+QA+1)]++,e.dyn_dtree[2*vw(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{_w(e,2,3),Ew(e,256,sw),(e=>{16===e.bi_valid?(yw(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Mw=(e,t,r,n)=>{let i=65535&e|0,a=e>>>16&65535|0,s=0;for(;0!==r;){s=r>2e3?2e3:r,r-=s;do{i=i+t[n++]|0,a=a+i|0}while(--s);i%=65521,a%=65521}return i|a<<16|0};const Nw=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Fw=(e,t,r,n)=>{const i=Nw,a=n+r;e^=-1;for(let s=n;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},Uw={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Bw={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:jw,_tr_stored_block:Hw,_tr_flush_block:Vw,_tr_tally:Gw,_tr_align:zw}=xw,{Z_NO_FLUSH:Kw,Z_PARTIAL_FLUSH:Ww,Z_FULL_FLUSH:Yw,Z_FINISH:qw,Z_BLOCK:Zw,Z_OK:Xw,Z_STREAM_END:Jw,Z_STREAM_ERROR:Qw,Z_DATA_ERROR:$w,Z_BUF_ERROR:eL,Z_DEFAULT_COMPRESSION:tL,Z_FILTERED:rL,Z_HUFFMAN_ONLY:nL,Z_RLE:iL,Z_FIXED:aL,Z_DEFAULT_STRATEGY:sL,Z_UNKNOWN:oL,Z_DEFLATED:lL}=Bw,cL=258,uL=262,dL=42,hL=113,fL=666,pL=(e,t)=>(e.msg=Uw[t],t),mL=e=>2*e-(e>4?9:0),gL=e=>{let t=e.length;for(;--t>=0;)e[t]=0},vL=e=>{let t,r,n,i=e.w_size;t=e.hash_size,n=t;do{r=e.head[--n],e.head[n]=r>=i?r-i:0}while(--t);t=i,n=t;do{r=e.prev[--n],e.prev[n]=r>=i?r-i:0}while(--t)};let yL=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const _L=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},EL=(e,t)=>{Vw(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_L(e.strm)},SL=(e,t)=>{e.pending_buf[e.pending++]=t},bL=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},TL=(e,t,r,n)=>{let i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),1===e.state.wrap?e.adler=Mw(e.adler,t,i,r):2===e.state.wrap&&(e.adler=Fw(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},RL=(e,t)=>{let r,n,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-uL?e.strstart-(e.w_size-uL):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+cL;let f=c[a+s-1],p=c[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(r=t,c[r+s]===p&&c[r+s-1]===f&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do{}while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&a<h);if(n=cL-(h-a),a=h-cL,n>s){if(e.match_start=t,s=n,n>=o)break;f=c[a+s-1],p=c[a+s]}}}while((t=d[t&u])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead},AL=e=>{const t=e.w_size;let r,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-uL)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),vL(e),n+=t),0===e.strm.avail_in)break;if(r=TL(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=yL(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=yL(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<uL&&0!==e.strm.avail_in)},wL=(e,t)=>{let r,n,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(r=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>i&&(r=i),r<a&&(0===r&&t!==qw||t===Kw||r!==n+e.strm.avail_in))break;s=t===qw&&r===n+e.strm.avail_in?1:0,Hw(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,_L(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(TL(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Kw&&t!==qw&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(TL(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=a||(n||t===qw)&&t!==Kw&&0===e.strm.avail_in&&n<=i)&&(r=n>i?i:n,s=t===qw&&0===e.strm.avail_in&&r===n?1:0,Hw(e,e.block_start,r,s),e.block_start+=r,_L(e.strm)),s?3:1)},LL=(e,t)=>{let r,n;for(;;){if(e.lookahead<uL){if(AL(e),e.lookahead<uL&&t===Kw)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=yL(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-uL&&(e.match_length=RL(e,r)),e.match_length>=3)if(n=Gw(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=yL(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=yL(e,e.ins_h,e.window[e.strstart+1]);else n=Gw(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(EL(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===qw?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2},CL=(e,t)=>{let r,n,i;for(;;){if(e.lookahead<uL){if(AL(e),e.lookahead<uL&&t===Kw)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=yL(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-uL&&(e.match_length=RL(e,r),e.match_length<=5&&(e.strategy===rL||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Gw(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=yL(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(EL(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Gw(e,0,e.window[e.strstart-1]),n&&EL(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Gw(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===qw?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2};function IL(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}const kL=[new IL(0,0,0,0,wL),new IL(4,4,8,4,LL),new IL(4,5,16,8,LL),new IL(4,6,32,32,LL),new IL(4,4,16,16,CL),new IL(8,16,32,32,CL),new IL(8,16,128,128,CL),new IL(8,32,128,256,CL),new IL(32,128,258,1024,CL),new IL(32,258,258,4096,CL)];function OL(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=lL,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),gL(this.dyn_ltree),gL(this.dyn_dtree),gL(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),gL(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),gL(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const DL=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==dL&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==hL&&t.status!==fL?1:0},PL=e=>{if(DL(e))return pL(e,Qw);e.total_in=e.total_out=0,e.data_type=oL;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?dL:hL,e.adler=2===t.wrap?0:1,t.last_flush=-2,jw(t),Xw},xL=e=>{const t=PL(e);var r;return t===Xw&&((r=e.state).window_size=2*r.w_size,gL(r.head),r.max_lazy_match=kL[r.level].max_lazy,r.good_match=kL[r.level].good_length,r.nice_match=kL[r.level].nice_length,r.max_chain_length=kL[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},ML=(e,t,r,n,i,a)=>{if(!e)return Qw;let s=1;if(t===tL&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>9||r!==lL||n<8||n>15||t<0||t>9||a<0||a>aL||8===n&&1!==s)return pL(e,Qw);8===n&&(n=9);const o=new OL;return e.state=o,o.strm=e,o.status=dL,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=a,o.method=r,xL(e)};var NL=(e,t)=>DL(e)||2!==e.state.wrap?Qw:(e.state.gzhead=t,Xw),FL=(e,t)=>{if(DL(e)||t>Zw||t<0)return e?pL(e,Qw):Qw;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===fL&&t!==qw)return pL(e,0===e.avail_out?eL:Qw);const n=r.last_flush;if(r.last_flush=t,0!==r.pending){if(_L(e),0===e.avail_out)return r.last_flush=-1,Xw}else if(0===e.avail_in&&mL(t)<=mL(n)&&t!==qw)return pL(e,eL);if(r.status===fL&&0!==e.avail_in)return pL(e,eL);if(r.status===dL&&0===r.wrap&&(r.status=hL),r.status===dL){let t=lL+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=nL||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=n<<6,0!==r.strstart&&(t|=32),t+=31-t%31,bL(r,t),0!==r.strstart&&(bL(r,e.adler>>>16),bL(r,65535&e.adler)),e.adler=1,r.status=hL,_L(e),0!==r.pending)return r.last_flush=-1,Xw}if(57===r.status)if(e.adler=0,SL(r,31),SL(r,139),SL(r,8),r.gzhead)SL(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),SL(r,255&r.gzhead.time),SL(r,r.gzhead.time>>8&255),SL(r,r.gzhead.time>>16&255),SL(r,r.gzhead.time>>24&255),SL(r,9===r.level?2:r.strategy>=nL||r.level<2?4:0),SL(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(SL(r,255&r.gzhead.extra.length),SL(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Fw(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(SL(r,0),SL(r,0),SL(r,0),SL(r,0),SL(r,0),SL(r,9===r.level?2:r.strategy>=nL||r.level<2?4:0),SL(r,3),r.status=hL,_L(e),0!==r.pending)return r.last_flush=-1,Xw;if(69===r.status){if(r.gzhead.extra){let t=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let i=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=Fw(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=i,_L(e),0!==r.pending)return r.last_flush=-1,Xw;t=0,n-=i}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>t&&(e.adler=Fw(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=Fw(e.adler,r.pending_buf,r.pending-n,n)),_L(e),0!==r.pending)return r.last_flush=-1,Xw;n=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,SL(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=Fw(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=Fw(e.adler,r.pending_buf,r.pending-n,n)),_L(e),0!==r.pending)return r.last_flush=-1,Xw;n=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,SL(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=Fw(e.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(_L(e),0!==r.pending))return r.last_flush=-1,Xw;SL(r,255&e.adler),SL(r,e.adler>>8&255),e.adler=0}if(r.status=hL,_L(e),0!==r.pending)return r.last_flush=-1,Xw}if(0!==e.avail_in||0!==r.lookahead||t!==Kw&&r.status!==fL){let n=0===r.level?wL(r,t):r.strategy===nL?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(AL(e),0===e.lookahead)){if(t===Kw)return 1;break}if(e.match_length=0,r=Gw(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(EL(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===qw?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===iL?((e,t)=>{let r,n,i,a;const s=e.window;for(;;){if(e.lookahead<=cL){if(AL(e),e.lookahead<=cL&&t===Kw)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,n=s[i],n===s[++i]&&n===s[++i]&&n===s[++i])){a=e.strstart+cL;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=cL-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Gw(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Gw(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(EL(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===qw?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2})(r,t):kL[r.level].func(r,t);if(3!==n&&4!==n||(r.status=fL),1===n||3===n)return 0===e.avail_out&&(r.last_flush=-1),Xw;if(2===n&&(t===Ww?zw(r):t!==Zw&&(Hw(r,0,0,!1),t===Yw&&(gL(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),_L(e),0===e.avail_out))return r.last_flush=-1,Xw}return t!==qw?Xw:r.wrap<=0?Jw:(2===r.wrap?(SL(r,255&e.adler),SL(r,e.adler>>8&255),SL(r,e.adler>>16&255),SL(r,e.adler>>24&255),SL(r,255&e.total_in),SL(r,e.total_in>>8&255),SL(r,e.total_in>>16&255),SL(r,e.total_in>>24&255)):(bL(r,e.adler>>>16),bL(r,65535&e.adler)),_L(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Xw:Jw)},UL={deflateInit:(e,t)=>ML(e,t,lL,15,8,sL),deflateInit2:ML,deflateReset:xL,deflateResetKeep:PL,deflateSetHeader:NL,deflate:FL,deflateEnd:e=>{if(DL(e))return Qw;const t=e.state.status;return e.state=null,t===hL?pL(e,$w):Xw},deflateSetDictionary:(e,t)=>{let r=t.length;if(DL(e))return Qw;const n=e.state,i=n.wrap;if(2===i||1===i&&n.status!==dL||n.lookahead)return Qw;if(1===i&&(e.adler=Mw(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===i&&(gL(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const a=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,AL(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=yL(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,AL(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=o,e.avail_in=a,n.wrap=i,Xw},deflateInfo:"pako deflate (from Nodeca project)"};const BL=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var jL={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)BL(r,t)&&(e[t]=r[t])}}return e},flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,i=0,a=e.length;n<a;n++){let t=e[n];r.set(t,i),i+=t.length}return r}};let HL=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Yk){HL=!1}const VL=new Uint8Array(256);for(let qk=0;qk<256;qk++)VL[qk]=qk>=252?6:qk>=248?5:qk>=240?4:qk>=224?3:qk>=192?2:1;VL[254]=VL[254]=1;var GL={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,n,i,a,s=e.length,o=0;for(i=0;i<s;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<s&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<s&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,i;const a=new Array(2*r);for(i=0,n=0;n<r;){let t=e[n++];if(t<128){a[i++]=t;continue}let s=VL[t];if(s>4)a[i++]=65533,n+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&n<r;)t=t<<6|63&e[n++],s--;s>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&HL)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r})(a,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+VL[e[r]]>t?r:t}};var zL=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const KL=Object.prototype.toString,{Z_NO_FLUSH:WL,Z_SYNC_FLUSH:YL,Z_FULL_FLUSH:qL,Z_FINISH:ZL,Z_OK:XL,Z_STREAM_END:JL,Z_DEFAULT_COMPRESSION:QL,Z_DEFAULT_STRATEGY:$L,Z_DEFLATED:eC}=Bw;function tC(e){this.options=jL.assign({level:QL,method:eC,chunkSize:16384,windowBits:15,memLevel:8,strategy:$L},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zL,this.strm.avail_out=0;let r=UL.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==XL)throw new Error(Uw[r]);if(t.header&&UL.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?GL.string2buf(t.dictionary):"[object ArrayBuffer]"===KL.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=UL.deflateSetDictionary(this.strm,e),r!==XL)throw new Error(Uw[r]);this._dict_set=!0}}function rC(e,t){const r=new tC(t);if(r.push(e,!0),r.err)throw r.msg||Uw[r.err];return r.result}tC.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?ZL:WL,"string"==typeof e?r.input=GL.string2buf(e):"[object ArrayBuffer]"===KL.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(a===YL||a===qL)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=UL.deflate(r,a),i===JL)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=UL.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===XL;if(0!==r.avail_out){if(a>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},tC.prototype.onData=function(e){this.chunks.push(e)},tC.prototype.onEnd=function(e){e===XL&&(this.result=jL.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nC={Deflate:tC,deflate:rC,deflateRaw:function(e,t){return(t=t||{}).raw=!0,rC(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,rC(e,t)},constants:Bw};const iC=16209;var aC=function(e,t){let r,n,i,a,s,o,l,c,u,d,h,f,p,m,g,v,y,_,E,S,b,T,R,A;const w=e.state;r=e.next_in,R=e.input,n=r+(e.avail_in-5),i=e.next_out,A=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),o=w.dmax,l=w.wsize,c=w.whave,u=w.wnext,d=w.window,h=w.hold,f=w.bits,p=w.lencode,m=w.distcode,g=(1<<w.lenbits)-1,v=(1<<w.distbits)-1;e:do{f<15&&(h+=R[r++]<<f,f+=8,h+=R[r++]<<f,f+=8),y=p[h&g];t:for(;;){if(_=y>>>24,h>>>=_,f-=_,_=y>>>16&255,0===_)A[i++]=65535&y;else{if(!(16&_)){if(0==(64&_)){y=p[(65535&y)+(h&(1<<_)-1)];continue t}if(32&_){w.mode=16191;break e}e.msg="invalid literal/length code",w.mode=iC;break e}E=65535&y,_&=15,_&&(f<_&&(h+=R[r++]<<f,f+=8),E+=h&(1<<_)-1,h>>>=_,f-=_),f<15&&(h+=R[r++]<<f,f+=8,h+=R[r++]<<f,f+=8),y=m[h&v];r:for(;;){if(_=y>>>24,h>>>=_,f-=_,_=y>>>16&255,!(16&_)){if(0==(64&_)){y=m[(65535&y)+(h&(1<<_)-1)];continue r}e.msg="invalid distance code",w.mode=iC;break e}if(S=65535&y,_&=15,f<_&&(h+=R[r++]<<f,f+=8,f<_&&(h+=R[r++]<<f,f+=8)),S+=h&(1<<_)-1,S>o){e.msg="invalid distance too far back",w.mode=iC;break e}if(h>>>=_,f-=_,_=i-a,S>_){if(_=S-_,_>c&&w.sane){e.msg="invalid distance too far back",w.mode=iC;break e}if(b=0,T=d,0===u){if(b+=l-_,_<E){E-=_;do{A[i++]=d[b++]}while(--_);b=i-S,T=A}}else if(u<_){if(b+=l+u-_,_-=u,_<E){E-=_;do{A[i++]=d[b++]}while(--_);if(b=0,u<E){_=u,E-=_;do{A[i++]=d[b++]}while(--_);b=i-S,T=A}}}else if(b+=u-_,_<E){E-=_;do{A[i++]=d[b++]}while(--_);b=i-S,T=A}for(;E>2;)A[i++]=T[b++],A[i++]=T[b++],A[i++]=T[b++],E-=3;E&&(A[i++]=T[b++],E>1&&(A[i++]=T[b++]))}else{b=i-S;do{A[i++]=A[b++],A[i++]=A[b++],A[i++]=A[b++],E-=3}while(E>2);E&&(A[i++]=A[b++],E>1&&(A[i++]=A[b++]))}break}}break}}while(r<n&&i<s);E=f>>3,r-=E,f-=E<<3,h&=(1<<f)-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<s?s-i+257:257-(i-s),w.hold=h,w.bits=f};const sC=15,oC=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lC=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),cC=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uC=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var dC=(e,t,r,n,i,a,s,o)=>{const l=o.bits;let c,u,d,h,f,p,m=0,g=0,v=0,y=0,_=0,E=0,S=0,b=0,T=0,R=0,A=null;const w=new Uint16Array(16),L=new Uint16Array(16);let C,I,k,O=null;for(m=0;m<=sC;m++)w[m]=0;for(g=0;g<n;g++)w[t[r+g]]++;for(_=l,y=sC;y>=1&&0===w[y];y--);if(_>y&&(_=y),0===y)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(v=1;v<y&&0===w[v];v++);for(_<v&&(_=v),b=1,m=1;m<=sC;m++)if(b<<=1,b-=w[m],b<0)return-1;if(b>0&&(0===e||1!==y))return-1;for(L[1]=0,m=1;m<sC;m++)L[m+1]=L[m]+w[m];for(g=0;g<n;g++)0!==t[r+g]&&(s[L[t[r+g]]++]=g);if(0===e?(A=O=s,p=20):1===e?(A=oC,O=lC,p=257):(A=cC,O=uC,p=0),R=0,g=0,m=v,f=a,E=_,S=0,d=-1,T=1<<_,h=T-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){C=m-S,s[g]+1<p?(I=0,k=s[g]):s[g]>=p?(I=O[s[g]-p],k=A[s[g]-p]):(I=96,k=0),c=1<<m-S,u=1<<E,v=u;do{u-=c,i[f+(R>>S)+u]=C<<24|I<<16|k|0}while(0!==u);for(c=1<<m-1;R&c;)c>>=1;if(0!==c?(R&=c-1,R+=c):R=0,g++,0==--w[m]){if(m===y)break;m=t[r+s[g]]}if(m>_&&(R&h)!==d){for(0===S&&(S=_),f+=v,E=m-S,b=1<<E;E+S<y&&(b-=w[E+S],!(b<=0));)E++,b<<=1;if(T+=1<<E,1===e&&T>852||2===e&&T>592)return 1;d=R&h,i[d]=_<<24|E<<16|f-a|0}}return 0!==R&&(i[f+R]=m-S<<24|64<<16|0),o.bits=_,0};const{Z_FINISH:hC,Z_BLOCK:fC,Z_TREES:pC,Z_OK:mC,Z_STREAM_END:gC,Z_NEED_DICT:vC,Z_STREAM_ERROR:yC,Z_DATA_ERROR:_C,Z_MEM_ERROR:EC,Z_BUF_ERROR:SC,Z_DEFLATED:bC}=Bw,TC=16180,RC=16190,AC=16191,wC=16192,LC=16194,CC=16199,IC=16200,kC=16206,OC=16209,DC=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function PC(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const xC=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<TC||t.mode>16211?1:0},MC=e=>{if(xC(e))return yC;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=TC,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,mC},NC=e=>{if(xC(e))return yC;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,MC(e)},FC=(e,t)=>{let r;if(xC(e))return yC;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?yC:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,NC(e))},UC=(e,t)=>{if(!e)return yC;const r=new PC;e.state=r,r.strm=e,r.window=null,r.mode=TC;const n=FC(e,t);return n!==mC&&(e.state=null),n};let BC,jC,HC=!0;const VC=e=>{if(HC){BC=new Int32Array(512),jC=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(dC(1,e.lens,0,288,BC,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;dC(2,e.lens,0,32,jC,0,e.work,{bits:5}),HC=!1}e.lencode=BC,e.lenbits=9,e.distcode=jC,e.distbits=5},GC=(e,t,r,n)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>n&&(i=n),a.window.set(t.subarray(r-n,r-n+i),a.wnext),(n-=i)?(a.window.set(t.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var zC=(e,t)=>{let r,n,i,a,s,o,l,c,u,d,h,f,p,m,g,v,y,_,E,S,b,T,R=0;const A=new Uint8Array(4);let w,L;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(xC(e)||!e.output||!e.input&&0!==e.avail_in)return yC;r=e.state,r.mode===AC&&(r.mode=wC),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,c=r.hold,u=r.bits,d=o,h=l,T=mC;e:for(;;)switch(r.mode){case TC:if(0===r.wrap){r.mode=wC;break}for(;u<16;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(2&r.wrap&&35615===c){0===r.wbits&&(r.wbits=15),r.check=0,A[0]=255&c,A[1]=c>>>8&255,r.check=Fw(r.check,A,2,0),c=0,u=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=OC;break}if((15&c)!==bC){e.msg="unknown compression method",r.mode=OC;break}if(c>>>=4,u-=4,b=8+(15&c),0===r.wbits&&(r.wbits=b),b>15||b>r.wbits){e.msg="invalid window size",r.mode=OC;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&c?16189:AC,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(r.flags=c,(255&r.flags)!==bC){e.msg="unknown compression method",r.mode=OC;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=OC;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&4&r.wrap&&(A[0]=255&c,A[1]=c>>>8&255,r.check=Fw(r.check,A,2,0)),c=0,u=0,r.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}r.head&&(r.head.time=c),512&r.flags&&4&r.wrap&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,r.check=Fw(r.check,A,4,0)),c=0,u=0,r.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&4&r.wrap&&(A[0]=255&c,A[1]=c>>>8&255,r.check=Fw(r.check,A,2,0)),c=0,u=0,r.mode=16184;case 16184:if(1024&r.flags){for(;u<16;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&4&r.wrap&&(A[0]=255&c,A[1]=c>>>8&255,r.check=Fw(r.check,A,2,0)),c=0,u=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(f=r.length,f>o&&(f=o),f&&(r.head&&(b=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(a,a+f),b)),512&r.flags&&4&r.wrap&&(r.check=Fw(r.check,n,f,a)),o-=f,a+=f,r.length-=f),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===o)break e;f=0;do{b=n[a+f++],r.head&&b&&r.length<65536&&(r.head.name+=String.fromCharCode(b))}while(b&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=Fw(r.check,n,f,a)),o-=f,a+=f,b)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===o)break e;f=0;do{b=n[a+f++],r.head&&b&&r.length<65536&&(r.head.comment+=String.fromCharCode(b))}while(b&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=Fw(r.check,n,f,a)),o-=f,a+=f,b)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;u<16;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(4&r.wrap&&c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=OC;break}c=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=AC;break;case 16189:for(;u<32;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}e.adler=r.check=DC(c),c=0,u=0,r.mode=RC;case RC:if(0===r.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=c,r.bits=u,vC;e.adler=r.check=1,r.mode=AC;case AC:if(t===fC||t===pC)break e;case wC:if(r.last){c>>>=7&u,u-=7&u,r.mode=kC;break}for(;u<3;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}switch(r.last=1&c,c>>>=1,u-=1,3&c){case 0:r.mode=16193;break;case 1:if(VC(r),r.mode=CC,t===pC){c>>>=2,u-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=OC}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=OC;break}if(r.length=65535&c,c=0,u=0,r.mode=LC,t===pC)break e;case LC:r.mode=16195;case 16195:if(f=r.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;i.set(n.subarray(a,a+f),s),o-=f,a+=f,l-=f,s+=f,r.length-=f;break}r.mode=AC;break;case 16196:for(;u<14;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(r.nlen=257+(31&c),c>>>=5,u-=5,r.ndist=1+(31&c),c>>>=5,u-=5,r.ncode=4+(15&c),c>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=OC;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;u<3;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}r.lens[C[r.have++]]=7&c,c>>>=3,u-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,w={bits:r.lenbits},T=dC(0,r.lens,0,19,r.lencode,0,r.work,w),r.lenbits=w.bits,T){e.msg="invalid code lengths set",r.mode=OC;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;R=r.lencode[c&(1<<r.lenbits)-1],g=R>>>24,v=R>>>16&255,y=65535&R,!(g<=u);){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(y<16)c>>>=g,u-=g,r.lens[r.have++]=y;else{if(16===y){for(L=g+2;u<L;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(c>>>=g,u-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=OC;break}b=r.lens[r.have-1],f=3+(3&c),c>>>=2,u-=2}else if(17===y){for(L=g+3;u<L;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}c>>>=g,u-=g,b=0,f=3+(7&c),c>>>=3,u-=3}else{for(L=g+7;u<L;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}c>>>=g,u-=g,b=0,f=11+(127&c),c>>>=7,u-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=OC;break}for(;f--;)r.lens[r.have++]=b}}if(r.mode===OC)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=OC;break}if(r.lenbits=9,w={bits:r.lenbits},T=dC(1,r.lens,0,r.nlen,r.lencode,0,r.work,w),r.lenbits=w.bits,T){e.msg="invalid literal/lengths set",r.mode=OC;break}if(r.distbits=6,r.distcode=r.distdyn,w={bits:r.distbits},T=dC(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,w),r.distbits=w.bits,T){e.msg="invalid distances set",r.mode=OC;break}if(r.mode=CC,t===pC)break e;case CC:r.mode=IC;case IC:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=c,r.bits=u,aC(e,h),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,c=r.hold,u=r.bits,r.mode===AC&&(r.back=-1);break}for(r.back=0;R=r.lencode[c&(1<<r.lenbits)-1],g=R>>>24,v=R>>>16&255,y=65535&R,!(g<=u);){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(v&&0==(240&v)){for(_=g,E=v,S=y;R=r.lencode[S+((c&(1<<_+E)-1)>>_)],g=R>>>24,v=R>>>16&255,y=65535&R,!(_+g<=u);){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}c>>>=_,u-=_,r.back+=_}if(c>>>=g,u-=g,r.back+=g,r.length=y,0===v){r.mode=16205;break}if(32&v){r.back=-1,r.mode=AC;break}if(64&v){e.msg="invalid literal/length code",r.mode=OC;break}r.extra=15&v,r.mode=16201;case 16201:if(r.extra){for(L=r.extra;u<L;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;R=r.distcode[c&(1<<r.distbits)-1],g=R>>>24,v=R>>>16&255,y=65535&R,!(g<=u);){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(0==(240&v)){for(_=g,E=v,S=y;R=r.distcode[S+((c&(1<<_+E)-1)>>_)],g=R>>>24,v=R>>>16&255,y=65535&R,!(_+g<=u);){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}c>>>=_,u-=_,r.back+=_}if(c>>>=g,u-=g,r.back+=g,64&v){e.msg="invalid distance code",r.mode=OC;break}r.offset=y,r.extra=15&v,r.mode=16203;case 16203:if(r.extra){for(L=r.extra;u<L;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=OC;break}r.mode=16204;case 16204:if(0===l)break e;if(f=h-l,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=OC;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=i,p=s-r.offset,f=r.length;f>l&&(f=l),l-=f,r.length-=f;do{i[s++]=m[p++]}while(--f);0===r.length&&(r.mode=IC);break;case 16205:if(0===l)break e;i[s++]=r.length,l--,r.mode=IC;break;case kC:if(r.wrap){for(;u<32;){if(0===o)break e;o--,c|=n[a++]<<u,u+=8}if(h-=l,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?Fw(r.check,i,h,s-h):Mw(r.check,i,h,s-h)),h=l,4&r.wrap&&(r.flags?c:DC(c))!==r.check){e.msg="incorrect data check",r.mode=OC;break}c=0,u=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;u<32;){if(0===o)break e;o--,c+=n[a++]<<u,u+=8}if(4&r.wrap&&c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=OC;break}c=0,u=0}r.mode=16208;case 16208:T=gC;break e;case OC:T=_C;break e;case 16210:return EC;default:return yC}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=c,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<OC&&(r.mode<kC||t!==hC))&&GC(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?Fw(r.check,i,h,e.next_out-h):Mw(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===AC?128:0)+(r.mode===CC||r.mode===LC?256:0),(0===d&&0===h||t===hC)&&T===mC&&(T=SC),T},KC=(e,t)=>{if(xC(e))return yC;const r=e.state;return 0==(2&r.wrap)?yC:(r.head=t,t.done=!1,mC)},WC={inflateReset:NC,inflateReset2:FC,inflateResetKeep:MC,inflateInit:e=>UC(e,15),inflateInit2:UC,inflate:zC,inflateEnd:e=>{if(xC(e))return yC;let t=e.state;return t.window&&(t.window=null),e.state=null,mC},inflateGetHeader:KC,inflateSetDictionary:(e,t)=>{const r=t.length;let n,i,a;return xC(e)?yC:(n=e.state,0!==n.wrap&&n.mode!==RC?yC:n.mode===RC&&(i=1,i=Mw(i,t,r,0),i!==n.check)?_C:(a=GC(e,t,r,r),a?(n.mode=16210,EC):(n.havedict=1,mC)))},inflateInfo:"pako inflate (from Nodeca project)"};var YC=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const qC=Object.prototype.toString,{Z_NO_FLUSH:ZC,Z_FINISH:XC,Z_OK:JC,Z_STREAM_END:QC,Z_NEED_DICT:$C,Z_STREAM_ERROR:eI,Z_DATA_ERROR:tI,Z_MEM_ERROR:rI}=Bw;function nI(e){this.options=jL.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zL,this.strm.avail_out=0;let r=WC.inflateInit2(this.strm,t.windowBits);if(r!==JC)throw new Error(Uw[r]);if(this.header=new YC,WC.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=GL.string2buf(t.dictionary):"[object ArrayBuffer]"===qC.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=WC.inflateSetDictionary(this.strm,t.dictionary),r!==JC)))throw new Error(Uw[r])}function iI(e,t){const r=new nI(t);if(r.push(e),r.err)throw r.msg||Uw[r.err];return r.result}nI.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let a,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?XC:ZC,"[object ArrayBuffer]"===qC.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),a=WC.inflate(r,s),a===$C&&i&&(a=WC.inflateSetDictionary(r,i),a===JC?a=WC.inflate(r,s):a===tI&&(a=$C));r.avail_in>0&&a===QC&&r.state.wrap>0&&0!==e[r.next_in];)WC.inflateReset(r),a=WC.inflate(r,s);switch(a){case eI:case tI:case $C:case rI:return this.onEnd(a),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(0===r.avail_out||a===QC))if("string"===this.options.to){let e=GL.utf8border(r.output,r.next_out),t=r.next_out-e,i=GL.buf2string(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(i)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(a!==JC||0!==o){if(a===QC)return a=WC.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},nI.prototype.onData=function(e){this.chunks.push(e)},nI.prototype.onEnd=function(e){e===JC&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=jL.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var aI={Inflate:nI,inflate:iI,inflateRaw:function(e,t){return(t=t||{}).raw=!0,iI(e,t)},ungzip:iI,constants:Bw};const{Deflate:sI,deflate:oI,deflateRaw:lI,gzip:cI}=nC,{Inflate:uI,inflate:dI,inflateRaw:hI,ungzip:fI}=aI;var pI,mI,gI,vI,yI,_I,EI,SI,bI,TI,RI,AI,wI,LI,CI,II,kI,OI,DI={Deflate:sI,deflate:oI,deflateRaw:lI,gzip:cI,Inflate:uI,inflate:dI,inflateRaw:hI,ungzip:fI,constants:Bw};class PI{constructor(e){Yl(this,"module_","FlvPlayer"),this.loadingUtils=new xR(e.parentDiv),this.event=e.eventEmitter,this.playerEventHandler={errorHandler:(e,t)=>{if($_.error(this.module_,"event ERROR: ".concat(JSON.stringify(e))),this.loadingMask(!1),e===aS.ErrorTypes.NETWORK_ERROR)switch(t){case aS.ErrorDetails.NETWORK_EXCEPTION:this.event.emit("Error",{errCode:Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL,errDesc:Ph[Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL]});break;case aS.ErrorDetails.NETWORK_STATUS_CODE_INVALID:this.event.emit("Error",{errCode:Dh.HWLLS_ERROR_STREAM_NOT_EXIST,errDesc:Ph[Dh.HWLLS_ERROR_STREAM_NOT_EXIST]});break;case aS.ErrorDetails.NETWORK_TIMEOUT:this.event.emit("Error",{errCode:Dh.HWLLS_ERROR_SERVER_NO_RESPONSE,errDesc:Ph[Dh.HWLLS_ERROR_SERVER_NO_RESPONSE]});break;case aS.ErrorDetails.NETWORK_UNRECOVERABLE_EARLY_EOF:this.event.emit("Error",{errCode:Dh.HWLLS_ERROR_UNEXPECTED_EOF,errDesc:Ph[Dh.HWLLS_ERROR_UNEXPECTED_EOF]});break;default:this.event.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:t})}else if(e===aS.ErrorTypes.MEDIA_ERROR){const e=this.getMediaInfo();this.event.emit("Error",{errCode:Dh.HWLLS_ERROR_MEDIA_ERROR,errDesc:"".concat(t,", videoCodec: ").concat(e.videoCodec," and audioCodec: ").concat(e.audioCodec)})}else this.event.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:t||Ph[Dh.HWLLS_INTERNAL_ERROR]})},loadCompleteHandler:()=>{$_.info(this.module_,"event LOADING_COMPLETE")},unexpectedEOFHandler:e=>{$_.error(this.module_,"event RECOVERED_EARLY_EOF: ".concat(JSON.stringify(e)))},mediaDataArrived:e=>{$_.info(this.module_,"event METADATA_ARRIVED: ".concat(JSON.stringify(e))),this.event.emit(uT.VIDEO_START),this.event.emit(uT.AUDIO_START),this.loadingMask(!1),this.videoBufferedReday=!0},logHandler:(e,t)=>{$_[e](this.module_,t)}},this.parentDiv=e.parentDiv,this.objectFit=e.objectFit||fT.CONTAIN,this.muted=Boolean(e.muted),this.poster_=e.poster,this.createFlvPlayer(e.url),this.initPlayerListener()}async play(e,t){this.autoPlay=!1!==e,this.poster_&&(MR.attachPoster(this.parentDiv,this.poster_.url,this.poster_.mode||nT.FILL),!this.autoPlay&&this.poster_.startEnable&&MR.disPlayPoster(!0,this.poster_.url)),this.showLoading=t;let r=this.parentDiv.querySelector("#video_player");r||(r=document.createElement("video"),r.setAttribute("id","video_player"),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style["object-fit"]=this.objectFit,this.autoPlay&&r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),X_.isTencentX5BrowserKernel()&&r.setAttribute("x5-playsinline",""),this.parentDiv.appendChild(r));try{this.player.attachMediaElement(r),this.muted?this.player.muted=!0:this.player.volume=.5,this.player.load(),this.autoPlay&&(t&&this.loadingMask(!0),await this.player.play())}catch(Wk){var n;throw $_.error(this.module_,"play failed, errmsg=".concat(Wk,",parentDiv id:").concat(null===(n=this.parentDiv)||void 0===n?void 0:n.id)),"NotAllowedError"===Wk.name?new xh(Dh.HWLLS_PLAY_NOT_ALLOW):new xh(Dh.HWLLS_INTERNAL_ERROR,Wk.message)}}pause(){var e;this.player&&(this.player.pause(),null!==(e=this.poster_)&&void 0!==e&&e.pauseEnable&&MR.disPlayPoster(!0,this.poster_.url))}async resume(){if(this.poster_&&MR.disPlayPoster(!1,this.poster_.url),this.player)return!this.videoBufferedReday&&this.showLoading&&this.loadingMask(!0),await this.player.play()}mute(e){this.player&&(this.player.muted=e,this.muted=e)}async switchPlay(e){var t;if(this.videoBufferedReday=!1,this.offPlayerListener(),this.player.detachMediaElement(),this.player.unload(),this.player.destroy(),this.poster_=e.poster,this.createFlvPlayer(e.url),this.parentDiv&&this.parentDiv.id!==(null===(t=e.parentDiv)||void 0===t?void 0:t.id)){var r;const t=document.querySelector("#".concat(this.parentDiv.id," #video_player"));t&&this.parentDiv.appendChild(t),null===(r=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===r||r.remove(),this.parentDiv=e.parentDiv}this.initPlayerListener(),await this.play(e.autoPlay,e.showLoading)}stopPlay(){var e;this.videoBufferedReday=!1,this.loadingUtils.stopLoadingMask(),null===(e=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===e||e.remove(),this.poster_&&MR.detachPoster(this.parentDiv,this.poster_.url),this.offPlayerListener(),this.player.detachMediaElement(),this.player.unload(),this.player.destroy()}destory(){this.stopPlay(),this.player=null}getPlayoutVolume(){var e,t;return null!==(e=this.player)&&void 0!==e&&e.muted?0:100*((null===(t=this.player)||void 0===t?void 0:t.volume)||0)}setPlayoutVolume(e){return!!this.player&&(this.player.volume=Number((e/100).toFixed(2)),!0)}getMediaInfo(){var e;return null===(e=this.player)||void 0===e?void 0:e.mediaInfo}getStatisticInfo(){var e;return null===(e=this.player)||void 0===e?void 0:e.statisticsInfo}loadingMask(e){e?this.autoPlay&&this.loadingUtils.loadingMask(!0):this.loadingUtils.loadingMask(!1)}exitFullScreen(){NR.exitFullScreen()}enterFullScreen(){NR.enterFullScreen(this.parentDiv,this.parentDiv.querySelector("#video_player"),this.event)}createFlvPlayer(e){this.player=aS.createPlayer({type:"flv",isLive:!0,cors:!0,url:e},{enableWorker:!1,enableStashBuffer:!0,lazyLoad:!1}),aS.LoggingControl.applyConfig({enableAll:!1}),aS.LoggingControl.addLogListener(this.playerEventHandler.logHandler)}initPlayerListener(){this.player.on(aS.Events.ERROR,this.playerEventHandler.errorHandler),this.player.on(aS.Events.LOADING_COMPLETE,this.playerEventHandler.loadCompleteHandler),this.player.on(aS.Events.RECOVERED_EARLY_EOF,this.playerEventHandler.unexpectedEOFHandler),this.player.on(aS.Events.METADATA_ARRIVED,this.playerEventHandler.mediaDataArrived)}offPlayerListener(){var e,t,r,n;null===(e=this.player)||void 0===e||e.off(aS.Events.ERROR,this.playerEventHandler.errorHandler),null===(t=this.player)||void 0===t||t.off(aS.Events.LOADING_COMPLETE,this.playerEventHandler.loadCompleteHandler),null===(r=this.player)||void 0===r||r.off(aS.Events.RECOVERED_EARLY_EOF,this.playerEventHandler.unexpectedEOFHandler),null===(n=this.player)||void 0===n||n.off(aS.Events.METADATA_ARRIVED,this.playerEventHandler.mediaDataArrived),aS.LoggingControl.removeLogListener(this.playerEventHandler.logHandler)}}const xI="HWFlvClient";let MI=(pI=Pb("HWFlvClient$startPlay#Promise<void>#string#StartPlayOptions"),mI=Pb("HWFlvClient$switchPlay#Promise<boolean>#string#StartPlayOptions"),gI=xb("HWFlvClient$stopPlay#boolean#void"),vI=Pb("HWFlvClient$replay#Promise<boolean>#void"),yI=Pb("HWFlvClient$resume#Promise<boolean>#void"),_I=xb("HWFlvClient$pause#boolean#void"),EI=xb("HWFlvClient$pauseVideo#boolean#void"),SI=Pb("HWFlvClient$resumeVideo#Promsise<boolean>#void"),bI=xb("HWFlvClient$pauseAudio#boolean#void"),TI=Pb("HWFlvClient$resumeAudio#Promsise<boolean>#void"),RI=xb("HWFlvClient$setPlayoutVolume#boolean#number"),AI=xb("HWFlvClient$getPlayoutVolume#number#void"),wI=xb("HWFlvClient$muteAudio#void#boolean"),LI=xb("HWFlvClient$destoryClient#void#void"),CI=xb("HWFlvClient$fullScreenToggle#void#boolean"),II=xb("HWFlvClient$streamStatistic#void#boolean#number#ExecutableFunction"),kI=xb("HWFlvClient$enableStreamStateDetection#boolean#boolean#number"),OI=class extends tR{constructor(e,t){super(xI,e,t),Yl(this,"debugStatisticTimer",{timer:null,interval:1}),Yl(this,"detectTimer",{timer:null,interval:3,interruptRetry:null}),Yl(this,"recoveryInfo",{recoveryTimer:null,retryTimes:0,recoveryUrl:null})}async startPlay(e,t){$_.info(xI,"[KPI] startPlay url: ".concat($_.shieldUrlParameters(e))),this.startPlayOptions=t,e=e.replace(/\.m3u8/gi,".flv"),this.recoveryInfo.recoveryUrl=e;if(!XA.checkUrlFormat(e,pT.FLV))throw $_.error(xI,"startPlay failed, invalid Parameter: ".concat(e)),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);const r=document.getElementById(t.elementId);if(!r)throw $_.error(xI,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");this.flvPlayer=new PI({eventEmitter:this.eventEmitter,url:e,parentDiv:r,objectFit:t.objectFit,muted:t.muted,poster:this.startPlayOptions.poster}),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&MR.preLoadPoster(this.startPlayOptions.poster.url),await this.flvPlayer.play(this.startPlayOptions.autoPlay,t.showLoading).catch((e=>{e instanceof xh&&e.getCode()===Dh.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}):this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:Ph[Dh.HWLLS_INTERNAL_ERROR]})}))}async switchPlay(e,t){clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0,$_.info(xI,"[KPI] switchPlay url: ".concat($_.shieldUrlParameters(e))),this.startPlayOptions=t||this.startPlayOptions,e=e.replace(/\.m3u8/gi,".flv"),this.recoveryInfo.recoveryUrl=e;const r=document.getElementById(this.startPlayOptions.elementId);if(!r)throw $_.error(xI,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&MR.preLoadPoster(this.startPlayOptions.poster.url),await this.flvPlayer.switchPlay({url:e,parentDiv:r,objectFit:this.startPlayOptions.objectFit,muted:this.startPlayOptions.muted,autoPlay:this.startPlayOptions.autoPlay,showLoading:t.showLoading,poster:this.startPlayOptions.poster}).catch((e=>{e instanceof xh&&e.getCode()===Dh.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}):this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:Ph[Dh.HWLLS_INTERNAL_ERROR]})})),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}stopPlay(){return this.resetPlayer()}async replay(){if(this.flvPlayer)try{return await this.flvPlayer.resume(),!0}catch(Wk){return $_.error(xI,"resume failed: ".concat(Wk)),!1}return!1}async resume(){if(this.flvPlayer)try{return await this.flvPlayer.resume(),!0}catch(Wk){return $_.error(xI,"resume failed: ".concat(Wk)),!1}return!1}pause(){return!!this.flvPlayer&&(this.flvPlayer.pause(),!0)}pauseVideo(){return $_.error(xI,"flv player is not support pause video only."),!1}async resumeVideo(){return $_.error(xI,"flv player is not support resume video only."),!1}pauseAudio(){return!!this.flvPlayer&&(this.flvPlayer.mute(!0),!0)}async resumeAudio(){return!!this.flvPlayer&&(this.flvPlayer.mute(!1),!0)}setPlayoutVolume(e){return!!this.flvPlayer&&(this.flvPlayer.mute(!1),this.flvPlayer.setPlayoutVolume(e),!0)}getPlayoutVolume(){var e;return null===(e=this.flvPlayer)||void 0===e?void 0:e.getPlayoutVolume()}muteAudio(e){var t;null===(t=this.flvPlayer)||void 0===t||t.mute(e)}destoryClient(){var e;null===(e=this.flvPlayer)||void 0===e||e.destory(),this.offAllEvents()}fullScreenToggle(){var e,t;arguments.length>0&&void 0!==arguments[0]&&arguments[0]?null===(e=this.flvPlayer)||void 0===e||e.exitFullScreen():null===(t=this.flvPlayer)||void 0===t||t.enterFullScreen()}on(e,t){[uT.MEDIA_STATISTIC,uT.NET_QUALITY].includes(e)?super.on(e,t):super.on(e,t,!0)}off(e,t){[uT.MEDIA_STATISTIC,uT.NET_QUALITY].includes(e)?super.off(e,t):super.off(e,t,!0)}streamStatistic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e){if(!Number.isInteger(t)||t<1||t>60)throw $_.error(xI,"streamStatistic, invalid parameter of interval."),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);const e=0;this.getStreamStatisticInfo(e,t)}else clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1}}enableStreamStateDetection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0;if(!e)return clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},!0;if(!Number.isInteger(t)||t<1||t>60)throw $_.error(xI,"enableStreamStateDetection, invalid parameter of interval."),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);clearTimeout(this.detectTimer.timer);const n={preFramesDecoded:0,isInterrupted:!1};var i;this.flvPlayer&&(n.preFramesDecoded=X_.getValue(null===(i=this.flvPlayer.getStatisticInfo())||void 0===i?void 0:i.decodedFrames,0));return this.detectTimer.interval=t,this.detectTimer.interruptRetry=r,this.judgeStreamInterrupted(n,t,r),!0}judgeStreamInterrupted(e,t,r){this.detectTimer.timer=setTimeout((()=>{clearTimeout(this.detectTimer.timer);let n=null,i=!1;var a,s;this.flvPlayer&&(n=this.flvPlayer.getStatisticInfo(),i=X_.getValue(null===(a=n)||void 0===a?void 0:a.decodedFrames,0)-X_.getValue(e.preFramesDecoded,0)<=0,i||(clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0),n&&(e.preFramesDecoded=X_.getValue(n.decodedFrames,0)));if(e.isInterrupted&&!i)null===(s=this.flvPlayer)||void 0===s||s.loadingMask(!1),this.eventEmitter.emit(uT.VIDEO_RECOVERY),this.eventEmitter.emit(uT.AUDIO_RECOVERY),e.isInterrupted=!1;else if(!e.isInterrupted&&i){var o;this.startPlayOptions.showLoading&&(null===(o=this.flvPlayer)||void 0===o||o.loadingMask(!0)),this.eventEmitter.emit(uT.VIDEO_INTERRUPTED),this.eventEmitter.emit(uT.AUDIO_INTERRUPTED),e.isInterrupted=!0,null!=r&&r.enable&&($_.info(this.moudle_,"autoRecoverPlay timer start"),clearTimeout(this.recoveryInfo.recoveryTimer),this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,Math.max(10,(null==r?void 0:r.retryInterval)||30),(null==r?void 0:r.retryTimes)||30))}this.judgeStreamInterrupted(e,t,r)}),1e3*t)}autoRecoverPlay(e,t,r){let n=0;this.recoveryInfo.recoveryTimer=setTimeout((async()=>{if($_.info(this.moudle_,"autoRecoverPlay every ".concat(t," sencond")),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.recoveryTimer=null,e===this.recoveryInfo.recoveryUrl)try{this.recoveryInfo.retryTimes++,n=this.recoveryInfo.retryTimes,await this.switchPlay(e)}finally{this.recoveryInfo.retryTimes=n,n<r?this.autoRecoverPlay(e,t,r):this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_PLAY_FLV_RETRY_FAILED,errDesc:Ph[Dh.HWLLS_PLAY_FLV_RETRY_FAILED]})}else this.recoveryInfo.retryTimes=0}),1e3*t)}resetPlayer(){var e;return this.startPlayOptions=null,clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo={recoveryTimer:null,retryTimes:0,recoveryUrl:null},null===(e=this.flvPlayer)||void 0===e||e.stopPlay(),!0}getStreamStatisticInfo(e,t){this.debugStatisticTimer.interval=t,this.debugStatisticTimer.timer=setTimeout((()=>{clearTimeout(this.debugStatisticTimer.timer);const r={},n=this.flvPlayer.getMediaInfo();if(n.audioCodec&&(r.audio={mediaType:rT.TRACK_TYPE_AUDIO,bitRate:Math.round(n.audioDataRate),codec:n.audioCodec}),n.videoCodec){const i=this.flvPlayer.getStatisticInfo();r.video={mediaType:rT.TRACK_TYPE_VIDEO,codec:n.videoCodec,bitRate:Math.round(n.videoDataRate),frameRate:e>0?Number(((i.decodedFrames-e)/t).toFixed(1)):0,width:X_.getValue(n.width,0),height:X_.getValue(n.height,0)},e=i.decodedFrames}this.eventEmitter.emit(uT.MEDIA_STATISTIC,r),this.getStreamStatisticInfo(e,t)}),1e3*t)}},t(OI.prototype,"startPlay",[pI],Object.getOwnPropertyDescriptor(OI.prototype,"startPlay"),OI.prototype),t(OI.prototype,"switchPlay",[mI],Object.getOwnPropertyDescriptor(OI.prototype,"switchPlay"),OI.prototype),t(OI.prototype,"stopPlay",[gI],Object.getOwnPropertyDescriptor(OI.prototype,"stopPlay"),OI.prototype),t(OI.prototype,"replay",[vI],Object.getOwnPropertyDescriptor(OI.prototype,"replay"),OI.prototype),t(OI.prototype,"resume",[yI],Object.getOwnPropertyDescriptor(OI.prototype,"resume"),OI.prototype),t(OI.prototype,"pause",[_I],Object.getOwnPropertyDescriptor(OI.prototype,"pause"),OI.prototype),t(OI.prototype,"pauseVideo",[EI],Object.getOwnPropertyDescriptor(OI.prototype,"pauseVideo"),OI.prototype),t(OI.prototype,"resumeVideo",[SI],Object.getOwnPropertyDescriptor(OI.prototype,"resumeVideo"),OI.prototype),t(OI.prototype,"pauseAudio",[bI],Object.getOwnPropertyDescriptor(OI.prototype,"pauseAudio"),OI.prototype),t(OI.prototype,"resumeAudio",[TI],Object.getOwnPropertyDescriptor(OI.prototype,"resumeAudio"),OI.prototype),t(OI.prototype,"setPlayoutVolume",[RI],Object.getOwnPropertyDescriptor(OI.prototype,"setPlayoutVolume"),OI.prototype),t(OI.prototype,"getPlayoutVolume",[AI],Object.getOwnPropertyDescriptor(OI.prototype,"getPlayoutVolume"),OI.prototype),t(OI.prototype,"muteAudio",[wI],Object.getOwnPropertyDescriptor(OI.prototype,"muteAudio"),OI.prototype),t(OI.prototype,"destoryClient",[LI],Object.getOwnPropertyDescriptor(OI.prototype,"destoryClient"),OI.prototype),t(OI.prototype,"fullScreenToggle",[CI],Object.getOwnPropertyDescriptor(OI.prototype,"fullScreenToggle"),OI.prototype),t(OI.prototype,"streamStatistic",[II],Object.getOwnPropertyDescriptor(OI.prototype,"streamStatistic"),OI.prototype),t(OI.prototype,"enableStreamStateDetection",[kI],Object.getOwnPropertyDescriptor(OI.prototype,"enableStreamStateDetection"),OI.prototype),OI);class NI{constructor(e){Yl(this,"module_","HlsPlayer"),this.loadingUtils=new xR(e.parentDiv),this.event=e.eventEmitter,this.parentDiv=e.parentDiv,this.objectFit=e.objectFit||fT.CONTAIN,this.muted=Boolean(e.muted),this.playUrl=e.url,this.pauseCount=0,this.poster_=e.poster,this.createHlsPlayer(),this.mobilePlayTimer=null,this.playerEventHandler={errorHandler:e=>{$_.error(this.module_,"video element error encountered: ".concat(JSON.stringify(e)))},playingHandler:e=>{$_.debug(this.module_,"video element playing encountered: ".concat(JSON.stringify(e))),clearTimeout(this.mobilePlayTimer)},loadedMetaHandler:e=>{$_.debug(this.module_,"video element loadedMeta encountered: ".concat(JSON.stringify(e)))},loadedDataHandler:e=>{$_.debug(this.module_,"video element loadedData encountered: ".concat(JSON.stringify(e))),this.loadingMask(!1)},canPlayHandler:e=>{$_.info(this.module_,"video element canPlay encountered: ".concat(JSON.stringify(e))),this.event.emit("hlsCanPlay"),this.loadingMask(!1),this.videoBufferedReday=!0},mediaRecoverHandler:()=>{var e,t;null===(e=this.hlsPlayer)||void 0===e||e.swapAudioCodec(),null===(t=this.hlsPlayer)||void 0===t||t.recoverMediaError()},mediaAttachedHandler:()=>{$_.info(this.module_,"HlsPlayer MEDIA_ATTACHED")},manifestParsedHandler:(e,t)=>{$_.info(this.module_,"HlsPlayer MANIFEST_PARSED, quality level: ".concat(JSON.stringify(t.levels)," "))},levelSwitchedHandler:(e,t)=>{$_.info(this.module_,"HlsPlayer LEVEL_SWITCHED, ".concat(JSON.stringify(t)))},frameDropHandler:(e,t)=>{if($_.info(this.module_,"HlsPlayer FPS_DROP, ".concat(JSON.stringify(t))),!this.isNativePlayer){var r;const e=this.hlsPlayer.levels[this.hlsPlayer.currentLevel],n=(null===(r=this.statisticInfo)||void 0===r?void 0:r.totalFrameDecoded)||0;this.statisticInfo={width:e.width||0,height:e.height||0,audioCodec:e.audioCodec,videoCodec:e.videoCodec,bitRate:e.realBitrate||e.bitrate||0,frameRate:t.currentDecoded||0,totalFrameDecoded:t.currentDecoded+n,frameDropped:t.currentDropped||0,totalFrameDropped:t.totalDroppedFrames||0}}},frameDropLevelCappingHandler:(e,t)=>{$_.info(this.module_,"HlsPlayer FPS_DROP_LEVEL_CAPPING, ".concat(JSON.stringify(t)))},mediaErrHandler:(e,t)=>{if(t.fatal)switch(t.type){case oS.ErrorTypes.NETWORK_ERROR:$_.error(this.module_,"HlsPlayer NETWORK_ERROR ".concat(JSON.stringify(t.details)," encountered, try to recover")),this.hlsPlayer.startLoad();break;case oS.ErrorTypes.MEDIA_ERROR:$_.error(this.module_,"HlsPlayer NETWORK_ERROR ".concat(JSON.stringify(t)," encountered, try to recover")),this.event.emit(oS.ErrorTypes.MEDIA_ERROR),this.hlsPlayer.recoverMediaError(),this.event.once(oS.ErrorTypes.MEDIA_ERROR,this.playerEventHandler.mediaRecoverHandler);break;default:$_.error(this.module_,"HlsPlayer other fatal ERROR ".concat(JSON.stringify(t)," encountered, try to recover")),this.hlsPlayer.destroy()}}}}async play(e,t){return this.autoPlay=!1!==e,this.poster_&&(MR.attachPoster(this.parentDiv,this.poster_.url,this.poster_.mode||nT.FILL),!this.autoPlay&&this.poster_.startEnable&&MR.disPlayPoster(!0,this.poster_.url)),this.showLoading=t,new Promise(((e,t)=>{let r=this.parentDiv.querySelector("#video_player"),n=!1;if(r||(n=!0,r=document.createElement("video"),r.setAttribute("id","video_player"),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style["object-fit"]=this.objectFit,r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),X_.isTencentX5BrowserKernel()&&r.setAttribute("x5-playsinline",""),this.parentDiv.appendChild(r),this.player=r),this.offPlayerAndListener(),this.initPlayerAndListener(),this.muted?this.player.muted=!0:this.player.volume=.5,this.autoPlay)return this.mobilePlayTimer=setTimeout((()=>{$_.error(this.module_,"mobile device not autoPlay, please manually play the video"),this.event.emit("mobileDeviceManualPlay")}),5e3),void e();clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{$_.info(this.module_,"trigger videoCanPlay event by Timer"),this.event.emit("hlsCanPlay"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{$_.info(this.module_,"video playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,e()}),2e3)}),n?0:1e3),this.playerEventHandler.playHandler&&this.event.removeListener("hlsCanPlay",this.playerEventHandler.playHandler),this.playerEventHandler.playHandler=async()=>{var r;await PR.multiPlatformAdapter(),null===(r=this.player)||void 0===r||r.play().then((()=>{var t;$_.info(this.module_,"play success, parentDiv id:".concat(null===(t=this.parentDiv)||void 0===t?void 0:t.id)),this.afterPlayStrategy(),e()})).catch((e=>{var r;$_.error(this.module_,"play failed, errmsg=".concat(e,", parentDiv id:").concat(null===(r=this.parentDiv)||void 0===r?void 0:r.id)),"NotAllowedError"===e.name?t(new xh(Dh.HWLLS_PLAY_NOT_ALLOW)):t(new xh(Dh.HWLLS_INTERNAL_ERROR,e.message))})).finally((()=>{clearTimeout(this.playTimeOutTimer)}))},this.event.on("hlsCanPlay",this.playerEventHandler.playHandler)}))}pause(){var e,t;null===(e=this.player)||void 0===e||e.pause(),null!==(t=this.poster_)&&void 0!==t&&t.pauseEnable&&MR.disPlayPoster(!0,this.poster_.url)}async resume(){var e;this.poster_&&MR.disPlayPoster(!1,this.poster_.url),this.manualStartedPlay()||(this.playerEventHandler.playHandler&&this.event.removeListener("hlsCanPlay",this.playerEventHandler.playHandler),this.playerEventHandler.playHandler=()=>{var e;null===(e=this.player)||void 0===e||e.play()},this.event.on("hlsCanPlay",this.playerEventHandler.playHandler),!this.videoBufferedReday&&this.showLoading&&this.loadingMask(!0)),await(null===(e=this.player)||void 0===e?void 0:e.play())}mute(e){this.player&&(this.player.muted=e,this.muted=e)}async switchPlay(e){var t;if(this.statisticInfo=null,this.videoBufferedReday=!1,this.offPlayerAndListener(),this.parentDiv&&this.parentDiv.id!==(null===(t=e.parentDiv)||void 0===t?void 0:t.id)){var r;const t=document.querySelector("#".concat(this.parentDiv.id," #video_player"));t&&this.parentDiv.appendChild(t),null===(r=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===r||r.remove(),this.parentDiv=e.parentDiv}this.playUrl=e.url,this.poster_=e.poster,await this.play(e.autoPlay,e.showLoading)}stopPlay(){var e,t;this.loadingUtils.stopLoadingMask(),null===(e=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===e||e.remove(),this.poster_&&MR.detachPoster(this.parentDiv,this.poster_.url),this.offPlayerAndListener(),this.playUrl=null,this.videoBufferedReday=!1,clearTimeout(this.playTimeOutTimer),null===(t=this.hlsPlayer)||void 0===t||t.destroy()}destory(){this.stopPlay(),this.player=null,this.hlsPlayer=null}getPlayoutVolume(){var e,t;return null!==(e=this.player)&&void 0!==e&&e.muted?0:100*((null===(t=this.player)||void 0===t?void 0:t.volume)||0)}setPlayoutVolume(e){return!!this.player&&(this.player.volume=Number((e/100).toFixed(2)),!0)}getStatisticInfo(){return this.statisticInfo}loadingMask(e){e?(this.autoPlay||this.manualStartedPlay())&&this.loadingUtils.loadingMask(!0):this.loadingUtils.loadingMask(!1)}manualStartedPlay(){return this.event.eventNames().includes("hlsCanPlay")}createHlsPlayer(){document.createElement("video").canPlayType("application/vnd.apple.mpegurl")?this.isNativePlayer=!0:(this.hlsPlayer=new oS({debug:{trace:$_.trace,debug:$_.debug,log:$_.log,warn:$_.warn,info:$_.info,error:$_.error},initialLiveManifestSize:1,liveSyncDurationCount:3,enableWorker:!1,lowLatencyMode:!0,progressive:!0,capLevelOnFPSDrop:!0,fpsDroppedMonitoringPeriod:1e3,fpsDroppedMonitoringThreshold:.2,startFragPrefetch:!0}),this.hlsPlayer.loadSource(this.playUrl),this.isNativePlayer=!1)}initPlayerAndListener(){this.player&&(this.player.addEventListener("error",this.playerEventHandler.errorHandler),this.player.addEventListener("playing",this.playerEventHandler.playingHandler),this.player.addEventListener("loadedmetadata",this.playerEventHandler.loadedMetaHandler),this.player.addEventListener("loadeddata",this.playerEventHandler.loadedDataHandler),this.player.addEventListener("canplay",this.playerEventHandler.canPlayHandler)),!this.hlsPlayer&&this.player?(this.player.src=this.playUrl,this.player.load()):this.hlsPlayer&&this.player&&(this.hlsPlayer.attachMedia(this.player),this.hlsPlayer.on(oS.Events.MEDIA_ATTACHED,this.playerEventHandler.mediaAttachedHandler),this.hlsPlayer.on(oS.Events.MANIFEST_PARSED,this.playerEventHandler.manifestParsedHandler),this.hlsPlayer.on(oS.Events.LEVEL_SWITCHED,this.playerEventHandler.levelSwitchedHandler),this.hlsPlayer.on(oS.Events.FPS_DROP,this.playerEventHandler.frameDropHandler),this.hlsPlayer.on(oS.Events.FPS_DROP_LEVEL_CAPPING,this.playerEventHandler.frameDropLevelCappingHandler),this.hlsPlayer.on(oS.Events.ERROR,this.playerEventHandler.mediaErrHandler))}offPlayerAndListener(){!this.hlsPlayer&&this.player?this.player.src=null:this.hlsPlayer&&this.player&&(this.hlsPlayer.detachMedia(),this.hlsPlayer.off(oS.Events.MEDIA_ATTACHED,this.playerEventHandler.mediaAttachedHandler),this.hlsPlayer.off(oS.Events.MANIFEST_PARSED,this.playerEventHandler.manifestParsedHandler),this.hlsPlayer.off(oS.Events.LEVEL_SWITCHED,this.playerEventHandler.levelSwitchedHandler),this.hlsPlayer.off(oS.Events.FPS_DROP,this.playerEventHandler.frameDropHandler),this.hlsPlayer.off(oS.Events.FPS_DROP_LEVEL_CAPPING,this.playerEventHandler.frameDropLevelCappingHandler),this.hlsPlayer.off(oS.Events.ERROR,this.playerEventHandler.mediaErrHandler)),this.player&&(this.player.removeEventListener("error",this.playerEventHandler.errorHandler),this.player.removeEventListener("playing",this.playerEventHandler.playingHandler),this.player.removeEventListener("loadedmetadata",this.playerEventHandler.loadedMetaHandler),this.player.removeEventListener("loadeddata",this.playerEventHandler.loadedDataHandler),this.player.removeEventListener("canplay",this.playerEventHandler.canPlayHandler)),this.event.removeListener(oS.ErrorTypes.MEDIA_ERROR,this.playerEventHandler.mediaRecoverHandler)}afterPlayStrategy(){if(!this.pauseCount&&X_.getPlatform().indexOf("Ios 15")>=0){$_.error(this.module_,X_.getPlatform());const e=setTimeout((()=>{var t;clearTimeout(e),null===(t=this.player)||void 0===t||t.pause(),this.pauseCount++}),100)}}}var FI,UI,BI,jI,HI,VI,GI,zI,KI,WI,YI,qI,ZI,XI,JI,QI,$I,ek;const tk="HWHlsClient";let rk=(FI=Pb("HWHlsClient$startPlay#Promise<void>#string#StartPlayOptions"),UI=Pb("HWHlsClient$switchPlay#Promise<void>#string#StartPlayOptions"),BI=xb("HWHlsClient$stopPlay#boolean#void"),jI=Pb("HWHlsClient$replay#Promise<void>#void"),HI=Pb("HWHlsClient$resume#Promise<boolean>#void"),VI=xb("HWHlsClient$pause#boolean#void"),GI=xb("HWHlsClient$pauseVideo#boolean#void"),zI=Pb("HWHlsClient$resumeVideo#Promise<boolean>#void"),KI=xb("HWHlsClient$pauseVideo#boolean#void"),WI=Pb("HWHlsClient$resumeAudio#Promise<boolean>#void"),YI=xb("HWHlsClient$setPlayoutVolume#boolean#number"),qI=xb("HWHlsClient$getPlayoutVolume#number#void"),ZI=xb("HWHlsClient$muteAudio#void#boolean"),XI=xb("HWHlsClient$destoryClient#void#void"),JI=xb("HWHlsClient$streamStatistic#void#boolean#number"),QI=xb("HWHlsClient$enableStreamStateDetection#boolean#boolean#number#StreamInterruptRetry"),$I=xb("HWHlsClient$fullScreenToggle#void#boolean"),ek=class extends tR{constructor(e,t){super(tk,e,t),Yl(this,"debugStatisticTimer",{timer:null,interval:1}),Yl(this,"detectTimer",{timer:null,interval:3,interruptRetry:null}),Yl(this,"recoveryInfo",{recoveryTimer:null,retryTimes:0,recoveryUrl:null}),this.initListeners()}async startPlay(e,t){$_.info(tk,"[KPI] startPlay url: ".concat($_.shieldUrlParameters(e))),this.startPlayOptions=t,e=e.replace(/\.flv/gi,".m3u8");if(!XA.checkUrlFormat(e,pT.HLS))throw $_.error(tk,"startPlay failed, invalid Parameter: ".concat(e)),this.eventEmitter.emit(yT),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);const r=document.getElementById(t.elementId);if(!r)throw $_.error(tk,"startPlay failed, invalid Parameter: ".concat(e)),this.eventEmitter.emit(yT),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");this.hlsPlayer=new NI({eventEmitter:this.eventEmitter,url:e,parentDiv:r,objectFit:t.objectFit,muted:t.muted,poster:this.startPlayOptions.poster}),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&MR.preLoadPoster(this.startPlayOptions.poster.url);try{await this.hlsPlayer.play(this.startPlayOptions.autoPlay,t.showLoading)}catch(Wk){this.eventEmitter.emit(yT);Wk instanceof xh&&Wk.getCode()===Dh.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:Wk.getCode(),errDesc:Wk.getMsg()}):this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:Ph[Dh.HWLLS_INTERNAL_ERROR]})}}async switchPlay(e,t){$_.info(tk,"[KPI] switchPlay url: ".concat($_.shieldUrlParameters(e))),this.startPlayOptions=t||this.startPlayOptions,e=e.replace(/\.flv/gi,".m3u8");const r=document.getElementById(this.startPlayOptions.elementId);if(!r)throw $_.error(tk,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&MR.preLoadPoster(this.startPlayOptions.poster.url),await this.hlsPlayer.switchPlay({url:e,parentDiv:r,objectFit:this.startPlayOptions.objectFit,muted:this.startPlayOptions.muted,autoPlay:this.startPlayOptions.autoPlay,showLoading:t.showLoading,poster:this.startPlayOptions.poster}).catch((e=>{e instanceof xh&&e.getCode()===Dh.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}):this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:Ph[Dh.HWLLS_INTERNAL_ERROR]})})),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}stopPlay(){var e;return null===(e=this.hlsPlayer)||void 0===e||e.stopPlay(),this.hlsPlayer=null,clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo={recoveryTimer:null,retryTimes:0,recoveryUrl:null},!0}async replay(){if(this.hlsPlayer)try{return await this.hlsPlayer.resume(),!0}catch(Wk){return $_.error(tk,"resume failed: ".concat(Wk)),!1}return!1}async resume(){if(this.hlsPlayer)try{return await this.hlsPlayer.resume(),!0}catch(Wk){return $_.error(tk,"resume failed: ".concat(Wk)),!1}return!1}pause(){return!!this.hlsPlayer&&(this.hlsPlayer.pause(),!0)}pauseVideo(){return $_.error(tk,"hls player is not support pause video only."),!1}async resumeVideo(){return $_.error(tk,"hls player is not support resume video only."),!0}pauseAudio(){return!!this.hlsPlayer&&(this.hlsPlayer.mute(!0),!0)}async resumeAudio(){return!!this.hlsPlayer&&(this.hlsPlayer.mute(!1),!0)}setPlayoutVolume(e){var t;return this.muteAudio(!1),null===(t=this.hlsPlayer)||void 0===t||t.setPlayoutVolume(e),!0}getPlayoutVolume(){var e;return null===(e=this.hlsPlayer)||void 0===e?void 0:e.getPlayoutVolume()}muteAudio(e){var t;null===(t=this.hlsPlayer)||void 0===t||t.mute(e)}destoryClient(){var e;null===(e=this.hlsPlayer)||void 0===e||e.destory(),this.hlsPlayer=null,clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo={recoveryTimer:null,retryTimes:0,recoveryUrl:null}}streamStatistic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e){if(!Number.isInteger(t)||t<1||t>60)throw $_.error(tk,"streamStatistic, invalid parameter of interval."),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);this.getStreamStatisticInfo(t)}else clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1}}enableStreamStateDetection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0;if(!e)return clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},!0;if(!Number.isInteger(t)||t<1||t>60)throw $_.error(tk,"enableStreamStateDetection, invalid parameter of interval."),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);clearTimeout(this.detectTimer.timer);const n={preFramesDecoded:0,isInterrupted:!1};var i,a;this.hlsPlayer&&(n.preFramesDecoded=X_.getValue(null===(i=this.hlsPlayer)||void 0===i||null===(a=i.getStatisticInfo())||void 0===a?void 0:a.totalFrameDecoded,0));return this.detectTimer.interval=t,this.detectTimer.interruptRetry=r,this.judgeStreamInterrupted(n,t,r),!0}fullScreenToggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];$_.error(tk,"hls player is not support fullScreenToggle.".concat(e))}getStreamStatisticInfo(e){clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer.interval=e,this.debugStatisticTimer.timer=setTimeout((()=>{var t;const r=null===(t=this.hlsPlayer)||void 0===t?void 0:t.getStatisticInfo();r&&this.eventEmitter.emit(uT.MEDIA_STATISTIC,{audio:{mediaType:rT.TRACK_TYPE_AUDIO,bitRate:0,codec:r.audioCodec},video:{mediaType:rT.TRACK_TYPE_VIDEO,codec:r.videoCodec,bitRate:Math.round(r.bitRate),frameRate:r.frameRate,width:r.width,height:r.height}}),this.getStreamStatisticInfo(e)}),1e3*e)}judgeStreamInterrupted(e,t,r){this.detectTimer.timer=setTimeout((()=>{var n;clearTimeout(this.detectTimer.timer);let i=!1;const a=null===(n=this.hlsPlayer)||void 0===n?void 0:n.getStatisticInfo();var s;if(a&&(i=X_.getValue(null==a?void 0:a.totalFrameDecoded,0)-X_.getValue(e.preFramesDecoded,0)<=0,i||(clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0),a&&(e.preFramesDecoded=X_.getValue(a.frameRate,0))),e.isInterrupted&&!i)null===(s=this.hlsPlayer)||void 0===s||s.loadingMask(!1),this.eventEmitter.emit(uT.VIDEO_RECOVERY),this.eventEmitter.emit(uT.AUDIO_RECOVERY),e.isInterrupted=!1;else if(!e.isInterrupted&&i){var o;this.startPlayOptions.showLoading&&(null===(o=this.hlsPlayer)||void 0===o||o.loadingMask(!0)),this.eventEmitter.emit(uT.VIDEO_INTERRUPTED),this.eventEmitter.emit(uT.AUDIO_INTERRUPTED),e.isInterrupted=!0,null!=r&&r.enable&&($_.info(this.moudle_,"autoRecoverPlay timer start"),clearTimeout(this.recoveryInfo.recoveryTimer),this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,Math.max(10,(null==r?void 0:r.retryInterval)||30),(null==r?void 0:r.retryTimes)||30))}this.judgeStreamInterrupted(e,t,r)}),1e3*t)}autoRecoverPlay(e,t,r){let n=0;this.recoveryInfo.recoveryTimer=setTimeout((async()=>{if($_.info(this.moudle_,"autoRecoverPlay every ".concat(t," sencond")),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.recoveryTimer=null,e===this.recoveryInfo.recoveryUrl)try{this.recoveryInfo.retryTimes++,n=this.recoveryInfo.retryTimes,await this.switchPlay(e)}finally{this.recoveryInfo.retryTimes=n,n<r?this.autoRecoverPlay(e,t,r):this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_PLAY_HLS_RETRY_FAILED,errDesc:Ph[Dh.HWLLS_PLAY_HLS_RETRY_FAILED]})}else this.recoveryInfo.retryTimes=0}),1e3*t)}initListeners(){this.eventEmitter.on("mobileDeviceManualPlay",(()=>{X_.isMobileDevice()&&($_.error(tk,"some mobile devices do not support autoPlay, now manually try to play"),this.resume())}))}},t(ek.prototype,"startPlay",[FI],Object.getOwnPropertyDescriptor(ek.prototype,"startPlay"),ek.prototype),t(ek.prototype,"switchPlay",[UI],Object.getOwnPropertyDescriptor(ek.prototype,"switchPlay"),ek.prototype),t(ek.prototype,"stopPlay",[BI],Object.getOwnPropertyDescriptor(ek.prototype,"stopPlay"),ek.prototype),t(ek.prototype,"replay",[jI],Object.getOwnPropertyDescriptor(ek.prototype,"replay"),ek.prototype),t(ek.prototype,"resume",[HI],Object.getOwnPropertyDescriptor(ek.prototype,"resume"),ek.prototype),t(ek.prototype,"pause",[VI],Object.getOwnPropertyDescriptor(ek.prototype,"pause"),ek.prototype),t(ek.prototype,"pauseVideo",[GI],Object.getOwnPropertyDescriptor(ek.prototype,"pauseVideo"),ek.prototype),t(ek.prototype,"resumeVideo",[zI],Object.getOwnPropertyDescriptor(ek.prototype,"resumeVideo"),ek.prototype),t(ek.prototype,"pauseAudio",[KI],Object.getOwnPropertyDescriptor(ek.prototype,"pauseAudio"),ek.prototype),t(ek.prototype,"resumeAudio",[WI],Object.getOwnPropertyDescriptor(ek.prototype,"resumeAudio"),ek.prototype),t(ek.prototype,"setPlayoutVolume",[YI],Object.getOwnPropertyDescriptor(ek.prototype,"setPlayoutVolume"),ek.prototype),t(ek.prototype,"getPlayoutVolume",[qI],Object.getOwnPropertyDescriptor(ek.prototype,"getPlayoutVolume"),ek.prototype),t(ek.prototype,"muteAudio",[ZI],Object.getOwnPropertyDescriptor(ek.prototype,"muteAudio"),ek.prototype),t(ek.prototype,"destoryClient",[XI],Object.getOwnPropertyDescriptor(ek.prototype,"destoryClient"),ek.prototype),t(ek.prototype,"streamStatistic",[JI],Object.getOwnPropertyDescriptor(ek.prototype,"streamStatistic"),ek.prototype),t(ek.prototype,"enableStreamStateDetection",[QI],Object.getOwnPropertyDescriptor(ek.prototype,"enableStreamStateDetection"),ek.prototype),t(ek.prototype,"fullScreenToggle",[$I],Object.getOwnPropertyDescriptor(ek.prototype,"fullScreenToggle"),ek.prototype),ek);const nk="DowngradeManager";class ik{constructor(e,t){this.eventEmitter=t,this.playOptions=e,this.initListener()}initListener(){this.eventEmitter.on(yT,(e=>{var t,r;void 0===this.downgradeForm&&null!==(t=this.playOptions.downgradeUrl)&&void 0!==t&&t.hlsUrl&&cS.hlsCapabilityCheck()?(this.downgradeForm=pT.HLS,this.downgradeClient=new rk(void 0,this.eventEmitter),this.trackDowngrade(),this.startPlay(this.playOptions.downgradeUrl.hlsUrl,this.playOptions)):null!==(r=this.playOptions.downgradeUrl)&&void 0!==r&&r.flvUrl&&cS.flvCapabilityCheck()?(this.destoryClient(),this.downgradeForm=pT.FLV,this.downgradeClient=new MI(void 0,this.eventEmitter),this.trackDowngrade(),this.startPlay(this.playOptions.downgradeUrl.flvUrl,this.playOptions)):($_.error(nk,"can't downgrade"),e&&e instanceof xh&&this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}))}))}trackDowngrade(){$_.warn(nk,"The autoDowngrade form has been set to ".concat(this.downgradeForm)),this.eventEmitter.emit(uT.PLAYER_CHANGE,this.downgradeForm)}async startPlay(e,t){var r;return null===(r=this.downgradeClient)||void 0===r?void 0:r.startPlay(e,t)}async switchPlay(e,t){var r;return null===(r=this.downgradeClient)||void 0===r?void 0:r.switchPlay(e,t||this.playOptions)}replay(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.replay()}pause(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.pause()}resume(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.resume()}stopPlay(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.stopPlay()}pauseVideo(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.pauseVideo()}resumeVideo(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.resumeVideo()}pauseAudio(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.pauseAudio()}resumeAudio(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.resumeAudio()}setPlayoutVolume(e){var t;return null===(t=this.downgradeClient)||void 0===t?void 0:t.setPlayoutVolume(e)}getPlayoutVolume(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.getPlayoutVolume()}muteAudio(e){var t;null===(t=this.downgradeClient)||void 0===t||t.muteAudio(e)}destoryClient(){var e;null===(e=this.downgradeClient)||void 0===e||e.destoryClient()}streamStatistic(e,t){var r;null===(r=this.downgradeClient)||void 0===r||r.streamStatistic(e,t)}enableStreamStateDetection(e,t,r){var n;return null===(n=this.downgradeClient)||void 0===n?void 0:n.enableStreamStateDetection(e,t,r)}fullScreenToggle(e){var t;return null===(t=this.downgradeClient)||void 0===t?void 0:t.fullScreenToggle(e)}}var ak={},sk=i(nh),ok={toString:function(e){switch(e){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+e},toType:function(e){switch(e.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":case"*":return 255}return e.toUpperCase().startsWith("UNKNOWN_")?parseInt(e.slice(8)):0}},lk={toString:function(e){switch(e){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+e},toRcode:function(e){switch(e.toUpperCase()){case"NOERROR":return 0;case"FORMERR":return 1;case"SERVFAIL":return 2;case"NXDOMAIN":return 3;case"NOTIMP":return 4;case"REFUSED":return 5;case"YXDOMAIN":return 6;case"YXRRSET":return 7;case"NXRRSET":return 8;case"NOTAUTH":return 9;case"NOTZONE":return 10;case"RCODE_11":return 11;case"RCODE_12":return 12;case"RCODE_13":return 13;case"RCODE_14":return 14;case"RCODE_15":return 15}return 0}},ck={toString:function(e){switch(e){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+e},toOpcode:function(e){switch(e.toUpperCase()){case"QUERY":return 0;case"IQUERY":return 1;case"STATUS":return 2;case"OPCODE_3":return 3;case"NOTIFY":return 4;case"UPDATE":return 5;case"OPCODE_6":return 6;case"OPCODE_7":return 7;case"OPCODE_8":return 8;case"OPCODE_9":return 9;case"OPCODE_10":return 10;case"OPCODE_11":return 11;case"OPCODE_12":return 12;case"OPCODE_13":return 13;case"OPCODE_14":return 14;case"OPCODE_15":return 15}return 0}},uk={toString:function(e){switch(e){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+e},toClass:function(e){switch(e.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}},dk={toString:function(e){switch(e){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return e<0?null:`OPTION_${e}`},toCode:function(e){if("number"==typeof e)return e;if(!e)return-1;switch(e.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const t=e.match(/_(\d+)$/);return t?parseInt(t[1],10):-1}},hk={exports:{}};!function(e,t){var r=function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=function(e,t,r){if(t=~~t,(r=r||e.length-t)===n.size)return n.decode(e,t,r);if(r===i.size)return i.decode(e,t,r);throw Error(`Invalid buffer size needs to be ${n.size} for v4 or ${i.size} for v6.`)},e.encode=function(e,t,r){r=~~r;const s=a(e);"function"==typeof t&&(t=t(r+s));if(s===n.size)return n.encode(e,t,r);return i.encode(e,t,r)},e.familyOf=function(e){return a(e)===n.size?1:2},e.name=void 0,e.sizeOf=a,e.v6=e.v4=void 0;const t=/^(\d{1,3}\.){3,3}\d{1,3}$/,r=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,n={name:"v4",size:4,isFormat:e=>t.test(e),encode(e,t,r){r=~~r,t=t||new Uint8Array(r+4);const n=e.length;let i=0;for(let a=0;a<n;){const n=e.charCodeAt(a++);46===n?(t[r++]=i,i=0):i=10*i+(n-48)}return t[r]=i,t},decode:(e,t)=>(t=~~t,`${e[t++]}.${e[t++]}.${e[t++]}.${e[t]}`)};e.v4=n;const i={name:"v6",size:16,isFormat:e=>e.length>0&&r.test(e),encode(e,t,r){let n=(r=~~r)+16,i=-1,a=0,s=0,o=!0,l=!1;t=t||new Uint8Array(r+16);for(let c=0;c<e.length;c++){let u=e.charCodeAt(c);58===u?(o?-1!==i?(r<n&&(t[r]=0),r<n-1&&(t[r+1]=0),r+=2):r<n&&(i=r):(!0===l?(r<n&&(t[r]=s),r++):(r<n&&(t[r]=a>>8),r<n-1&&(t[r+1]=255&a),r+=2),a=0,s=0),o=!0,l=!1):46===u?(r<n&&(t[r]=s),r++,s=0,a=0,o=!1,l=!0):(o=!1,u>=97?u-=87:u>=65?u-=55:(u-=48,s=10*s+u),a=(a<<4)+u)}if(!1===o)!0===l?(r<n&&(t[r]=s),r++):(r<n&&(t[r]=a>>8),r<n-1&&(t[r+1]=255&a),r+=2);else if(0===i)r<n&&(t[r]=0),r<n-1&&(t[r+1]=0),r+=2;else if(-1!==i){r+=2;for(let e=Math.min(r-1,n-1);e>=i+2;e--)t[e]=t[e-2];t[i]=0,t[i+1]=0,i=r}if(i!==r&&-1!==i)for(r>n-2&&(r=n-2);n>i;)t[--n]=r<n&&r>i?t[--r]:0;else for(;r<n;)t[r++]=0;return t},decode(e,t){t=~~t;let r="";for(let n=0;n<16;n+=2)0!==n&&(r+=":"),r+=(e[t+n]<<8|e[t+n+1]).toString(16);return r.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};e.v6=i;function a(e){if(n.isFormat(e))return n.size;if(i.isFormat(e))return i.size;throw Error(`Invalid ip address: ${e}`)}return e.name="ip","default"in e?e.default:e}({});e.exports=r}(hk),function(e){const t=sk.Buffer,r=ok,n=lk,i=ck,a=uk,s=dk,o=hk.exports,l=32768,c=e.name={};c.encode=function(e,r,n){r||(r=t.alloc(c.encodingLength(e))),n||(n=0);const i=n,a=e.replace(/^\.|\.$/gm,"");if(a.length){const e=a.split(".");for(let t=0;t<e.length;t++){const i=r.write(e[t],n+1);r[n]=i,n+=i+1}}return r[n++]=0,c.encode.bytes=n-i,r},c.encode.bytes=0,c.decode=function(e,t){t||(t=0);const r=[];let n=t,i=0,a=0,s=!1;for(;;){if(t>=e.length)throw new Error("Cannot decode name (buffer overflow)");const o=e[t++];if(a+=s?0:1,0===o)break;if(0==(192&o)){if(t+o>e.length)throw new Error("Cannot decode name (buffer overflow)");if(i+=o+1,i>254)throw new Error("Cannot decode name (name too long)");r.push(e.toString("utf-8",t,t+o)),t+=o,a+=s?0:o}else{if(192!=(192&o))throw new Error("Cannot decode name (bad label)");{if(t+1>e.length)throw new Error("Cannot decode name (buffer overflow)");const r=e.readUInt16BE(t-1)-49152;if(r>=n)throw new Error("Cannot decode name (bad pointer)");t=r,n=r,a+=s?0:1,s=!0}}}return c.decode.bytes=a,0===r.length?".":r.join(".")},c.decode.bytes=0,c.encodingLength=function(e){return"."===e||".."===e?1:t.byteLength(e.replace(/^\.|\.$/gm,""))+2};const u={encode:function(e,r,n){r||(r=t.alloc(u.encodingLength(e))),n||(n=0);const i=r.write(e,n+1);return r[n]=i,u.encode.bytes=i+1,r}};u.encode.bytes=0,u.decode=function(e,t){t||(t=0);const r=e[t],n=e.toString("utf-8",t+1,t+1+r);return u.decode.bytes=r+1,n},u.decode.bytes=0,u.encodingLength=function(e){return t.byteLength(e)+1};const d={encode:function(e,t,r){t||(t=d.encodingLength(e)),r||(r=0);const n=32767&(e.flags||0),i="response"===e.type?32768:0;return t.writeUInt16BE(e.id||0,r),t.writeUInt16BE(n|i,r+2),t.writeUInt16BE(e.questions.length,r+4),t.writeUInt16BE(e.answers.length,r+6),t.writeUInt16BE(e.authorities.length,r+8),t.writeUInt16BE(e.additionals.length,r+10),t}};d.encode.bytes=12,d.decode=function(e,t){if(t||(t=0),e.length<12)throw new Error("Header must be 12 bytes");const r=e.readUInt16BE(t+2);return{id:e.readUInt16BE(t),type:32768&r?"response":"query",flags:32767&r,flag_qr:1==(r>>15&1),opcode:i.toString(r>>11&15),flag_aa:1==(r>>10&1),flag_tc:1==(r>>9&1),flag_rd:1==(r>>8&1),flag_ra:1==(r>>7&1),flag_z:1==(r>>6&1),flag_ad:1==(r>>5&1),flag_cd:1==(r>>4&1),rcode:n.toString(15&r),questions:new Array(e.readUInt16BE(t+4)),answers:new Array(e.readUInt16BE(t+6)),authorities:new Array(e.readUInt16BE(t+8)),additionals:new Array(e.readUInt16BE(t+10))}},d.decode.bytes=12,d.encodingLength=function(){return 12};const h=e.unknown={};h.encode=function(e,r,n){return r||(r=t.alloc(h.encodingLength(e))),n||(n=0),r.writeUInt16BE(e.length,n),e.copy(r,n+2),h.encode.bytes=e.length+2,r},h.encode.bytes=0,h.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),n=e.slice(t+2,t+2+r);return h.decode.bytes=r+2,n},h.decode.bytes=0,h.encodingLength=function(e){return e.length+2};const f=e.ns={};f.encode=function(e,r,n){return r||(r=t.alloc(f.encodingLength(e))),n||(n=0),c.encode(e,r,n+2),r.writeUInt16BE(c.encode.bytes,n),f.encode.bytes=c.encode.bytes+2,r},f.encode.bytes=0,f.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),n=c.decode(e,t+2);return f.decode.bytes=r+2,n},f.decode.bytes=0,f.encodingLength=function(e){return c.encodingLength(e)+2};const p=e.soa={};p.encode=function(e,r,n){r||(r=t.alloc(p.encodingLength(e))),n||(n=0);const i=n;return n+=2,c.encode(e.mname,r,n),n+=c.encode.bytes,c.encode(e.rname,r,n),n+=c.encode.bytes,r.writeUInt32BE(e.serial||0,n),n+=4,r.writeUInt32BE(e.refresh||0,n),n+=4,r.writeUInt32BE(e.retry||0,n),n+=4,r.writeUInt32BE(e.expire||0,n),n+=4,r.writeUInt32BE(e.minimum||0,n),n+=4,r.writeUInt16BE(n-i-2,i),p.encode.bytes=n-i,r},p.encode.bytes=0,p.decode=function(e,t){t||(t=0);const r=t,n={};return t+=2,n.mname=c.decode(e,t),t+=c.decode.bytes,n.rname=c.decode(e,t),t+=c.decode.bytes,n.serial=e.readUInt32BE(t),t+=4,n.refresh=e.readUInt32BE(t),t+=4,n.retry=e.readUInt32BE(t),t+=4,n.expire=e.readUInt32BE(t),t+=4,n.minimum=e.readUInt32BE(t),t+=4,p.decode.bytes=t-r,n},p.decode.bytes=0,p.encodingLength=function(e){return 22+c.encodingLength(e.mname)+c.encodingLength(e.rname)};const m=e.txt={};m.encode=function(e,r,n){Array.isArray(e)||(e=[e]);for(let a=0;a<e.length;a++)if("string"==typeof e[a]&&(e[a]=t.from(e[a])),!t.isBuffer(e[a]))throw new Error("Must be a Buffer");r||(r=t.alloc(m.encodingLength(e))),n||(n=0);const i=n;return n+=2,e.forEach((function(e){r[n++]=e.length,e.copy(r,n,0,e.length),n+=e.length})),r.writeUInt16BE(n-i-2,i),m.encode.bytes=n-i,r},m.encode.bytes=0,m.decode=function(e,t){t||(t=0);const r=t;let n=e.readUInt16BE(t);t+=2;let i=[];for(;n>0;){const r=e[t++];if(--n,n<r)throw new Error("Buffer overflow");i.push(e.slice(t,t+r)),t+=r,n-=r}return m.decode.bytes=t-r,i},m.decode.bytes=0,m.encodingLength=function(e){Array.isArray(e)||(e=[e]);let r=2;return e.forEach((function(e){r+="string"==typeof e?t.byteLength(e)+1:e.length+1})),r};const g=e.null={};g.encode=function(e,r,n){r||(r=t.alloc(g.encodingLength(e))),n||(n=0),"string"==typeof e&&(e=t.from(e)),e||(e=t.alloc(0));const i=n;n+=2;const a=e.length;return e.copy(r,n,0,a),n+=a,r.writeUInt16BE(n-i-2,i),g.encode.bytes=n-i,r},g.encode.bytes=0,g.decode=function(e,t){t||(t=0);const r=t,n=e.readUInt16BE(t);t+=2;const i=e.slice(t,t+n);return t+=n,g.decode.bytes=t-r,i},g.decode.bytes=0,g.encodingLength=function(e){return e?(t.isBuffer(e)?e.length:t.byteLength(e))+2:2};const v=e.hinfo={};v.encode=function(e,r,n){r||(r=t.alloc(v.encodingLength(e))),n||(n=0);const i=n;return n+=2,u.encode(e.cpu,r,n),n+=u.encode.bytes,u.encode(e.os,r,n),n+=u.encode.bytes,r.writeUInt16BE(n-i-2,i),v.encode.bytes=n-i,r},v.encode.bytes=0,v.decode=function(e,t){t||(t=0);const r=t,n={};return t+=2,n.cpu=u.decode(e,t),t+=u.decode.bytes,n.os=u.decode(e,t),t+=u.decode.bytes,v.decode.bytes=t-r,n},v.decode.bytes=0,v.encodingLength=function(e){return u.encodingLength(e.cpu)+u.encodingLength(e.os)+2};const y=e.ptr={},_=e.cname=y,E=e.dname=y;y.encode=function(e,r,n){return r||(r=t.alloc(y.encodingLength(e))),n||(n=0),c.encode(e,r,n+2),r.writeUInt16BE(c.encode.bytes,n),y.encode.bytes=c.encode.bytes+2,r},y.encode.bytes=0,y.decode=function(e,t){t||(t=0);const r=c.decode(e,t+2);return y.decode.bytes=c.decode.bytes+2,r},y.decode.bytes=0,y.encodingLength=function(e){return c.encodingLength(e)+2};const S=e.srv={};S.encode=function(e,r,n){r||(r=t.alloc(S.encodingLength(e))),n||(n=0),r.writeUInt16BE(e.priority||0,n+2),r.writeUInt16BE(e.weight||0,n+4),r.writeUInt16BE(e.port||0,n+6),c.encode(e.target,r,n+8);const i=c.encode.bytes+6;return r.writeUInt16BE(i,n),S.encode.bytes=i+2,r},S.encode.bytes=0,S.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),n={};return n.priority=e.readUInt16BE(t+2),n.weight=e.readUInt16BE(t+4),n.port=e.readUInt16BE(t+6),n.target=c.decode(e,t+8),S.decode.bytes=r+2,n},S.decode.bytes=0,S.encodingLength=function(e){return 8+c.encodingLength(e.target)};const b=e.caa={};b.ISSUER_CRITICAL=128,b.encode=function(e,r,n){const i=b.encodingLength(e);return r||(r=t.alloc(b.encodingLength(e))),n||(n=0),e.issuerCritical&&(e.flags=b.ISSUER_CRITICAL),r.writeUInt16BE(i-2,n),n+=2,r.writeUInt8(e.flags||0,n),n+=1,u.encode(e.tag,r,n),n+=u.encode.bytes,r.write(e.value,n),n+=t.byteLength(e.value),b.encode.bytes=i,r},b.encode.bytes=0,b.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),n=t+=2,i={};return i.flags=e.readUInt8(t),t+=1,i.tag=u.decode(e,t),t+=u.decode.bytes,i.value=e.toString("utf-8",t,n+r),i.issuerCritical=!!(i.flags&b.ISSUER_CRITICAL),b.decode.bytes=r+2,i},b.decode.bytes=0,b.encodingLength=function(e){return u.encodingLength(e.tag)+u.encodingLength(e.value)+2};const T=e.mx={};T.encode=function(e,r,n){r||(r=t.alloc(T.encodingLength(e))),n||(n=0);const i=n;return n+=2,r.writeUInt16BE(e.preference||0,n),n+=2,c.encode(e.exchange,r,n),n+=c.encode.bytes,r.writeUInt16BE(n-i-2,i),T.encode.bytes=n-i,r},T.encode.bytes=0,T.decode=function(e,t){t||(t=0);const r=t,n={};return t+=2,n.preference=e.readUInt16BE(t),t+=2,n.exchange=c.decode(e,t),t+=c.decode.bytes,T.decode.bytes=t-r,n},T.encodingLength=function(e){return 4+c.encodingLength(e.exchange)};const R=e.a={};R.encode=function(e,r,n){return r||(r=t.alloc(R.encodingLength(e))),n||(n=0),r.writeUInt16BE(4,n),n+=2,o.v4.encode(e,r,n),R.encode.bytes=6,r},R.encode.bytes=0,R.decode=function(e,t){t||(t=0),t+=2;const r=o.v4.decode(e,t);return R.decode.bytes=6,r},R.decode.bytes=0,R.encodingLength=function(){return 6};const A=e.aaaa={};A.encode=function(e,r,n){return r||(r=t.alloc(A.encodingLength(e))),n||(n=0),r.writeUInt16BE(16,n),n+=2,o.v6.encode(e,r,n),A.encode.bytes=18,r},A.encode.bytes=0,A.decode=function(e,t){t||(t=0),t+=2;const r=o.v6.decode(e,t);return A.decode.bytes=18,r},A.decode.bytes=0,A.encodingLength=function(){return 18};const w=e.option={};w.encode=function(e,r,n){r||(r=t.alloc(w.encodingLength(e))),n||(n=0);const i=n,a=s.toCode(e.code);if(r.writeUInt16BE(a,n),n+=2,e.data)r.writeUInt16BE(e.data.length,n),n+=2,e.data.copy(r,n),n+=e.data.length;else switch(a){case 8:const i=e.sourcePrefixLength||0,a=e.family||o.familyOf(e.ip),s=o.encode(e.ip,t.alloc),l=Math.ceil(i/8);r.writeUInt16BE(l+4,n),n+=2,r.writeUInt16BE(a,n),n+=2,r.writeUInt8(i,n++),r.writeUInt8(e.scopePrefixLength||0,n++),s.copy(r,n,0,l),n+=l;break;case 11:e.timeout?(r.writeUInt16BE(2,n),n+=2,r.writeUInt16BE(e.timeout,n),n+=2):(r.writeUInt16BE(0,n),n+=2);break;case 12:const c=e.length||0;r.writeUInt16BE(c,n),n+=2,r.fill(0,n,n+c),n+=c;break;case 14:const u=2*e.tags.length;r.writeUInt16BE(u,n),n+=2;for(const t of e.tags)r.writeUInt16BE(t,n),n+=2;break;default:throw new Error(`Unknown roption code: ${e.code}`)}return w.encode.bytes=n-i,r},w.encode.bytes=0,w.decode=function(e,r){r||(r=0);const n={};n.code=e.readUInt16BE(r),n.type=s.toString(n.code),r+=2;const i=e.readUInt16BE(r);switch(r+=2,n.data=e.slice(r,r+i),n.code){case 8:n.family=e.readUInt16BE(r),r+=2,n.sourcePrefixLength=e.readUInt8(r++),n.scopePrefixLength=e.readUInt8(r++);const a=t.alloc(1===n.family?4:16);e.copy(a,0,r,r+i-4),n.ip=o.decode(a);break;case 11:i>0&&(n.timeout=e.readUInt16BE(r),r+=2);break;case 14:n.tags=[];for(let t=0;t<i;t+=2)n.tags.push(e.readUInt16BE(r)),r+=2}return w.decode.bytes=i+4,n},w.decode.bytes=0,w.encodingLength=function(e){if(e.data)return e.data.length+4;switch(s.toCode(e.code)){case 8:const t=e.sourcePrefixLength||0;return Math.ceil(t/8)+8;case 11:return"number"==typeof e.timeout?6:4;case 12:return e.length+4;case 14:return 4+2*e.tags.length}throw new Error(`Unknown roption code: ${e.code}`)};const L=e.opt={};L.encode=function(e,r,n){r||(r=t.alloc(L.encodingLength(e))),n||(n=0);const i=n,a=U(e,w);return r.writeUInt16BE(a,n),n=B(e,w,r,n+2),L.encode.bytes=n-i,r},L.encode.bytes=0,L.decode=function(e,t){t||(t=0);const r=t,n=[];let i=e.readUInt16BE(t);t+=2;let a=0;for(;i>0;)n[a++]=w.decode(e,t),t+=w.decode.bytes,i-=w.decode.bytes;return L.decode.bytes=t-r,n},L.decode.bytes=0,L.encodingLength=function(e){return 2+U(e||[],w)};const C=e.dnskey={};C.PROTOCOL_DNSSEC=3,C.ZONE_KEY=128,C.SECURE_ENTRYPOINT=32768,C.encode=function(e,r,n){r||(r=t.alloc(C.encodingLength(e))),n||(n=0);const i=n,a=e.key;if(!t.isBuffer(a))throw new Error("Key must be a Buffer");return n+=2,r.writeUInt16BE(e.flags,n),n+=2,r.writeUInt8(C.PROTOCOL_DNSSEC,n),n+=1,r.writeUInt8(e.algorithm,n),n+=1,a.copy(r,n,0,a.length),n+=a.length,C.encode.bytes=n-i,r.writeUInt16BE(C.encode.bytes-2,i),r},C.encode.bytes=0,C.decode=function(e,t){t||(t=0);const r=t;var n={},i=e.readUInt16BE(t);if(t+=2,n.flags=e.readUInt16BE(t),t+=2,e.readUInt8(t)!==C.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return t+=1,n.algorithm=e.readUInt8(t),t+=1,n.key=e.slice(t,r+i+2),t+=n.key.length,C.decode.bytes=t-r,n},C.decode.bytes=0,C.encodingLength=function(e){return 6+t.byteLength(e.key)};const I=e.rrsig={};I.encode=function(e,n,i){n||(n=t.alloc(I.encodingLength(e))),i||(i=0);const a=i,s=e.signature;if(!t.isBuffer(s))throw new Error("Signature must be a Buffer");return i+=2,n.writeUInt16BE(r.toType(e.typeCovered),i),i+=2,n.writeUInt8(e.algorithm,i),i+=1,n.writeUInt8(e.labels,i),i+=1,n.writeUInt32BE(e.originalTTL,i),i+=4,n.writeUInt32BE(e.expiration,i),i+=4,n.writeUInt32BE(e.inception,i),i+=4,n.writeUInt16BE(e.keyTag,i),i+=2,c.encode(e.signersName,n,i),i+=c.encode.bytes,s.copy(n,i,0,s.length),i+=s.length,I.encode.bytes=i-a,n.writeUInt16BE(I.encode.bytes-2,a),n},I.encode.bytes=0,I.decode=function(e,t){t||(t=0);const n=t;var i={},a=e.readUInt16BE(t);return t+=2,i.typeCovered=r.toString(e.readUInt16BE(t)),t+=2,i.algorithm=e.readUInt8(t),t+=1,i.labels=e.readUInt8(t),t+=1,i.originalTTL=e.readUInt32BE(t),t+=4,i.expiration=e.readUInt32BE(t),t+=4,i.inception=e.readUInt32BE(t),t+=4,i.keyTag=e.readUInt16BE(t),t+=2,i.signersName=c.decode(e,t),t+=c.decode.bytes,i.signature=e.slice(t,n+a+2),t+=i.signature.length,I.decode.bytes=t-n,i},I.decode.bytes=0,I.encodingLength=function(e){return 20+c.encodingLength(e.signersName)+t.byteLength(e.signature)};const k=e.rp={};k.encode=function(e,r,n){r||(r=t.alloc(k.encodingLength(e))),n||(n=0);const i=n;return n+=2,c.encode(e.mbox||".",r,n),n+=c.encode.bytes,c.encode(e.txt||".",r,n),n+=c.encode.bytes,k.encode.bytes=n-i,r.writeUInt16BE(k.encode.bytes-2,i),r},k.encode.bytes=0,k.decode=function(e,t){t||(t=0);const r=t,n={};return t+=2,n.mbox=c.decode(e,t)||".",t+=c.decode.bytes,n.txt=c.decode(e,t)||".",t+=c.decode.bytes,k.decode.bytes=t-r,n},k.decode.bytes=0,k.encodingLength=function(e){return 2+c.encodingLength(e.mbox||".")+c.encodingLength(e.txt||".")};const O={encode:function(e,n,i){n||(n=t.alloc(O.encodingLength(e))),i||(i=0);const a=i;for(var s=[],o=0;o<e.length;o++){var l=r.toType(e[o]);void 0===s[l>>8]&&(s[l>>8]=[]),s[l>>8][l>>3&31]|=1<<7-(7&l)}for(o=0;o<s.length;o++)if(void 0!==s[o]){var c=t.from(s[o]);n.writeUInt8(o,i),i+=1,n.writeUInt8(c.length,i),i+=1,c.copy(n,i),i+=c.length}return O.encode.bytes=i-a,n}};O.encode.bytes=0,O.decode=function(e,t,n){t||(t=0);const i=t;for(var a=[];t-i<n;){var s=e.readUInt8(t);t+=1;var o=e.readUInt8(t);t+=1;for(var l=0;l<o;l++)for(var c=e.readUInt8(t+l),u=0;u<8;u++)if(c&1<<7-u){var d=r.toString(s<<8|l<<3|u);a.push(d)}t+=o}return O.decode.bytes=t-i,a},O.decode.bytes=0,O.encodingLength=function(e){for(var t=[],n=0;n<e.length;n++){var i=r.toType(e[n]);t[i>>8]=Math.max(t[i>>8]||0,255&i)}var a=0;for(n=0;n<t.length;n++)void 0!==t[n]&&(a+=2+Math.ceil((t[n]+1)/8));return a};const D=e.nsec={};D.encode=function(e,r,n){r||(r=t.alloc(D.encodingLength(e))),n||(n=0);const i=n;return n+=2,c.encode(e.nextDomain,r,n),n+=c.encode.bytes,O.encode(e.rrtypes,r,n),n+=O.encode.bytes,D.encode.bytes=n-i,r.writeUInt16BE(D.encode.bytes-2,i),r},D.encode.bytes=0,D.decode=function(e,t){t||(t=0);const r=t;var n={},i=e.readUInt16BE(t);return t+=2,n.nextDomain=c.decode(e,t),t+=c.decode.bytes,n.rrtypes=O.decode(e,t,i-(t-r)),t+=O.decode.bytes,D.decode.bytes=t-r,n},D.decode.bytes=0,D.encodingLength=function(e){return 2+c.encodingLength(e.nextDomain)+O.encodingLength(e.rrtypes)};const P=e.nsec3={};P.encode=function(e,r,n){r||(r=t.alloc(P.encodingLength(e))),n||(n=0);const i=n,a=e.salt;if(!t.isBuffer(a))throw new Error("salt must be a Buffer");const s=e.nextDomain;if(!t.isBuffer(s))throw new Error("nextDomain must be a Buffer");return n+=2,r.writeUInt8(e.algorithm,n),n+=1,r.writeUInt8(e.flags,n),n+=1,r.writeUInt16BE(e.iterations,n),n+=2,r.writeUInt8(a.length,n),n+=1,a.copy(r,n,0,a.length),n+=a.length,r.writeUInt8(s.length,n),n+=1,s.copy(r,n,0,s.length),n+=s.length,O.encode(e.rrtypes,r,n),n+=O.encode.bytes,P.encode.bytes=n-i,r.writeUInt16BE(P.encode.bytes-2,i),r},P.encode.bytes=0,P.decode=function(e,t){t||(t=0);const r=t;var n={},i=e.readUInt16BE(t);t+=2,n.algorithm=e.readUInt8(t),t+=1,n.flags=e.readUInt8(t),t+=1,n.iterations=e.readUInt16BE(t),t+=2;const a=e.readUInt8(t);t+=1,n.salt=e.slice(t,t+a),t+=a;const s=e.readUInt8(t);return t+=1,n.nextDomain=e.slice(t,t+s),t+=s,n.rrtypes=O.decode(e,t,i-(t-r)),t+=O.decode.bytes,P.decode.bytes=t-r,n},P.decode.bytes=0,P.encodingLength=function(e){return 8+e.salt.length+e.nextDomain.length+O.encodingLength(e.rrtypes)};const x=e.ds={};x.encode=function(e,r,n){r||(r=t.alloc(x.encodingLength(e))),n||(n=0);const i=n,a=e.digest;if(!t.isBuffer(a))throw new Error("Digest must be a Buffer");return n+=2,r.writeUInt16BE(e.keyTag,n),n+=2,r.writeUInt8(e.algorithm,n),n+=1,r.writeUInt8(e.digestType,n),n+=1,a.copy(r,n,0,a.length),n+=a.length,x.encode.bytes=n-i,r.writeUInt16BE(x.encode.bytes-2,i),r},x.encode.bytes=0,x.decode=function(e,t){t||(t=0);const r=t;var n={},i=e.readUInt16BE(t);return t+=2,n.keyTag=e.readUInt16BE(t),t+=2,n.algorithm=e.readUInt8(t),t+=1,n.digestType=e.readUInt8(t),t+=1,n.digest=e.slice(t,r+i+2),t+=n.digest.length,x.decode.bytes=t-r,n},x.decode.bytes=0,x.encodingLength=function(e){return 6+t.byteLength(e.digest)};const M=e.record=function(e){switch(e.toUpperCase()){case"A":return R;case"PTR":return y;case"CNAME":return _;case"DNAME":return E;case"TXT":return m;case"NULL":return g;case"AAAA":return A;case"SRV":return S;case"HINFO":return v;case"CAA":return b;case"NS":return f;case"SOA":return p;case"MX":return T;case"OPT":return L;case"DNSKEY":return C;case"RRSIG":return I;case"RP":return k;case"NSEC":return D;case"NSEC3":return P;case"DS":return x}return h},N=e.answer={};N.encode=function(e,n,i){n||(n=t.alloc(N.encodingLength(e))),i||(i=0);const s=i;if(c.encode(e.name,n,i),i+=c.encode.bytes,n.writeUInt16BE(r.toType(e.type),i),"OPT"===e.type.toUpperCase()){if("."!==e.name)throw new Error("OPT name must be root.");n.writeUInt16BE(e.udpPayloadSize||4096,i+2),n.writeUInt8(e.extendedRcode||0,i+4),n.writeUInt8(e.ednsVersion||0,i+5),n.writeUInt16BE(e.flags||0,i+6),i+=8,L.encode(e.options||[],n,i),i+=L.encode.bytes}else{let t=a.toClass(void 0===e.class?"IN":e.class);e.flush&&(t|=l),n.writeUInt16BE(t,i+2),n.writeUInt32BE(e.ttl||0,i+4),i+=8;const r=M(e.type);r.encode(e.data,n,i),i+=r.encode.bytes}return N.encode.bytes=i-s,n},N.encode.bytes=0,N.decode=function(e,t){t||(t=0);const n={},i=t;if(n.name=c.decode(e,t),t+=c.decode.bytes,n.type=r.toString(e.readUInt16BE(t)),"OPT"===n.type)n.udpPayloadSize=e.readUInt16BE(t+2),n.extendedRcode=e.readUInt8(t+4),n.ednsVersion=e.readUInt8(t+5),n.flags=e.readUInt16BE(t+6),n.flag_do=1==(n.flags>>15&1),n.options=L.decode(e,t+8),t+=8+L.decode.bytes;else{const r=e.readUInt16BE(t+2);n.ttl=e.readUInt32BE(t+4),n.class=a.toString(-32769&r),n.flush=!!(r&l);const i=M(n.type);n.data=i.decode(e,t+8),t+=8+i.decode.bytes}return N.decode.bytes=t-i,n},N.decode.bytes=0,N.encodingLength=function(e){const t=null!==e.data&&void 0!==e.data?e.data:e.options;return c.encodingLength(e.name)+8+M(e.type).encodingLength(t)};const F=e.question={};function U(e,t){let r=0;for(let n=0;n<e.length;n++)r+=t.encodingLength(e[n]);return r}function B(e,t,r,n){for(let i=0;i<e.length;i++)t.encode(e[i],r,n),n+=t.encode.bytes;return n}function j(e,t,r,n){for(let i=0;i<e.length;i++)e[i]=t.decode(r,n),n+=t.decode.bytes;return n}F.encode=function(e,n,i){n||(n=t.alloc(F.encodingLength(e))),i||(i=0);const s=i;return c.encode(e.name,n,i),i+=c.encode.bytes,n.writeUInt16BE(r.toType(e.type),i),i+=2,n.writeUInt16BE(a.toClass(void 0===e.class?"IN":e.class),i),i+=2,F.encode.bytes=i-s,e},F.encode.bytes=0,F.decode=function(e,t){t||(t=0);const n=t,i={};i.name=c.decode(e,t),t+=c.decode.bytes,i.type=r.toString(e.readUInt16BE(t)),t+=2,i.class=a.toString(e.readUInt16BE(t)),t+=2;return!!(32768&i.class)&&(i.class&=-32769),F.decode.bytes=t-n,i},F.decode.bytes=0,F.encodingLength=function(e){return c.encodingLength(e.name)+4},e.AUTHORITATIVE_ANSWER=1024,e.TRUNCATED_RESPONSE=512,e.RECURSION_DESIRED=256,e.RECURSION_AVAILABLE=128,e.AUTHENTIC_DATA=32,e.CHECKING_DISABLED=16,e.DNSSEC_OK=32768,e.encode=function(r,n,i){const a=!n;a&&(n=t.alloc(e.encodingLength(r))),i||(i=0);const s=i;return r.questions||(r.questions=[]),r.answers||(r.answers=[]),r.authorities||(r.authorities=[]),r.additionals||(r.additionals=[]),d.encode(r,n,i),i+=d.encode.bytes,i=B(r.questions,F,n,i),i=B(r.answers,N,n,i),i=B(r.authorities,N,n,i),i=B(r.additionals,N,n,i),e.encode.bytes=i-s,a&&e.encode.bytes!==n.length?n.slice(0,e.encode.bytes):n},e.encode.bytes=0,e.decode=function(t,r){r||(r=0);const n=r,i=d.decode(t,r);return r+=d.decode.bytes,r=j(i.questions,F,t,r),r=j(i.answers,N,t,r),r=j(i.authorities,N,t,r),r=j(i.additionals,N,t,r),e.decode.bytes=r-n,i},e.decode.bytes=0,e.encodingLength=function(e){return d.encodingLength(e)+U(e.questions||[],F)+U(e.answers||[],N)+U(e.authorities||[],N)+U(e.additionals||[],N)},e.streamEncode=function(r){const n=e.encode(r),i=t.alloc(2);i.writeUInt16BE(n.byteLength);const a=t.concat([i,n]);return e.streamEncode.bytes=a.byteLength,a},e.streamEncode.bytes=0,e.streamDecode=function(t){const r=t.readUInt16BE(0);if(t.byteLength<r+2)return null;const n=e.decode(t.slice(2));return e.streamDecode.bytes=e.decode.bytes,n},e.streamDecode.bytes=0}(ak);const fk="DomainUtil";const pk=new class{async dnsQuery(e){if(!1===Lb.getParameter(Rb)||!e||e.length<1)return"";let t="";for(const r of e){if(!this.checkDomain(r)){$_.info(fk,"check domain not need dns parse,".concat(r));const e=this.getIpFromUrl(r);return $_.info(fk,"check domain get ip:".concat(e[0])),e[0]}const e={type:"query",id:0,flags:256,questions:[{type:"A",name:r.includes("/")?this.getDomainFromUrl(r.replace(/^\.|\.$/gm,"")):r}]};for(const n of Oh.PUBLIC_DNS_SERVER)try{const i=await H_.fetch(["https://".concat(n,"/dns-query?dns=").concat(X_.dnsRequestEncode(e))],{method:"GET",mode:"cors"},{},Oh.DNS_REQUEST_TIMEOUT);if(200!==i.httpCode){$_.error(fk,"dns parse failed:".concat(r));continue}const a=ak.decode(yd.from(i.data));for(const e of(null==a?void 0:a.answers)||[])if("A"===e.type){t=e.data;break}if(t)break;$_.error(fk,"dns parse failed, ip4ARecord is null!");continue}catch(Wk){$_.error(fk,"dnsQuery failed for ".concat(r,":  ").concat(Wk))}if(t)break}return $_.info(fk,"dns query domain get ip:".concat(t)),t}checkDomain(e){return/^((https?):\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(e)}getIpFromUrl(e){const t=new RegExp(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/);return e.match(t)}getDomainFromUrl(e){const t=e.split("/");return e[2]?t[2]:""}};var mk,gk,vk,yk,_k,Ek,Sk,bk,Tk,Rk,Ak,wk,Lk,Ck,Ik,kk,Ok,Dk,Pk;function xk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Mk(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xk(Object(r),!0).forEach((function(t){Yl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xk(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Nk="HWLLSClient";let Fk=(mk=Pb("HWLLSClient$startPlay#Promise<void>#string#StartPlayOptions"),gk=Pb("HWLLSClient$startPlayCustomize#Promise<void>#string#StartPlayOptions"),vk=Pb("HWLLSClient$switchPlay#Promise<boolean>#string#StartPlayOptions"),yk=xb("HWLLSClient$stopPlay#boolean#void"),_k=Pb("HWLLSClient$replay#Promise<boolean>#void"),Ek=Pb("HWLLSClient$resume#Promise<boolean>#void"),Sk=xb("HWLLSClient$pause#boolean#void"),bk=xb("HWLLSClient$pauseVideo#boolean#void"),Tk=Pb("HWLLSClient$resumeVideo#Promise<boolean>#void"),Rk=xb("HWLLSClient$pauseAudio#boolean#void"),Ak=Pb("HWLLSClient$Promise<boolean>#boolean#void"),wk=xb("HWLLSClient$setPlayoutVolume#boolean#number"),Lk=xb("HWLLSClient$getPlayoutVolume#number#void"),Ck=xb("HWLLSClient$muteAudio#void#boolean"),Ik=xb("HWLLSClient$streamStatistic#void#boolean#number#ExecutableFunction"),kk=xb("HWLLSClient$destoryClient#void#void"),Ok=xb("HWLLSClient$fullScreenToggle#void#boolean"),Dk=xb("HWLLSClient$enableStreamStateDetection#boolean#boolean#number#StreamInterruptRetry"),Pk=class extends tR{constructor(){super(Nk),Yl(this,"debugStatisticTimer",{timer:null,interval:1}),Yl(this,"detectTimer",{timer:null,interval:3,interruptRetry:null}),Yl(this,"recoveryInfo",{recoveryTimer:null,retryTimes:0,recoveryUrl:null}),Yl(this,"videoRecoveryInfo",{interval:3,retryTimes:30}),Yl(this,"firstFrameHandler",{videoHandler:()=>{var e,t;null===(e=XT.getInstance(this.identifiedId))||void 0===e||e.updatePlayTrackKpi("videoPlaySucc"),this.receivedFirstFrame=!0;let r=iT.SUCC;(null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getPlayTrackKpi().videoTimeOut)>0&&(r=iT.SUCC_AFTER_TIMEOUT),this.stats.reportPullMediaStreamResult(rT.TRACK_TYPE_VIDEO,r)},audioHandler:()=>{var e,t;null===(e=XT.getInstance(this.identifiedId))||void 0===e||e.updatePlayTrackKpi("audioPlaySucc");let r=iT.SUCC;(null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getPlayTrackKpi().audioTimeOut)>0&&(r=iT.SUCC_AFTER_TIMEOUT),this.stats.reportPullMediaStreamResult(rT.TRACK_TYPE_AUDIO,r)}}),this.preNetQuality=dT.NETWORK_QUALITY_INIT,this.preRemoteStreamStatistic={packetsReceived:[0,0],packetsLost:[0,0],nackCnt:[0,0],preLostRate:[]},this.connectionsManager=new kR(this.stats,this.eventEmitter,this.identifiedId),this.initErrorMap(),window.onbeforeunload=()=>{$_.info(Nk,"app is closing, emergency stop"),this.liveStream&&this.stopSignal()},this.downgraded=!1,this.receivedFirstFrame=!1}getInfo(){return{clientId:this.identifiedId,userAgent:navigator.userAgent}}async startPlay(e,t){if(await this.checkDowngrade(t))return;$_.info(Nk,"[KPI] startPlay url: ".concat($_.shieldUrlParameters(e))),XT.addInstance(this.identifiedId),XT.getInstance(this.identifiedId).updatePlayTrackKpi("startPlayTime");let r=XA.checkUrlFormat(e,pT.WEBRTC);if(!r)throw $_.error(Nk,"startPlay failed, invalid url protocol or format: ".concat(e)),new xh(Dh.HWLLS_ERROR_INVALID_URL);if(r=XA.checkPlayOpt(t),!r)throw $_.error(Nk,"startPlay failed, invalid Parameter: ".concat(JSON.stringify(t))),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);await this.initPeerConnection(e,tT.COMMON_STANDARD,t),this.netQualityRegularReport(),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&($_.info(Nk,"video stream start play , this.detectTimer.timer : ".concat(this.detectTimer.timer)),this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry))}async startPlayCustomize(e,t){if(await this.checkDowngrade(t))return;$_.info(Nk,"[KPI] startPlay url: ".concat($_.shieldUrlParameters(e))),XT.addInstance(this.identifiedId),XT.getInstance(this.identifiedId).updatePlayTrackKpi("startPlayTime");if(!XA.checkPlayOpt(t))throw $_.error(Nk,"startPlayCustomize failed, invalid Parameter: ".concat(JSON.stringify(t))),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);await this.initPeerConnection(e,tT.CUSTOMIZE_STANDARD,t),this.netQualityRegularReport(),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}async switchPlay(e,t){var r;if(this.downgraded)return void(null===(r=this.autoDowngradeManager)||void 0===r||r.switchPlay(e,t));if(this.liveStream){const e=X_.getCurrentLocalTimestamp();try{this.liveStream.stop(),this.stopSignal(),XT.getInstance(this.identifiedId).updatePlayTrackKpi("endPlayTime")}catch(Wk){$_.error(Nk,"stopPlay occur error: ".concat(Wk))}finally{this.stats.reportStopPullStreamReqEvent(e),this.resetClient4Switch()}}$_.info(Nk,"[KPI] switchPlay url: ".concat($_.shieldUrlParameters(e))),XT.addInstance(this.identifiedId),XT.getInstance(this.identifiedId).updatePlayTrackKpi("startPlayTime");let n=!1,i=tT.COMMON_STANDARD;if(/webrtc:\/\/.*/gi.test(e)){if(n=XA.checkUrlFormat(e,pT.WEBRTC),!n)throw $_.error(Nk,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER)}else i=tT.CUSTOMIZE_STANDARD;if(!t&&!this.startPlayOptions)throw $_.error(Nk,"switchPlay failed, options is null"),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);if(t&&(n=XA.checkPlayOpt(t),!n))throw $_.error(Nk,"switchPlay failed, invalid Parameter: ".concat(JSON.stringify(t))),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);await this.initPeerConnection(e,i,t||this.startPlayOptions,!0),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}stopPlay(){var e;if(this.receivedFirstFrame=!1,this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.stopPlay();if(this.liveStream){const e=X_.getCurrentLocalTimestamp();try{return this.liveStream.stop(),this.stopSignal(),XT.getInstance(this.identifiedId).updatePlayTrackKpi("endPlayTime"),!0}finally{this.stats.reportStopPullStreamReqEvent(e),this.resetClient4Stop()}}return!1}async replay(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.replay();if(this.liveStream)try{return await this.liveStream.resume(),!0}catch(Wk){return $_.error(Nk,"resume failed: ".concat(Wk)),!1}return!1}async resume(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.resume();if(this.liveStream)try{return await this.liveStream.resume(),!0}catch(Wk){return $_.error(Nk,"resume failed: ".concat(Wk)),!1}return!1}pause(){var e;return this.downgraded?null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.pause():!!this.liveStream&&(this.liveStream.pause(),!0)}pauseVideo(){var e;return this.downgraded?null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.pauseVideo():!!this.liveStream&&(this.liveStream.pauseVideo(),!0)}async resumeVideo(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.resumeVideo();if(this.liveStream)try{return await this.liveStream.resumeVideo(),!0}catch(Wk){return $_.error(Nk,"resumeVideo failed: ".concat(Wk)),!1}return!1}pauseAudio(){var e;return this.downgraded?null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.pauseAudio():!!this.liveStream&&(this.liveStream.pauseAudio(),!0)}async resumeAudio(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.resumeAudio();if(this.liveStream)try{return await this.liveStream.resumeAudio(),!0}catch(Wk){return $_.error(Nk,"resumeAudio failed: ".concat(Wk)),!1}return!1}setPlayoutVolume(e){var t;if(this.downgraded)return null===(t=this.autoDowngradeManager)||void 0===t?void 0:t.setPlayoutVolume(e);if(this.liveStream){const t=this.liveStream.getAudioHRTCTrack();if(t)return t.setAudioVolume(e),!0}return!1}on(e,t){[uT.MEDIA_STATISTIC,uT.NET_QUALITY].includes(e)?super.on(e,t):super.on(e,t,!0)}off(e,t){[uT.MEDIA_STATISTIC,uT.NET_QUALITY].includes(e)?super.off(e,t):super.off(e,t,!0)}getPlayoutVolume(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.getPlayoutVolume();if(this.liveStream)try{const e=this.liveStream.getAudioHRTCTrack();if(e)return 100*e.getAudioLevel()}catch(Wk){$_.error(Nk,"getPlayoutVolume occur error: ".concat(Wk))}return 0}muteAudio(e){var t;if(this.downgraded)null===(t=this.autoDowngradeManager)||void 0===t||t.muteAudio(e);else if(this.liveStream)try{const t=this.liveStream.getAudioHRTCTrack();t&&t.muteAudio(e)}catch(Wk){$_.error(Nk,"muteAudio occur error: ".concat(Wk))}}streamStatistic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var r;if(this.downgraded)null===(r=this.autoDowngradeManager)||void 0===r||r.streamStatistic(e,t);else if(e){if(!Number.isInteger(t)||t<1||t>60)throw $_.error(Nk,"streamStatistic, invalid parameter of interval."),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);const e={audioReceiveBytes:0,videoReceiveBytes:0,videoFrames:0};this.getStreamStatisticInfo(e,t)}else clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1}}destoryClient(){var e;window.onbeforeunload=null,this.resetClient(),this.offAllEvents(),null===(e=this.autoDowngradeManager)||void 0===e||e.destoryClient()}fullScreenToggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t,r,n;this.downgraded?null===(t=this.autoDowngradeManager)||void 0===t||t.fullScreenToggle(e):e?null===(r=this.liveStream)||void 0===r||r.exitFullScreen():null===(n=this.liveStream)||void 0===n||n.enterFullScreen()}enableStreamStateDetection(e){var t,r,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=arguments.length>2?arguments[2]:void 0;var s;if(this.downgraded)return null===(s=this.autoDowngradeManager)||void 0===s?void 0:s.enableStreamStateDetection(e,i,a);if(!e)return clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:i,interruptRetry:null},!0;if(!Number.isInteger(i)||i<1||i>60)throw $_.error(Nk,"enableStreamStateDetection, invalid parameter of interval."),new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER);clearTimeout(this.detectTimer.timer);const o={preVideoStat:{preFramesDecoded:0,isInterrupted:!1},preAudioStat:{prePacketReceived:0,isInterrupted:!1}},l=null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo();var c,u;null!==(r=this.liveStream)&&void 0!==r&&r.getVideoHRTCTrack()&&(o.preVideoStat.preFramesDecoded=X_.getValue(null===(c=WT.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),l.vSsrc))||void 0===c?void 0:c.framesDecoded,0));null!==(n=this.liveStream)&&void 0!==n&&n.getAudioHRTCTrack()&&(o.preAudioStat.prePacketReceived=X_.getValue(null===(u=WT.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),l.aSsrc))||void 0===u?void 0:u.packetsReceived,0));return this.detectTimer.interval=i,this.detectTimer.interruptRetry=a,$_.info(Nk,"video stream , enableStreamStateDetection ,\n      detect interval : ".concat(i,",\n      recoverenable:").concat(a.enable," ,\n      recover interval:").concat(a.retryInterval,",\n      recovertimes:").concat(a.retryTimes)),this.judgeStreamInterrupted(o,i,a),!0}judgeStreamInterrupted(e,t,r){this.detectTimer.timer=setTimeout((()=>{var n,i,a,s,o,l,c;clearTimeout(this.detectTimer.timer);let u=null,d=null,h=!1,f=!1;const p=null===(n=XT.getInstance(this.identifiedId))||void 0===n?void 0:n.getSfuInfo();var m,g;null!==(i=this.liveStream)&&void 0!==i&&i.getVideoHRTCTrack()&&(u=WT.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),p.vSsrc),h=X_.getValue(null===(m=u)||void 0===m?void 0:m.framesDecoded,0)-X_.getValue(e.preVideoStat.preFramesDecoded,0)<=0,h||(clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0),u&&(e.preVideoStat.preFramesDecoded=X_.getValue(u.framesDecoded,0)));null!==(a=this.liveStream)&&void 0!==a&&a.getAudioHRTCTrack()&&(d=WT.getLeastestAudioInfo(this.connectionsManager.getConnectionId(),p.aSsrc),f=X_.getValue(null===(g=d)||void 0===g?void 0:g.packetsReceived,0)-X_.getValue(e.preAudioStat.prePacketReceived,0)<=0,d&&(e.preAudioStat.prePacketReceived=X_.getValue(d.packetsReceived,0)));if(!1!==(null===(s=this.startPlayOptions)||void 0===s||null===(o=s.webrtcConfig)||void 0===o?void 0:o.receiveVideo))if(e.preVideoStat.isInterrupted&&!h)this.eventEmitter.emit(uT.VIDEO_RECOVERY),e.preVideoStat.isInterrupted=!1,$_.info(Nk,"video stream recovery ...");else if(!e.preVideoStat.isInterrupted&&h&&(this.eventEmitter.emit(uT.VIDEO_INTERRUPTED),e.preVideoStat.isInterrupted=!0,$_.info(Nk,"video stream interrupt, retry enable : ".concat(null==r?void 0:r.enable)),null!=r&&r.enable)){var v,y;clearTimeout(this.recoveryInfo.recoveryTimer);const e=null!==(v=r.retryInterval)&&void 0!==v?v:3,t=null!==(y=null==r?void 0:r.retryTimes)&&void 0!==y?y:30;this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,e,t)}!1!==(null===(l=this.startPlayOptions)||void 0===l||null===(c=l.webrtcConfig)||void 0===c?void 0:c.receiveAudio)&&(e.preAudioStat.isInterrupted&&!f?(this.eventEmitter.emit(uT.AUDIO_RECOVERY),e.preAudioStat.isInterrupted=!1):!e.preAudioStat.isInterrupted&&f&&(this.eventEmitter.emit(uT.AUDIO_INTERRUPTED),e.preAudioStat.isInterrupted=!0)),this.judgeStreamInterrupted(e,t,r)}),1e3*t)}autoRecoverPlay(e,t,r){let n=0;const i=0==this.recoveryInfo.retryTimes?0:t;this.recoveryInfo.recoveryTimer=setTimeout((async()=>{if($_.info(Nk,"video stream , autoRecoverPlay every ".concat(t," sencond, currentRetryTimes : ").concat(this.recoveryInfo.retryTimes)),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.recoveryTimer=null,e===this.recoveryInfo.recoveryUrl)try{this.recoveryInfo.retryTimes++,n=this.recoveryInfo.retryTimes,await this.switchPlay(e,Mk(Mk({},this.startPlayOptions),{recover:!0})).then((()=>{this.recoveryInfo.retryTimes=0}))}catch(pL){$_.error(Nk,"video stream , recovery failed, err : ".concat(pL)),this.recoveryInfo.retryTimes=n,n<r?this.autoRecoverPlay(e,t,r):(this.recoveryInfo.retryTimes=0,this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_PLAY_WEBRTC_RETRY_FAILED,errDesc:Ph[Dh.HWLLS_PLAY_WEBRTC_RETRY_FAILED]}))}else this.recoveryInfo.retryTimes=0}),1e3*i)}initErrorMap(){this.errMap=new Map,this.errMap.set(100,Dh.HWLLS_ERROR_INVALID_URL),this.errMap.set(101,Dh.HWLLS_ERROR_INVALID_PARAMETER),this.errMap.set(102,Dh.HWLLS_ERROR_ENCODING_NOT_ACCEPTED),this.errMap.set(400,Dh.HWLLS_ERROR_BAD_REQUEST),this.errMap.set(401,Dh.HWLLS_ERROR_STREAM_INVALID_PARAMETER),this.errMap.set(403,Dh.HWLLS_ERROR_AUTH_FAIL),this.errMap.set(404,Dh.HWLLS_ERROR_STREAM_NOT_EXIST),this.errMap.set(500,Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL),this.errMap.set(503,Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL),this.errMap.set(601,Dh.HWLLS_BUSSINESS_DOWNGRADE)}async calcNetworkQuality(){const e=this.connectionsManager.getConnection();if(!e)return dT.NETWORK_QUALITY_UNKNOW;if(e&&["disconnected","failed","closed"].includes(e.connectionState))return dT.NETWORK_QUALITY_DISCONNECT;let t=await this.getDownloadStatistic(rT.TRACK_TYPE_VIDEO);return t<0&&(t=await this.getDownloadStatistic(rT.TRACK_TYPE_AUDIO)),-1===t?dT.NETWORK_QUALITY_UNKNOW:t<1?dT.NETWORK_QUALITY_GREAT:t<5?dT.NETWORK_QUALITY_GOOD:t<12?dT.NETWORK_QUALITY_DEFECTS:t<20?dT.NETWORK_QUALITY_WEAK:t<30?dT.NETWORK_QUALITY_BAD:dT.NETWORK_QUALITY_DISCONNECT}async getDownloadStatistic(e){const t=XT.getInstance(this.identifiedId).getSfuInfo(),r=e===rT.TRACK_TYPE_VIDEO?WT.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),null==t?void 0:t.vSsrc):WT.getLeastestAudioInfo(this.connectionsManager.getConnectionId(),null==t?void 0:t.aSsrc);if(!r)return-1;const n=e===rT.TRACK_TYPE_VIDEO?0:1,i={packetsReceived:0,packetsLost:0,nackCnt:0};if(i.packetsReceived=X_.getValue(r.packetsReceived,0),i.packetsLost=X_.getValue(r.packetsLost,0),i.nackCnt=X_.getValue(r.nackCount,0),0===i.packetsReceived)return-1;const a=Math.max(i.packetsReceived-this.preRemoteStreamStatistic.packetsReceived[n],1),s=Math.max(i.packetsLost-this.preRemoteStreamStatistic.packetsLost[n],0),o=Math.max(i.nackCnt-this.preRemoteStreamStatistic.nackCnt[n],0);let l=0;const c=100*o/(o+a);l=c<=20?.9*o*100/(.9*o+a):c<=30?.86*o*100/(.86*o+a):c<=40?.82*o*100/(.82*o+a):c<=50?.78*o*100/(.78*o+a):.7*o*100/(.7*o+a),this.preRemoteStreamStatistic.preLostRate.push(Math.min(Math.max(100*s/(s+a),l),100)),this.preRemoteStreamStatistic.preLostRate.length>3&&this.preRemoteStreamStatistic.preLostRate.shift(),this.preRemoteStreamStatistic.packetsReceived[n]=i.packetsReceived,this.preRemoteStreamStatistic.packetsLost[n]=i.packetsLost,this.preRemoteStreamStatistic.nackCnt[n]=i.nackCnt;const u=this.smoothData(this.preRemoteStreamStatistic.preLostRate,.9);return u[u.length-1]}smoothData(e,t){const r=e=>e.reduce((function(e,t){return e+t}),0)/e.length,n=r(e)*t,i=[];for(let a=0;a<e.length;a++){const t=e[a],s=a>0?i[a-1]:e[e.length-1],o=a<e.length-1?e[a+1]:e[0],l=Number(r([n,s,t,o]).toFixed(2));i.push(l)}return i}netQualityRegularReport(){clearTimeout(this.netQualityTimer),this.netQualityTimer=setTimeout((()=>{clearTimeout(this.netQualityTimer),this.calcNetworkQuality().then((e=>{this.preNetQuality!==dT.NETWORK_QUALITY_INIT&&this.preNetQuality===e||($_.info(Nk,"emit: ".concat(uT.NET_QUALITY,", quality: ").concat(e," ")),this.eventEmitter.emit(uT.NET_QUALITY,e),this.loadingconfig.netQualityLoading&&this.eventEmitter.emit(uT.VIDEO_STUCK,e<=dT.NETWORK_QUALITY_UNKNOW||e>=this.loadingconfig.netQualityLoadingThreshold)),this.preNetQuality=e})).finally(this.netQualityRegularReport.bind(this))}),1e3)}checkRecover(e){e?(delete this.startPlayOptions.recover,this.playOption=Mk(Mk({},this.startPlayOptions),{autoPlay:!0})):this.playOption=this.startPlayOptions}async initPeerConnection(e){var t,r,n,i;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tT.COMMON_STANDARD,s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;this.recoveryInfo.recoveryUrl=e,s.sessionId&&!o||(s.sessionId=X_.generateStandardUuid()),s.domainPolicy=s.domainPolicy||mT.USER_DOMIAN,s.schedulePolicy=s.schedulePolicy||gT.DNS,this.startPlayOptions=s;const l=s.recover;this.checkRecover(l),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&MR.preLoadPoster(this.startPlayOptions.poster.url),this.loadingconfig=Mk(Mk({},{netQualityLoading:!1,netQualityLoadingThreshold:dT.NETWORK_QUALITY_BAD}),Lb.getParameter(bb)||{}),await this.connectionsManager.initConnectionAndSdp({receiveVideo:!1!==(null===(t=this.startPlayOptions.webrtcConfig)||void 0===t?void 0:t.receiveVideo),receiveAudio:!1!==(null===(r=this.startPlayOptions.webrtcConfig)||void 0===r?void 0:r.receiveAudio)},{onTrackHandler:this.onTrackHandler.bind(this)});const c=this.connectionsManager.modifySdpCandidates(),u=[],d=[];if(a===tT.COMMON_STANDARD){const{policy:t,userIp:r,routeType:n}=await this.getPullStreamDomain(e,s,u);XT.getInstance(this.identifiedId).updateClientAddr(r);for(let e of this.domains)/^https?:\/\/.+/g.test(e)||(e="https://".concat(e)),d.push(/\/pullstream\??/.test(e)?e:"".concat(e).concat(Oh.NEGOTIATE_SDP_URL_PATH));t&&(e="".concat(e).concat(e.indexOf("?")>0?"&":"?","policy=").concat(t)),this.setInputParams(e,n)}else d.push(e),this.setInputParams(e);const h=await this.negotiateSDP(d,e,{offerSdp:c,sdpNegotiateMode:a,sessionId:s.sessionId,joinQos:u,autoRetry:l});if(null===h)return void $_.error(Nk,"answerSdp is null");const f=XT.getInstance(this.identifiedId).getSfuInfo();f.aSsrc&&f.vSsrc||!1===(null===(n=this.startPlayOptions.webrtcConfig)||void 0===n?void 0:n.receiveVideo)||!1===(null===(i=this.startPlayOptions.webrtcConfig)||void 0===i?void 0:i.receiveAudio)||(this.connectionsManager.destroyPeerConnection(),await this.connectionsManager.initConnectionAndSdp({receiveVideo:!!f.vSsrc,receiveAudio:!!f.aSsrc},{onTrackHandler:this.onTrackHandler.bind(this)})),this.addStartPlayEvent(!!f.aSsrc,!!f.vSsrc),await this.connectionsManager.handleAnswerSdpFromServer(h)}addStartPlayEvent(e,t){e&&(super.off(uT.AUDIO_START,this.firstFrameHandler.audioHandler),super.once(uT.AUDIO_START,this.firstFrameHandler.audioHandler),GT.off("audio_start_".concat(this.connectionsManager.getConnectionId())),GT.on("audio_start_".concat(this.connectionsManager.getConnectionId()),(()=>{this.eventEmitter.listeners(uT.AUDIO_START).find((e=>e===this.firstFrameHandler.audioHandler))&&this.eventEmitter.emit(uT.AUDIO_START)}))),t&&(super.off(uT.VIDEO_START,this.firstFrameHandler.videoHandler),super.once(uT.VIDEO_START,this.firstFrameHandler.videoHandler),GT.off("video_start_".concat(this.connectionsManager.getConnectionId())),GT.on("video_start_".concat(this.connectionsManager.getConnectionId()),(()=>{this.eventEmitter.listeners(uT.VIDEO_START).find((e=>e===this.firstFrameHandler.videoHandler))&&this.eventEmitter.emit(uT.VIDEO_START)})),GT.off("video_broken_".concat(this.connectionsManager.getConnectionId())),GT.on("video_broken_".concat(this.connectionsManager.getConnectionId()),(()=>{this.recoveryInfo.recoveryTimer||0!=this.recoveryInfo.retryTimes?$_.info(Nk,"the recovery timer is running..."):this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,this.videoRecoveryInfo.interval,this.videoRecoveryInfo.retryTimes)})))}async getPullStreamDomain(e,t,r){const n=Lb.getParameter(Tb);if(n)this.domains=[n];else if(t.domainPolicy===mT.SHARE_DOMAIN)this.domains=Oh.SHARE_PULL_DOMAIN;else{const t=/(?:webrtc):\/\/([^\/]+)\/.*/gi.exec(e);t&&2===t.length&&(this.domains=[t[1]])}const i={policy:null,userIp:null,routeType:hT.DNS};try{if(XT.getInstance(this.identifiedId).updatePlayTrackKpi("glsbRequest"),t.schedulePolicy===gT.HTTPDNS){let e=Lb.getParameter(Ab)||Oh.GSLB_DOMAIN;/^https?:\/\/.+/g.test(e)||(e="https://".concat(e));const t="".concat(e,"/v1/live/dns?dns=").concat(this.domains[0],"&withdomain=1&dualstack=1");if(t===X_.responeInfo.gslbRequestUrl)this.gslbResponeProcess(X_.responeInfo.respone,i);else{const e=await H_.fetch([t],{method:"GET",mode:"cors"},{"Content-Type":"application/json"},Oh.GSLB_REQUEST_TIMEOUT,1,r);this.gslbResponeProcess(e,i),X_.gslbResponeConfigurationEnvironment(e)}}}catch(Wk){$_.error(Nk,"gslb request failed: ".concat(Wk))}finally{XT.getInstance(this.identifiedId).updatePlayTrackKpi("glsbRespone"),i.routeType!==hT.GSLB&&this.domains&&this.domains.length>0&&pk.dnsQuery(this.domains).then((e=>{$_.info(Nk,"dnsQuery get ip:".concat(e)),XT.getInstance(this.identifiedId).updateAccessAddr(e)}))}return i}gslbResponeProcess(e,t){var r;if(200===e.httpCode&&0===(null===(r=e.data)||void 0===r?void 0:r.errno)){const r=e.data.data[this.domains[0]],n=[];if(n.push(...(null==r?void 0:r.ips)||[],...(null==r?void 0:r.ipv6s)||[]),n.length>0){$_.debug(Nk,"gslb respone handle");const{ip:i,domain:a}=n[0];XT.getInstance(this.identifiedId).updateAccessAddr(i),this.domains=[a],t.policy=r.policy,t.userIp=e.data.user_ip,t.routeType=hT.GSLB}}else $_.error(Nk,"gslb respone data error")}setInputParams(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hT.DNS;const r={sessionId:this.startPlayOptions.sessionId,routeType:t},n=/(?:webrtc|http(?:s?)):\/\/([^\/]+)\/([^\/]+)\/([^?]+).*/gi.exec(e);n&&4===n.length?(r.streamDomain=n[1],r.appName=n[2],r.streamName=n[3].replace(/\..*/,""),$_.setExtraInfos({domain:r.streamDomain,appName:r.appName,streamName:r.streamName,svrsid:r.sessionId})):$_.info(Nk,"get domain / appName / streamName failed"),XT.getInstance(this.identifiedId).setStreamParams(r)}async negotiateSDP(e,t,r){$_.info(Nk,"[KPI] negotiateSDP begin"),XT.getInstance(this.identifiedId).updatePlayTrackKpi("negotiateSDPRequest");const n={httpCode:-1,retCode:-1,retMsg:""},i=this.setSdpInfo(t,r);$_.info(Nk,"fetch sdp request: ".concat(JSON.stringify(i))),r.joinQos.push({offersdp:r.offerSdp});try{return await this.getAnswerSdp(e,t,r,i,n)}catch(Wk){$_.error(Nk,"[KPI] negotiateSDP occur error: ".concat(Wk));const t=Wk.getCode?Wk.getCode():Wk.name;if(-1===n.httpCode&&(n.httpCode=t),-1===n.retCode&&(n.retCode=t,n.retMsg=Wk.getMsg?Wk.getMsg():Wk.message),this.canDowngrade(this.startPlayOptions)&&n.retCode>=400)return this.eventEmitter.emit(yT),null;throw Wk}finally{var a;null===(a=XT.getInstance(this.identifiedId))||void 0===a||a.updatePlayTrackKpi("negotiateSDPRespone"),setTimeout((()=>{this.stats.reportStartPullStreamReqEvent({httpCode:n.httpCode,retCode:n.retCode,retMsg:n.retMsg,joinQos:r.joinQos,autoRetry:r.autoRetry?1:0})}),1e3)}}async getAnswerSdp(e,t,r,n,i){var a;let s=await this.tryNegotiateFetch(e,r,n,!0);if(this.errMap.get(s.data.errcode||s.data.code)===Dh.HWLLS_ERROR_ENCODING_NOT_ACCEPTED&&($_.error(Nk,"".concat(Ph[Dh.HWLLS_ERROR_ENCODING_NOT_ACCEPTED])),s=await this.tryNegotiateFetch(e,r,n,!1)),i.httpCode=s.httpCode,$_.setExtraInfos({svrsid:s.data.svrsid}),XT.getInstance(this.identifiedId).setPullMediaParams({svrSid:s.data.svrsid,svrsig:s.data.svrsig,streamUrl:t,clientAddr:s.data.clientaddr}),i.retCode=isNaN(s.data.errcode)?s.data.code:s.data.errcode,i.retMsg=s.data.message||s.data.errmsg,0!==i.retCode&&200!==i.retCode)throw this.errMap.get(i.retCode)?new xh(this.errMap.get(i.retCode)):new xh(Dh.HWLLS_INTERNAL_ERROR,"".concat(i.retCode," _ ").concat(i.retMsg));const o=(s.data.remotesdp||s.data.remoteSdp).sdp;return null===(a=XT.getInstance(this.identifiedId))||void 0===a||a.setSfuInfo(this.connectionsManager.getSfuInfoFromSdp(o)),o}setSdpInfo(e,t){let r;return r=t.sdpNegotiateMode===tT.COMMON_STANDARD?{sessionid:t.sessionId,streamurl:e,localsdp:{type:"offer",sdp:t.offerSdp}}:{version:"v1.0",sessionId:t.sessionId,localSdp:{type:"offer",sdp:t.offerSdp}},r}async tryNegotiateFetch(e,t,r,n){const i={request:JSON.stringify(r),header:{"Content-Type":"application/json"}};if(n)try{const e=DI.gzip(i.request,{to:"string"});i.request=e,i.header["Content-Encoding"]="gzip"}catch(Wk){$_.error(Nk,"negotiateSDP gzip request failed")}const a=await H_.fetch(e,{method:"POST",body:i.request,mode:"cors"},i.header,Oh.PULLSTREAM_REQUEST_TIMEOUT,this.startPlayOptions.domainPolicy===mT.SHARE_DOMAIN?vT.SHARE_DOMAIN_RETRY_TIMES:vT.USER_DOMAIN_RETRY_TIMES,t.joinQos);if($_.info(Nk,"[KPI] negotiateSDP get respone: ".concat(JSON.stringify(a))),200!==a.httpCode)throw new xh(Dh.HWLLS_ERROR_SERVER_CONNECT_FAIL);if(!a.data||"{}"===JSON.stringify(a.data))throw $_.error(Nk,"negotiateSDP, respone is null"),new xh(Dh.HWLLS_INTERNAL_ERROR,"respone is null");return a}async stopSignal(){var e;const t=null===(e=XT.getInstance(this.identifiedId))||void 0===e?void 0:e.getPullMediaParams();if(null!=t&&t.svrsig)for(let r of this.domains)try{/^https?:\/\/.+/g.test(r)||(r="https://".concat(r));const e=/\/pullstream\??/.test(r)?r.replace(/(https?:\/\/[^\/]*)\/.*/g,"$1".concat(Oh.STOP_PLAY_URL_PATH)):"".concat(r).concat(Oh.STOP_PLAY_URL_PATH);await H_.fetch([e],{method:"POST",body:JSON.stringify({streamurl:t.streamUrl,svrsig:t.svrsig}),mode:"cors"},{"Content-Type":"application/json"});break}catch(Wk){$_.warn(Nk,"stop stream signal failed: ".concat(Wk))}else $_.warn(Nk,"stop stream signal failed, svrsig is null.")}onTrackHandler(e){$_.info(Nk,"peerconnection ontrack event: ".concat(e.track.kind));const t=e.track.kind;if(t===rT.TRACK_TYPE_VIDEO||t===rT.TRACK_TYPE_AUDIO){var r,n,i;this.liveStream||(this.liveStream=new tA(this.stats,this.eventEmitter)),this.liveStream.addRemoteTrack(e.track);const a=t===rT.TRACK_TYPE_VIDEO;a&&(GT.off("video_stuck_".concat(this.connectionsManager.getConnectionId())),GT.on("video_stuck_".concat(this.connectionsManager.getConnectionId()),(e=>{!e&&this.loadingconfig.netQualityLoading&&this.preNetQuality>=this.loadingconfig.netQualityLoadingThreshold||this.eventEmitter.emit(uT.VIDEO_STUCK,e)})),GT.off("video_broken_".concat(this.connectionsManager.getConnectionId())),GT.on("video_broken_".concat(this.connectionsManager.getConnectionId()),(()=>{this.recoveryInfo.recoveryTimer||0!=this.recoveryInfo.retryTimes?$_.info(Nk,"video broken, the recovery timer is running..."):this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,this.videoRecoveryInfo.interval,this.videoRecoveryInfo.retryTimes)})));const s=null===(r=XT.getInstance(this.identifiedId))||void 0===r?void 0:r.getSfuInfo(),o=null===(n=XT.getInstance(this.identifiedId))||void 0===n?void 0:n.getStreamParams(),l=null===(i=XT.getInstance(this.identifiedId))||void 0===i?void 0:i.getPullMediaParams();this.liveStream.play(Mk(Mk({},this.playOption),{},{audio:!a,video:a})).catch((e=>{if(e instanceof xh&&(e.getCode()===Dh.HWLLS_PLAY_NOT_ALLOW||/The operation was aborted/gi.test(e.getMsg())))this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()});else{let r=iT.FAIL;if(e instanceof xh)if(e.getCode()!==Dh.HWLLS_PLAY_TIMEOUT){if(/interrupted by a new load request/gi.test(e.getMsg())&&(r=iT.INTERRUPT),a&&s.aSsrc){this.eventEmitter.listeners(uT.AUDIO_START).find((e=>e===this.firstFrameHandler.audioHandler))&&this.stats.reportPullMediaStreamResult(rT.TRACK_TYPE_AUDIO,r,{playTrackKpi:this.prePlayTrackCache,sfuInfo:s,streamParams:o,mediaParams:l})}this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()})}else{if(this.connectionsManager.isConnectionEstablished()||(r=iT.CONNECTION_UNCOMPLETE),a&&s.aSsrc){this.eventEmitter.listeners(uT.AUDIO_START).find((e=>e===this.firstFrameHandler.audioHandler))&&(XT.getInstance(this.identifiedId).updatePlayTrackKpi("audioTimeOut"),this.stats.reportPullMediaStreamResult(rT.TRACK_TYPE_AUDIO,r,{playTrackKpi:this.prePlayTrackCache,sfuInfo:s,streamParams:o,mediaParams:l}))}XT.getInstance(this.identifiedId).updatePlayTrackKpi("".concat(a?"video":"audio","TimeOut")),this.receivedFirstFrame||this.eventEmitter.emit(yT,e)}else this.eventEmitter.emit("Error",{errCode:Dh.HWLLS_INTERNAL_ERROR,errDesc:Ph[Dh.HWLLS_INTERNAL_ERROR]});this.stats.reportPullMediaStreamResult(t,r,{playTrackKpi:this.prePlayTrackCache,sfuInfo:s,streamParams:o,mediaParams:l})}})),this.stats.startMediaStatistic()}}resetClient4Switch(){var e;this.stats.cancelMediaStatistic(),this.connectionsManager.destroyPeerConnection(),this.prePlayTrackCache=null===(e=XT.getInstance(this.identifiedId))||void 0===e?void 0:e.getPlayTrackKpi(),XT.delInstance(this.identifiedId),clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0}resetClient4Stop(){var e,t;this.stats.cancelMediaStatistic(),this.connectionsManager.destroyPeerConnection(),this.prePlayTrackCache=null===(e=XT.getInstance(this.identifiedId))||void 0===e?void 0:e.getPlayTrackKpi(),XT.delInstance(this.identifiedId),clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),clearTimeout(this.netQualityTimer),this.netQualityTimer=null,this.preNetQuality=dT.NETWORK_QUALITY_INIT,clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0,this.recoveryInfo.recoveryUrl=null,null===(t=this.liveStream)||void 0===t||t.destory(),this.liveStream=null,this.startPlayOptions=null}resetClient(e){var t,r;this.stats.cancelMediaStatistic(),this.connectionsManager.destroyPeerConnection(),this.prePlayTrackCache=null===(t=XT.getInstance(this.identifiedId))||void 0===t?void 0:t.getPlayTrackKpi(),e||XT.delInstance(this.identifiedId),clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.netQualityTimer),this.netQualityTimer=null,clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0,this.recoveryInfo.recoveryUrl=null,null===(r=this.liveStream)||void 0===r||r.destory(),this.liveStream=null,this.startPlayOptions=null,this.preNetQuality=dT.NETWORK_QUALITY_INIT}getStreamStatisticInfo(e,t){this.debugStatisticTimer.interval=t,this.debugStatisticTimer.timer=setTimeout((()=>{clearTimeout(this.debugStatisticTimer.timer);const r=XT.getInstance(this.identifiedId).getSfuInfo(),n={};if(r.aSsrc){const i=WT.getLeastestAudioInfo(this.connectionsManager.getConnectionId(),r.aSsrc),a=XT.getInstance(this.identifiedId).getMediaFreezeStatistic(rT.TRACK_TYPE_AUDIO);if(i){const r=0!==e.audioReceiveBytes?Math.round(8*(X_.getValue(i.bytesReceived,0)-e.audioReceiveBytes)/1e3):0;n.audio={mediaType:rT.TRACK_TYPE_AUDIO,codec:"OPUS",bitRate:Math.round(1e3*r/(1e3*t)),packetsLost:Math.max(X_.getValue(i.packetsLost,0),0),jitter:Math.floor(1e3*X_.getValue(i.jitter,0)),bytesReceived:X_.getValue(i.bytesReceived,0),packetsReceived:X_.getValue(i.packetsReceived,0),freeze200Count:a.freeze200Count,freeze200Duration:a.freeze200Duration},e.audioReceiveBytes=X_.getValue(i.bytesReceived,0)}}if(r.vSsrc){const i=WT.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),r.vSsrc);if(i){const r=0!==e.videoReceiveBytes?Math.round(8*(X_.getValue(i.bytesReceived,0)-e.videoReceiveBytes)/1e3):0,a=0!==e.videoFrames?X_.getValue(i.framesDecoded,0)-e.videoFrames:0;e.videoFrames=X_.getValue(i.framesDecoded,0);const s=XT.getInstance(this.identifiedId).getMediaFreezeStatistic(rT.TRACK_TYPE_VIDEO);n.video={mediaType:rT.TRACK_TYPE_VIDEO,codec:"H264",jitter:Math.floor(1e3*X_.getValue(i.jitter,0)),bitRate:Math.round(1e3*r/(1e3*t)),bytesReceived:X_.getValue(i.bytesReceived,0),packetsReceived:X_.getValue(i.packetsReceived,0),packetsLost:Math.max(X_.getValue(i.packetsLost,0),0),frameRate:Math.ceil(1e3*a/(1e3*t)),width:X_.getValue(i.frameWidth,0),height:X_.getValue(i.frameHeight,0),freeze200Count:s.freeze200Count,freeze200Duration:s.freeze200Duration,freeze600Count:s.freeze600Count,freeze600Duration:s.freeze600Duration},e.videoReceiveBytes=X_.getValue(i.bytesReceived,0)}}this.eventEmitter.emit(uT.MEDIA_STATISTIC,n),this.getStreamStatisticInfo(e,t)}),1e3*t)}canDowngrade(e){return!(!e.downgradeUrl||!e.downgradeUrl.hlsUrl&&!e.downgradeUrl.flvUrl)}async checkDowngrade(e){this.eventEmitter.once(yT,(()=>{this.downgraded=!0,window.onbeforeunload=null,this.resetClient(!0)})),this.autoDowngradeManager=new ik(e,this.eventEmitter);let t=!1;if(!this.canDowngrade(e))return $_.error(Nk,"user has not set downgrade url"),t;try{await cS.checkSystemRequirements()}catch(pL){$_.error(Nk,"checkSystemRequirements failed, ".concat(pL.toString())),this.eventEmitter.emit(yT,pL),t=!0}return t}},t(Pk.prototype,"startPlay",[mk],Object.getOwnPropertyDescriptor(Pk.prototype,"startPlay"),Pk.prototype),t(Pk.prototype,"startPlayCustomize",[gk],Object.getOwnPropertyDescriptor(Pk.prototype,"startPlayCustomize"),Pk.prototype),t(Pk.prototype,"switchPlay",[vk],Object.getOwnPropertyDescriptor(Pk.prototype,"switchPlay"),Pk.prototype),t(Pk.prototype,"stopPlay",[yk],Object.getOwnPropertyDescriptor(Pk.prototype,"stopPlay"),Pk.prototype),t(Pk.prototype,"replay",[_k],Object.getOwnPropertyDescriptor(Pk.prototype,"replay"),Pk.prototype),t(Pk.prototype,"resume",[Ek],Object.getOwnPropertyDescriptor(Pk.prototype,"resume"),Pk.prototype),t(Pk.prototype,"pause",[Sk],Object.getOwnPropertyDescriptor(Pk.prototype,"pause"),Pk.prototype),t(Pk.prototype,"pauseVideo",[bk],Object.getOwnPropertyDescriptor(Pk.prototype,"pauseVideo"),Pk.prototype),t(Pk.prototype,"resumeVideo",[Tk],Object.getOwnPropertyDescriptor(Pk.prototype,"resumeVideo"),Pk.prototype),t(Pk.prototype,"pauseAudio",[Rk],Object.getOwnPropertyDescriptor(Pk.prototype,"pauseAudio"),Pk.prototype),t(Pk.prototype,"resumeAudio",[Ak],Object.getOwnPropertyDescriptor(Pk.prototype,"resumeAudio"),Pk.prototype),t(Pk.prototype,"setPlayoutVolume",[wk],Object.getOwnPropertyDescriptor(Pk.prototype,"setPlayoutVolume"),Pk.prototype),t(Pk.prototype,"getPlayoutVolume",[Lk],Object.getOwnPropertyDescriptor(Pk.prototype,"getPlayoutVolume"),Pk.prototype),t(Pk.prototype,"muteAudio",[Ck],Object.getOwnPropertyDescriptor(Pk.prototype,"muteAudio"),Pk.prototype),t(Pk.prototype,"streamStatistic",[Ik],Object.getOwnPropertyDescriptor(Pk.prototype,"streamStatistic"),Pk.prototype),t(Pk.prototype,"destoryClient",[kk],Object.getOwnPropertyDescriptor(Pk.prototype,"destoryClient"),Pk.prototype),t(Pk.prototype,"fullScreenToggle",[Ok],Object.getOwnPropertyDescriptor(Pk.prototype,"fullScreenToggle"),Pk.prototype),t(Pk.prototype,"enableStreamStateDetection",[Dk],Object.getOwnPropertyDescriptor(Pk.prototype,"enableStreamStateDetection"),Pk.prototype),Pk);var Uk,Bk,jk,Hk,Vk,Gk,zk;const Kk=new(Uk=xb("HWLLSEnter$getVersion#string#void"),Bk=Pb("HWLLSEnter$checkSystemRequirements#Promise<boolean>#void"),jk=xb("HWLLSEnter$setParameter#boolean#string#string"),Hk=xb("HWLLSEnter$createClient#HWLLSClient|HWFlvClient#void"),Vk=xb("HWLLSEnter$uploadLog#Promise<void>#void"),Gk=xb("HWLLSEnter$setLogLevel#boolean#string"),t((zk=class extends tR{constructor(){super("HWLLSEnter"),X_.configurationEnvironment()}getVersion(){return Oh.SDK_VERSION}async checkSystemRequirements(){return await cS.checkSystemRequirements()}setParameter(e,t){return Lb.setParameter(e,t)}createClient(e){if(!e||e===pT.WEBRTC)return new Fk;if(e===pT.HLS&&cS.hlsCapabilityCheck())return new rk;if(e===pT.FLV&&cS.flvCapabilityCheck())return new MI;throw new xh(Dh.HWLLS_ERROR_INVALID_PARAMETER)}uploadLog(){return $_.uploadLog()}async saveLog(){return(await $_.getLogFileInfo()).content}setLogLevel(e){return $_.setLogLevel(e)}}).prototype,"getVersion",[Uk],Object.getOwnPropertyDescriptor(zk.prototype,"getVersion"),zk.prototype),t(zk.prototype,"checkSystemRequirements",[Bk],Object.getOwnPropertyDescriptor(zk.prototype,"checkSystemRequirements"),zk.prototype),t(zk.prototype,"setParameter",[jk],Object.getOwnPropertyDescriptor(zk.prototype,"setParameter"),zk.prototype),t(zk.prototype,"createClient",[Hk],Object.getOwnPropertyDescriptor(zk.prototype,"createClient"),zk.prototype),t(zk.prototype,"uploadLog",[Vk],Object.getOwnPropertyDescriptor(zk.prototype,"uploadLog"),zk.prototype),t(zk.prototype,"setLogLevel",[Gk],Object.getOwnPropertyDescriptor(zk.prototype,"setLogLevel"),zk.prototype),zk);return{getVersion:Kk.getVersion.bind(Kk),checkSystemRequirements:Kk.checkSystemRequirements.bind(Kk),setParameter:Kk.setParameter.bind(Kk),createClient:Kk.createClient.bind(Kk),saveLog:Kk.saveLog.bind(Kk),setLogLevel:Kk.setLogLevel.bind(Kk),uploadLog:Kk.uploadLog.bind(Kk)}}));
